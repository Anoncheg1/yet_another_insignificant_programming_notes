<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2025-01-14 Tue 12:52 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>&lrm;</title>
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="content" class="content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org4b69ead">1. tty - teletype or terminal</a>
<ul>
<li><a href="#orgb40fce9">1.1. keys</a>
<ul>
<li><a href="#orgbb0fc98">1.1.1. Caret notation</a></li>
<li><a href="#orga36041b">1.1.2. my collected</a></li>
<li><a href="#orgadecc97">1.1.3. special Bash keys</a></li>
<li><a href="#orgb4c1c8f">1.1.4. History:</a></li>
<li><a href="#orgc9f1b30">1.1.5. Process control:</a></li>
<li><a href="#orga6bd60b">1.1.6. Moving the cursor:</a></li>
<li><a href="#org12b6ad3">1.1.7. Editing:</a></li>
</ul>
</li>
<li><a href="#org189fbfc">1.2. how it works</a></li>
<li><a href="#org0fbdf5d">1.3. terminal related commands:</a></li>
<li><a href="#org582fd60">1.4. escape codes</a></li>
<li><a href="#org07b94e1">1.5. <span class="todo TODO">TODO</span> POSIX terminal interface</a></li>
<li><a href="#org6c3949b">1.6. pseudo-teletypes (PTS)</a></li>
<li><a href="#org22a5f53">1.7. history links</a></li>
<li><a href="#orgb408955">1.8. tty scroll</a>
<ul>
<li><a href="#org5c88f61">1.8.1. screen</a></li>
</ul>
</li>
<li><a href="#orge169bb7">1.9. clipboard</a></li>
<li><a href="#org0e6eb5d">1.10. keymaps, dvorak</a></li>
<li><a href="#org0f2030a">1.11. ASCII</a></li>
</ul>
</li>
<li><a href="#orgeaf2832">2. shell</a>
<ul>
<li><a href="#org370be30">2.1. variables</a></li>
<li><a href="#orgda09c95">2.2. Enveronmental Variables</a></li>
<li><a href="#org9ce1c98">2.3. Wildcard</a>
<ul>
<li><a href="#orgfa2999b">2.3.1. Standard Wildcards (globbing patterns)</a></li>
<li><a href="#org6e9fa16">2.3.2. advanced</a></li>
<li><a href="#org2ed49ce">2.3.3. classes</a></li>
<li><a href="#orga6e2dcf">2.3.4. links</a></li>
</ul>
</li>
<li><a href="#org3d73a76">2.4. {} Curly Braces</a></li>
<li><a href="#org7d01593">2.5. {} Brace Expansion</a></li>
<li><a href="#orgdbd9cf9">2.6. Extended globs</a></li>
<li><a href="#org34d6bf0">2.7. stdin(0), stdout(1), and stderr(2), pipes</a>
<ul>
<li><a href="#orgeba692f">2.7.1. pipeline</a></li>
<li><a href="#orgfd5b230">2.7.2. redirection</a></li>
<li><a href="#org2632e7f">2.7.3. close file descriptors/streams</a></li>
<li><a href="#orgc2bb308">2.7.4. "2&gt;&amp;1 &gt;file" vs "&gt; file 2&gt;&amp;1"</a></li>
<li><a href="#org1e6174f">2.7.5. stderr to pipe</a></li>
<li><a href="#orge95c2b6">2.7.6. redirect stdout to file and to stdout</a></li>
<li><a href="#org85309c4">2.7.7. named pipe</a></li>
<li><a href="#org9ef57d3">2.7.8. not all output?</a></li>
</ul>
</li>
<li><a href="#orge5a16ac">2.8. String processing</a>
<ul>
<li><a href="#org6328fff">2.8.1. multiline string - HereDoc</a></li>
<li><a href="#org3da81fe">2.8.2. sort</a></li>
<li><a href="#org79c9a92">2.8.3. cut - get column</a></li>
<li><a href="#orgd05a1e4">2.8.4. sed</a></li>
<li><a href="#orga704e08">2.8.5. grep</a></li>
<li><a href="#orgf160d7f">2.8.6. python</a></li>
<li><a href="#org95cf77c">2.8.7. perl</a></li>
<li><a href="#org3962a66">2.8.8. awk</a></li>
<li><a href="#orge0b9052">2.8.9. uniq</a></li>
<li><a href="#org4b01b7d">2.8.10. strip remove leading and trailing white spaces</a></li>
<li><a href="#org16fc79a">2.8.11. tail</a></li>
</ul>
</li>
<li><a href="#org31f8664">2.9. Process Control</a></li>
<li><a href="#orge81fc41">2.10. Programming</a>
<ul>
<li><a href="#org0674648">2.10.1. shebang</a></li>
<li><a href="#org074db0d">2.10.2. pros and cons</a></li>
<li><a href="#org5a635dd">2.10.3. Hello World.sh, scriptinga</a></li>
<li><a href="#org614bcb5">2.10.4. arguments</a></li>
<li><a href="#org0b793ad">2.10.5. array</a></li>
<li><a href="#org6e99b52">2.10.6. comparision Posix</a></li>
<li><a href="#orgdb29a13">2.10.7. numbers comparision</a></li>
<li><a href="#org05e3829">2.10.8. strings comparision</a></li>
<li><a href="#org374d016">2.10.9. if</a></li>
<li><a href="#orgdcb9d85">2.10.10. loop</a></li>
<li><a href="#org3311fa8">2.10.11. file comparision</a></li>
<li><a href="#orga34f5b1">2.10.12. functions</a></li>
<li><a href="#orgbe61c7f">2.10.13. debug </a></li>
<li><a href="#org4846fde">2.10.14. exit status</a></li>
<li><a href="#org7701081">2.10.15. generate random</a></li>
<li><a href="#orgd56fa26">2.10.16. documentation</a></li>
<li><a href="#orgd3004ca">2.10.17. best practices</a></li>
<li><a href="#orgcf9c587">2.10.18. export</a></li>
<li><a href="#orga9d1d1e">2.10.19. null command</a></li>
<li><a href="#org9fc9537">2.10.20. multiline comment</a></li>
<li><a href="#org36f75d3">2.10.21. read</a></li>
<li><a href="#orgd5b03b3">2.10.22. Templates</a></li>
<li><a href="#org3121e14">2.10.23. links</a></li>
</ul>
</li>
<li><a href="#org402c539">2.11. set builtin </a>
<ul>
<li><a href="#orgeb0c27f">2.11.1. usage</a></li>
<li><a href="#org49e37b0">2.11.2. traps</a></li>
</ul>
</li>
<li><a href="#org0e44ab1">2.12. ls</a>
<ul>
<li><a href="#orgc40482e">2.12.1. get direcotories</a></li>
<li><a href="#org8ffadd1">2.12.2. Linux File Timestamps</a></li>
</ul>
</li>
<li><a href="#orgdac21fb">2.13. pushd/popd and dirs</a></li>
<li><a href="#org657c10a">2.14. sh script</a></li>
<li><a href="#org224f39d">2.15. source &amp; ./ &amp; exec</a></li>
<li><a href="#orgb789acf">2.16. ariphmetic</a></li>
<li><a href="#orgda4ca81">2.17. execute command</a></li>
<li><a href="#orgf495c4e">2.18. xargs</a></li>
<li><a href="#orgdefccb7">2.19. history save with time</a></li>
<li><a href="#orgc1d6388">2.20. id -u user</a></li>
<li><a href="#org686a4bb">2.21. diff</a></li>
<li><a href="#orgdd83a06">2.22. date</a></li>
<li><a href="#org0911f8e">2.23. ps </a>
<ul>
<li><a href="#orgb13eb93">2.23.1. Column	Description</a></li>
<li><a href="#orga00db97">2.23.2. stat code with description</a></li>
</ul>
</li>
<li><a href="#orgf56289e">2.24. top </a>
<ul>
<li><a href="#orgbb89ca5">2.24.1. view description</a></li>
</ul>
</li>
<li><a href="#org17ea2a7">2.25. pgrep</a></li>
<li><a href="#org972fb99">2.26. vmstat</a></li>
<li><a href="#orgf573286">2.27. pmap</a></li>
<li><a href="#org78bddcb">2.28. find</a>
<ul>
<li><a href="#org9ffe2c2">2.28.1. find [options] [starting-point&#x2026;] [ex‐pression]</a></li>
<li><a href="#org8c2d212">2.28.2. links</a></li>
</ul>
</li>
<li><a href="#orgc9ff91d">2.29. dd</a>
<ul>
<li><a href="#org1ad68c0">2.29.1. usecases</a></li>
<li><a href="#orgcd1afcc">2.29.2. bs</a></li>
<li><a href="#org5699861">2.29.3. cteate disk</a></li>
</ul>
</li>
<li><a href="#org7228bd5">2.30. access control to files</a></li>
<li><a href="#org8b22236">2.31. for external storages</a></li>
<li><a href="#orgb93638b">2.32. filesystem block size</a></li>
<li><a href="#org0f496f3">2.33. tar</a></li>
<li><a href="#orgf53b46f">2.34. compression</a>
<ul>
<li><a href="#orgb7f786b">2.34.1. tar.7z</a></li>
<li><a href="#orgb0e0cb6">2.34.2. zip</a></li>
<li><a href="#org21e7aa4">2.34.3. links</a></li>
</ul>
</li>
<li><a href="#orgc857e9c">2.35. curl</a>
<ul>
<li><a href="#orga0b8295">2.35.1. SOCKS5 proxy</a></li>
<li><a href="#orgc77829c">2.35.2. mimic browser request:</a></li>
<li><a href="#org2fb931e">2.35.3. POST GET</a></li>
<li><a href="#org913f084">2.35.4. POST paramters</a></li>
<li><a href="#org5a9c930">2.35.5. FTP</a></li>
</ul>
</li>
<li><a href="#orga5209f2">2.36. du - file space usage</a></li>
<li><a href="#org6d8355a">2.37. man, info, help</a>
<ul>
<li><a href="#orgdb2b7d4">2.37.1. history</a></li>
<li><a href="#org4f25a95">2.37.2. man</a></li>
<li><a href="#orga7b0b58">2.37.3. info </a></li>
</ul>
</li>
<li><a href="#orgcbedb7a">2.38. less</a></li>
<li><a href="#org12684f7">2.39. date</a></li>
<li><a href="#org19269f4">2.40. tee</a>
<ul>
<li><a href="#orgb0c0d90">2.40.1. freeze problem</a></li>
</ul>
</li>
<li><a href="#org419d03b">2.41. time</a></li>
<li><a href="#orgbf8d280">2.42. lsfd</a></li>
<li><a href="#orgbbc4a31">2.43. fuser</a></li>
<li><a href="#orgc996d92">2.44. administration commands</a>
<ul>
<li><a href="#org5821b7f">2.44.1. memory</a></li>
</ul>
</li>
<li><a href="#orgb9afc3f">2.45. USECASES</a></li>
<li><a href="#org899765d">2.46. USECASE: save output of command to cash</a></li>
<li><a href="#org41209ab">2.47. USECASE: case - set environment varibles per directory after cd command</a></li>
<li><a href="#org752bdb1">2.48. USECASE: find N last modified files in current directory and subdirs</a></li>
<li><a href="#orgeeee35a">2.49. links</a></li>
</ul>
</li>
<li><a href="#org4739f7c">3. Bash new features</a>
<ul>
<li><a href="#orgc540f97">3.1. links</a></li>
</ul>
</li>
<li><a href="#orge5e9080">4. tmux</a>
<ul>
<li><a href="#org2685fd6">4.1. status</a></li>
<li><a href="#org57a54e5">4.2. terms</a></li>
<li><a href="#orgf6907d7">4.3. keys</a></li>
<li><a href="#org4d8bc03">4.4. commands</a></li>
<li><a href="#org95c848f">4.5. xorg start and terminal unused</a></li>
<li><a href="#org8bcc2a3">4.6. xorg system clipboard - How to copy to clipboard?</a></li>
<li><a href="#org5279b3a">4.7. kill deattached sessions</a></li>
<li><a href="#org93f5491">4.8. option</a></li>
<li><a href="#org9b42904">4.9. rebind keys</a></li>
</ul>
</li>
<li><a href="#org5481568">5. SSH</a>
<ul>
<li><a href="#orgcad8fc4">5.1. config files</a></li>
<li><a href="#orgf404acc">5.2. permissions</a></li>
<li><a href="#orgbb73a63">5.3. authentication types</a></li>
<li><a href="#org0cc8441">5.4. usage</a></li>
<li><a href="#org68c03f4">5.5. commands</a></li>
<li><a href="#org6a655b2">5.6. 1) ssh server - password</a></li>
<li><a href="#org161d7c7">5.7. 2) ssh server - generate key - public key and private key</a></li>
<li><a href="#orgca2a192">5.8. 3) sftp server</a></li>
<li><a href="#orgcbfeb30">5.9. 4) X11 Forwarding</a></li>
<li><a href="#org5c4bb06">5.10. 5) sshfs - client</a></li>
<li><a href="#orga4fef71">5.11. <span class="todo TODO">TODO</span> Internet over socks</a></li>
<li><a href="#orga29a232">5.12. DNS over socks</a></li>
<li><a href="#orgcf2300e">5.13. ssh-agent</a></li>
<li><a href="#org462cadf">5.14. agent forwarding problem</a></li>
<li><a href="#orge2641e5">5.15. ssh-copy-id</a></li>
<li><a href="#orge0849ae">5.16. inside of ssh</a></li>
<li><a href="#orgf2d000e">5.17. old</a></li>
<li><a href="#orgc9cec63">5.18. githib ~/.ssh/config</a></li>
<li><a href="#orgf1b4503">5.19. key type</a></li>
<li><a href="#orga1ad062">5.20. security</a></li>
<li><a href="#org274104f">5.21. Port Forwarding/Tunneling</a>
<ul>
<li><a href="#org0571d16">5.21.1. Local</a></li>
<li><a href="#org205db21">5.21.2. Remote</a></li>
<li><a href="#orge08efeb">5.21.3. Dynamic</a></li>
<li><a href="#orgea14aeb">5.21.4. examples</a></li>
</ul>
</li>
<li><a href="#org72429c7">5.22. Reverse SSH Tunnel</a></li>
<li><a href="#org6c9ad97">5.23. USE CASES</a></li>
<li><a href="#org76c2e4f">5.24. rsync</a>
<ul>
<li><a href="#orgdca80ba">5.24.1. troubleshooting</a></li>
</ul>
</li>
<li><a href="#org364dfdd">5.25. user with limited permissions</a></li>
<li><a href="#org9b6452c">5.26. links</a></li>
<li><a href="#org57dd1f7">5.27. ssh over socks5</a></li>
<li><a href="#orge0e5780">5.28. problems</a></li>
<li><a href="#org1408c25">5.29. ssh as a tor hidden service </a></li>
<li><a href="#orgad1f13a">5.30. ssh systemd service</a></li>
<li><a href="#orgbfa3163">5.31. rsync over ssh</a></li>
<li><a href="#org5671998">5.32. timeouts</a></li>
</ul>
</li>
<li><a href="#org0ae2905">6. Text User Interface (TUI)</a></li>
<li><a href="#org1889ee8">7. jq - JSON parser</a>
<ul>
<li><a href="#org0405d1d">7.1. output format</a></li>
<li><a href="#orgae7a53e">7.2. access</a></li>
<li><a href="#orgb326a4f">7.3. merge</a></li>
<li><a href="#orga966f41">7.4. building</a></li>
</ul>
</li>
<li><a href="#orgd0f7aae">8. fish</a></li>
<li><a href="#orgc3cf0d9">9. print JSON</a></li>
</ul>
</div>
</div>
<p>
;-<b>- mode: Org; fill-column: 110;-</b>-
</p>
<div id="outline-container-org4b69ead" class="outline-2">
<h2 id="org4b69ead"><span class="section-number-2">1.</span> tty - teletype or terminal</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-orgb40fce9" class="outline-3">
<h3 id="orgb40fce9"><span class="section-number-3">1.1.</span> keys</h3>
<div class="outline-text-3" id="text-1-1">
<ul class="org-ul">
<li><a href="https://ss64.com/bash/syntax-keyboard.html">https://ss64.com/bash/syntax-keyboard.html</a></li>
<li>$ info readline</li>
<li><a href="https://git.savannah.gnu.org/cgit/readline.git/tree/doc/rluserman.info">https://git.savannah.gnu.org/cgit/readline.git/tree/doc/rluserman.info</a></li>
<li>man termios</li>
</ul>
<p>
It's basically a device (implemented in software nowadays)
</p>
</div>
<div id="outline-container-orgbb0fc98" class="outline-4">
<h4 id="orgbb0fc98"><span class="section-number-4">1.1.1.</span> Caret notation</h4>
<div class="outline-text-4" id="text-1-1-1">
<ul class="org-ul">
<li>caret (^)</li>
</ul>

<p>
Often a control character can be typed on a keyboard by holding down the Ctrl and typing the character shown
 after the caret.
</p>

<p>
Caret notation dont support Shift key. ^K - key should be uppercase
</p>
</div>
</div>
<div id="outline-container-orga36041b" class="outline-4">
<h4 id="orga36041b"><span class="section-number-4">1.1.2.</span> my collected</h4>
<div class="outline-text-4" id="text-1-1-2">
<div class="org-src-container">
<pre class="src src-text">Ctrl+-          undo

Ctrl+[          Escape
Ctrl+I          Tab
Ctrl+M          Enter

Autocompletion:
Alt+/           autocompletion for path
Alt-*           list all completion for command/path

Ctrl+J          Newline
Ctrl+v          tells the terminal to not interpret the following character, so Ctrl+v Ctrl-I will display a tab character,
similarly Ctrl+v ENTER will display the escape sequence for the Enter key: ^M

Ctrl + C        SIGINT, Break command
Ctrl + Z        in background, commands: jobs, fg, bg
Ctrl + D        SIGTSTP, logout
Ctrl + \        SIGQUIT

Ctrl + XX       toggle cursor from current position to begining and back
Alt+U/L to UPPER/LOWER case word
Alt+C           upper first letter of word

Ctrl/Alt + D:   Delete one char/to end of word starting at the cursor

Ctrl + u/k      erase line to begining/end of line
Ctrl + w        cut word before cursor
Alt + k cut word before cursor
Alt + b         cut word after cursor
Ctrl+y          yank

Alt + c capitalize word after cursor


Ctrl+S  Stops all output on-screen (XOFF).
Ctrl+Q  Turns all output stopped on-screen back on (XON). Also, closes an application window.

Alt+SysRq+r Unraw       Take control of keyboard back from X.   4
Alt+SysRq+e Terminate   Send SIGTERM to all processes, allowing them to terminate gracefully.   64
Alt+SysRq+i Kill        Send SIGKILL to all processes, forcing them to terminate immediately.
Alt+SysRq+s Sync        Flush data to disk.     16      -
Alt+SysRq+u Unmount     Unmount and remount all filesystems read-only.  32      -
Alt+SysRq+b Reboot      Reboot  128
Alt+SysRq+k SAK
Alt+SysRq+f OOM kill
Alt+SysRq+j Thaw

X
Ctrl+Alt+F1, F2, F3, ...        Switch to n-th virtual console  If it does not work, try Ctrl+Alt+Fn+F&#8230;.
Shift+Insert    Paste text from the PRIMARY buffer

M-O     in console activates when some key is pressed and holded for some time
</pre>
</div>
<ul class="org-ul">
<li><a href="https://ss64.com/bash/syntax-keyboard.html">https://ss64.com/bash/syntax-keyboard.html</a></li>
<li><a href="https://catern.com/posts/terminal_quirks.html">https://catern.com/posts/terminal_quirks.html</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgadecc97" class="outline-4">
<h4 id="orgadecc97"><span class="section-number-4">1.1.3.</span> special Bash keys</h4>
<div class="outline-text-4" id="text-1-1-3">
<p>
<a href="https://git.savannah.gnu.org/cgit/bash.git/tree/bashline.c?id=3ba697465bc74fab513a26dea700cc82e9f4724e#n957">https://git.savannah.gnu.org/cgit/bash.git/tree/bashline.c?id=3ba697465bc74fab513a26dea700cc82e9f4724e#n957</a>
<a href="https://www.gnu.org/savannah-checkouts/gnu/bash/manual/bash.html">https://www.gnu.org/savannah-checkouts/gnu/bash/manual/bash.html</a>
C-x ~ - bash<sub>possible</sub><sub>username</sub><sub>completions</sub>
C-x @ - bash<sub>complete</sub><sub>hostname</sub>
C-x C-$ - bash<sub>complete</sub><sub>variable</sub>
C-x C-! - bash<sub>complete</sub><sub>command</sub>
C-x / - bash<sub>complete</sub><sub>filename</sub>
C-x C-e - Bash attempts to invoke $FCEDIT, $EDITOR, and emacs as the editor, in that order.
C-x C-v - Bash version
C-x C-r - re-reads this init file, thus incorporating any changes that you might have made to it.
</p>

<p>
Alt+number - repeat next key
</p>

<p>
C-_ or C-x C-u  Undo the last editing command. You can undo all the way back to an empty line.
</p>
</div>
</div>
<div id="outline-container-orgb4c1c8f" class="outline-4">
<h4 id="orgb4c1c8f"><span class="section-number-4">1.1.4.</span> History:</h4>
<div class="outline-text-4" id="text-1-1-4">
<div class="org-src-container">
<pre class="src src-text">  Ctrl + r   Recall the last command including the specified character(s).
             searches the command history as you type. Ctrl + Shift + r - reverse reverse-i-search
             Equivalent to : vim ~/.bash_history.
  Ctrl + n/p  Next/Previous command in history (i.e. walk back through the command history).

  Ctrl + s   Go back to the next most recent command.
             (beware to not execute it from a terminal because this will also launch its XOFF).
  Ctrl + o   Execute the command found via Ctrl+r or Ctrl+s
  Ctrl + g   Escape from history searching mode
        !!   Repeat last command
       !n    Repeat from the last command: args n e.g. !:2 for the second argumant.
       !n:m  Repeat from the last command: args from n to m. e.g. !:2-3 for the second and third.
       !n:$  Repeat from the last command: args n to the last argument.
       !n:p  Print last command starting with n
     !string Print the last command beginning with string.
       !:q   Quote the last command with proper Bash escaping applied.
              Tip: enter a line of Bash starting with a # comment, then run !:q on the next line to escape it.
        !$   Last argument of previous command.
   ALT + .   Last argument of previous command.
        !*   All arguments of previous command.
^abc&#173;^&#173;def   Run previous command, replacing abc with def
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc9f1b30" class="outline-4">
<h4 id="orgc9f1b30"><span class="section-number-4">1.1.5.</span> Process control:</h4>
<div class="outline-text-4" id="text-1-1-5">
<div class="org-src-container">
<pre class="src src-text">
 Ctrl + C   Interrupt/Kill whatever you are running (SIGINT).
 Ctrl + l   Clear the screen.
 Ctrl + s   Stop output to the screen (for long running verbose commands).
            Then use PgUp/PgDn for navigation.
 Ctrl + q   Allow output to the screen (if previously stopped using command above).
 Ctrl + D   Send an EOF marker, unless disabled by an option, this will close the current shell (EXIT).
 Ctrl + Z   Send the signal SIGTSTP to the current task, which suspends it.
            To return to it later enter fg 'process name' (foreground).
</pre>
</div>
</div>
</div>
<div id="outline-container-orga6bd60b" class="outline-4">
<h4 id="orga6bd60b"><span class="section-number-4">1.1.6.</span> Moving the cursor:</h4>
<div class="outline-text-4" id="text-1-1-6">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Ctrl + a</td>
<td class="org-left">Go to the beginning of the line (Home)</td>
</tr>

<tr>
<td class="org-left">Ctrl + e</td>
<td class="org-left">Go to the End of the line (End)</td>
</tr>

<tr>
<td class="org-left">Ctrl + p</td>
<td class="org-left">Previous command (Up arrow)</td>
</tr>

<tr>
<td class="org-left">Ctrl + n</td>
<td class="org-left">Next command (Down arrow)</td>
</tr>

<tr>
<td class="org-left">Alt + b</td>
<td class="org-left">Back (left) one word</td>
</tr>

<tr>
<td class="org-left">Alt + f</td>
<td class="org-left">Forward (right) one word</td>
</tr>

<tr>
<td class="org-left">Ctrl + f</td>
<td class="org-left">Forward one character</td>
</tr>

<tr>
<td class="org-left">Ctrl + b</td>
<td class="org-left">Backward one character</td>
</tr>

<tr>
<td class="org-left">Ctrl + xx</td>
<td class="org-left">Toggle between the start of line and current cursor position</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org12b6ad3" class="outline-4">
<h4 id="org12b6ad3"><span class="section-number-4">1.1.7.</span> Editing:</h4>
<div class="outline-text-4" id="text-1-1-7">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Ctrl + L</td>
<td class="org-left">Clear the Screen, similar to the clear command</td>
</tr>

<tr>
<td class="org-left">Alt + Del</td>
<td class="org-left">Delete the Word before the cursor.</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Alt + d</td>
<td class="org-left">Delete the Word after the cursor.</td>
</tr>

<tr>
<td class="org-left">Ctrl + d</td>
<td class="org-left">Delete character under the cursor</td>
</tr>

<tr>
<td class="org-left">Ctrl + h</td>
<td class="org-left">Delete character before the cursor (Backspace)</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Ctrl + w</td>
<td class="org-left">Cut the Word before the cursor to the clipboard.</td>
</tr>

<tr>
<td class="org-left">Ctrl + k/u</td>
<td class="org-left">Cut the Line after/before the cursor to the clipboard.</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Alt + t</td>
<td class="org-left">Swap current word with previous</td>
</tr>

<tr>
<td class="org-left">Ctrl + t</td>
<td class="org-left">Swap the last two characters before the cursor (typo).</td>
</tr>

<tr>
<td class="org-left">Esc  + t</td>
<td class="org-left">Swap the last two words before the cursor.</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">ctrl + y</td>
<td class="org-left">Paste the last thing to be cut (yank)</td>
</tr>

<tr>
<td class="org-left">Alt + u</td>
<td class="org-left">UPPER capitalize every character from the cursor to the end of the current word.</td>
</tr>

<tr>
<td class="org-left">Alt + l</td>
<td class="org-left">Lower the case of every character from the cursor to the end of the current word.</td>
</tr>

<tr>
<td class="org-left">Alt + c</td>
<td class="org-left">Capitalize the character under the cursor and move to the end of the word.</td>
</tr>

<tr>
<td class="org-left">Alt + r</td>
<td class="org-left">Cancel the changes and put back the line as it was in the history (revert).</td>
</tr>

<tr>
<td class="org-left">ctrl + _</td>
<td class="org-left">Undo</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="outline-container-org189fbfc" class="outline-3">
<h3 id="org189fbfc"><span class="section-number-3">1.2.</span> how it works</h3>
<div class="outline-text-3" id="text-1-2">
<p>
<a href="https://unix.stackexchange.com/questions/4126/what-is-the-exact-difference-between-a-terminal-a-shell-a-tty-and-a-con">https://unix.stackexchange.com/questions/4126/what-is-the-exact-difference-between-a-terminal-a-shell-a-tty-and-a-con</a>
<a href="https://dev.to/napicella/linux-terminals-tty-pty-and-shell-192e">https://dev.to/napicella/linux-terminals-tty-pty-and-shell-192e</a>
<a href="https://www.oreilly.com/library/view/linux-device-drivers/0596005903/ch18.html">https://www.oreilly.com/library/view/linux-device-drivers/0596005903/ch18.html</a>
<a href="https://en.wikipedia.org/wiki/POSIX_terminal_interface">https://en.wikipedia.org/wiki/POSIX_terminal_interface</a>
<a href="https://habr.com/ru/post/460257/">https://habr.com/ru/post/460257/</a>
<a href="https://medium.com/securitythread/linux-terminal-subsystem-d000475c8dd">https://medium.com/securitythread/linux-terminal-subsystem-d000475c8dd</a>
www.embeddedlinux.org.cn/essentiallinuxdevicedrivers/final/ch06lev1sec4.html
</p>

<p>
tty - teletypewriter <a href="https://en.wikipedia.org/wiki/Teleprinter">https://en.wikipedia.org/wiki/Teleprinter</a>
</p>

<ul class="org-ul">
<li>terminal - became a computer program in the kernel which would send characters directly to the TTY
driver, read from it and print to the screen.
<ul class="org-ul">
<li>is a character-oriented device, comprising streams of characters received from and sent to the
device,  dev/tty - device which implements a number of additional commands (ioctls) beyond read and write.</li>
<li>consist of:
<ul class="org-ul">
<li>character device interface ( open, read, write, close …)</li>
<li>Line discipline</li>
<li>driver - keyboard IO, display</li>
</ul></li>
<li>may be: kernel program or pseudo terminal or serial device (old)</li>
<li>communicate with the terminal through terminal character device file</li>
</ul></li>
<li>terminal emulator - the kernel program emulate the physical terminal device. it listens for events
coming from the keyboard and sends it down to the driver</li>
<li>pseudo-terminal (pty) - provided by terminal emulators - it's not a kernel program but one that
runs in the user land.</li>
<li>System console - interface more
<ol class="org-ol">
<li>physical device consisting of a keyboard and a screen</li>
<li>text entry and display device for system administration messages</li>
</ol></li>
<li>Virtual console/virtual terminal - Ctrl+Alt+F1234
<ul class="org-ul">
<li>On each virtual terminal, a getty process is run, which in turn runs /bin/login to authenticate a user.</li>
<li>supported at the Linux kernel level</li>
<li>are emulated text terminals, using the keyboard and monitor of a personal computer or workstation</li>
</ul></li>
<li>terminal monitor program spawns (sets TERM env - Specifies the terminal type.)
<ul class="org-ul">
<li>may be:
<ul class="org-ul">
<li>getty TERM=linux</li>
<li>SSH server ( to the same terminal type as the SSH client)</li>
<li>software terminal emulator, using a pseudoterminal ( sets the TERM environment variable to
specify the type of terminal that it is emulating)
<ul class="org-ul">
<li>GNU Screen program sets <i>screen</i> as the terminal type.</li>
</ul></li>
</ul></li>
</ul></li>
<li>shell - user space app</li>
<li>escape code - . Certain sequences of bytes, most starting with an ASCII escape character and a
bracket character, are embedded into text to control cursor location, color, font styling, and
other options on video text terminals and terminal emulators.
<ul class="org-ul">
<li>man console<sub>codes</sub> - Linux console escape and control sequences</li>
</ul></li>
</ul>


<p>
Terminal emulator(get keys and draw gui) -&gt; PTY master -&gt; tty driver(with line discipline) -&gt; pty slave -&gt; bash
</p>

<p>
По умолчанию TTY устройство работает в каноничном режиме с включенным эхо (echoing). Эхо — это
отображение введенных вами символов на экране.
</p>

<p>
GNU Readline - library that provides in-line editing and history capabilities - supports both Emacs and vi
 editing modes
</p>

<p>
terminfo - used by TERM enveronmental variable. which strings to send for clear screen, move cursor, etc.
</p>
<ul class="org-ul">
<li>database: /usr/share/terminfo/*/* - /etc/terminfo/*/*</li>
<li>default = /etc/terminfo/l/linux</li>
</ul>

<p>
agetty - opens a tty port
</p>
</div>
</div>
<div id="outline-container-org0fbdf5d" class="outline-3">
<h3 id="org0fbdf5d"><span class="section-number-3">1.3.</span> terminal related commands:</h3>
<div class="outline-text-3" id="text-1-3">
<ul class="org-ul">
<li>who</li>
<li>w</li>
<li>last</li>
<li>tty</li>
<li>ps</li>
<li>stty - change terminal settings, prints baud rate, line discipline, and deviations from stty  sane
<ul class="org-ul">
<li>stty -a  - get all</li>
<li>stty icanon -echo - disable echo</li>
<li>stty raw echo</li>
<li>stty &lt;control-character&gt; &lt;string&gt;</li>
<li>stty erase 0</li>
</ul></li>
<li>reset - reset terminal after cat binary file</li>
<li>infocmp  - compare or print out terminfo descriptions</li>
</ul>
</div>
</div>
<div id="outline-container-org582fd60" class="outline-3">
<h3 id="org582fd60"><span class="section-number-3">1.4.</span> escape codes</h3>
<div class="outline-text-3" id="text-1-4">
<p>
The escape codes received from the terminal signify things such as function key, arrow key, and
other special keystrokes (home key, end key, help key, PgUp key, PgDn key, insert key, delete key,
and so forth)
</p>
</div>
</div>
<div id="outline-container-org07b94e1" class="outline-3">
<h3 id="org07b94e1"><span class="section-number-3">1.5.</span> <span class="todo TODO">TODO</span> POSIX terminal interface</h3>
</div>
<div id="outline-container-org6c3949b" class="outline-3">
<h3 id="org6c3949b"><span class="section-number-3">1.6.</span> pseudo-teletypes (PTS)</h3>
<div class="outline-text-3" id="text-1-6">
<p>
The multiplexor is the master, and the PTS are the slaves. The multiplexor is addressed by the
kernel through the device file located at /dev/ptmx.
</p>
</div>
</div>

<div id="outline-container-org22a5f53" class="outline-3">
<h3 id="org22a5f53"><span class="section-number-3">1.7.</span> history links</h3>
<div class="outline-text-3" id="text-1-7">
<p>
<a href="https://www.computernetworkingnotes.com/linux-tutorials/linux-virtual-console-and-terminal-explained.html">https://www.computernetworkingnotes.com/linux-tutorials/linux-virtual-console-and-terminal-explained.html</a>
<a href="https://www.howtogeek.com/428174/what-is-a-tty-on-linux-and-how-to-use-the-tty-command/">https://www.howtogeek.com/428174/what-is-a-tty-on-linux-and-how-to-use-the-tty-command/</a>
</p>
</div>
</div>
<div id="outline-container-orgb408955" class="outline-3">
<h3 id="orgb408955"><span class="section-number-3">1.8.</span> tty scroll</h3>
<div class="outline-text-3" id="text-1-8">
<ul class="org-ul">
<li>tmux</li>
</ul>
</div>
<div id="outline-container-org5c88f61" class="outline-4">
<h4 id="org5c88f61"><span class="section-number-4">1.8.1.</span> screen</h4>
<div class="outline-text-4" id="text-1-8-1">
<p>
Ctrl-A, Esc - now Page Up, Page down
Esc - exit
</p>

<p>
without:
</p>
<ul class="org-ul">
<li>Ctrl+z - background</li>
<li>$ fg - front</li>
</ul>

<p>
Scroll:
Ctrl-A, Esc - now Page Up, Page down
</p>

<ul class="org-ul">
<li>screen - start</li>
<li>Ctrl+a+c create new</li>
<li>Ctrl+a+" list</li>

<li>Ctrl+a+d deattach</li>
<li>Ctrl+a+b next window</li>
<li>Ctrl+a   to last used</li>
<li>Ctrl+a+0 switch to 0 screen</li>
<li>Shift+a - Set title for window.</li>
</ul>

<p>
Copy/paste
</p>
<ul class="org-ul">
<li>Ctrl-A, Esc</li>
<li>Enter, Enter</li>
<li>Ctrl-A, ] - paste</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orge169bb7" class="outline-3">
<h3 id="orge169bb7"><span class="section-number-3">1.9.</span> clipboard</h3>
<div class="outline-text-3" id="text-1-9">
<ol class="org-ol">
<li>emerge x11-misc/xsel
<ul class="org-ul">
<li>bind '"\C-p": "\C-e\C-u xsel &lt;&lt;"EOF"\n\C-y\nEOF\n\C-y"'</li>
</ul></li>
<li>emerge x11-misc/xclip
<ul class="org-ul">
<li>cat a | xclip -sel clip</li>
</ul></li>
</ol>
</div>

<ol class="org-ol">
<li><a id="org400d788"></a>configure<br />
<div class="outline-text-5" id="text-1-9-0-1">
<p>
tmux show-options -g | grep status
</p>
</div>
</li>
</ol>
</div>

<div id="outline-container-org0e6eb5d" class="outline-3">
<h3 id="org0e6eb5d"><span class="section-number-3">1.10.</span> keymaps, dvorak</h3>
<div class="outline-text-3" id="text-1-10">
<p>
ubuntu: apt install console-keymaps
</p>
<ul class="org-ul">
<li>loadkeys /usr/share/keymaps/i386/dvorak/dvorak.kmap.gz</li>
</ul>
</div>
</div>
<div id="outline-container-org0f2030a" class="outline-3">
<h3 id="org0f2030a"><span class="section-number-3">1.11.</span> ASCII</h3>
<div class="outline-text-3" id="text-1-11">
<div class="org-src-container">
<pre class="src src-text">0 ^@    \0      Null
1 ^A            Start of Heading
2 ^B            Start of Text
3 ^C            End of Text
4 ^D            End of Transmission
5 ^E            Enquiry
6 ^F            Acknowledgement
7 ^G    \a      Bell
8 ^H    \b      Backspace[e][f]
9 ^I    \t      Horizontal Tab[g]
10 ^J   \n      Line Feed
11 ^K   \v      Vertical Tab
12 ^L   \f      Form Feed
13 ^M   \r      Carriage Return[h]
14 ^N           Shift Out
15 ^O           Shift In
16 ^P           Data Link Escape
17 ^Q           Device Control 1 (often XON)
18 ^R           Device Control 2
19 ^S           Device Control 3 (often XOFF)
20 ^T           Device Control 4
21 ^U           Negative Acknowledgement
22 ^V           Synchronous Idle
23 ^W           End of Transmission Block
24 ^X           Cancel
25 ^Y           End of Medium
26 ^Z           Substitute
27 ^[   \e[i]   Escape[j]
28 ^\           File Separator
29 ^]           Group Separator
30 ^^           Record Separator
31 ^_           Unit Separator

32 space
33 !    Exclamation mark
34 "    Double quotes (or speech marks)
35 #    Number sign
36 $    Dollar
37 %    Per cent sign
38 &amp;    Ampersand
39 '    Single quote
40 (    Open parenthesis (or open bracket)
41 )    Close parenthesis (or close bracket)
42 *    Asterisk
43 +    Plus
44 ,    Comma
45 -    Hyphen-minus
46 .    Period, dot or full stop
47 /    Slash or divide
48 0
49 1
50 2
51 3
52 4
53 5
54 6
55 7
56 8
57 9
58 :    Colon
59 ;    Semicolon
60 &lt;    Less than (or open angled bracket)
61 =    Equals
62 &gt;    Greater than (or close angled bracket)
63 ?    Question mark
64 @, `, @      At sign
65 A
66 B
67 C
68 D
69 E
70 F
71 G
72 H
73 I
74 J
75 K
76 L
77 M
78 N
79 O
80 P
81 Q
82 R
83 S
84 T
85 U
86 V
87 W
88 X
89 Y
90 Z
91 [    Opening bracket
92 \, ~, \      Backslash
93 ]    Closing bracket
94 &#8593;, ^ Caret - circumflex
95 &#8592;, _ Underscore
96 @, ` Grave accent
97 a
98 b
99 c
100 d
101 e
102 f
103 g
104 h
105 i
106 j
107 k
108 l
109 m
110 n
111 o
112 p
113 q
114 r
115 s
116 t
117 u
118 v
119 w
120 x
121 y
122 z
123 {   Opening brace
124 ACK, &#172;, |   Vertical bar
125 }   Closing brace
126 ESC, |, ~   Equivalency sign - tilde
127 DEL Delete
</pre>
</div>

<p>
sessions:
</p>
<ul class="org-ul">
<li>tmux new-session -d top</li>
<li>tmux ; C-b ( - switch to background session with top</li>
<li>C-b ) ; C-d - deattach from background session</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgeaf2832" class="outline-2">
<h2 id="orgeaf2832"><span class="section-number-2">2.</span> shell</h2>
<div class="outline-text-2" id="text-2">
<p>
You may indent or not indent however you like
</p>
</div>
<div id="outline-container-org370be30" class="outline-3">
<h3 id="org370be30"><span class="section-number-3">2.1.</span> variables</h3>
<div class="outline-text-3" id="text-2-1">
<p>
${ varname } is general syntax for $variable
</p>
<ul class="org-ul">
<li>$_ At shell startup, set to the pathname used to invoke the shell or shell script being executed</li>
<li>$1 - first parameter</li>
<li>$#: How many command line parameters were passed to the script.</li>
<li>$?: The exit status of the last process to run.</li>
<li>$$: The Process ID (PID) of the current script.</li>
<li>$* is a single string that consists of all of the positional parameters, separated by the first character in the environment variable IFS</li>
<li>$@: All the command line parameters passed to the script. Cat be set: $set &#x2013; 1 2 3</li>
<li>$USER: The username of the user executing the script.</li>
<li>$HOSTNAME: The hostname of the computer running the script.</li>
<li>$SECONDS: The number of seconds the script has been running for.</li>
<li>$RANDOM: Returns a random number.</li>
<li>$LINENO: Returns the current line number of the script.</li>
<li>IFS (internal field separator), which is a space, TAB, and NEWLINE by default.</li>
<li>env | less # environment variables</li>
</ul>


<p>
my=Dave
my="Dave Green"
file<sub>count</sub>=$(ls $folder<sub>to</sub><sub>count</sub> | wc -l) # miltiline
</p>

<p>
export mt<sub>var</sub> # to save variables to outside of the script
</p>

<p>
multiline variable (heredoc):
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #cae682;">method1</span>=<span style="color: #95e454;">"This is line no.1\nThis is line no.3\nThis is line no.3"</span>
<span style="color: #e5786d;">echo</span> -e $<span style="color: #cae682;">method1</span>


<span style="color: #e5786d;">read</span> -r -d <span style="color: #95e454;">''</span> MULTI_LINE_VAR &lt;&lt; EOM
<span style="color: #ffff00; font-weight: bold;">Print line 1.</span>
<span style="color: #ffff00; font-weight: bold;">Print line 2.</span>
<span style="color: #ffff00; font-weight: bold;">Print line 3</span>
<span style="color: #ffff00; font-weight: bold;">EOM</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgda09c95" class="outline-3">
<h3 id="orgda09c95"><span class="section-number-3">2.2.</span> Enveronmental Variables</h3>
<div class="outline-text-3" id="text-2-2">
<ul class="org-ul">
<li>( set -o posix ; set ) | less</li>
<li>env</li>
<li>printenv - same as env</li>
</ul>
</div>
</div>
<div id="outline-container-org9ce1c98" class="outline-3">
<h3 id="org9ce1c98"><span class="section-number-3">2.3.</span> Wildcard</h3>
<div class="outline-text-3" id="text-2-3">
</div>
<div id="outline-container-orgfa2999b" class="outline-4">
<h4 id="orgfa2999b"><span class="section-number-4">2.3.1.</span> Standard Wildcards (globbing patterns)</h4>
<div class="outline-text-4" id="text-2-3-1">
<p>
globbing for pathnames
</p>

<p>
used by nearly any command
</p>
<ul class="org-ul">
<li>man 7 glob</li>
<li>^$ - begin and end</li>
<li>. - any single character</li>
<li>\ - escaping</li>
<li>[] - character in range</li>
</ul>
</div>
</div>
<div id="outline-container-org6e9fa16" class="outline-4">
<h4 id="org6e9fa16"><span class="section-number-4">2.3.2.</span> advanced</h4>
<div class="outline-text-4" id="text-2-3-2">
<p>
move all except one:
</p>
<ul class="org-ul">
<li>shopt -s extglob</li>
<li>mv !(fileOne) ~/path/newFolder</li>
</ul>

<pre class="example">
ls hello.???
</pre>


<pre class="example">
ls [a-p0-5]*.* # dot means dot
</pre>


<p>
[!&#x2026;] or [^&#x2026;] which matches any character except the ones in the set.
</p>

<p>
brace expansion {}
</p>
<ul class="org-ul">
<li>it actually generates all the permutations of the pattern you specify and then performs wildcard expansion on the results.</li>
<li>echo d{a,e,i,u,o}g =&gt; dag deg dig dug dog</li>
<li>echo d{a..z}g =&gt;  dag dbg dcg ddg deg dfg dgg dhg dig djg dkg dlg dmg dng dog dpg dqg drg dsg dtg dug dvg dwg dxg dyg dzg</li>
<li>echo {cat,dog} =&gt; cat dog</li>
<li>echo {cat,d*} =&gt; cat dawg dg dig dog doug dug</li>
<li>echo {j{p,pe}g,png} =&gt; jpg jpeg png</li>
<li>echo .{mp{3..4},m4{a,b,p,v}} =&gt; .mp3 .mp4 .m4a .m4b .m4p .m4v</li>
</ul>
</div>
</div>
<div id="outline-container-org2ed49ce" class="outline-4">
<h4 id="org2ed49ce"><span class="section-number-4">2.3.3.</span> classes</h4>
<div class="outline-text-4" id="text-2-3-3">
<ul class="org-ul">
<li>[:alpha:] 	It is used to match with any uppercase and lowercase letter and equivalent to [a-zA-Z].</li>
<li>[:digit:] 	It is used to match with any digits and is equivalent to [0-9].</li>
<li>[:alnum:] 	It is used to match any alphabet and digit. It is equivalent to [a-zA-Z].</li>
<li>[:upper:] 	It is used to match with uppercase latter only and equivalent to [A-Z]</li>
<li>[:lower:] 	It is used to match with uppercase latter only and equivalent to [a-z]</li>
<li>[:blank:] 	It is used to match with space and tab.</li>
<li>[:print:] 	It is used to match with printable characters.</li>
<li>[:cntrl:] 	It is used to match with non-printable characters.</li>
<li>[:space:] 	It is used to match with while-space.</li>
<li>[:xdigit:] 	It is used to match with hexadecimal digits.</li>
<li>[:ascii:] 	It is used to match with ASCII characters.</li>
<li>[:word:] 	It is used to alphanumeric characters including underscore(_).</li>
</ul>
</div>
</div>
<div id="outline-container-orga6e2dcf" class="outline-4">
<h4 id="orga6e2dcf"><span class="section-number-4">2.3.4.</span> links</h4>
<div class="outline-text-4" id="text-2-3-4">
<ul class="org-ul">
<li>linux wildcard <a href="https://tldp.org/LDP/GNU-Linux-Tools-Summary/html/x11655.htm">https://tldp.org/LDP/GNU-Linux-Tools-Summary/html/x11655.htm</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org3d73a76" class="outline-3">
<h3 id="org3d73a76"><span class="section-number-3">2.4.</span> {} Curly Braces</h3>
<div class="outline-text-3" id="text-2-4">
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #cae682;">a</span>=<span style="color: #95e454;">"asdasdvvv22"</span>
<span style="color: #e5786d;">echo</span> ${<span style="color: #cae682;">a</span>//vvv}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash">
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash">$ echo {0..10}
0 1 2 3 4 5 6 7 8 9 10
<span style="color: #e5786d;">echo</span> a{d,c,b}e
ade ace abe
<span style="color: #e5786d;">echo</span> {a..z}{a..z}
aa ab ac ad ae af ag ah ai aj ak al am an ao ap aq ar as at au av aw ax ...
<span style="color: #cae682;">month</span>=(<span style="color: #95e454;">"Jan"</span> <span style="color: #95e454;">"Feb"</span> <span style="color: #95e454;">"Mar"</span> <span style="color: #95e454;">"Apr"</span>)
<span style="color: #e5786d;">echo</span> ${<span style="color: #cae682;">month</span>[3]}
Apr
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">{ ... } to group the output from several commands into one big blob</span>
{ <span style="color: #e5786d;">echo</span> <span style="color: #95e454;">"I found all these PNGs:"</span>; find . -iname <span style="color: #95e454;">"*.png"</span>; <span style="color: #e5786d;">echo</span> <span style="color: #95e454;">"Within this bunch of files:"</span>; ls; } &gt; PNGs.txt

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Parameter Expansion:</span>
<span style="color: #cae682;">parameter</span>=22 &amp;&amp; <span style="color: #e5786d;">echo</span> $<span style="color: #cae682;">0</span> <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">parent command paramters</span>
bash
<span style="color: #cae682;">parameter</span>=22 &amp;&amp; <span style="color: #e5786d;">echo</span> $<span style="color: #cae682;">parameter</span>
22
<span style="color: #cae682;">parameter</span>=22 &amp;&amp; <span style="color: #e5786d;">echo</span> ${<span style="color: #cae682;">parameter</span>}
22
<span style="color: #cae682;">parameter</span>=abcd &amp;&amp; <span style="color: #e5786d;">echo</span> ${<span style="color: #cae682;">parameter</span>:1} <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">get [1:] ${parameter:offset:length}</span>
bcd
<span style="color: #cae682;">a</span>=213 &amp;&amp; <span style="color: #cae682;">p</span>=a &amp;&amp; <span style="color: #e5786d;">echo</span> ${<span style="color: #cae682;">!</span>p} <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">indirection</span>
213
<span style="color: #e5786d;">echo</span> ${<span style="color: #cae682;">!</span>#} <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">"#" stores the number of arguments !#=0</span>
<span style="color: #cae682;">array</span>=(2 1 3) &amp;&amp; ${<span style="color: #cae682;">array</span>[@]} == ${<span style="color: #cae682;">array</span>[*]} <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">all elements</span>
bash
<span style="color: #cae682;">p</span>=abc &amp;&amp; <span style="color: #e5786d;">echo</span> ${<span style="color: #cae682;">p</span>^} <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">The ^ operator modifies the first character to uppercase, the , operator to lowercase</span>
Abc
<span style="color: #cae682;">p</span>=abc &amp;&amp; <span style="color: #e5786d;">echo</span> ${<span style="color: #cae682;">p</span>^^} <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">uppercase</span>
ABC
<span style="color: #cae682;">p</span>=ABC &amp;&amp; <span style="color: #e5786d;">echo</span> ${<span style="color: #cae682;">p</span>~} <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">change case of first letter</span>
aBC
<span style="color: #cae682;">p</span>=ABC &amp;&amp; <span style="color: #e5786d;">echo</span> ${<span style="color: #cae682;">p</span>~} <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">change case - lowercase or uppercase</span>
abc
<span style="color: #e5786d;">echo</span> ${<span style="color: #cae682;">BASH</span>*}  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">${!PREFIX*} or ${!PREFIX@}  variable names beginning with the string PREFIX</span>
BASH BASH_ARGC BASH_ARGV BASH_COMMAND BASH_LINENO BASH_SOURCE BASH_SUBSHELL BASH_VERSINFO BASH_VERSION

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Substring removal:</span>
<span style="color: #cae682;">a</span>=<span style="color: #95e454;">"Hello World!"</span> &amp;&amp; <span style="color: #e5786d;">echo</span> Goodbye${<span style="color: #cae682;">a</span>#Hello} <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">a chunk from the beginning of a variable</span>
Goodbye World!
<span style="color: #cae682;">a</span>=<span style="color: #95e454;">"Too longgg"</span> &amp;&amp; <span style="color: #e5786d;">echo</span> ${<span style="color: #cae682;">a</span>%gg} <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">chops off the last two gg and prints &#8220;Too long&#8220;.</span>
Too long
<span style="color: #cae682;">p</span>=123 &amp;&amp; <span style="color: #e5786d;">echo</span> ${<span style="color: #cae682;">p</span>%??} <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">remove 23</span>
1
<span style="color: #fa8072;">#  </span><span style="color: #99968b; font-style: italic;">"#" will try to remove the shortest text matching the pattern, while "##" tries to do it with the longest text matching.</span>
<span style="color: #cae682;">MYSTRING</span>=<span style="color: #95e454;">"Be liberal in what you accept, and conservative in what you send"</span> &amp;&amp;  <span style="color: #e5786d;">echo</span> ${<span style="color: #cae682;">MYSTRING</span>#*in}
what you accept, and conservative<span style="color: #8ac6f2; font-weight: bold;"> in</span> what you send
<span style="color: #cae682;">MYSTRING</span>=<span style="color: #95e454;">"Be liberal in what you accept, and conservative in what you send"</span> &amp;&amp;  <span style="color: #e5786d;">echo</span> ${<span style="color: #cae682;">MYSTRING</span>##*in}
what you send

    Get name without extension
        ${<span style="color: #cae682;">FILENAME</span>%.*}
        &#8658; bash_hackers.txt
    Get extension
        ${<span style="color: #cae682;">FILENAME</span>##*.}
        &#8658; bash_hackers.txt
    Get directory name
        ${<span style="color: #cae682;">PATHNAME</span>%/*}
        &#8658; /home/bash/bash_hackers.txt
    Get filename
        ${<span style="color: #cae682;">PATHNAME</span>##*/}
        &#8658; /home/bash/bash_hackers.txt

    <span style="color: #e5786d;">echo</span> <span style="color: #95e454;">"${array[@]%is}"</span> <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Simple example, removing a trailing is from all array elements (on expansion):</span>
        &#8658; Th a text
        (it was: This is a text)

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Search and replace</span>
${<span style="color: #cae682;">PARAMETER</span>/PATTERN/STRING} <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">first occurrence</span>
${<span style="color: #cae682;">PARAMETER</span>//PATTERN/STRING} <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">all occurrence</span>
${<span style="color: #cae682;">PARAMETER</span>/PATTERN} <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">remove</span>
${<span style="color: #cae682;">PARAMETER</span>//PATTERN} <span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">same</span>

<span style="color: #cae682;">p</span>=abc &amp;&amp; <span style="color: #e5786d;">echo</span> ${#<span style="color: #cae682;">p</span>} <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">length</span>
3

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Use a default value</span>
<span style="color: #cae682;">p</span>= &amp;&amp; <span style="color: #e5786d;">echo</span> ${<span style="color: #cae682;">p</span>:-aaa} <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">if unset or empty</span>
aaa
<span style="color: #cae682;">p</span>= &amp;&amp; <span style="color: #e5786d;">echo</span> ${<span style="color: #cae682;">v</span>:-aaa} <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">if unset</span>
aaa
<span style="color: #cae682;">p</span>= &amp;&amp; <span style="color: #e5786d;">echo</span> ${<span style="color: #cae682;">p</span>:=aaa} <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">p=aaa now</span>
aaa
<span style="color: #cae682;">p</span>= &amp;&amp; <span style="color: #e5786d;">echo</span> ${<span style="color: #cae682;">p</span>=aaa} <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">p=aaa now dont print</span>
<span style="color: #95e454;">""</span>
<span style="color: #cae682;">p</span>=123 &amp;&amp; <span style="color: #e5786d;">echo</span> ${<span style="color: #cae682;">p</span>:+aaa} <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">is set and not empty. but ignore p value</span>
aaa
<span style="color: #cae682;">p</span>= &amp;&amp; <span style="color: #e5786d;">echo</span> ${<span style="color: #cae682;">p</span>:+aaa}
<span style="color: #95e454;">""</span>
<span style="color: #cae682;">p</span>= &amp;&amp; <span style="color: #e5786d;">echo</span> ${<span style="color: #cae682;">p</span>+aaa} <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">is set (empy or not). but ignore p value</span>
aaa
<span style="color: #cae682;">p</span>= &amp;&amp; <span style="color: #e5786d;">echo</span> ${<span style="color: #cae682;">p</span>:?aaa} <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">if not set or empty</span>
bash: p: aaa
<span style="color: #cae682;">p</span>= &amp;&amp; <span style="color: #e5786d;">echo</span> ${<span style="color: #cae682;">p</span>:?aaa} <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">if not set or empty</span>
bash: p: aaa
<span style="color: #cae682;">p</span>= &amp;&amp; <span style="color: #e5786d;">echo</span> ${<span style="color: #cae682;">p</span>?aaa} <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">if not set</span>
<span style="color: #95e454;">""</span>
</pre>
</div>

<p>
Split string:
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #cae682;">var</span>=/home/bash/bash_hackers.txt
<span style="color: #e5786d;">echo</span> ${<span style="color: #cae682;">var</span>%_*}
<span style="color: #e5786d;">echo</span> ${<span style="color: #cae682;">var</span>##*_}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7d01593" class="outline-3">
<h3 id="org7d01593"><span class="section-number-3">2.5.</span> {} Brace Expansion</h3>
<div class="outline-text-3" id="text-2-5">
<ul class="org-ul">
<li>ls *{txt,log} list all files ending with txt or log in the current directory</li>
<li>cp ~/projects/adders/verilog/{half<sub>,full</sub>_}adder.v . copy half<sub>adder.v</sub> and full<sub>adder.v</sub> to current directory</li>
<li>mv story.txt{,.bkp} rename story.txt as story.txt.bkp</li>
<li>cp story.txt{,.bkp} to create bkp file as well retain original</li>
<li>mv story.txt{.bkp,} rename story.txt.bkp as story.txt</li>
<li>mv story{,<sub>old</sub>}.txt rename story.txt as story<sub>old.txt</sub></li>
<li>touch file{1..4}.txt same as touch file1.txt file2.txt file3.txt file4.txt</li>
<li>touch file<sub>x..z</sub>.txt same as touch file<sub>x.txt</sub> file<sub>y.txt</sub> file<sub>z.txt</sub></li>
<li>rm file{1..4}.txt same as rm file1.txt file2.txt file3.txt file4.txt</li>
<li>echo story.txt{,.bkp} displays the expanded version 'story.txt story.txt.bkp' , useful to dry run before executing actual command</li>
</ul>
</div>
</div>

<div id="outline-container-orgdbd9cf9" class="outline-3">
<h3 id="orgdbd9cf9"><span class="section-number-3">2.6.</span> Extended globs</h3>
<div class="outline-text-3" id="text-2-6">
<ul class="org-ul">
<li>?(pattern-list) Matches zero or one occurrence of the given patterns</li>
<li>*(pattern-list) Matches zero or more occurrences of the given patterns</li>
<li>+(pattern-list) Matches one or more occurrences of the given patterns</li>
<li>@(pattern-list) Matches one of the given patterns</li>
<li>!(pattern-list) Matches anything except one of the given patterns</li>
</ul>

<p>
sheck if enabled:
</p>
<pre class="example">
$ shopt extglob
extglob            on
</pre>


<p>
ex.
</p>
<pre class="example">
$ ls !(*.txt)
main.c  math.h  power.log
</pre>
</div>
</div>

<div id="outline-container-org34d6bf0" class="outline-3">
<h3 id="org34d6bf0"><span class="section-number-3">2.7.</span> stdin(0), stdout(1), and stderr(2), pipes</h3>
<div class="outline-text-3" id="text-2-7">
<p>
standard streams == file descriptors
</p>

<p>
Commands has:
</p>
<ul class="org-ul">
<li>0 &lt;- terminal</li>
<li>1 -&gt; terminal</li>
<li>2 -&gt; terminal</li>
</ul>
</div>
<div id="outline-container-orgeba692f" class="outline-4">
<h4 id="orgeba692f"><span class="section-number-4">2.7.1.</span> pipeline</h4>
<div class="outline-text-4" id="text-2-7-1">
<ul class="org-ul">
<li>'|&amp;' equal to '2&gt;&amp;1 |' std out+err to std input</li>
<li>| - pipe stdout only</li>
<li>command &gt;(command1) &gt;(command2g) - pipe to two and more processes</li>
<li>command 2&gt; &gt;(command) &gt;c - pipe</li>
<li>(command1 ; command2 ; command3) | command4</li>
</ul>
</div>
</div>
<div id="outline-container-orgfd5b230" class="outline-4">
<h4 id="orgfd5b230"><span class="section-number-4">2.7.2.</span> redirection</h4>
<div class="outline-text-4" id="text-2-7-2">
<ul class="org-ul">
<li>redirect stdout to a file	ls &gt; a.txt</li>
<li>redirect stderr to a file	2&gt; a.txt</li>
<li>redirect stdout to a stderr	ls 1&gt;&amp;2 &gt;&amp;2</li>
<li>redirect stderr to a stdout	ls 2&gt;&amp;1</li>
<li>redirect stderr and stdout to a file	ls &amp;&gt; /dev/null</li>
<li>redirect stderr and stdout to stdout &amp;&gt;&amp;1</li>
<li>redirect stderr and stdout to stderr &amp;&gt;&amp;2</li>
</ul>

<p>
&gt;&amp;2 means copy file descriptor 2 to 1 both will refer to the 2
</p>

<p>
more:
</p>
<ul class="org-ul">
<li>command 3&gt; file # open new file descriptor</li>
<li>command &lt; file # standard input from file</li>

<li>tee a b c - redirection to multiple files (&gt;a &gt;b &gt;c - not working)</li>
</ul>
</div>
</div>
<div id="outline-container-org2632e7f" class="outline-4">
<h4 id="org2632e7f"><span class="section-number-4">2.7.3.</span> close file descriptors/streams</h4>
<div class="outline-text-4" id="text-2-7-3">
<ul class="org-ul">
<li>&gt;&amp;- 2&gt;&amp;- 3&gt;&amp;- # close 1,2,3</li>
<li>&lt;&amp;- # close 0</li>
</ul>
</div>
</div>
<div id="outline-container-orgc2bb308" class="outline-4">
<h4 id="orgc2bb308"><span class="section-number-4">2.7.4.</span> "2&gt;&amp;1 &gt;file" vs "&gt; file 2&gt;&amp;1"</h4>
<div class="outline-text-4" id="text-2-7-4">
<p>
2&gt;&amp; - do nothing becouse 0,1,2 -&gt; points to terminal
</p>

<p>
command &gt;file 2&gt;&amp;1 (or just &amp;&gt;)
</p>
<ul class="org-ul">
<li>stdout = file</li>
<li>stderr = file</li>
</ul>

<p>
command 2&gt;&amp;1 &gt;file   - redirects only stdout to file
</p>
<ul class="org-ul">
<li>stderr is redirected to stdout
<ul class="org-ul">
<li>stderr = stdout<sub>target</sub></li>
</ul></li>
<li>stdout = file</li>
</ul>
</div>
</div>
<div id="outline-container-org1e6174f" class="outline-4">
<h4 id="org1e6174f"><span class="section-number-4">2.7.5.</span> stderr to pipe</h4>
<div class="outline-text-4" id="text-2-7-5">
<p>
command 2&gt;&amp;1 &gt;/dev/null | grep 'something'
</p>
<ol class="org-ol">
<li>First copy stderr to stdout - all stderr</li>
<li>redirect stdout to /dev/null</li>
<li>pipe stdout</li>
</ol>
</div>
</div>

<div id="outline-container-orge95c2b6" class="outline-4">
<h4 id="orge95c2b6"><span class="section-number-4">2.7.6.</span> redirect stdout to file and to stdout</h4>
<div class="outline-text-4" id="text-2-7-6">
<pre class="example">
command | tee &gt;(tee) &gt; file
</pre>
</div>
</div>
<div id="outline-container-org85309c4" class="outline-4">
<h4 id="org85309c4"><span class="section-number-4">2.7.7.</span> named pipe</h4>
<div class="outline-text-4" id="text-2-7-7">
<p>
the FIFO file must be opened on both ends
</p>
<ul class="org-ul">
<li>mkfifo pipe0 # create file</li>
<li>mkfifo -m 644 pipe0</li>
<li>echo "input message" &gt; pipe0</li>
<li>cat pipe0</li>
</ul>
</div>
</div>
<div id="outline-container-org9ef57d3" class="outline-4">
<h4 id="org9ef57d3"><span class="section-number-4">2.7.8.</span> not all output?</h4>
<div class="outline-text-4" id="text-2-7-8">
<p>
script -c 'python -i &lt;&lt;&lt; "print \"test\""'
</p>
</div>
</div>
</div>
<div id="outline-container-orge5a16ac" class="outline-3">
<h3 id="orge5a16ac"><span class="section-number-3">2.8.</span> String processing</h3>
<div class="outline-text-3" id="text-2-8">
<p>
get length
</p>
<pre class="example">
${#my_string}
</pre>


<ul class="org-ul">
<li>echo '$(echo "upg")' = &gt; $(echo "upg")</li>
<li>echo "$(echo "upg")" = &gt; upg
<ul class="org-ul">
<li>The special parameters * and @ have special meaning when in double quotes in special cases</li>
</ul></li>
<li>a="as\nasd $BASH $(echo wtf)(new line)"</li>
<li>a='as\nasd $BASH $(echo wtf)(new line)'
<ul class="org-ul">
<li>echo $a =&gt; as\nasd $BASH $(echo wtf)</li>
<li>echo "$a" =&gt; as\nasd $BASH $(echo wtf)(new line)</li>
<li>echo -e $a =&gt; as(new line)asd $BASH $(echo wtf)</li>
<li>echo -e "$a" =&gt; as(new line)asd $BASH $(echo wtf)(new line)</li>
<li>printf '%q\n' "$a" =&gt; $'as\\nasd $BASH $(echo wtf)\n'</li>
</ul></li>
</ul>
<p>
general
</p>
<ul class="org-ul">
<li>cat</li>
<li>sed</li>
<li>grep</li>
<li>awk - excellent slicer and more</li>
<li>perl/python</li>
</ul>

<p>
special
</p>
<ul class="org-ul">
<li>sort</li>
<li>head/tail</li>
<li>cut</li>
<li>xargs - convert several lines to one line</li>
<li>uniq</li>
<li>cmp/diff</li>
<li>tr		replace characters</li>
<li>nl		number lines of files</li>
<li>paste	merge lines of files</li>
<li>rev		reverse lines characterwise</li>
<li>fold		wrap each input line to fit in specified width (-s break at spaces, -w 80)</li>
<li>shuf		get random lines</li>
<li>for item in list; do command $item done</li>
<li>expand and unexpand: convert between tabs and spaces</li>
<li>cut 		print part of each line of file separated by TAB or delimiter</li>
<li>paste and join: read two files into one</li>
<li>fmt, pr, fold, column, nl : text formatting</li>
</ul>
</div>
<div id="outline-container-org6328fff" class="outline-4">
<h4 id="org6328fff"><span class="section-number-4">2.8.1.</span> multiline string - HereDoc</h4>
<div class="outline-text-4" id="text-2-8-1">
<p>
short for "Here Document," is a type of redirection
</p>

<pre class="example">
[n]&lt;&lt;[-]word
       here-document
delimiter
</pre>


<p>
END, EOT, and EOF are common for world
</p>

<p>
If any part of word is quoted:
</p>
<ul class="org-ul">
<li>the delimiter is the result of quote removal on word</li>
<li>the lines in the here-document are not expanded, otherwise lines are subjected to parameter expansion,
command substitution, and arithmetic expansion, the character sequence \newline is ignored, and ‘\’ must be
used to quote the characters ‘\’, ‘$’, and ‘`’.</li>
</ul>

<p>
‘&lt;&lt;-’ - all leading tab characters are stripped from input lines and the line containing delimiter.
</p>

<p>
quoting:
</p>
<div class="org-src-container">
<pre class="src src-shell">cat &lt;&lt; EOF
<span style="color: #ffff00; font-weight: bold;">$(</span><span style="color: #fa8072;">echo Hello</span><span style="color: #ffff00; font-weight: bold;">)</span>
<span style="color: #ffff00; font-weight: bold;">EOF</span>

cat &lt;&lt; <span style="color: #95e454;">'EOF'</span>
<span style="color: #ffff00; font-weight: bold;">$(</span><span style="color: #fa8072;">echo Hello</span><span style="color: #ffff00; font-weight: bold;">)</span>
<span style="color: #ffff00; font-weight: bold;">EOF</span>

cat &lt;&lt; <span style="color: #95e454;">"EOF"</span>
<span style="color: #ffff00; font-weight: bold;">$(</span><span style="color: #fa8072;">echo Hello</span><span style="color: #ffff00; font-weight: bold;">)</span>
<span style="color: #ffff00; font-weight: bold;">EOF</span>

cat &lt;&lt; \EOF
<span style="color: #ffff00; font-weight: bold;">$(</span><span style="color: #fa8072;">echo Hello</span><span style="color: #ffff00; font-weight: bold;">)</span>
<span style="color: #ffff00; font-weight: bold;">EOF</span>
</pre>
</div>

<pre class="example">
Hello
$(echo Hello)
$(echo Hello)
$(echo Hello)
</pre>


<p>
declare variable:
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #cae682;">a</span>=$(<span style="color: #fa8072;">cat &lt;&lt;EOF</span>
<span style="color: #ffff00; font-weight: bold;">s</span>
<span style="color: #ffff00; font-weight: bold;">s</span>
<span style="color: #ffff00; font-weight: bold;">EOF</span>
)
<span style="color: #e5786d;">echo</span> -e <span style="color: #95e454;">"$a"</span>
</pre>
</div>

<pre class="example">
s
s
</pre>



<p>
as=$(echo -e "s\ns")
</p>

<p>
echo $a  # s s
echo "$a"  # s\ns
</p>

<p>
cat - внешняя программа которой нет в bash
</p>
<div class="org-src-container">
<pre class="src src-sh" id="org79e291f"><span style="color: #e5786d;">set</span> +e
<span style="color: #e5786d;">read</span> -rd <span style="color: #95e454;">''</span> EMACS_EVAL &lt;&lt;EOF
<span style="color: #ffff00; font-weight: bold;">(progn</span>
<span style="color: #ffff00; font-weight: bold;"> (org-babel-tangle-file "./index.org"))</span>
<span style="color: #ffff00; font-weight: bold;">EOF</span>
<span style="color: #e5786d;">set</span> -e
</pre>
</div>

<p>
piping:
</p>
<div class="org-src-container">
<pre class="src src-bash">cat &lt;&lt; <span style="color: #95e454;">'EOF'</span> | base64 -d
<span style="color: #ffff00; font-weight: bold;">SGVsbG8KV29ybGQK</span>
<span style="color: #ffff00; font-weight: bold;">EOF</span>
</pre>
</div>

<pre class="example">
Hello
World
</pre>


<p>
Write to a file. The way to create script at remote server.
</p>
<div class="org-src-container">
<pre class="src src-sh">cat &lt;&lt;EOF &gt; print.sh
<span style="color: #ffff00; font-weight: bold;">#!/bin/bash</span>
<span style="color: #ffff00; font-weight: bold;">echo \$PWD</span>
<span style="color: #ffff00; font-weight: bold;">echo $PWD</span>
<span style="color: #ffff00; font-weight: bold;">EOF</span>
</pre>
</div>

<p>
function - stores the information provided by the HereDoc into variables.
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #cae682; font-weight: bold;">readLines</span>(){
        <span style="color: #e5786d;">read</span> greeting
        <span style="color: #e5786d;">read</span> name
}

readLines &lt;&lt; EOF
<span style="color: #ffff00; font-weight: bold;">Hello</span>
<span style="color: #ffff00; font-weight: bold;">$USER</span>
<span style="color: #ffff00; font-weight: bold;">EOF</span>

<span style="color: #e5786d;">echo</span> $<span style="color: #cae682;">greeting</span>
<span style="color: #e5786d;">echo</span> $<span style="color: #cae682;">name</span>
</pre>
</div>

<pre class="example">
Hello
u
</pre>


<p>
executing multiple commands on a remote machine:
</p>
<div class="org-src-container">
<pre class="src src-sh">ssh username@host &lt;&lt; EOF
<span style="color: #ffff00; font-weight: bold;">echo hello! # this commands will be executed on remote machine</span>
<span style="color: #ffff00; font-weight: bold;">echo do your work!</span>
<span style="color: #ffff00; font-weight: bold;">EOF</span>

sftp username@host &lt;&lt; EOF
<span style="color: #ffff00; font-weight: bold;">put test.sh # run multiple SFTP commands automatically</span>
<span style="color: #ffff00; font-weight: bold;">EOF</span>
</pre>
</div>
</div>

<ol class="org-ol">
<li><a id="org4cdb26e"></a>links<br />
<div class="outline-text-5" id="text-2-8-1-1">
<ul class="org-ul">
<li><a href="https://www.gnu.org/software/bash/manual/html_node/Redirections.html#Here-Documents">https://www.gnu.org/software/bash/manual/html_node/Redirections.html#Here-Documents</a></li>
<li><a href="https://phoenixnap.com/kb/bash-heredoc">https://phoenixnap.com/kb/bash-heredoc</a></li>
</ul>
</div>
</li>
</ol>
</div>
<div id="outline-container-org3da81fe" class="outline-4">
<h4 id="org3da81fe"><span class="section-number-4">2.8.2.</span> sort</h4>
<div class="outline-text-4" id="text-2-8-2">
<p>
sort by column:
</p>
<pre class="example">
sort -t, -nk3 user.csv
</pre>

<ul class="org-ul">
<li>-t, - defines your delimiter as ,. (default delimeter - tab ? )</li>
<li>-n - gives you numerical sort. Added since you added it in your attempt. If your user field is text only
then you dont need it.</li>
<li>-k3 - defines the field (key). user is the third field.</li>
</ul>

<p>
sort -k 2,2 -k 1,1 Hogwarts # sort by second and by first column
</p>
</div>
<ol class="org-ol">
<li><a id="org8ec41e6"></a>-s, &#x2013;stable stabilize sort by disabling last-resort comparison<br />
<div class="outline-text-6" id="text-2-8-2-0-1">
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #cae682;">a</span>=$(<span style="color: #fa8072;">cat &lt;&lt;EOF</span>
<span style="color: #ffff00; font-weight: bold;">1   4</span>
<span style="color: #ffff00; font-weight: bold;">1   2</span>
<span style="color: #ffff00; font-weight: bold;">1   3</span>
<span style="color: #ffff00; font-weight: bold;">1   1</span>
<span style="color: #ffff00; font-weight: bold;">3   3</span>
<span style="color: #ffff00; font-weight: bold;">2   1</span>
<span style="color: #ffff00; font-weight: bold;">2   2</span>
<span style="color: #ffff00; font-weight: bold;">EOF</span>
)
<span style="color: #e5786d;">echo</span> <span style="color: #95e454;">"$a"</span> | sort -nk1 -s
<span style="color: #e5786d;">echo</span>
<span style="color: #e5786d;">echo</span> <span style="color: #95e454;">"$a"</span> | sort -nk1
</pre>
</div>

<pre class="example" id="orga5366af">
1   4
1   2
1   3
1   1
2   1
2   2
3   3

1   1
1   2
1   3
1   4
2   1
2   2
3   3
</pre>
</div>
</li>
</ol>
</div>
<div id="outline-container-org79c9a92" class="outline-4">
<h4 id="org79c9a92"><span class="section-number-4">2.8.3.</span> cut - get column</h4>
<div class="outline-text-4" id="text-2-8-3">
<p>
cut -d "delimiter" -f (field number) file.txt
</p>
<ul class="org-ul">
<li>&#x2013;complement</li>
<li>&#x2013;output-delimiter=”delimiter”</li>
</ul>

<p>
cut -c [(k)-(n)/(k),(n)/(n)] filename
</p>
<ul class="org-ul">
<li>k denotes the starting position of the character</li>
<li>n denotes the ending position of the character in each line</li>
<li>if k and n are separated by “-” otherwise they are only the position of character in each line from the file
taken as an input.</li>
</ul>

<pre class="example">
ps -aux | tr -s ' ' | cut -d ' ' -f 2
</pre>
</div>
</div>
<div id="outline-container-orgd05a1e4" class="outline-4">
<h4 id="orgd05a1e4"><span class="section-number-4">2.8.4.</span> sed</h4>
<div class="outline-text-4" id="text-2-8-4">
<p>
Default only change the first occurrence of the word on a line.
</p>

<p>
get line:
</p>
<pre class="example">
echo -e "as\nasd" | sed -n '2p' =&gt; asd
</pre>


<p>
split file by first occured character and number lines:
</p>
<pre class="example">
sed -z -e 's/\//\\:\\:\n\//' -e 's/*/\\:\\:\n\*/' | sed -e '0,/^[^\/*]/ s/^[^\/*]/\\:\\:\n/' | nl
</pre>
</div>
</div>
<div id="outline-container-orga704e08" class="outline-4">
<h4 id="orga704e08"><span class="section-number-4">2.8.5.</span> grep</h4>
<div class="outline-text-4" id="text-2-8-5">
<ul class="org-ul">
<li>filter lines by pattern -</li>
<li>case insensitive grep -i "FILe"</li>

<li>-o only matching</li>
<li>-v invert match or NOT</li>
<li>-i case insensitive</li>
<li>-A num Print num lines of trailing context after each match. See also the -B and -C options.</li>
<li>-B num Print num lines of leading context before each match. See also the -A and -C options.</li>
<li>-C[num] Print num lines of leading and trailing context surrounding each match. The default is 2 and is
equivalent to -A 2 -B 2. Note: no whitespace may be given between the option and its argument.</li>
<li>-m N - stop reading file after N matching lines</li>
</ul>

<p>
OR
</p>
<ul class="org-ul">
<li>dmesg | grep -i -E 'xx:xx.x|wlan|iwl|80211'</li>
<li>dmesg | grep -i -e 'xx:xx.x' -e wlan -e iwl -e 80211</li>
<li>grep -Ev "(127|192)"</li>
</ul>

<p>
first match
</p>
<ul class="org-ul">
<li>ip a | grep -o -m 1 wlan.</li>
</ul>

<p>
search in files:
</p>
<ul class="org-ul">
<li>grep -Rin patern
<ul class="org-ul">
<li>n - line number, R - recursive</li>
</ul></li>
</ul>

<p>
extract http links
</p>
<ul class="org-ul">
<li>cat a.html | grep -o 'href=\"<i>.media[^\"]*/dl</i>[0-9]*[^\"]*' | grep -o "/.*" | sed 's#^#<a href="http://site.onion">http://site.onion</a>#' | xatrs torsocks wget &#x2013;user-agent="Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)"</li>
</ul>
</div>
</div>
<div id="outline-container-orgf160d7f" class="outline-4">
<h4 id="orgf160d7f"><span class="section-number-4">2.8.6.</span> python</h4>
<div class="outline-text-4" id="text-2-8-6">
<p>
split paragraphs:
</p>
<ul class="org-ul">
<li>cat aa | python -c "import sys; print(sys.stdin.read().split('123'))"
<ul class="org-ul">
<li>['asasd\n\n\n asdasd\n\n','asd\nas']</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org95cf77c" class="outline-4">
<h4 id="org95cf77c"><span class="section-number-4">2.8.7.</span> perl</h4>
<div class="outline-text-4" id="text-2-8-7">
<p>
split paragraphs:
</p>
<ul class="org-ul">
<li></li>
</ul>
<p>
bad try:
</p>
<ul class="org-ul">
<li>echo "aavbb" | perl -e '@a=&lt;&gt;; print( (split(<i>v</i>, join "", @a))[0] )' =&gt; "aa"</li>
</ul>
</div>
</div>
<div id="outline-container-org3962a66" class="outline-4">
<h4 id="org3962a66"><span class="section-number-4">2.8.8.</span> awk</h4>
<div class="outline-text-4" id="text-2-8-8">
<ul class="org-ul">
<li>echo -e "a\navbb" | awk -v RS='v' 'NR==1' - get a\na</li>
<li>ps ux | awk '{if($8=="Z") print}' - get column 8 if == "Z"</li>
<li>ps | awk '{print $2}' - get column 2</li>
</ul>
</div>
</div>
<div id="outline-container-orge0b9052" class="outline-4">
<h4 id="orge0b9052"><span class="section-number-4">2.8.9.</span> uniq</h4>
<div class="outline-text-4" id="text-2-8-9">
<p>
MUST BE USED AFTER <b>sort</b>
</p>
<ul class="org-ul">
<li>-s n - skip n first characters</li>
<li>-w n - sort by n first characters</li>
<li>&#x2013;group - separate duplicates</li>
<li>-c - count unique</li>
</ul>
</div>
</div>
<div id="outline-container-org4b01b7d" class="outline-4">
<h4 id="org4b01b7d"><span class="section-number-4">2.8.10.</span> strip remove leading and trailing white spaces</h4>
<div class="outline-text-4" id="text-2-8-10">
<pre class="example">
vv="  asd  "
v=$(echo $vv)
echo $v
</pre>
</div>
</div>
<div id="outline-container-org16fc79a" class="outline-4">
<h4 id="org16fc79a"><span class="section-number-4">2.8.11.</span> tail</h4>
<div class="outline-text-4" id="text-2-8-11">
<p>
skip first line of output:
</p>
<pre class="example">
route -n | tail -n +2
</pre>


<p>
search sentence or word in files with extension:
</p>
<pre class="example">
grep -r -i --include=\*.txt 'searchterm' ./
</pre>

<ul class="org-ul">
<li>-r: recursively</li>
<li>-i: ignore-case</li>
<li>&#x2013;include: all *.txt: text files (escape with \ just in case you have a directory with asterisks in the filenames)</li>
<li>'searchterm': What to search</li>
<li>./: Start at current directory.</li>
</ul>


<p>
add prefix to every string
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #e5786d;">echo</span> -e <span style="color: #95e454;">"a23d\nasdasd"</span> | sed <span style="color: #95e454;">'s/^/worker: /'</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org31f8664" class="outline-3">
<h3 id="org31f8664"><span class="section-number-3">2.9.</span> Process Control</h3>
<div class="outline-text-3" id="text-2-9">
<ul class="org-ul">
<li>top <a href="#orgddc6097">2.24</a></li>
<li>ps <a href="#org35a0895">2.23</a></li>
<li>kill/killall/pkill</li>
<li>free</li>
<li>pgrep</li>
<li>fg - background child processes</li>
<li>jobs
<ul class="org-ul">
<li>-l list</li>
<li>-p process numbers</li>
</ul></li>
</ul>

<p>
background
</p>
<ul class="org-ul">
<li>nohup command &amp; - even after exiting the shell - ignore HUP (hangup) signal and therefore does not stop when the user logs out.</li>
<li>timeout 15 command &amp;</li>
<li>( sleep 1000 &amp; ) - deattached from bash</li>
</ul>

<p>
Which process block file/folder?
</p>
<ul class="org-ul">
<li>ls -l /proc/*/fd/* | grep ~/Downloads</li>
<li>lsof/lsfd -l ~/Downloads</li>
<li></li>

<li>fuser Downloads</li>
</ul>


<p>
$! - get pid of last started background child proces
</p>

<p>
run two processes in parallel in background :
</p>
<pre class="example">
(python3 lsp-bridge/lsp_bridge.py &amp; ) ; nohup python3 .local/bin/pylsp -v --tcp &amp;
</pre>
</div>
</div>

<div id="outline-container-orge81fc41" class="outline-3">
<h3 id="orge81fc41"><span class="section-number-3">2.10.</span> Programming</h3>
<div class="outline-text-3" id="text-2-10">
</div>
<div id="outline-container-org0674648" class="outline-4">
<h4 id="org0674648"><span class="section-number-4">2.10.1.</span> shebang</h4>
<div class="outline-text-4" id="text-2-10-1">
<pre class="example">
#!/usr/bin/env bash
#!/usr/bin/env sh
</pre>

<p>
On most but not all systems, I recommend using:
</p>
<pre class="example">
#!/bin/bash
#!/bin/sh
</pre>
</div>
</div>
<div id="outline-container-org074db0d" class="outline-4">
<h4 id="org074db0d"><span class="section-number-4">2.10.2.</span> pros and cons</h4>
<div class="outline-text-4" id="text-2-10-2">
<p>
pros:
</p>
<ul class="org-ul">
<li>Simple, easily understood</li>
<li>Quick to write</li>
<li>Doesn't take up much disk space</li>
<li>Reasonable chance of working on multiple operating systems without modification, if you know what you're doing</li>
</ul>

<p>
cons:
</p>
<ul class="org-ul">
<li>Slow execution (typically)</li>
<li>No sane or robust access to floating point math, complex data structures, database query results, etc. (depending on language)</li>
<li>Shebang line must be edited for each target system</li>
</ul>
</div>
</div>

<div id="outline-container-org5a635dd" class="outline-4">
<h4 id="org5a635dd"><span class="section-number-4">2.10.3.</span> Hello World.sh, scriptinga</h4>
<div class="outline-text-4" id="text-2-10-3">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">!/bin/</span><span style="color: #8ac6f2; font-weight: bold;">sh</span>
<span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">or</span>
<span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">!/usr/bin/env bash</span>
<span style="color: #e5786d;">set</span> -u <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Report Non-Existent Variables</span>
<span style="color: #e5786d;">set</span> -e <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">It terminates the execution when the error occurs. (does not work with piped commands. use Set -eo pipefail)</span>
<span style="color: #e5786d;">set</span> -o pipefail <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">exit execution if one of the commands in the pipe fails.</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">set -x # write to standard error a trace for each  command</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">set -n # do not execute only check syntax</span>

<span style="color: #e5786d;">declare</span> -r -i <span style="color: #cae682;">PORT_NUMBER</span>=8080 <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">integer, read only</span>
<span style="color: #e5786d;">declare</span> -a <span style="color: #cae682;">my_array</span>=( apple orange ) <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">indexed array</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Processes a file.</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">$1 - the name of the input file</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">$2 - the name of the output file</span>
<span style="color: #cae682; font-weight: bold;">main</span>(){
    <span style="color: #e5786d;">local</span> -r <span style="color: #cae682;">input_file</span>=<span style="color: #95e454;">"$1"</span>;  <span style="color: #e5786d;">shift</span>
    <span style="color: #e5786d;">local</span> -r <span style="color: #cae682;">output_file</span>=<span style="color: #95e454;">"$1"</span>; <span style="color: #e5786d;">shift</span>
}

main <span style="color: #95e454;">"${@}"</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org614bcb5" class="outline-4">
<h4 id="org614bcb5"><span class="section-number-4">2.10.4.</span> arguments</h4>
<div class="outline-text-4" id="text-2-10-4">
<ul class="org-ul">
<li>$@ - all</li>
<li>$0 - script name</li>
<li>$1-&#x2026;  - argumensts</li>
</ul>

<p>
easy to swap in future:
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #cae682; font-weight: bold;">main</span>(){
    <span style="color: #e5786d;">local</span> -r <span style="color: #cae682;">input_file</span>=<span style="color: #95e454;">"$1"</span>;  <span style="color: #e5786d;">shift</span>
    <span style="color: #e5786d;">local</span> -r <span style="color: #cae682;">output_file</span>=<span style="color: #95e454;">"$1"</span>; <span style="color: #e5786d;">shift</span>
}
</pre>
</div>
</div>
<ol class="org-ol">
<li><a id="org737691b"></a>check if executes with source or with exec<br />
<div class="outline-text-5" id="text-2-10-4-1">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #8ac6f2; font-weight: bold;">if</span> [ -n <span style="color: #95e454;">"$(</span><span style="color: #fa8072;">echo $0 | grep a.sh</span><span style="color: #95e454;">)"</span> ] ; <span style="color: #8ac6f2; font-weight: bold;">then</span>
    <span style="color: #e5786d;">echo</span> exec
<span style="color: #8ac6f2; font-weight: bold;">else</span>
    <span style="color: #e5786d;">echo</span> source
<span style="color: #8ac6f2; font-weight: bold;">fi</span>
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-org0b793ad" class="outline-4">
<h4 id="org0b793ad"><span class="section-number-4">2.10.5.</span> array</h4>
<div class="outline-text-4" id="text-2-10-5">
<ul class="org-ul">
<li>array=(item1 item2 item3)</li>
<li>echo ${array[*]} # echo item1 item2 item3</li>
<li>set &#x2013; item1 item2 item3</li>
<li>echo "$3" # Arrays indices start from 1</li>
<li>set &#x2013; "$@" 4 # add item</li>
<li>shift 2 # Remove first 2 items</li>
<li>for item in "$@"; do echo "$item"; done # loop</li>
<li>“${99}” - “$98” is not working</li>
</ul>

<p>
Associative Arrays / Hash Maps
</p>
<ul class="org-ul">
<li>hm="$(hm<sub>create</sub>)"</li>
<li>hm<sub>put</sub> "$hm" mykey myvalue</li>
<li>hm<sub>get</sub> "$hm" mykey</li>
<li></li>
</ul>

<p>
length:
</p>
<ul class="org-ul">
<li>echo ${#array[@]}</li>
</ul>

<p>
Splice an Array:
</p>
<ul class="org-ul">
<li>${arrayname[@]:start:end}</li>
</ul>


<p>
from start point to end:
</p>
<ul class="org-ul">
<li>v=${#a[@]}</li>
<li>echo ${a[@]:1:$v}</li>
</ul>
</div>
</div>
<div id="outline-container-org6e99b52" class="outline-4">
<h4 id="org6e99b52"><span class="section-number-4">2.10.6.</span> comparision Posix</h4>
<div class="outline-text-4" id="text-2-10-6">
<ol class="org-ol">
<li>! EXPRESSION 	The EXPRESSION is false.</li>
<li>-n STRING	 	The length of STRING is greater than zero.</li>
<li>-z STRING 		The lengh of STRING is zero (ie it is empty).</li>
<li>STRING1 = STRING2 	STRING1 is equal to STRING2</li>
<li>STRING1 != STRING2 	STRING1 is not equal to STRING2</li>
<li>INTEGER1 -eq INTEGER2 	INTEGER1 is numerically equal to INTEGER2</li>
<li>INTEGER1 -gt INTEGER2 	INTEGER1 is numerically greater than INTEGER2</li>
<li>INTEGER1 -lt INTEGER2 	INTEGER1 is numerically less than INTEGER2</li>
<li>-d FILE 		FILE exists and is a directory.</li>
<li>-e FILE 		FILE exists.</li>
<li>-r FILE 		FILE exists and the read permission is granted.</li>
<li>-s FILE 		FILE exists and it's size is greater than zero (ie. it is not empty).</li>
<li>-w FILE 		FILE exists and the write permission is granted.</li>
<li>-x FILE 		FILE exists and the execute permission is granted.</li>
</ol>

<p>
Boolean Operations
</p>
<ul class="org-ul">
<li>&amp;&amp; - is and</li>
<li>|| - is or</li>
</ul>

<p>
-a means AND and -o means OR
</p>
</div>
</div>
<div id="outline-container-orgdb29a13" class="outline-4">
<h4 id="orgdb29a13"><span class="section-number-4">2.10.7.</span> numbers comparision</h4>
<div class="outline-text-4" id="text-2-10-7">
<p>
must be checked agains tested not empty values
</p>
<ul class="org-ul">
<li>= and != is safe for empty values
"$n" = 1 - must be in ""</li>

<li>num1 -eq num2                  check if 1st  number is equal to 2nd number</li>
<li>num1 -ge num2                  checks if 1st  number  is greater than or equal to 2nd number</li>
<li>num1 -gt num2                  checks if 1st  number is greater than 2nd number</li>
<li>num1 -le num2                   checks if 1st number is less than or equal to 2nd number</li>
<li>num1 -lt num2                   checks if 1st  number  is less than 2nd number</li>
<li>num1 -ne num2                  checks if 1st  number  is not equal to 2nd number</li>
</ul>
</div>
</div>
<div id="outline-container-org05e3829" class="outline-4">
<h4 id="org05e3829"><span class="section-number-4">2.10.8.</span> strings comparision</h4>
<div class="outline-text-4" id="text-2-10-8">
<p>
variables must be in ""
</p>
<ul class="org-ul">
<li>var1 = var2     checks if var1 is the same as string var2</li>
<li>var1 != var2    checks if var1 is not the same as var2</li>
<li>var1 &lt; var2     checks if var1 is less than var2</li>
<li>var1 &gt; var2     checks if var1 is greater than var2</li>
<li>-n var1             checks if var1 has a length greater than zero</li>
<li>-z var1             checks if var1 has a length of zero</li>
</ul>

<p>
Substring:
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #8ac6f2; font-weight: bold;">if</span> [[ $<span style="color: #cae682;">full_string</span> =~ <span style="color: #95e454;">"$substring"</span> ]]; <span style="color: #8ac6f2; font-weight: bold;">then</span>
    <span style="color: #e5786d;">echo</span> <span style="color: #95e454;">"Found '$substr' in $full_string"</span>
<span style="color: #8ac6f2; font-weight: bold;">else</span>
    <span style="color: #e5786d;">echo</span> <span style="color: #95e454;">"'$substr' not found in $full_string"</span>
<span style="color: #8ac6f2; font-weight: bold;">fi</span>

<span style="color: #8ac6f2; font-weight: bold;">if </span><span style="color: #e5786d;">echo</span> <span style="color: #95e454;">"$full_string"</span> | grep -q <span style="color: #95e454;">"$substring"</span>; <span style="color: #8ac6f2; font-weight: bold;">then</span>
  <span style="color: #e5786d;">echo</span> <span style="color: #95e454;">"Found '$substring' in $full_string"</span>
<span style="color: #8ac6f2; font-weight: bold;">else</span>
  <span style="color: #e5786d;">echo</span> <span style="color: #95e454;">"'$substring' not found in $full_string"</span>
<span style="color: #8ac6f2; font-weight: bold;">fi</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org374d016" class="outline-4">
<h4 id="org374d016"><span class="section-number-4">2.10.9.</span> if</h4>
<div class="outline-text-4" id="text-2-10-9">
<ul class="org-ul">
<li>[] is just a reference to the command <b>test</b></li>
<li>(( )) - ariphmetic</li>
</ul>

<p>
statements:
</p>
<ul class="org-ul">
<li><b>if</b> [ $c == 5 ]</li>
<li><b>then</b> echo ok</li>
<li><b>elif</b> [ &lt;some test&gt; ]</li>
<li><b>then</b> something</li>
<li><b>else</b> something</li>
<li><b>fi</b></li>
</ul>

<pre class="example">
if [ "5" == 6 ] ;then echo ok;else echo bad;fi
</pre>


<pre class="example">
test $c = 5;echo $?
</pre>


<pre class="example">
ERROR: if[ or [$c or 5] or 5 ];
</pre>
</div>
<ol class="org-ol">
<li><a id="org8618901"></a>double square brackets<br />
<div class="outline-text-5" id="text-2-10-9-1">
<ul class="org-ul">
<li>Single [] are posix shell compliant condition tests. Portable.</li>
<li>Double [[]] are an extension to the standard [] and are supported by bash and other shells (e.g. zsh, ksh)
For example: || instead of -o and regex matching with =~</li>
<li>[ is POSIX</li>
<li>[[ is a Bash extension inspired from Korn shell</li>
</ul>

<p>
Use [] whenever you want your script to be portable across shells. Use [[]] if you want conditional
expressions not supported by [] and don't need to be portable.
</p>
</div>
</li>
</ol>
</div>
<div id="outline-container-orgdcb9d85" class="outline-4">
<h4 id="orgdcb9d85"><span class="section-number-4">2.10.10.</span> loop</h4>
<div class="outline-text-4" id="text-2-10-10">
<ul class="org-ul">
<li>while - while COMMAND; do done</li>
<li>until - same as while and inverse</li>
<li>for - for v in VARIABLE; do ? done ; if no "in VARIABLE" - in "$@" is assumed</li>
<li>select word in words - same as echo words | while IFS=" " read word; do</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #8ac6f2; font-weight: bold;">while</span> <span style="color: #cae682;">IFS</span>= read -r line
<span style="color: #8ac6f2; font-weight: bold;">do</span>
    <span style="color: #e5786d;">echo</span> <span style="color: #95e454;">"$line"</span>
<span style="color: #8ac6f2; font-weight: bold;">done</span> &lt;&lt;&lt; <span style="color: #95e454;">"$the_list"</span>

<span style="color: #8ac6f2; font-weight: bold;">while</span> <span style="color: #cae682;">IFS</span>=, read -r name familyname address; <span style="color: #8ac6f2; font-weight: bold;">do</span>
    <span style="color: #e5786d;">printf</span> <span style="color: #95e454;">'Got "%s", "%s", and "%s"\n'</span> <span style="color: #95e454;">"$name"</span> <span style="color: #95e454;">"$familyname"</span> <span style="color: #95e454;">"$address"</span>
<span style="color: #8ac6f2; font-weight: bold;">done</span> &lt;file.csv

<span style="color: #8ac6f2; font-weight: bold;">while </span><span style="color: #e5786d;">read</span> line ; <span style="color: #8ac6f2; font-weight: bold;">do</span>
    <span style="color: #e5786d;">echo</span> $<span style="color: #cae682;">line</span>
<span style="color: #8ac6f2; font-weight: bold;">done</span> &lt; &lt;( ... code ... )

your_code | <span style="color: #8ac6f2; font-weight: bold;">while </span><span style="color: #e5786d;">read</span> line;
<span style="color: #8ac6f2; font-weight: bold;">do</span>
    <span style="color: #e5786d;">echo</span> $<span style="color: #cae682;">line</span>
<span style="color: #8ac6f2; font-weight: bold;">done</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">while read line;</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">do</span>
<span style="color: #fa8072;">#     </span><span style="color: #99968b; font-style: italic;">echo $line</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">done &lt; $lines</span>

<span style="color: #e5786d;">echo</span> -e <span style="color: #95e454;">"$a"</span> | <span style="color: #8ac6f2; font-weight: bold;">while</span> <span style="color: #cae682;">IFS</span>=<span style="color: #95e454;">":"</span> read f v; <span style="color: #8ac6f2; font-weight: bold;">do</span>
    <span style="color: #e5786d;">echo</span> <span style="color: #95e454;">"$f _ $v"</span> <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">f - first column v - all others</span>
<span style="color: #8ac6f2; font-weight: bold;">done</span>

<span style="color: #e5786d;">set</span> -- <span style="color: #95e454;">"123 3456"</span>
<span style="color: #8ac6f2; font-weight: bold;">for</span> v<span style="color: #8ac6f2; font-weight: bold;"> in</span> <span style="color: #95e454;">"$@"</span>; <span style="color: #8ac6f2; font-weight: bold;">do</span>
    $<span style="color: #cae682;">v</span>
<span style="color: #8ac6f2; font-weight: bold;">done</span>

<span style="color: #8ac6f2; font-weight: bold;">for</span> j<span style="color: #8ac6f2; font-weight: bold;"> in</span> <span style="color: #fa8072;">`seq 0 24`</span>; <span style="color: #8ac6f2; font-weight: bold;">do</span> <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">safest</span>
    ...
<span style="color: #8ac6f2; font-weight: bold;">done</span>

<span style="color: #8ac6f2; font-weight: bold;">for</span> j<span style="color: #8ac6f2; font-weight: bold;"> in</span> <span style="color: #fa8072;">`seq 0 24`</span>; <span style="color: #8ac6f2; font-weight: bold;">do </span><span style="color: #e5786d;">echo</span> we ; <span style="color: #8ac6f2; font-weight: bold;">done</span>

<span style="color: #8ac6f2; font-weight: bold;">select</span> DRINK<span style="color: #8ac6f2; font-weight: bold;"> in</span> tea cofee water juice appe all none
<span style="color: #8ac6f2; font-weight: bold;">do</span>
   <span style="color: #8ac6f2; font-weight: bold;">case</span> $<span style="color: #cae682;">DRINK</span><span style="color: #8ac6f2; font-weight: bold;"> in</span>
      tea|cofee|water|all)
         <span style="color: #e5786d;">echo</span> <span style="color: #95e454;">"Go to canteen"</span>
         ;;
      juice|appe)
         <span style="color: #e5786d;">echo</span> <span style="color: #95e454;">"Available at home"</span>
      ;;
      none)
         <span style="color: #8ac6f2; font-weight: bold;">break</span>
      ;;
      *) <span style="color: #e5786d;">echo</span> <span style="color: #95e454;">"ERROR: Invalid selection"</span>
      ;;
   <span style="color: #8ac6f2; font-weight: bold;">esac</span>
<span style="color: #8ac6f2; font-weight: bold;">done</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">loop files in current directory</span>
<span style="color: #8ac6f2; font-weight: bold;">for</span> filename<span style="color: #8ac6f2; font-weight: bold;"> in</span> *; <span style="color: #8ac6f2; font-weight: bold;">do </span><span style="color: #e5786d;">echo</span> <span style="color: #95e454;">"put ${filename}"</span>; <span style="color: #8ac6f2; font-weight: bold;">done</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">command for every line of file - can not use variables</span>
xargs -rd<span style="color: #95e454;">'\n'</span> -I@ -a p2.txt echo @

</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #8ac6f2; font-weight: bold;">for</span> myvar<span style="color: #8ac6f2; font-weight: bold;"> in</span> <span style="color: #95e454;">"the first"</span> <span style="color: #95e454;">"the second"</span> <span style="color: #95e454;">"and the third"</span> ; <span style="color: #8ac6f2; font-weight: bold;">do</span>
        <span style="color: #e5786d;">echo</span> <span style="color: #95e454;">"This is ${myvar}"</span>
<span style="color: #8ac6f2; font-weight: bold;">done</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #8ac6f2; font-weight: bold;">for</span> (( i = 1 ; i &lt;= 3 ; i++ )) ; <span style="color: #8ac6f2; font-weight: bold;">do</span>
        <span style="color: #e5786d;">echo</span> <span style="color: #95e454;">"i is ${i}"</span>
<span style="color: #8ac6f2; font-weight: bold;">done</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3311fa8" class="outline-4">
<h4 id="org3311fa8"><span class="section-number-4">2.10.11.</span> file comparision</h4>
<div class="outline-text-4" id="text-2-10-11">
<ul class="org-ul">
<li>-d file                        checks if the file exists and is it’s a directory</li>
<li>-e file                        checks if the file exists on system</li>
<li>-w file                       checks if the file exists on system and if it is writable</li>
<li>-r file                        checks if the file exists on system and it is readable</li>
<li>-s file                        checks if the file exists on system and it is not empty</li>
<li>-f file                         checks if the file exists on system and it is a file</li>
<li>-O file                       checks if the file exists on system and if it’s is owned by the current user</li>
<li>-G file                        checks if the file exists and the default group is the same as the current user</li>
<li>-x file                         checks if the file exists on system and is executable</li>
<li>file A -nt file B         checks if file A is newer than file B</li>
<li>file A -ot file B          checks if file A is older than file B</li>
</ul>
</div>
</div>

<div id="outline-container-orga34f5b1" class="outline-4">
<h4 id="orga34f5b1"><span class="section-number-4">2.10.12.</span> functions</h4>
<div class="outline-text-4" id="text-2-10-12">
<ul class="org-ul">
<li>function must precede call.</li>
<li>exit - stop script</li>
<li>return - stop function</li>
</ul>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #cae682; font-weight: bold;">function_name</span> () {
    <span style="color: #8ac6f2; font-weight: bold;">if</span> [ -z $<span style="color: #cae682;">1</span> ] ;<span style="color: #8ac6f2; font-weight: bold;">then return</span> 1;<span style="color: #8ac6f2; font-weight: bold;">fi</span> <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Checks if any params.</span>
    <span style="color: #e5786d;">echo</span> $<span style="color: #cae682;">1</span> <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">first parameter</span>
    <span style="color: #8ac6f2; font-weight: bold;">if</span> [ $<span style="color: #cae682;">2</span> ] ; <span style="color: #8ac6f2; font-weight: bold;">then</span>
        <span style="color: #e5786d;">echo</span> <span style="color: #95e454;">"Parameter #2 is $2."</span>
    <span style="color: #8ac6f2; font-weight: bold;">fi</span>
    <span style="color: #cae682;">ret</span>=<span style="color: #95e454;">"val"</span> <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">return value</span>
    <span style="color: #8ac6f2; font-weight: bold;">return</span> 32 <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">set $? status</span>
}

func2 <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">call with no params</span>
func2 first <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">call with one param</span>

<span style="color: #cae682; font-weight: bold;">b</span>(){ <span style="color: #e5786d;">echo</span> wtf;}

</pre>
</div>
</div>
</div>

<div id="outline-container-orgbe61c7f" class="outline-4">
<h4 id="orgbe61c7f"><span class="section-number-4">2.10.13.</span> debug <a id="orgfad25a8"></a></h4>
<div class="outline-text-4" id="text-2-10-13">
<p>
Display commands and their arguments as they are executed.
</p>
<ul class="org-ul">
<li>bash -x script-name</li>
<li>set -x - for bash</li>
</ul>

<p>
Display shell input lines as they are read.
</p>
<ul class="org-ul">
<li>set -v - for bash</li>
</ul>

<p>
export _DEBUG=on #  intelligent DEBUG function
</p>

<p>
there is two way for debug: trap command and PROMPT<sub>COMMAND</sub>="echo Bye"
</p>
</div>
<ol class="org-ol">
<li><a id="org1e250ee"></a>links<br />
<div class="outline-text-5" id="text-2-10-13-1">
<ul class="org-ul">
<li><a href="https://www.cyberciti.biz/tips/debugging-shell-script.html">https://www.cyberciti.biz/tips/debugging-shell-script.html</a></li>
<li><a href="https://habr.com/ru/articles/666982/">https://habr.com/ru/articles/666982/</a></li>
</ul>
</div>
</li>
</ol>
</div>
<div id="outline-container-org4846fde" class="outline-4">
<h4 id="org4846fde"><span class="section-number-4">2.10.14.</span> exit status</h4>
<div class="outline-text-4" id="text-2-10-14">
<ul class="org-ul">
<li>$?</li>
<li>exit 5</li>
</ul>

<p>
exit codes:
</p>
<ul class="org-ul">
<li>0           success</li>
<li>1-255       failure (in general)</li>
<li>1 : Miscellaneous errors, such as “divide by zero” and other impermissible operations.</li>
<li>2 : Missing keyword or command, or permission problem.</li>
<li>126         the requested command (file) can't be executed (but was found)</li>
<li>127         command (file) not found</li>
<li>128         according to ABS it's used to report an invalid argument to the exit uiltin, but I wasn't able to verify that in the source code of Bash (see code 255)</li>
<li>128 +        N the shell was terminated by the signal N (also used like this by various other programs), invalid argument to exit.</li>
<li>255          wrong argument to the exit builtin (see code 128)</li>
</ul>
</div>
</div>
<div id="outline-container-org7701081" class="outline-4">
<h4 id="org7701081"><span class="section-number-4">2.10.15.</span> generate random</h4>
<div class="outline-text-4" id="text-2-10-15">
<p>
2 byte unsigned decimal integers,
</p>
<pre class="example">
$ od -vAn -N2 -tu2 &lt; /dev/urandom
24352
</pre>


<p>
1 byte signed decimal integer,
</p>
<pre class="example">
$ od -vAn -N1 -td1 &lt; /dev/urandom
-78
</pre>


<p>
4 byte unsigned decimal integers,
</p>
<pre class="example">
$ od -vAn -N4 -tu4 &lt; /dev/urandom
3394619386
</pre>


<p>
seconds since epoch
</p>
<pre class="example">
date +%s%N | cut -b10-19
</pre>


<p>
RANDOM env variable
</p>
<pre class="example">
echo $RANDOM % 1000 + 1 | bc
</pre>


<p>
shasum
</p>
<pre class="example">
head -100 /dev/urandom | sha1sum | cut -d ' ' -f 1
</pre>
</div>
</div>
<div id="outline-container-orgd56fa26" class="outline-4">
<h4 id="orgd56fa26"><span class="section-number-4">2.10.16.</span> documentation</h4>
<div class="outline-text-4" id="text-2-10-16">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Processes a file.</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">$1 - the name of the input file</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">$2 - the name of the output file</span>
<span style="color: #cae682; font-weight: bold;">process_file</span>(){
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd3004ca" class="outline-4">
<h4 id="orgd3004ca"><span class="section-number-4">2.10.17.</span> best practices</h4>
<div class="outline-text-4" id="text-2-10-17">
<ol class="org-ol">
<li>safer scripts, see <a href="#orgd02d529">2.11</a>:
<ul class="org-ul">
<li>set -euxo pipefail</li>
</ul></li>
<li>Instead of, use:
<ul class="org-ul">
<li>cd "${foo}"; &#x2026; ; cd ..</li>
<li>( cd "${foo}" &#x2026; )</li>
<li>pushd "${foo}"; &#x2026; ; popd</li>
</ul></li>
<li>variables:
<ul class="org-ul">
<li>preffer local</li>
<li>global make readonle declare -r</li>
<li>always refer as "${var}"</li>
</ul></li>
<li>Prepend a command with \ to override alias/builtin lookup. E.g.:
<ul class="org-ul">
<li>t() { ls ;}</li>
<li>alias  t="ls .."</li>
<li>t # refer to alias</li>
<li>\t # refer to function</li>
</ul></li>
<li>For various reasons, printf is preferable to echo
<ul class="org-ul">
<li>error() {  printf "\({red}!!! %s\){reset}\\n" "${*}" 1&gt;&amp;2 ;   }</li>
</ul></li>
<li>Name heredoc tags with what they’re part of, like:</li>
</ol>
<div class="org-src-container">
<pre class="src src-sh">cat &lt;&lt;HELPMSG
<span style="color: #ffff00; font-weight: bold;">  usage $0 [OPTION]... [ARGUMENT]...</span>
<span style="color: #ffff00; font-weight: bold;">HELPMSG</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Single-quote heredocs leading tag to prevent interpolation of text between them.</span>
cat &lt;&lt;<span style="color: #95e454;">'MSG'</span>
<span style="color: #ffff00; font-weight: bold;">  [...]</span>
<span style="color: #ffff00; font-weight: bold;">MSG</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">7)</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">this won't work:</span>
  sudo printf <span style="color: #95e454;">"..."</span> &gt; /root/some_file

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">this will:</span>
  <span style="color: #e5786d;">printf</span> <span style="color: #95e454;">"..."</span> | sudo tee /root/some_file &gt; /dev/null


8) <span style="color: #8ac6f2; font-weight: bold;">if</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Don't do this</span>
  <span style="color: #8ac6f2; font-weight: bold;">if</span> [ <span style="color: #95e454;">"$#"</span> -ge <span style="color: #95e454;">"1"</span> ] &amp;&amp; [ <span style="color: #95e454;">"$1"</span> = <span style="color: #95e454;">'-h'</span> ] || [ <span style="color: #95e454;">"$1"</span> = <span style="color: #95e454;">'--help'</span> ] || [ <span style="color: #95e454;">"$1"</span> = <span style="color: #95e454;">"-?"</span> ]; <span style="color: #8ac6f2; font-weight: bold;">then</span>
    usage
    <span style="color: #8ac6f2; font-weight: bold;">exit</span> 0
  <span style="color: #8ac6f2; font-weight: bold;">fi</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Do this</span>
  help_wanted() {
    [ <span style="color: #95e454;">"$#"</span> -ge <span style="color: #95e454;">"1"</span> ] &amp;&amp; [ <span style="color: #95e454;">"$1"</span> = <span style="color: #95e454;">'-h'</span> ] || [ <span style="color: #95e454;">"$1"</span> = <span style="color: #95e454;">'--help'</span> ] || [ <span style="color: #95e454;">"$1"</span> = <span style="color: #95e454;">"-?"</span> ]
  }

  <span style="color: #8ac6f2; font-weight: bold;">if</span> help_wanted <span style="color: #95e454;">"$@"</span>; <span style="color: #8ac6f2; font-weight: bold;">then</span>
    usage
    <span style="color: #8ac6f2; font-weight: bold;">exit</span> 0
  <span style="color: #8ac6f2; font-weight: bold;">fi</span>
</pre>
</div>

<ol class="org-ol">
<li>Check whether the script is running in the correct folder
<ul class="org-ul">
<li>Allow the script to run in any folder</li>
<li>Allow the script to run in any folder and locate input and output based on the environment</li>
<li>Require the script to be run from a certain folder and test if folder is good.</li>
</ul></li>

<li>write log:</li>
</ol>
<pre class="example">
echo "[${now}] Logfile for $scriptName:  $logFile" 2&gt;&amp;1 | tee $logFile
</pre>


<ol class="org-ol">
<li>Create documentation with -h and &#x2013;help</li>
<li>Clean up function</li>
</ol>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #cae682; font-weight: bold;">finish</span>() {
  <span style="color: #cae682;">result</span>=$<span style="color: #cae682;">?</span>
  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Your cleanup code here</span>
  <span style="color: #8ac6f2; font-weight: bold;">exit</span> ${<span style="color: #cae682;">result</span>}
}
<span style="color: #8ac6f2; font-weight: bold;">trap</span> finish EXIT ERR <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">secuted on EXIT or ERR</span>
</pre>
</div>



<p>
grep pattern file | awk ‘{print $1}’
</p>

<p>
awk ‘/pattern/{print $1}’
</p>
</div>
<ol class="org-ol">
<li><a id="org7fbeeae"></a>links<br />
<div class="outline-text-5" id="text-2-10-17-1">
<ul class="org-ul">
<li><a href="https://www.javacodegeeks.com/2013/10/shell-scripting-best-practices.html">https://www.javacodegeeks.com/2013/10/shell-scripting-best-practices.html</a></li>
<li><a href="https://bertvv.github.io/cheat-sheets/Bash.html">https://bertvv.github.io/cheat-sheets/Bash.html</a></li>
<li><a href="http://redsymbol.net/articles/bash-exit-traps/">http://redsymbol.net/articles/bash-exit-traps/</a></li>
</ul>
</div>
</li>
</ol>
</div>

<div id="outline-container-orgcf9c587" class="outline-4">
<h4 id="orgcf9c587"><span class="section-number-4">2.10.18.</span> export</h4>
<div class="outline-text-4" id="text-2-10-18">
<pre class="example">
export FLASK_RUN_HOST=localhost FLASK_RUN_PORT=8080 ; flask --app main run --no-debug
</pre>


<p>
new bash session will have exports.
</p>
<ul class="org-ul">
<li>-n NAME - disable export</li>
<li>-f - export function</li>
<li>-p - same as env but in order of history of exports.</li>
</ul>
</div>
</div>
<div id="outline-container-orga9d1d1e" class="outline-4">
<h4 id="orga9d1d1e"><span class="section-number-4">2.10.19.</span> null command</h4>
<div class="outline-text-4" id="text-2-10-19">
<pre class="example">

</pre>

<p>
creates the effect of block comments in Bash scripts.
</p>
</div>
</div>
<div id="outline-container-org9fc9537" class="outline-4">
<h4 id="org9fc9537"><span class="section-number-4">2.10.20.</span> multiline comment</h4>
<div class="outline-text-4" id="text-2-10-20">
<div class="org-src-container">
<pre class="src src-bash">: &lt;&lt; <span style="color: #95e454;">'END'</span>
<span style="color: #ffff00; font-weight: bold;">This is a comment</span>
<span style="color: #ffff00; font-weight: bold;">END</span>
</pre>
</div>

<pre class="example">
$100
</pre>
</div>
</div>

<div id="outline-container-org36f75d3" class="outline-4">
<h4 id="org36f75d3"><span class="section-number-4">2.10.21.</span> read</h4>
<div class="outline-text-4" id="text-2-10-21">
<p>
Read a line from the standard input.
</p>
<ul class="org-ul">
<li>-d delim	continue until the first character of DELIM is read, by default '\n'</li>
<li>-r 		If this option is given, backslash does not act as an escape character. The backslash is considered to be
part of the line.</li>
</ul>
<pre class="example">
read -ei asd: aaa ; echo $aaa
&gt;&gt; asd:22345r
&gt;&gt; asd:22345r
</pre>


<pre class="example">
read -d '' &lt;&lt;EOF ... EOF
</pre>


<p>
Collect all input until EOF, exit code = 1
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #e5786d;">read</span> -d <span style="color: #95e454;">''</span> AAA
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">echo $AAA</span>
mypy -c <span style="color: #95e454;">"$AAA"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd5b03b3" class="outline-4">
<h4 id="orgd5b03b3"><span class="section-number-4">2.10.22.</span> Templates</h4>
<div class="outline-text-4" id="text-2-10-22">
<p>
in function check that argument was passed
</p>
<pre class="example">
if [ -z "$1" ] ; then echo brute_loop no \$1 ; return 1 ; fi
</pre>
</div>
</div>
<div id="outline-container-org3121e14" class="outline-4">
<h4 id="org3121e14"><span class="section-number-4">2.10.23.</span> links</h4>
<div class="outline-text-4" id="text-2-10-23">
<p>
<a href="https://devmanual.gentoo.org/tools-reference/bash/index.html">https://devmanual.gentoo.org/tools-reference/bash/index.html</a>
</p>
</div>
</div>
</div>
<div id="outline-container-org402c539" class="outline-3">
<h3 id="org402c539"><span class="section-number-3">2.11.</span> set builtin <a id="orgd02d529"></a></h3>
<div class="outline-text-3" id="text-2-11">
<p>
see <a href="#orgfad25a8">2.10.13</a>
</p>
<pre class="example">
help set
</pre>


<p>
Using + rather than - causes these flags to be turned off.
</p>

<p>
The current set of flags:
</p>
<pre class="example">
echo $- # himBHs
</pre>


<ul class="org-ul">
<li>&#x2013;  Assign any remaining arguments to the positional parameters.</li>
<li>-   Assign any remaining arguments to the positional parameters.</li>
<li>-e  Exit immediately if a command exits with a non-zero status.</li>
<li>-u  Treat unset variables as an error when substituting.</li>
<li>-f  Disable file name generation (globbing). disables filename expansion also known as globbing.</li>
<li>-o pipefail exit execution if one of the commands in the pipe fails.</li>
<li>-v  Print shell input lines as they are read.</li>
<li>-x  Print commands and their arguments as they are executed.</li>
<li>-C  If set, disallow existing regular files to be overwritten by redirection of output</li>
<li>-T  If set, the DEBUG and RETURN traps are inherited by shell functions.</li>
</ul>

<p>
set -e may result in some difficult to debug issues during loops because a failed command will <span class="underline">only exit the subshell created by the pipe</span>
</p>
</div>

<div id="outline-container-orgeb0c27f" class="outline-4">
<h4 id="orgeb0c27f"><span class="section-number-4">2.11.1.</span> usage</h4>
<div class="outline-text-4" id="text-2-11-1">
<p>
Prevent unexpected errors, make shell safer:
</p>
<pre class="example">
set -euxo pipefail
</pre>


<div class="org-src-container">
<pre class="src src-sh"><span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">"unofficial" bash strict mode</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">See: http://redsymbol.net/articles/unofficial-bash-strict-mode</span>
<span style="color: #e5786d;">set</span> -o errexit  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Exit when simple command fails               'set -e'</span>
<span style="color: #e5786d;">set</span> -o errtrace <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Exit on error inside any functions or subshells.</span>
<span style="color: #e5786d;">set</span> -o nounset  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Trigger error when expanding unset variables 'set -u'</span>
<span style="color: #e5786d;">set</span> -o pipefail <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Do not hide errors within pipes              'set -o pipefail'</span>
<span style="color: #e5786d;">set</span> -o xtrace   <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Display expanded command and arguments       'set -x'</span>
<span style="color: #cae682;">IFS</span>=$<span style="color: #95e454;">'\n\t'</span>     <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Split words on \n\t rather than spaces</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org49e37b0" class="outline-4">
<h4 id="org49e37b0"><span class="section-number-4">2.11.2.</span> traps</h4>
<div class="outline-text-4" id="text-2-11-2">
<p>
Defines and activates handlers to be run when the shell receives signals
    or other conditions.
</p>

<pre class="example">
trap --help
</pre>

<ul class="org-ul">
<li>-l	print a list of signal names and their corresponding numbers</li>
<li>-p	display the trap commands associated with each SIGNAL<sub>SPEC</sub></li>
</ul>

<p>
Besides traps(handlers) for signals, bash have 4 special traps:
</p>
<ul class="org-ul">
<li>EXIT to run on exit from the shell.</li>
<li>RETURN to run each time a function or a sources script finishes.</li>
<li>ERR to run each time command failure would cause the shell to exit if set -e is used.</li>
<li>DEBUG to execute before every command.</li>
</ul>

<pre class="example">
trap "echo $BASH_COMMAND" DEBUG
</pre>


<p>
add variable trace attribete to see when it used:
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #e5786d;">declare</span> -t <span style="color: #cae682;">VARIABLE</span>=value
<span style="color: #8ac6f2; font-weight: bold;">trap</span> <span style="color: #95e454;">"echo VARIABLE is being used here."</span> DEBUG
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #e5786d;">set</span> -E <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">If set, the ERR trap is inherited by shell functions.</span>
<span style="color: #e5786d;">set</span> -o pipefail <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">exit execution if one of the commands in the pipe fails.</span>
<span style="color: #e5786d;">set</span> -u <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Report Non-Existent Variables</span>
<span style="color: #8ac6f2; font-weight: bold;">trap</span> <span style="color: #95e454;">'echo $? $LINENO :${BASH_LINENO[@]} "$BASH_COMMAND" ::${FUNCNAME[@]}'</span> ERR
</pre>
</div>
</div>
<ol class="org-ol">
<li><a id="orgb11afd4"></a>links<br />
<div class="outline-text-5" id="text-2-11-2-1">
<ul class="org-ul">
<li><a href="https://selivan.github.io/2022/05/21/bash-debug.html">https://selivan.github.io/2022/05/21/bash-debug.html</a></li>
<li><a href="https://tldp.org/LDP/Bash-Beginners-Guide/html/sect_12_02.html">https://tldp.org/LDP/Bash-Beginners-Guide/html/sect_12_02.html</a></li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-org0e44ab1" class="outline-3">
<h3 id="org0e44ab1"><span class="section-number-3">2.12.</span> ls</h3>
<div class="outline-text-3" id="text-2-12">
<p>
directory -  flat file that maps an name to inode on the filesystem.
</p>

<ul class="org-ul">
<li>ls -al -tr - sort by time, reversal (latest at the bottom) (desc)</li>
<li>ls * - directories and their files/folders - deep 1</li>
<li>ls -d */ - only directories</li>
<li>ls -d .* - dot files</li>
<li>ls -d /home/user/{<b>,.</b>} - directories and all files, include hidden with full path</li>
<li>ls -F appends symbols to filenames */=&gt;@|
<ul class="org-ul">
<li>@ means symbolic link (or that the file has extended attributes).</li>
<li>* means executable.</li>
<li>= means socket.</li>
<li>| means named pipe.</li>
<li>&gt; means door.</li>
<li>/ means directory.</li>
</ul></li>
</ul>

<p>
output in columns with classify
</p>
<pre class="example">
l='ls -F --color' ; paste -d: &lt;($l | grep '/$') &lt;($l | grep '*$') &lt;($l | grep '@$') &lt;($l | grep -v '[/@*]$') | tac| column -t -s ":" -N FOLDERS,EXECUTABLES,LINKS,OTHER
</pre>
</div>
<div id="outline-container-orgc40482e" class="outline-4">
<h4 id="orgc40482e"><span class="section-number-4">2.12.1.</span> get direcotories</h4>
<div class="outline-text-4" id="text-2-12-1">
<ul class="org-ul">
<li>ls -d */</li>
<li>ls -l | grep ^d</li>
<li>find . -maxdepth 1 -type d</li>
<li>echo */</li>
<li>tree -d -L 1</li>
</ul>
</div>
</div>
<div id="outline-container-org8ffadd1" class="outline-4">
<h4 id="org8ffadd1"><span class="section-number-4">2.12.2.</span> Linux File Timestamps</h4>
<div class="outline-text-4" id="text-2-12-2">
<ul class="org-ul">
<li>mtime - modified time - write file's conetents</li>
<li>ctime - change time - tracks metadata changes such as ownership and permissions. It includes renaming a file.</li>
<li>atime - (access time) anyone accessed the file</li>
</ul>

<p>
ls - default mtime
</p>
<ul class="org-ul">
<li>u - atime</li>
<li>c - ctime</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgdac21fb" class="outline-3">
<h3 id="orgdac21fb"><span class="section-number-3">2.13.</span> pushd/popd and dirs</h3>
<div class="outline-text-3" id="text-2-13">
<ul class="org-ul">
<li>dirs -v - to print stack</li>
<li>dirs - cd history without pushd/popd.
<ul class="org-ul">
<li>dirs +0 - current directory</li>
<li>dirs +1 - last directory</li>
<li>~1 = dirs +1</li>
<li>~-0 dirs -0 - first directory in history</li>
</ul></li>
</ul>
<p>
<a href="https://www.howtogeek.com/659146/how-to-use-pushd-and-popd-on-linux/">https://www.howtogeek.com/659146/how-to-use-pushd-and-popd-on-linux/</a>
</p>
</div>
</div>
<div id="outline-container-org657c10a" class="outline-3">
<h3 id="org657c10a"><span class="section-number-3">2.14.</span> sh script</h3>
<div class="outline-text-3" id="text-2-14">
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">!/usr/bin/</span><span style="color: #8ac6f2; font-weight: bold;">env</span><span style="color: #99968b; font-style: italic;"> bash</span>
<span style="color: #e5786d;">set</span> -euxo pipefail

<span style="color: #cae682; font-weight: bold;">help_wanted</span>() {
    [ <span style="color: #95e454;">"$#"</span> -ge <span style="color: #95e454;">"1"</span> ] &amp;&amp; [ <span style="color: #95e454;">"$1"</span> = <span style="color: #95e454;">'-h'</span> ] || [ <span style="color: #95e454;">"$1"</span> = <span style="color: #95e454;">'--help'</span> ] || [ <span style="color: #95e454;">"$1"</span> = <span style="color: #95e454;">"-?"</span> ]
}

<span style="color: #8ac6f2; font-weight: bold;">if</span> help_wanted <span style="color: #95e454;">"$@"</span>; <span style="color: #8ac6f2; font-weight: bold;">then</span>
    usage
    <span style="color: #8ac6f2; font-weight: bold;">exit</span> 0
<span style="color: #8ac6f2; font-weight: bold;">fi</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org224f39d" class="outline-3">
<h3 id="org224f39d"><span class="section-number-3">2.15.</span> source &amp; ./ &amp; exec</h3>
<div class="outline-text-3" id="text-2-15">
<p>
in bash . and source equal
in POSIX:
</p>
<ul class="org-ul">
<li>./script creates a new shell and executes each command in the script within the new shell. When
the end of the script file is encountered, the new shell exits. Any changes in the new shell
caused by the script are lost when the shell exits. (no screen formations)</li>
<li><b>source</b> execute a shell script within the context of the current shell. Since execution takes place
within the context of the current shell, any changes in the shell are retained following the
completion of the shell. (like by yourself)</li>
<li>. script - in the current shell without forking a sub shell (equal to <b>source</b>)</li>
<li>exec ./script - exit shell after finish</li>
</ul>

<p>
The exec command will execute a command in place of the current shell, that is, it terminates the
current shell and starts a new process in its place.
</p>

<p>
exec was often used to execute the last command of a shell script. This would kill the shell
slightly earlier; otherwise, the shell would wait until the last command was finished. This practice
saves a process and some memory.
</p>

<p>
try exec ls. you will be logged out from your login shell.
</p>
</div>
</div>
<div id="outline-container-orgb789acf" class="outline-3">
<h3 id="orgb789acf"><span class="section-number-3">2.16.</span> ariphmetic</h3>
<div class="outline-text-3" id="text-2-16">
<p>
let m=(4 * 1024)
echo $((2*2))
((m-=3)) # m=m-3
((m++)
</p>

<p>
the let command is not specified by POSIX®. The portable alternative is:
[ "$(( &lt;EXPRESSION&gt; ))" -ne 0 ]
</p>

<p>
echo $((2#010)) - binary to decimal
</p>

<p>
expr
</p>
<ul class="org-ul">
<li>is command should be preffered</li>
<li>cannot assign directly to bash variables but instead returns a result on stdout</li>
<li>takes each operator it recognizes as a separate word and then concatenates them into a single expression that's evaluated according to it's own rules (which differ from shell arithmetic).</li>
</ul>
</div>
</div>
<div id="outline-container-orgda4ca81" class="outline-3">
<h3 id="orgda4ca81"><span class="section-number-3">2.17.</span> execute command</h3>
<div class="outline-text-3" id="text-2-17">
<p>
$() or ``
</p>

<p>
. file == source file - execute commands in file in current shell. no need x right
./file - execute file - need x right
</p>

<p>
$( ) has the side-effect of removing trailing newlines from the results.
</p>
</div>
</div>
<div id="outline-container-orgf495c4e" class="outline-3">
<h3 id="orgf495c4e"><span class="section-number-3">2.18.</span> xargs</h3>
<div class="outline-text-3" id="text-2-18">
<ul class="org-ul">
<li>-0, &#x2013;null - Input items are terminated by a null character instead of by whitespace - file or directory
names containing spaces or newlines are correctly handled</li>
<li></li>


<li>transfer input to one line usable as arguments (default echo)</li>
<li>xargs -n 2 # execute command for every two argument, ex diff</li>
</ul>

<p>
ex
</p>
<ul class="org-ul">
<li>find /path -name '*.foo' | xargs -P 24 -I '{}' /cpu/bound/process '{}' -o '{}'.out
<ul class="org-ul">
<li>-P n - Run up to max-procs processes at a time</li>
</ul></li>
<li>cat lines | xargs | tr ' ' ',' =&gt; line1,line2,line3,line4</li>
</ul>
</div>
</div>
<div id="outline-container-orgdefccb7" class="outline-3">
<h3 id="orgdefccb7"><span class="section-number-3">2.19.</span> history save with time</h3>
<div class="outline-text-3" id="text-2-19">
<p>
with timestamp
echo 'export HISTTIMEFORMAT="%d/%m/%y %T "' &gt;&gt; ~/.bash<sub>profile</sub>
</p>
</div>
</div>

<div id="outline-container-orgc1d6388" class="outline-3">
<h3 id="orgc1d6388"><span class="section-number-3">2.20.</span> id -u user</h3>
<div class="outline-text-3" id="text-2-20">
<p>
get user id
</p>
</div>
</div>
<div id="outline-container-org686a4bb" class="outline-3">
<h3 id="org686a4bb"><span class="section-number-3">2.21.</span> diff</h3>
<div class="outline-text-3" id="text-2-21">
<p>
<a href="https://www.math.utah.edu/docs/info/diff_3.html">https://www.math.utah.edu/docs/info/diff_3.html</a>
</p>

<ul class="org-ul">
<li>default</li>
<li>“Copied” context with -c</li>
<li>“Unified” context with -u Instead of displaying the two files separately, it merges them together.</li>
</ul>

<p>
diff one two
</p>

<p>
Default context - no longer widely used (used by git)
</p>
<ul class="org-ul">
<li>`8a12,15' (lar) - after line 8 of one append lines 12-15 of two.</li>
<li>'5,7c8,10' (fct) - change lines 5&#x2013;7 of one to read as lines 8&#x2013;10 of two</li>
<li>`5,7d3' (rdl) - delete lines 5&#x2013;7 of one (which at 3 in two)</li>
<li>&lt; - in one</li>
<li>&gt; - in two</li>
</ul>

<p>
“Copied” context - has context lines without pre-symbols
</p>
<ul class="org-ul">
<li>'!' - changing like</li>
<li>'+' - line of two file (nothin in one)</li>
<li>'-' - line of one file (nothin in two)</li>
</ul>

<p>
“Unified” context - more compact because it omits redundant context lines. GNU patch can apply this format.
</p>
<ul class="org-ul">
<li><b>*</b> from-file from-file-modification-time</li>
<li>&#x2014; to-file to-file-modification time</li>
<li>@@ from-file-range to-file-range @@</li>
<li>'+' line of two file</li>
<li>'-' line of one file</li>
</ul>

<p>
Differences Side by Side diff -y :
</p>
<ul class="org-ul">
<li>`|'    The corresponding lines differ, and they are either both complete or both incomplete.</li>
<li>`&lt;'    The files differ and only the first file contains the line.</li>
<li>`&gt;'    The files differ and only the second file contains the line.</li>
<li>`('    Only the first file contains the line, but the difference is ignored.</li>
<li>`)'    Only the second file contains the line, but the difference is ignored.</li>
<li>`\'    The corresponding lines differ, and only the first line is incomplete.</li>
<li>`/'    The corresponding lines differ, and only the second line is incomplete.</li>
</ul>
</div>
</div>
<div id="outline-container-orgdd83a06" class="outline-3">
<h3 id="orgdd83a06"><span class="section-number-3">2.22.</span> date</h3>
<div class="outline-text-3" id="text-2-22">
<ul class="org-ul">
<li>date +%c &#x2013;date "2022-06-20" =&gt; Mon Jun 20 00:00:00 2022</li>
<li>date +%F &#x2013;date='@2147483647' =&gt; 2038-01-19</li>
<li>date &#x2013;date '06/02/2016 09:01:39' +"%s" =&gt; 1464872499</li>
<li>date +%s =&gt; 1656480511</li>
</ul>
</div>
</div>
<div id="outline-container-org0911f8e" class="outline-3">
<h3 id="org0911f8e"><span class="section-number-3">2.23.</span> ps <a id="org35a0895"></a></h3>
<div class="outline-text-3" id="text-2-23">
<p>
<a href="https://www.computernetworkingnotes.com/linux-tutorials/ps-aux-command-and-ps-command-explained.html">https://www.computernetworkingnotes.com/linux-tutorials/ps-aux-command-and-ps-command-explained.html</a>
</p>

<p>
a:- This option prints the running processes from all users.
u:- This option shows user or owner column in output.
x:- This option prints the processes those have not been executed from the terminal.
</p>

<p>
ps –eo pid,user,%cpu,cmd –-sort=-%cpu | head –n 4
ps –A &#x2013;forest
</p>

<p>
notes:
</p>
<ul class="org-ul">
<li>CPU usage is expressed as the percentage of time spent running during the entire lifetime of a process.</li>
<li>The SIZE and RSS fields don't count some parts of a process including the page tables, kernel stack, struct thread<sub>info</sub>, and struct task<sub>struct</sub>.</li>
<li>SIZE is the virtual size of the process (code+data+stack).</li>
<li>Processes marked &lt;defunct&gt; are dead processes (so-called "zombies") that remain because their parent has not destroyed them properly.</li>
<li>If the length of the username is greater than the length of the display column, the username will be truncated.</li>
</ul>

<p>
PID of the bash script you can use variable $$
</p>
</div>
<div id="outline-container-orgb13eb93" class="outline-4">
<h4 id="orgb13eb93"><span class="section-number-4">2.23.1.</span> Column	Description</h4>
<div class="outline-text-4" id="text-2-23-1">
<p>
USER 	The user account under which this process is running
PID	Process ID of this process
%CPU	CPU time used by this process (in percentage).
%MEM	Physical memory used by this process (in percentage).
VSZ	Virtual memory used by this process (in bytes).
RSS	Resident Set Size, the non-swappable physical memory used by this process (in KiB)
TTY	Terminal from which this process is started. Question mark (?) sign represents that this process is not started from a terminal.
STAT	Process state. Explained in next table.
START	Starting time and date of this process
TIME	Total CPU time used by this process
COMMAND	The command with all its arguments which started this process
</p>
</div>
</div>

<div id="outline-container-orga00db97" class="outline-4">
<h4 id="orga00db97"><span class="section-number-4">2.23.2.</span> stat code with description</h4>
<div class="outline-text-4" id="text-2-23-2">
<p>
D	uninterruptible sleep (usually IO)
R	running or runnable (on run queue)
S	interruptible sleep (waiting for an event to complete)
T	stopped by job control signal
t	stopped by debugger during the tracing
w	paging (not valid since the 2.6.xx kernel)
x	dead (should never be seen)
Z	defunct ("zombie") process, terminated but not reaped by its parent
&lt; 	high-priority (not nice to other users)
N	low-priority (nice to other users)
L	has pages locked into memory (for real-time and custom IO)
s	is a session leader
l	is multi-threaded (using CLONE<sub>THREAD</sub>, like NPTL pthreads do)
</p>
<ul class="org-ul">
<li>is in the foreground process group</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgf56289e" class="outline-3">
<h3 id="orgf56289e"><span class="section-number-3">2.24.</span> top <a id="orgddc6097"></a></h3>
<div class="outline-text-3" id="text-2-24">
<p>
include <b>uptime</b> command
</p>
<pre class="example">
top -d 0.5 # faster
cat /proc/loadavg
</pre>


<p>
sort:
</p>
<ul class="org-ul">
<li>ps -o RES</li>
<li>ps -o +%MEM</li>
<li>f - Field manager
<ul class="org-ul">
<li>s -  current sort field,</li>
<li>q - quit</li>
</ul></li>
</ul>

<p>
control:
</p>
<ul class="org-ul">
<li>? - help</li>
<li>parent-child - V key</li>
<li>kill: press k and enter PID</li>
<li>bold/colur - b/z</li>
<li>renice - r</li>
<li>&lt;/&gt; - sort by column</li>
</ul>

<p>
memory:
</p>
<ul class="org-ul">
<li>%MEM: The percentage of the system’s physical memory in use by this process</li>
<li>VIRT: Virtual memory size</li>
<li>RES: Resident set size: the total physical memory in use by this process</li>
</ul>


<p>
sort by VIRT memory
</p>
<pre class="example">
for i in {1..10};do date; top -b -o +VIRT | head -n 17|tail -11;sleep 5;done
</pre>
</div>
<div id="outline-container-orgbb89ca5" class="outline-4">
<h4 id="orgbb89ca5"><span class="section-number-4">2.24.1.</span> view description</h4>
<div class="outline-text-4" id="text-2-24-1">
<p>
first row:
</p>
<ul class="org-ul">
<li>current time (22 :14:26)</li>
<li>uptime of the machine (up 155 day, 16:33)</li>
<li>users sessions logged in (2 users)</li>
<li>average load: 1, 5, 15 - exponentially-damped moving sums of a five second average</li>
</ul>

<p>
second row:
</p>
<ul class="org-ul">
<li>Total Processes running (866 total)</li>
<li>Running Processes (8 running)</li>
<li>Sleeping Processes (856 sleeping)</li>
<li>Stopped Processes (0 stopped)</li>
</ul>

<p>
CPU line: sum up all the percentages the total will be 100% of the cpu
</p>
<ul class="org-ul">
<li>us, user    : time running un-niced user processes in percentage(18.6%us)</li>
<li>sy, system  : time running kernel processes</li>
<li>ni, nice    : time running niced user processes</li>
<li>id, idle    : time spent in the kernel idle handler</li>
<li>wa, IO-wait : time waiting for I/O completion</li>
<li>hi : time spent servicing hardware interrupts</li>
<li>si : time spent servicing software interrupts</li>
<li>st : time stolen from this vm by the hypervisor</li>
</ul>

<p>
processes
</p>
<ul class="org-ul">
<li>PID – ID of the process(819328)</li>
<li>USER – The user that is the owner of the process (root)</li>
<li>PR – priority of the process (20)</li>
<li>NI – The “NICE” value of the process (0)</li>
<li>VIRT – virtual memory used by the process (3423m)</li>
<li>RES – physical memory used from the process (3.3g)</li>
<li>SHR – shared memory of the process (1788)</li>
<li>S – indicates the status of the process: S=sleep R=running Z=zombie (S)</li>
<li>%CPU – This is the percentage of CPU used by this process (65.9)</li>
<li>%MEM – This is the percentage of RAM used by the process (5.2)</li>
<li>TIME+ –This is the total time of activity of this process (1363:48)</li>
<li>COMMAND – And this is the name of the process (exim)</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org17ea2a7" class="outline-3">
<h3 id="org17ea2a7"><span class="section-number-3">2.25.</span> pgrep</h3>
<div class="outline-text-3" id="text-2-25">
<p>
get all processed by name and kill them
</p>
<pre class="example">
pgrep python | xargs kill -s 9
</pre>
</div>
</div>
<div id="outline-container-org972fb99" class="outline-3">
<h3 id="org972fb99"><span class="section-number-3">2.26.</span> vmstat</h3>
<div class="outline-text-3" id="text-2-26">
<p>
<a href="https://www.howtogeek.com/425232/how-to-securely-delete-files-on-linux/">https://www.howtogeek.com/425232/how-to-securely-delete-files-on-linux/</a>
</p>


<p>
Since last reboot
</p>

<p>
vmstat 2 -d -S M
</p>
<ul class="org-ul">
<li>2 sec recreate</li>
<li></li>
</ul>


<ul class="org-ul">
<li>-a - active and inactive memory</li>
<li>-f -  shows the number of tasks that have been launched</li>
<li>-d - disk</li>
<li>-D - summary statistics for your disk activity</li>
<li>-p sda1</li>
</ul>
</div>
</div>
<div id="outline-container-orgf573286" class="outline-3">
<h3 id="orgf573286"><span class="section-number-3">2.27.</span> pmap</h3>
<div class="outline-text-3" id="text-2-27">
<p>
report memory map of a process
</p>
<pre class="example">
pmap -x $(pidof bash | cut -d ' ' -f 1) | head -n-2 | tail -n+3 | grep -v deleted | sort -k2 -n | awk '{sum+=$2} END {print sum/1024 " MiB"}'
</pre>
</div>
</div>
<div id="outline-container-org78bddcb" class="outline-3">
<h3 id="org78bddcb"><span class="section-number-3">2.28.</span> find</h3>
<div class="outline-text-3" id="text-2-28">
<p>
find files by name and execute command:
</p>
<ul class="org-ul">
<li>find . -type f -name "*.txt" -exec ls -l {} +</li>
<li>find . -type f -name "*.txt" | xargs ls -l</li>
<li>find . -type f -name "*.txt" -exec mv {} {}.old \;</li>
</ul>
<p>
multiple file extensions:
</p>
<ul class="org-ul">
<li>find . -type f \( -name "*.sh" -o -name "*.txt" \)</li>
</ul>
<p>
find directory:
</p>
<ul class="org-ul">
<li>find . -type d -iname So* -ls
<ul class="org-ul">
<li>-ls - print in ls -al format</li>
</ul></li>
</ul>
</div>
<div id="outline-container-org9ffe2c2" class="outline-4">
<h4 id="org9ffe2c2"><span class="section-number-4">2.28.1.</span> find [options] [starting-point&#x2026;] [ex‐pression]</h4>
<div class="outline-text-4" id="text-2-28-1">
<p>
expressions:
</p>
<ul class="org-ul">
<li>TESTS:
<ul class="org-ul">
<li>-amin n File was last accessed less than, more than or exactly n minutes ago.</li>
<li>-empty File is empty and is either a regular file or a directory.</li>
<li>-executable Matches  files  which  are  executable</li>
<li>-group gname File belongs to group gname (numeric group ID allowed).</li>
<li>-iname pattern  Like -name, but the match is case insensitive.</li>
<li>-name pattern  Base of file name</li>
<li>-links n  has less than, more than or exactly n hard links.</li>
<li>-nouser No user corresponds to file's numeric user ID.</li>
<li>-perm -a+r,u+w</li>
<li>-readable  Matches  files  which  are  readable  by the current user.</li>
<li>-size 2M</li>
<li>-type c
<ul class="org-ul">
<li>b      block (buffered) special</li>
<li>c      character (unbuffered) special</li>
<li>d      directory</li>
<li>p      named pipe (FIFO)</li>
<li>f      regular file</li>
<li>l      symbolic link;</li>
<li>s      socket</li>
<li>D      door (Solaris)</li>
</ul></li>
<li>-user uname File is owned by user uname (numeric user ID allowed).</li>
</ul></li>
<li>ACTION
<ul class="org-ul">
<li>-delete</li>
<li>exec command ;</li>
<li>-print full file name</li>
<li>-quit exit</li>
</ul></li>
</ul>

<p>
when {} used - at the end must be:
</p>
<ul class="org-ul">
<li>+ - result: ls -l file1 file2 file3</li>
<li>\; -  {} may be used more than once in the same exec statement, result: ls -l file1, ls -l file2</li>
</ul>
</div>
</div>

<div id="outline-container-org8c2d212" class="outline-4">
<h4 id="org8c2d212"><span class="section-number-4">2.28.2.</span> links</h4>
<div class="outline-text-4" id="text-2-28-2">
<p>
<a href="https://www.howtogeek.com/425408/how-to-use-all-linuxs-search-commands/">https://www.howtogeek.com/425408/how-to-use-all-linuxs-search-commands/</a>
</p>
</div>
</div>
</div>

<div id="outline-container-orgc9ff91d" class="outline-3">
<h3 id="orgc9ff91d"><span class="section-number-3">2.29.</span> dd</h3>
<div class="outline-text-3" id="text-2-29">
</div>
<div id="outline-container-org1ad68c0" class="outline-4">
<h4 id="org1ad68c0"><span class="section-number-4">2.29.1.</span> usecases</h4>
<div class="outline-text-4" id="text-2-29-1">
<p>
create:
dd if=/dev/zero of=test.img bs=1 count 0 seek=10G
</p>

<p>
resize +2G:
e2fsck -f test.img
resize2fs test.img 12G
e2fsck -f test.img
</p>


<p>
&#x2014;
Iso Disk write:
cdrecord dev=0,0,0 -eject -dao debian-testing-amd64-xfce-CD-1.iso
</p>

<p>
dd if=/a.iso of=/dev/sdc bs=8192k
</p>

<p>
dd if=tails.img of=/dev/sda bs=16M oflag=direct status=progress
</p>

<p>
dd if=gentoo.iso of=/dev/sda bs=4M oflag=direct status=progress
</p>

<p>
dd bs=16M if=/dev/sda3 | ssh root@serverB "dd bs=16M of=/dev/sda3"
</p>
</div>
</div>
<div id="outline-container-orgcd1afcc" class="outline-4">
<h4 id="orgcd1afcc"><span class="section-number-4">2.29.2.</span> bs</h4>
<div class="outline-text-4" id="text-2-29-2">
<p>
read and write up to BYTES bytes at a time (default: 512); overrides ibs and obs
</p>
</div>

<ol class="org-ol">
<li><a id="org3a07281"></a>block size theory<br />
<div class="outline-text-5" id="text-2-29-2-1">
<p>
Block devices and block sizes
</p>
<ul class="org-ul">
<li>For example hard disks, cdrom drives and floppies are block devices, but not the keyboard.</li>
<li>file system needs to split up a partition into blocks to store files and file parts (another block size)</li>
<li>Most hard drives shipped with 512 byte sector/block sizes.</li>
</ul>


<p>
Logical and Physical Sector Size
</p>
<ul class="org-ul">
<li>Advanced Format, same as 4K sector technology, uses the storage surface media more efficiently by combining</li>
</ul>
<p>
data that would have been stored in eight 512-byte sectors into one single sector that is 4096 bytes (4 KiB)
in length.
</p>
<ul class="org-ul">
<li>any data transfers between the disk and the computer still use the common 512-byte block size.</li>
<li>the disk is addressable in 512-byte blocks, but performance will be better if the OS arranges the disk
operations to take into account the 4096-byte internal block size.</li>
</ul>

<p>
filesystem block size:
</p>
<ul class="org-ul">
<li>tune2fs -l /dev/sdb2</li>
<li>file -s /dev/sda1</li>
<li>stat -fc %s .</li>
<li>blockdev &#x2013;getbsz /dev/sda # change when mounted</li>
</ul>

<p>
Kernel block size
</p>
<ul class="org-ul">
<li>All linux blocks are currently 1024 bytes.</li>
</ul>

<p>
<a href="https://www.baeldung.com/linux/dd-optimal-blocksize">https://www.baeldung.com/linux/dd-optimal-blocksize</a>
</p>
</div>
</li>
</ol>
</div>
<div id="outline-container-org5699861" class="outline-4">
<h4 id="org5699861"><span class="section-number-4">2.29.3.</span> cteate disk</h4>
<div class="outline-text-4" id="text-2-29-3">
<p>
dd if=/dev/zero of=/mnt/sda5/tdisk.img bs=1 seek=40G count=1
Discarding device blocks:     4096/10485760                 done
Creating filesystem with 10485760 4k blocks and 2621440 inodes
Filesystem UUID: 351a17dd-246d-49f5-b871-dde0cf38c1c4
Superblock backups stored on blocks:
	32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208,
	4096000, 7962624
</p>

<p>
Allocating group tables:   0/320       done
Writing inode tables:   0/320       done
Creating journal (65536 blocks): done
Writing superblocks and filesystem accounting information:   0/320       done
</p>

<p>
mkfs.ext4 tdisk.img
</p>


<p>
.
</p>
</div>
</div>
</div>
<div id="outline-container-org7228bd5" class="outline-3">
<h3 id="org7228bd5"><span class="section-number-3">2.30.</span> access control to files</h3>
<div class="outline-text-3" id="text-2-30">
<ul class="org-ul">
<li>lsattr</li>
<li>chattr</li>
<li>chmod</li>
<li>chown</li>
<li>stat</li>
</ul>
</div>
</div>
<div id="outline-container-org8b22236" class="outline-3">
<h3 id="org8b22236"><span class="section-number-3">2.31.</span> for external storages</h3>
<div class="outline-text-3" id="text-2-31">
<ul class="org-ul">
<li>lsblk -p - list block devices, find connected USB Flash</li>
<li>parted - partition table
<ul class="org-ul">
<li>parted -l  - list partitions on all disks</li>
</ul></li>
<li>fdisk - partition table
<ul class="org-ul">
<li>fdisk -l</li>
</ul></li>
<li>dd
<ul class="org-ul">
<li>status=progress - useful to see what's happening</li>
</ul></li>
<li>sync - Synchronize cached writes to persistent storagem, when u write to USB</li>
</ul>
</div>
</div>

<div id="outline-container-orgb93638b" class="outline-3">
<h3 id="orgb93638b"><span class="section-number-3">2.32.</span> filesystem block size</h3>
<div class="outline-text-3" id="text-2-32">
<ul class="org-ul">
<li>tune2fs -l /dev/sdb2</li>
<li>file -s /dev/sda1</li>
<li>stat -fc %s .</li>
<li>blockdev &#x2013;getbsz /dev/sda # change when mounted</li>
</ul>
</div>
</div>

<div id="outline-container-org0f496f3" class="outline-3">
<h3 id="org0f496f3"><span class="section-number-3">2.33.</span> tar</h3>
<div class="outline-text-3" id="text-2-33">
<p>
tar.gz:
</p>
<ul class="org-ul">
<li>crate: tar -czf a.tar.gz /</li>
<li>extract: tar xpzf  &#x2013;xattrs-include=' <b>.</b>' &#x2013;numeric-owner a.tar.gz
<ul class="org-ul">
<li>-p, &#x2013;preserve-permissions (default for supe ruser)</li>
</ul></li>
<li>inspect: tar ztf/tf m.tar.gz/m.tar</li>
<li>create from files: tar &#x2013;totals -cvf a.tar file1 file2 file3</li>
</ul>

<p>
common archives and commands to extract
</p>
<ul class="org-ul">
<li>.tar 	-xvf</li>
<li>.tar.gz	-xvzf</li>
<li>.tar.bz2	-xvjf</li>
<li>.tar.xz	-xJf</li>
<li>.tar.lzma	-xlf</li>
<li>.tar.lzo	-xlOf</li>
<li>.tar.zst	-xIf</li>
</ul>
</div>
</div>

<div id="outline-container-orgf53b46f" class="outline-3">
<h3 id="orgf53b46f"><span class="section-number-3">2.34.</span> compression</h3>
<div class="outline-text-3" id="text-2-34">
<p>
TOP for texts:
</p>
<ul class="org-ul">
<li>7z - LZMA compression algorithm</li>
<li>xz</li>
<li>bzip2 - BWT</li>
<li>rar</li>
<li>gzip - LZ77</li>
<li>zip</li>
</ul>

<p>
TOP for mixed:
</p>
<ul class="org-ul">
<li>rar</li>
<li>7z</li>
<li>zip</li>
<li>bzip2</li>
<li>gzip</li>
</ul>

<p>
my for texts 518MB :
</p>
<ul class="org-ul">
<li>time tar.xz - real	1m49.582s, user	1m50.062s - 44M</li>
<li>time tar.7z - real	0m55.497s, user	1m43.210s - 44M</li>
<li>time tar.bz2 - real	0m33.160s, user	0m31.348s - 48M</li>
<li>time tar.gz - real	0m10.430s, user	0m8.876s - 59M</li>
</ul>

<p>
texts &lt; 14370 chars:
</p>
<pre class="example">
cat file  | gzip -f - |base64 | base64 -d | gzip -d -
</pre>

<p>
for text &gt; 14370 chars:
</p>
<pre class="example">
cat file  | bzip2 |base64 | base64 -d | bzip2 -d
</pre>
</div>
<div id="outline-container-orgb7f786b" class="outline-4">
<h4 id="orgb7f786b"><span class="section-number-4">2.34.1.</span> tar.7z</h4>
<div class="outline-text-4" id="text-2-34-1">
<p>
compress:
</p>
<pre class="example">
tar cf - &lt;source folder&gt; | 7z a -si &lt;Destination archive&gt;.tar.7z
</pre>

<p>
decompress
</p>
<pre class="example">
7z x -so yourfile.tar.7z | tar xf - -C target_dir
</pre>
</div>
</div>
<div id="outline-container-orgb0e0cb6" class="outline-4">
<h4 id="orgb0e0cb6"><span class="section-number-4">2.34.2.</span> zip</h4>
<div class="outline-text-4" id="text-2-34-2">
<p>
create:
</p>
<ul class="org-ul">
<li>zip a f	# creat a.zip with f file</li>
<li>zip -r a f	# creat a.zip with with f folder and all it's files</li>
<li></li>
</ul>

<p>
inspect archive: unzip -l a.zip
</p>

<p>
extract:
</p>
<ul class="org-ul">
<li>unzip test<sub>archive.zip</sub> -d ./Music</li>
</ul>
</div>

<ol class="org-ol">
<li><a id="orgd8528a9"></a>zip chunks/multi-part/split<br />
<div class="outline-text-5" id="text-2-34-2-1">
<p>
to chunks:
</p>
<ul class="org-ul">
<li>zip -r -s &lt;size in megabytes&gt;M &lt;new<sub>file</sub>&gt;.zip &lt;folder&gt;/*</li>
</ul>
<p>
to single archive (myfiles.z01, myfiles.z02, myfiles.z03):
</p>
<ul class="org-ul">
<li>zip -F myfiles.zip &#x2013;out single-archive.zip</li>
</ul>
<p>
decompress:
</p>
<ul class="org-ul">
<li>All parts must be concatenated together in order, and then ``zip -F'' (for zip 2.x) or ``zip -FF'' (for zip
3.x) must be performed on the concatenated archive in order to ``fix'' it</li>
<li>unzip -l - list archive files</li>
</ul>
</div>
</li>
</ol>
</div>
<div id="outline-container-org21e7aa4" class="outline-4">
<h4 id="org21e7aa4"><span class="section-number-4">2.34.3.</span> links</h4>
<div class="outline-text-4" id="text-2-34-3">
<ul class="org-ul">
<li><a href="https://www.mattmahoney.net/dc/text.html">https://www.mattmahoney.net/dc/text.html</a></li>
<li><a href="https://www.mattmahoney.net/dc/10gb.html">https://www.mattmahoney.net/dc/10gb.html</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgc857e9c" class="outline-3">
<h3 id="orgc857e9c"><span class="section-number-3">2.35.</span> curl</h3>
<div class="outline-text-3" id="text-2-35">
<ul class="org-ul">
<li>proxy support</li>
<li>user authentication</li>
<li>ftp upload</li>
<li>SSL connections</li>
<li>cookies</li>
<li>file transfer resume and more</li>
</ul>
</div>

<div id="outline-container-orga0b8295" class="outline-4">
<h4 id="orga0b8295"><span class="section-number-4">2.35.1.</span> SOCKS5 proxy</h4>
<div class="outline-text-4" id="text-2-35-1">
<ul class="org-ul">
<li>curl -x socks5h://localhost:8080 api.ipify.org</li>
</ul>
</div>
</div>

<div id="outline-container-orgc77829c" class="outline-4">
<h4 id="orgc77829c"><span class="section-number-4">2.35.2.</span> mimic browser request:</h4>
<div class="outline-text-4" id="text-2-35-2">
<ul class="org-ul">
<li>curl &#x2013;http0.9 -vvv -H "Accept: application/xml" -A "Mozilla" <a href="http://a.ru">http://a.ru</a></li>
</ul>
</div>
</div>
<div id="outline-container-org2fb931e" class="outline-4">
<h4 id="org2fb931e"><span class="section-number-4">2.35.3.</span> POST GET</h4>
<div class="outline-text-4" id="text-2-35-3">
<p>
POST file:
</p>
<ul class="org-ul">
<li>curl -X POST -F file1=@/art.jpg <a href="http://site.com/api/upload">http://site.com/api/upload</a></li>
<li>curl -i -X POST host:port/post-file  -H "Content-Type: text/xml" &#x2013;data-binary "@path/to/file"</li>
<li></li>
</ul>

<p>
GET
</p>
<ul class="org-ul">
<li>curl -X GET "<a href="http://anonchek.ru/get?id=a43219ce4a4a490d9cd34beb718cb09f">http://anonchek.ru/get?id=a43219ce4a4a490d9cd34beb718cb09f</a>" -H  "accept: application/json"</li>
<li>curl -Gv 'https://geocode-maps.yandex.ru/1.x/?apikey=ba47e54a-61a5-49af-9c84-558d92b35a33&amp;format=json' &#x2013;data-urlencode 'geocode=Тверская 6'</li>
</ul>

<p>
you cannot really use the -d/&#x2013;data option if this is not a POST request. But this is still possible if you
 use the -G option.
</p>
<ul class="org-ul">
<li>curl -X DELETE -G 'http://localhost:5000/locations' -d 'id=3'</li>
<li></li>
</ul>
</div>
</div>
<div id="outline-container-org913f084" class="outline-4">
<h4 id="org913f084"><span class="section-number-4">2.35.4.</span> POST paramters</h4>
<div class="outline-text-4" id="text-2-35-4">
<p>
&#x2013;url-query
</p>
<ul class="org-ul">
<li>&#x2013;url-query name=val</li>
<li>&#x2013;url-query "+name=%20foo"</li>
<li>&#x2013;url-query @fileonly</li>
<li>&#x2013;url-query name@file</li>
<li>&#x2013;url-query =encodethis</li>
</ul>

<p>
-d
</p>
<ul class="org-ul">
<li>-d "name=curl" -d "tool=cmdline"</li>
<li>-d @filename</li>
</ul>

<p>
&#x2013;data-urlencode - as -d buth with urlencode
</p>
<ul class="org-ul">
<li>&#x2013;data-urlencode name=val</li>
<li>&#x2013;data-urlencode =encodethis</li>
<li>-data-urlencode name@file</li>
<li>&#x2013;data-urlencode @fileonly</li>
</ul>

<p>
&#x2013;data-raw - without the special interpretation of the @ character
</p>

<p>
&#x2013;data-binary @filename
</p>

<p>
&#x2013;data-ascii alias to -d
</p>

<p>
-I,  &#x2013;head
</p>

<p>
-F or &#x2013;form
</p>

<p>
-T, &#x2013;upload-file
</p>
</div>
</div>

<div id="outline-container-org5a9c930" class="outline-4">
<h4 id="org5a9c930"><span class="section-number-4">2.35.5.</span> FTP</h4>
<div class="outline-text-4" id="text-2-35-5">
<p>
upload folder
</p>
<pre class="example">
find mydir -type f -exec curl -u xxx:psw --ftp-create-dirs -T {} ftp://192.168.1.158/public/demon_test/{} \;
</pre>

<p>
upload file
</p>
<pre class="example">
curl -g -k -T "Armored Core 4 [BLES00039].iso" ftp://192.168.1.101/dev_hdd0/GAMES/
</pre>
</div>
</div>
</div>
<div id="outline-container-orga5209f2" class="outline-3">
<h3 id="orga5209f2"><span class="section-number-3">2.36.</span> du - file space usage</h3>
<div class="outline-text-3" id="text-2-36">
<p>
du -h -x -s &#x2013; * | sort -r -h | head -20 - biggest files
</p>
</div>
</div>
<div id="outline-container-org6d8355a" class="outline-3">
<h3 id="org6d8355a"><span class="section-number-3">2.37.</span> man, info, help</h3>
<div class="outline-text-3" id="text-2-37">
</div>
<div id="outline-container-orgdb2b7d4" class="outline-4">
<h4 id="orgdb2b7d4"><span class="section-number-4">2.37.1.</span> history</h4>
<div class="outline-text-4" id="text-2-37-1">
<p>
Man pages - UNIX traditional way of distributing documentation about programs.
</p>

<p>
GNU advocates against the use of man pages at all and contends that complex software systems should have
 complete and comprehensive documentation rather than just a set of short man pages.
</p>

<p>
help is a built-in command in the bash shell (and that shell only) that documents some of the builtin commands
 and keywords of that shell
</p>
</div>
</div>

<div id="outline-container-org4f25a95" class="outline-4">
<h4 id="org4f25a95"><span class="section-number-4">2.37.2.</span> man</h4>
<div class="outline-text-4" id="text-2-37-2">
</div>
<ol class="org-ol">
<li><a id="org55bb196"></a>terms<br />
<div class="outline-text-5" id="text-2-37-2-1">
<p>
convention to the layout of man pages (sections of page): Name, Synopsis, Configuration, Description, Options, &#x2026; etc.
</p>

<p>
page - name of program or function.
</p>

<p>
pages located in <b>sections</b> 1-9. (groups of pages) see: $ man man
</p>
<ul class="org-ul">
<li>man man.7 or man 7 man or man 'man(7)'</li>
</ul>
</div>
</li>
<li><a id="org7e7c1c7"></a>arguments<br />
<div class="outline-text-5" id="text-2-37-2-2">
<ul class="org-ul">
<li>-a	display all pages, wihtout will exit after displaying the most suitable manual page it finds.</li>
<li>-aw	print list of exisitng pages</li>
<li>&#x2013;wildcard gl* - to use wildcard in term</li>
<li>&#x2013;regex gl.*</li>
<li>-k search -s 3	 list of all man pages which relate to 'search' in section 3</li>
<li>man -P 'less -p ^EXAMPLES' man	to get EXAMPLES section for man comman</li>
<li>man tcpdump | less -Ip examples</li>
</ul>
</div>
</li>
<li><a id="orga4fc645"></a>keys<br />
<div class="outline-text-5" id="text-2-37-2-3">
<ul class="org-ul">
<li>h		help</li>
<li>/ and ?	search forward/backward
<ul class="org-ul">
<li>n/N	search forward, backward</li>
</ul></li>
<li>Ctrl + k/n	up/down</li>
<li>u / d	Scroll up/down by half a page</li>
<li>b / space	Scroll up/down by a page</li>
<li>highlighting on and off, press Esc+U.</li>
</ul>
</div>
</li>
</ol>
</div>
<div id="outline-container-orga7b0b58" class="outline-4">
<h4 id="orga7b0b58"><span class="section-number-4">2.37.3.</span> info <a id="org5e552a6"></a></h4>
<div class="outline-text-4" id="text-2-37-3">
</div>
<ol class="org-ol">
<li><a id="orgc8b3916"></a>info command line arguments<br />
<div class="outline-text-5" id="text-2-37-3-1">
<dl class="org-dl">
<dt>-a</dt><dd>get list of all manuals for term</dd>
<dt>-k</dt><dd>look up string in all indices of all manuals</dd>
<dt>-d</dt><dd></dd>

<dt>-O</dt><dd>command line options for command</dd>
</dl>
</div>
</li>

<li><a id="orge199d2e"></a>terms:<br />
<div class="outline-text-5" id="text-2-37-3-2">
<ul class="org-ul">
<li>node - page</li>
</ul>
</div>
</li>

<li><a id="org1af2137"></a>keys:<br />
<div class="outline-text-5" id="text-2-37-3-3">
<p>
navigation
</p>
<ul class="org-ul">
<li>d		directory node - internal mode</li>
<li>n/p or <code>[/]</code> next/previous node</li>
<li>u		up node (level)</li>
<li>l/r		go back/forward - return from reference</li>
<li>t		top node</li>
</ul>

<p>
help
</p>
<ul class="org-ul">
<li>h 		help</li>
<li>H		Basic info command keys</li>
<li>q		quit</li>

<li>C-n/p	next/previous line</li>
<li>//?		search
<ul class="org-ul">
<li>}/{ or C-x n/p	next/previous</li>
<li>R			toggle regex search</li>
</ul></li>
<li>M-/		tree search in current node tree, Global search!</li>
<li>TAB/S-TAB	next/previous reference</li>
<li>C-x C-b	list of visiter references with locations of files</li>
<li>t/T		default - major nodes and detail or full one tree.</li>
<li>C-x 1	Delete all other windows.</li>
<li>x		Delete current window.</li>
</ul>

<p>
Backspace or ] - back and up level
space or [ - forward and down
</p>

<p>
b - top of buffer
1-9 - pick node in menu
</p>

<p>
&lt; - top page
&gt; - bottom page
</p>

<p>
l - go back at history
r - go forward at history
</p>

<p>
i - search for topoc and go to the index
</p>

<p>
Cross reference - link to another topic
Follow cross reference - just RET or f name<sub>of</sub><sub>reference</sub>
f? - get list of references
Tab - scroll references at page (very useful)
l - go back
</p>

<p>
d - directory
</p>
</div>
</li>

<li><a id="org3b788b5"></a>search sequence<br />
<div class="outline-text-5" id="text-2-37-3-4">
<ul class="org-ul">
<li>d	directory node</li>
<li>m	Pick a menu item specified by name with completion</li>
<li>i	Search for a specified string in the index</li>
</ul>

<p>
M-x apropos
</p>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-orgcbedb7a" class="outline-3">
<h3 id="orgcbedb7a"><span class="section-number-3">2.38.</span> less</h3>
<div class="outline-text-3" id="text-2-38">
<p>
man tcpdump | less -Ip examples
</p>
<ul class="org-ul">
<li>I - IGNORE-CASE</li>
<li>p - pattern</li>
</ul>
</div>
</div>
<div id="outline-container-org12684f7" class="outline-3">
<h3 id="org12684f7"><span class="section-number-3">2.39.</span> date</h3>
<div class="outline-text-3" id="text-2-39">
<p>
set time:
</p>
<ul class="org-ul">
<li>date +%Y%m%d -s "20220429"</li>
<li>date -s "19:35"</li>
</ul>
<p>
epoch to time:
</p>
<ul class="org-ul">
<li>date -d @1234567890</li>
</ul>
</div>
</div>

<div id="outline-container-org19269f4" class="outline-3">
<h3 id="org19269f4"><span class="section-number-3">2.40.</span> tee</h3>
<div class="outline-text-3" id="text-2-40">
<p>
append line to file and to STDOUT
</p>
<pre class="example">
echo "as" | tee -a /etc/fstab
</pre>
</div>
<div id="outline-container-orgb0c0d90" class="outline-4">
<h4 id="orgb0c0d90"><span class="section-number-4">2.40.1.</span> freeze problem</h4>
<div class="outline-text-4" id="text-2-40-1">
<p>
tee inside the process substitution will not exit until it gets an eof on its stdin or some error happens.
</p>
</div>
</div>
</div>
<div id="outline-container-org419d03b" class="outline-3">
<h3 id="org419d03b"><span class="section-number-3">2.41.</span> time</h3>
<div class="outline-text-3" id="text-2-41">
<ul class="org-ul">
<li>real - time from start to finish of the call.</li>
<li>user - amount of CPU time spent in user-mode code (outside the kernel) within the process. This is only actual CPU</li>
</ul>
<p>
time used in executing the process.
</p>
<ul class="org-ul">
<li>Sys - is the amount of CPU time spent in the kernel within the process.</li>
</ul>

<p>
other explanation.
</p>
<ul class="org-ul">
<li>Real time is wall clock time. (what we could measure with a stopwatch)</li>
<li>User time is the amount of time spend in user-mode within the process</li>
<li>Sys is the CPU time spend in the kernel within the process.</li>
</ul>

<p>
Wall time, or the amount of time that passes between you starting the process and the process ending.
</p>

<p>
(Wall time) - (CPU time) = (time the CPU spent doing other things)
</p>

<p>
cases
</p>
<ul class="org-ul">
<li>real &lt; user: The process is CPU bound and takes advantage of parallel execution on multiple cores/CPUs.</li>
<li>real ≈ user: The process is CPU bound and takes no advantage of parallel exeuction.</li>
<li>real &gt; user: The process is I/O bound. Execution on multiple cores would be of little to no advantage.</li>
</ul>
</div>
</div>

<div id="outline-container-orgbf8d280" class="outline-3">
<h3 id="orgbf8d280"><span class="section-number-3">2.42.</span> lsfd</h3>
<div class="outline-text-3" id="text-2-42">
<p>
files opende by processes of user:
lsfd -Q 'USER == "larry"'
</p>
</div>
</div>
<div id="outline-container-orgbbc4a31" class="outline-3">
<h3 id="orgbbc4a31"><span class="section-number-3">2.43.</span> fuser</h3>
<div class="outline-text-3" id="text-2-43">
<p>
find process on port:
</p>
<pre class="example">
fuser -nv tcp 80
</pre>
</div>
</div>
<div id="outline-container-orgc996d92" class="outline-3">
<h3 id="orgc996d92"><span class="section-number-3">2.44.</span> administration commands</h3>
<div class="outline-text-3" id="text-2-44">
<ul class="org-ul">
<li>мониторинга процессов (ps, top, htop, atop, lsof)</li>
<li>проверок производительности системы (nmon, iostat, sar, vmstat)</li>
<li>утилитами диагностики сетевых подключений (ping, traceroute, mtr, nmap, netstat, tcpdupm, dig, scp),</li>
<li>файрволов Linux (ufw/firewalld, iptables/nftables)</li>
</ul>
</div>
<div id="outline-container-org5821b7f" class="outline-4">
<h4 id="org5821b7f"><span class="section-number-4">2.44.1.</span> memory</h4>
<div class="outline-text-4" id="text-2-44-1">
<ul class="org-ul">
<li>dmesg | grep Memory:  - RAM memory available in kilobytes.</li>
<li>cat /proc/meminfo, free
<ul class="org-ul">
<li>free - idle memory</li>
<li>buff/cache - memory used for cache but available.</li>
</ul></li>
<li>vmstat -w - first report produced gives averages since the last reboot, additional for delay period.</li>
<li>vmstat -wa - active/inactive</li>
</ul>


<p>
Context switching
</p>
<ul class="org-ul">
<li>Context switching can be due to multitasking, Interrupt handling , user &amp; kernel mode switching. The
interrupt rate will naturally go high, if there is higher network traffic, or higher disk traffic. Also it is
dependent on the application which every now and then invoking system calls.</li>
<li>If the cores/CPU's are not sufficient to handle load of threads created by application will also result in context switching.</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgb9afc3f" class="outline-3">
<h3 id="orgb9afc3f"><span class="section-number-3">2.45.</span> USECASES</h3>
<div class="outline-text-3" id="text-2-45">
<ul class="org-ul">
<li>print column:
<ul class="org-ul">
<li>ps | awk '{print $2}'</li>
<li>ps | tr -s ' ' | cut -d ' ' -f 3</li>
</ul></li>
<li>find duplicated files:
<ul class="org-ul">
<li>find ./ -type f -exec md5sum '{}' ';' &gt; dupl</li>
<li>cat dupl  | sort | uniq &#x2013;all-repeated=separate -w 15 | grep '\.\/' | uniq -w 15 | cut -c 35- | xargs rm</li>
</ul></li>
<li>copy files from stdinput | xargs -I{} cp -u {} /destination/path</li>
<li>rename multiple files: find . -depth -name "*.html" -exec sh -c 'f="{}"; mv &#x2013; "\(f" "\){f%.html}.php"' \;</li>
</ul>


<ul class="org-ul">
<li>sync directories:  # rsync -aqxP /var/* /mnt/newvar</li>
<li>вывод в файл и stdout: cmd | tee file</li>
<li>list directories: ls -d */</li>
<li>read file line by line:  while read -r line;do echo "$line";done &lt; file</li>
<li>message window: xmessage -timeout 50 "MESSAGE HERE!!!"</li>
<li>execute for every file: find . -name "*.jpg" -maxdepth 1 -type f -exec ~/firef \{\} \; -exec sleep 1 \; -exec pkill firefox \;
<ul class="org-ul">
<li>find . -name "*.mpg" -maxdepth 1 -type f   -exec sh -c "firefox {} &amp; sleep 10 ; pkill firefox ;" \;</li>
<li>for f in *.txt; do echo "$f"; done</li>
</ul></li>
<li>zip
<ul class="org-ul">
<li>for f in ./* ; do zip -r "\({f:2}".zip "\){f:2}" ; done # all folders</li>
<li>for f in ./* ; do zip -r "${f:2}".zip "$f" ; done # all files</li>
</ul></li>
</ul>

<p>
<b>time elapsed</b>
</p>
<pre class="example">
SECONDS=0 ;  while true ; sleep 1 ; do echo -ne "\r" $SECONDS ; done
</pre>


<p>
<b>get parent process</b>
</p>
<ul class="org-ul">
<li>ps -o ppid= -p 21509</li>
<li>pstree -s -p 21509</li>
</ul>

<p>
<b>filename filepath</b>
</p>
<ul class="org-ul">
<li>basename $fspec # get filename</li>
<li>dirname $fspec # get filedir</li>
</ul>

<p>
<b>split and rejoin big file</b>
</p>
<ul class="org-ul">
<li>split -d -b 1M file file<sub>prefix</sub>_
<ul class="org-ul">
<li>-b 1M put SIZE bytes per output file</li>
<li>-d use numeric suffixes starting at 0, not alphabetic</li>
</ul></li>
<li>cat file<sub>prefix</sub><sub>*</sub> &gt; file</li>
</ul>

<p>
<b>logs from several host to one file</b>
</p>
<ul class="org-ul">
<li>node:</li>
</ul>
<pre class="example">
script -c 'python param.py' |&amp; sed -u "s/^/${who}: /" |&amp; perl -ne 'use IO::Handle ; printf "%s %s",  scalar time(), $_ ; STDOUT-&gt;autoflush(1) ;' |&amp; tee -a ${who}.log
</pre>

<ul class="org-ul">
<li>server:</li>
</ul>
<pre class="example">
watch "cat chief_0.log worker_0.log worker_1.log | sort -ns -k1 | tail"
</pre>


<p>
add string to every line in pipeline:
</p>
<ul class="org-ul">
<li>&lt;command&gt; | sed 's/^/&lt;string&gt;/'</li>
<li>&lt;command&gt; | awk '{print "&lt;string&gt;" $0}'</li>
<li>&lt;command&gt; | while read line; do echo "&lt;string&gt;$line"; done</li>
<li>echo "asd\n asd2 \n ddvv" | sed 's/$/ file/'</li>
</ul>

<p>
<b>overwrite output</b>
</p>
<pre class="example">
echo -en "aaaa\r" ; sleep 1 ; echo -ne "bbb\033[0K\r" ; sleep 1; echo "[INFO] Processing file: log.txt"
</pre>


<p>
<a id="org94dbcc5"></a>
</p>
<ul class="org-ul">
<li>cat messages.org | grep -o "@[^$ ]*" | grep -v '&gt;' | sort | uniq -c | sort -r</li>
</ul>

<p>
<b>find line and remove this line and next one</b>
</p>
<pre class="example">
sed '/pattern/,+1d' file.txt &gt; temp_file.txt &amp;&amp; mv temp_file.txt file.txt
</pre>



<p>
<b>replace substring in files</b>
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #8ac6f2; font-weight: bold;">for</span> f<span style="color: #8ac6f2; font-weight: bold;"> in</span> ./*.el ; <span style="color: #8ac6f2; font-weight: bold;">do</span>
    cat $<span style="color: #cae682;">f</span> | sed <span style="color: #95e454;">'s/2023/2024/g'</span> &gt; /tmp/t
    mv /tmp/t $<span style="color: #cae682;">f</span>
<span style="color: #8ac6f2; font-weight: bold;">done</span>
</pre>
</div>

<p>
<b>split long lines</b>, broke line with limit
</p>
<pre class="example">
echo 'asdasd' | fold -s -w 80
</pre>


<p>
<b>filter lines by dinstance</b>
</p>
<ul class="org-ul">
<li>sed -r '/<sup>(.{9,})</sup>$/d' inputfile.txt</li>
</ul>
</div>
</div>
<div id="outline-container-org899765d" class="outline-3">
<h3 id="org899765d"><span class="section-number-3">2.46.</span> USECASE: save output of command to cash</h3>
<div class="outline-text-3" id="text-2-46">
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #cae682;">CACHE_TIME</span>=3600 <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">1 hour</span>

<span style="color: #cae682;">CACHE_DIR</span>=/tmp/cache_exec

<span style="color: #8ac6f2; font-weight: bold;">function</span> <span style="color: #cae682; font-weight: bold;">cache_exec</span>() {

  <span style="color: #e5786d;">local</span> <span style="color: #cae682;">cmd</span>=<span style="color: #95e454;">"$*"</span>
  <span style="color: #e5786d;">local</span> <span style="color: #cae682;">cache_file</span>=<span style="color: #95e454;">"$CACHE_DIR/"</span>$(<span style="color: #fa8072;">echo "$cmd" | sha1sum | cut -f 1 -d ' '</span>)

  mkdir -p $<span style="color: #cae682;">CACHE_DIR</span> <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">create if not exist</span>

  <span style="color: #8ac6f2; font-weight: bold;">if</span> [ -f <span style="color: #95e454;">"$cache_file"</span> ] &amp;&amp; [ $(<span style="color: #fa8072;">($(date +%s</span>) - $(<span style="color: #fa8072;">stat -c "%Y" "$cache_file"</span>))) -lt $<span style="color: #cae682;">CACHE_TIME</span> ]; <span style="color: #8ac6f2; font-weight: bold;">then</span>
    cat <span style="color: #95e454;">"$cache_file"</span>
  <span style="color: #8ac6f2; font-weight: bold;">else</span>
    <span style="color: #e5786d;">local</span> <span style="color: #cae682;">output</span>=$(<span style="color: #fa8072;">"$@"</span>)
    <span style="color: #e5786d;">echo</span> <span style="color: #95e454;">"$output"</span> &gt; <span style="color: #95e454;">"$cache_file"</span>
    <span style="color: #e5786d;">echo</span> <span style="color: #95e454;">"$output"</span>
  <span style="color: #8ac6f2; font-weight: bold;">fi</span>
}
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">cache_exec uname -a</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org41209ab" class="outline-3">
<h3 id="org41209ab"><span class="section-number-3">2.47.</span> USECASE: case - set environment varibles per directory after cd command</h3>
<div class="outline-text-3" id="text-2-47">
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #cae682; font-weight: bold;">set_env</span>() {
  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Check the current directory and set environment variables accordingly</span>
  <span style="color: #8ac6f2; font-weight: bold;">case</span> <span style="color: #95e454;">"$PWD"</span><span style="color: #8ac6f2; font-weight: bold;"> in</span>
    /etc/*)
      <span style="color: #e5786d;">export</span> <span style="color: #cae682;">AETCEA</span>=<span style="color: #95e454;">"vvasd"</span>
      ;;
    /home/*)
      <span style="color: #e5786d;">export</span> <span style="color: #cae682;">HALOM</span>=<span style="color: #95e454;">"12345"</span>
      ;;
    *)
      <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Do nothing if the directory does not match any of the above cases</span>
      ;;
  <span style="color: #8ac6f2; font-weight: bold;">esac</span>
}

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Modify the cd command to call the set_env function</span>
<span style="color: #e5786d;">cd</span>() { <span style="color: #e5786d;">builtin</span> cd <span style="color: #95e454;">"$@"</span> ; set_env ; }
</pre>
</div>
<p>
Do not unset them.
</p>
</div>
</div>
<div id="outline-container-org752bdb1" class="outline-3">
<h3 id="org752bdb1"><span class="section-number-3">2.48.</span> USECASE: find N last modified files in current directory and subdirs</h3>
<div class="outline-text-3" id="text-2-48">
<pre class="example">
find . -type f -printf '%T@ %p\n' | sort -n | tail -4 | cut -f2- -d" "
</pre>

<p>
where -4 - to get last 4 modified
</p>
</div>
</div>
<div id="outline-container-orgeeee35a" class="outline-3">
<h3 id="orgeeee35a"><span class="section-number-3">2.49.</span> links</h3>
<div class="outline-text-3" id="text-2-49">
<ul class="org-ul">
<li><a href="https://learnbyexample.gitbooks.io/linux-command-line/content/Shell.html">https://learnbyexample.gitbooks.io/linux-command-line/content/Shell.html</a></li>
<li>Shell &amp; Utilities <a href="https://pubs.opengroup.org/onlinepubs/9699919799/utilities/contents.html">https://pubs.opengroup.org/onlinepubs/9699919799/utilities/contents.html</a></li>
<li><a href="https://github.com/dylanaraps/pure-bash-bible">https://github.com/dylanaraps/pure-bash-bible</a></li>
</ul>

<p>
extract IP:PORT from file:
</p>
<ul class="org-ul">
<li>grep -E -o "([0-9]{1,3}[\.]){3}[0-9]{1,3}:[0-9]{1,5}" p.txt</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org4739f7c" class="outline-2">
<h2 id="org4739f7c"><span class="section-number-2">3.</span> Bash new features</h2>
<div class="outline-text-2" id="text-3">
<p>
bash &#x2013;posix or set -o posix - to execute in POSIX mode
</p>

<p>
Syntax
</p>
<dl class="org-dl">
<dt>case</dt><dd>;;&amp; ;&amp; etc</dd>
<dt>(no term)</dt><dd>for ((i=0; i&lt;3; i++)); do ; printf '%s\n' "$i" ; done</dd>
<dt>extended glob </dt><dd>+( ) @( ) !( ) *( )</dd>
<dt>select</dt><dd>construction to create menu with input from user.</dd>
<dt>file slurp</dt><dd>$(&lt; file), in shell: $(cat file)</dd>
</dl>

<p>
Expansions
</p>
<ul class="org-ul">
<li>{a,b,c} or {1..10}</li>
<li>&lt;( ) and &gt;( ) process substitutions. instead of foo &lt;(bar), write mkfifo /tmp/foo<sub>fifo</sub>; bar &gt; /tmp/foo<sub>fifo</sub> &amp; foo /tmp/foo<sub>fifo</sub></li>
</ul>

<p>
Parameter Expansions
</p>
<ul class="org-ul">
<li>${name:n:l} - $(expr "x$name" : "x.\{0,$n\}\(.\{0,$l\}\)")</li>
<li>${name/foo/bar} &#x2013; you can use $(printf '%s\n' "$name" | sed 's/foo/bar/')</li>
<li>${!name}</li>
<li>#, ##, %, and %% - operators when used together with the @ or * parameters</li>
</ul>

<p>
Arrays, in shell: IFS and set -f
</p>

<p>
Conditionals
</p>
<ul class="org-ul">
<li>[[ - use [ and use double quotes around the expansions [ "$var" = "" ]</li>
<li>[ foo = *glov ]] - use case or expr or grep</li>
<li>== - use = instead - only = is defined by POSIX</li>
<li>compare lexicographically. &lt; &gt;  - not POSIX</li>
<li>compare modification times [ file1 -nt/-ot file2 ]] - [ "$(find 'file1' -prune -newer 'file2')" ] or [ "file1" -nt "file2" ]</li>
<li>same hardlink [ file1 -ef file2 ]]  - [ "file1" -ef "file2" ]</li>
<li>(( )) (without the $) acts like a command on its own</li>
</ul>

<p>
Arithmetic
</p>
<ul class="org-ul">
<li>++ &#x2013;</li>
<li>, - comma as command separator</li>
<li>**</li>
<li>let or ((&#x2026;)) - use [ "$((&#x2026;))" -ne 0 ]</li>
</ul>
</div>
<div id="outline-container-orgc540f97" class="outline-3">
<h3 id="orgc540f97"><span class="section-number-3">3.1.</span> links</h3>
<div class="outline-text-3" id="text-3-1">
<ul class="org-ul">
<li><a href="http://mywiki.wooledge.org/Bashism">http://mywiki.wooledge.org/Bashism</a></li>
<li><a href="https://www.gnu.org/software/bash/manual/html_node/Bash-POSIX-Mode.html">https://www.gnu.org/software/bash/manual/html_node/Bash-POSIX-Mode.html</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orge5e9080" class="outline-2">
<h2 id="orge5e9080"><span class="section-number-2">4.</span> tmux</h2>
<div class="outline-text-2" id="text-4">
<p>
emerge &#x2013;ask app-misc/tmux
</p>
</div>
<div id="outline-container-org2685fd6" class="outline-3">
<h3 id="org2685fd6"><span class="section-number-3">4.1.</span> status</h3>
<div class="outline-text-3" id="text-4-1">
<p>
[10] 0: bash*
</p>
<ul class="org-ul">
<li>10 - session number</li>
<li>bash - window name, default is dynamic from current command name</li>
</ul>
</div>
</div>
<div id="outline-container-org57a54e5" class="outline-3">
<h3 id="org57a54e5"><span class="section-number-3">4.2.</span> terms</h3>
<div class="outline-text-3" id="text-4-2">
<dl class="org-dl">
<dt>server</dt><dd>Servers are terminated when the last remaining running session is closed.</dd>
<dt>session</dt><dd>default session with number 0. When we start a new instance of tmux, new session is created
inside the running server.</dd>
<dt>window</dt><dd></dd>

<dt>pane</dt><dd>splits of window, pseudoterminals. Window always have at least one pane.</dd>
</dl>

<p>
target-session (-t)
</p>
<ul class="org-ul">
<li></li>
</ul>
</div>
</div>

<div id="outline-container-orgf6907d7" class="outline-3">
<h3 id="orgf6907d7"><span class="section-number-3">4.3.</span> keys</h3>
<div class="outline-text-3" id="text-4-3">
<p>
Ctrl-b is the begining of commands:
</p>
<ul class="org-ul">
<li>?	help</li>
<li>[	now Page Up, Page down</li>
<li>CTRL+SPACE to start copying</li>
<li>ALT+w or CTRL+w to copy into Tmux buffer.</li>
<li>]	to paste</li>
</ul>
<p>
quit:
</p>
<ul class="org-ul">
<li>x	kill the current panel and quit if one left in window</li>
<li>&amp;	kill window and quit</li>
<li>d	disconnect from panel</li>
</ul>

<p>
toggle between:
</p>
<ul class="org-ul">
<li>(/)	toggle between sessions</li>
<li>s	list sessions, x - kill session, C-p/n - up/down</li>
<li>w	list sessions and windows</li>
<li>%	create a horizontal pane</li>
<li>"	create a vertical pane</li>
<li>o	toggle between panes - current surround with green lines</li>
<li>array toggle between panes</li>
<li>L</li>
</ul>


<p>
rename:
</p>
<ul class="org-ul">
<li>$	session</li>
<li>,	window</li>

<li><a href="https://danielmiessler.com/study/tmux/">https://danielmiessler.com/study/tmux/</a></li>
</ul>
</div>
</div>

<div id="outline-container-org4d8bc03" class="outline-3">
<h3 id="org4d8bc03"><span class="section-number-3">4.4.</span> commands</h3>
<div class="outline-text-3" id="text-4-4">
<ul class="org-ul">
<li>tmux ls - list tmux sessions</li>
<li>tmux attach -t 0 - attach to session</li>
<li>tmux</li>
</ul>
</div>
</div>
<div id="outline-container-org95c848f" class="outline-3">
<h3 id="org95c848f"><span class="section-number-3">4.5.</span> xorg start and terminal unused</h3>
<div class="outline-text-3" id="text-4-5">
<p>
To start terminal with tmux:
</p>
<pre class="example">
xfce4-terminal -e tmux
</pre>

<p>
To kill unused terminal windows with idling single bash:
</p>
<pre class="example">
alias cl="ps aux | grep '\-bash' | grep Ss+ |  tr -s ' ' | cut -f 2 -d ' ' | xargs kill -s 9"
</pre>


<p>
to kill deattached tmux sessions, add to ~/.bashrc,
</p>
<pre class="example">
test -n "$DISPLAY" &amp;&amp; tmux list-sessions | grep -v attached | cut -d: -f1 |  xargs -r -n1 tmux kill-session -t &amp;&gt;/dev/null
</pre>


<p>
to set nema of new window:
</p>
<pre class="example">
xdotool getactivewindow set_window --name $(echo "${PWD/#$HOME/\~}")
</pre>
</div>
</div>
<div id="outline-container-org8bcc2a3" class="outline-3">
<h3 id="org8bcc2a3"><span class="section-number-3">4.6.</span> xorg system clipboard - How to copy to clipboard?</h3>
<div class="outline-text-3" id="text-4-6">
<p>
Soltuion:
create file ~/tmux.conf and add this line:
</p>
<pre class="example">
set -s copy-command "xclip -sel clip -i"
</pre>


<p>
this app should be installed:
</p>
<pre class="example">
emerge x11-misc/xclip
</pre>
</div>
</div>
<div id="outline-container-org5279b3a" class="outline-3">
<h3 id="org5279b3a"><span class="section-number-3">4.7.</span> kill deattached sessions</h3>
<div class="outline-text-3" id="text-4-7">
<pre class="example">
tmux list-sessions | grep -v attached | cut -d: -f1 |  xargs -r -n1 tmux kill-session -t &amp;&gt;/dev/null
</pre>
</div>
</div>

<div id="outline-container-org93f5491" class="outline-3">
<h3 id="org93f5491"><span class="section-number-3">4.8.</span> option</h3>
<div class="outline-text-3" id="text-4-8">
<p>
global options:
</p>
<pre class="example">
tmux show-options -g
</pre>

<p>
For window options:
</p>
<pre class="example">
tmux show-options -w
</pre>

<p>
For server options:
</p>
<pre class="example">
tmux show-options -s
</pre>
</div>
</div>

<div id="outline-container-org9b42904" class="outline-3">
<h3 id="org9b42904"><span class="section-number-3">4.9.</span> rebind keys</h3>
<div class="outline-text-3" id="text-4-9">
<p>
tmux list-keys | less
</p>
<pre class="example">
bind-key -T copy-mode C-k    send-keys -X cursor-up
bind-key -T copy-mode C-l    send-keys -X cursor-left
</pre>
</div>
</div>
</div>

<div id="outline-container-org5481568" class="outline-2">
<h2 id="org5481568"><span class="section-number-2">5.</span> SSH</h2>
<div class="outline-text-2" id="text-5">
<p>
Secure SHell - port 22.
</p>
<ul class="org-ul">
<li>Mozilla recommendations <a href="https://infosec.mozilla.org/guidelines/openssh">https://infosec.mozilla.org/guidelines/openssh</a></li>
</ul>
</div>
<div id="outline-container-orgcad8fc4" class="outline-3">
<h3 id="orgcad8fc4"><span class="section-number-3">5.1.</span> config files</h3>
<div class="outline-text-3" id="text-5-1">
<ul class="org-ul">
<li>/etc/ssh/sshd<sub>config</sub> - server conf
<ul class="org-ul">
<li>/etc/conf.d/sshd</li>
<li><i>etc/ssh/known<sub>hosts</sub> and ~</i>.ssh/known<sub>hosts</sub> - list of public keys for all the hosts to which the user has
connected with ssh. for verifying the identity of client's systems. protecting against impersonation or
man-in-the-middle attacks.</li>
<li>~/.ssh/authorized<sub>keys</sub> - mandatory, not added automatically</li>
</ul></li>
<li>/etc/ssh/ssh<sub>config</sub> - client conf
<ul class="org-ul">
<li>~/.ssh/config</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-orgf404acc" class="outline-3">
<h3 id="orgf404acc"><span class="section-number-3">5.2.</span> permissions</h3>
<div class="outline-text-3" id="text-5-2">
<ul class="org-ul">
<li>0600 ~/.ssh/authorized<sub>keys</sub> # rw</li>
<li>0600 ~/.ssh/known<sub>hosts</sub></li>
<li>0644 ~/.ssh/config # rw-r-r</li>
<li>0600 ~/.ssh/id<sub>rsa</sub> # rw</li>
<li>0644 ~/.ssh/id<sub>rsa.pub</sub> # rw-r-r</li>
<li>0700 or 755 /ssh</li>
<li>644 /etc/ssh<sub>config</sub></li>
<li>600 /etc/ss<sub>config</sub></li>
</ul>
</div>
</div>
<div id="outline-container-orgbb73a63" class="outline-3">
<h3 id="orgbb73a63"><span class="section-number-3">5.3.</span> authentication types</h3>
<div class="outline-text-3" id="text-5-3">
<ol class="org-ol">
<li>password
<ul class="org-ul">
<li>PasswordAuthentication yes</li>
</ul></li>
<li>public key</li>
<li>Host-based - public key + ip white list
<ul class="org-ul">
<li>EnableSSHKeySign yes</li>
<li>HostbasedAuthentication yes</li>
<li>IgnoreRhosts no</li>
</ul></li>
<li>keyboard-interactive - server sends prompts to the Client who should provide the correct response.
<ul class="org-ul">
<li>KbdInteractiveAuthentication yes</li>
<li>ChallengeResponseAuthentication yes</li>
</ul></li>
<li>challenge-response - A specific backend system sends the challenges to the client’s PC and verifies the response.
<ul class="org-ul">
<li>ChallengeResponseAuthentication yes</li>
<li>KbdInteractiveAuthentication yes</li>
</ul></li>
<li>GSSAPI - Kerberos authentication
<ul class="org-ul">
<li>GssapiAuthentication</li>
<li>GssapiKeyExchange</li>
</ul></li>
</ol>
</div>
</div>
<div id="outline-container-org0cc8441" class="outline-3">
<h3 id="org0cc8441"><span class="section-number-3">5.4.</span> usage</h3>
<div class="outline-text-3" id="text-5-4">
<ul class="org-ul">
<li>/usr/sbin/sshd -t # validate its configuration</li>
<li>ssh-add -l # list keys</li>
<li>copy files
<ul class="org-ul">
<li>from remote to local
<ul class="org-ul">
<li>rsync username@ip<sub>address</sub>:/home/username/filename .</li>
<li>scp filename username@ip<sub>address</sub>:/home/username .</li>
<li>rsync -r source<sub>folder</sub>/ dest<sub>folder</sub>/ # recurse copy contents of the source folder into dest<sub>folder</sub></li>
<li>rsync -vP username@host:/path/to/file . # download large file with progress</li>
</ul></li>
<li>from local to the remote
<ul class="org-ul">
<li>rsync username@ip<sub>address</sub>:/home/username/filename .</li>
<li>scp filename username@ip<sub>address</sub>:/home/username
<ul class="org-ul">
<li></li>
</ul></li>
</ul></li>
</ul></li>
<li>ssh -t command # execute command right after login</li>
</ul>
</div>
</div>
<div id="outline-container-org68c03f4" class="outline-3">
<h3 id="org68c03f4"><span class="section-number-3">5.5.</span> commands</h3>
<div class="outline-text-3" id="text-5-5">
<ul class="org-ul">
<li>scp - secure file copy</li>
<li>sftp - secure file transfer</li>
<li>ssh-add - add private key identities to the authentication agent</li>
<li>ssh-agent - authentication agent</li>
<li>ssh-copy-id - use locally available keys to authorize logins on a remote machine</li>
<li>ssh-keygen - authentication key utility</li>
<li>ssh-keyscan - gather SSH public keys from servers</li>
<li>sshd - OpenSSH daemon</li>
</ul>
</div>
</div>

<div id="outline-container-org6a655b2" class="outline-3">
<h3 id="org6a655b2"><span class="section-number-3">5.6.</span> 1) ssh server - password</h3>
<div class="outline-text-3" id="text-5-6">
<ul class="org-ul">
<li>net-misc/openssh</li>
<li>Config server:
<ul class="org-ul">
<li>PasswordAuthentication yes</li>
<li>PermitRootLogin yes</li>
<li>PubkeyAuthentication yes # allow migrate to pubkey (not required)</li>
<li>ListenAddress 0.0.0.0 # and add rc<sub>need</sub>="net.enp" to /etc/conf.d/sshd (not required)</li>
</ul></li>
<li>sshd -t</li>
</ul>
<p>
client: ssh user@127.16.0.1
</p>
</div>
</div>

<div id="outline-container-org161d7c7" class="outline-3">
<h3 id="org161d7c7"><span class="section-number-3">5.7.</span> 2) ssh server - generate key - public key and private key</h3>
<div class="outline-text-3" id="text-5-7">
<p>
Just don’t use ECDSA/DSA!
</p>

<ol class="org-ol">
<li>create and copy key at client
<ul class="org-ul">
<li>ssh-keygen -t ecdsa -a 256 -b 521 (-f ~/.ssh/id<sub>ed25519</sub> -C "username@hostname") (best security)</li>
<li>ssh-keygen -t ed25519 -a 256 -b 521 (-f ~/.ssh/id<sub>ed25519</sub> -C "username@hostname")</li>
<li>ssh-keygen -b 4096 -t rsa -f ~/.ssh/mykey<sub>rsa</sub>

<ul class="org-ul">
<li>add <b>-q -N ""</b> for empty passphrase</li>
</ul></li>
<li>ssh-copy-id -i ~/.ssh/id<sub>rsa.pub</sub> 172.16.0.1</li>
<li>ssh user@172.16.0.1 # try loggin</li>
<li>eval `ssh-agent`</li>
<li>ssh-add <i>home/user</i>.ssh/id<sub>rsa</sub></li>
<li>ssh user@172.16.0.1 # try loggin</li>
</ul></li>
<li>server - change config of sshd
<ul class="org-ul">
<li>PermitRootLogin no # if not needed</li>
<li>PasswordAuthentication no</li>
<li>HostbasedAuthentication no</li>
<li>KbdInteractiveAuthentication no # keyboard-interactive</li>
<li># UsePAM yes # should be commented</li>
<li>AllowUsers user1 user2 # restrict access for this users only</li>
<li>sshd -t</li>
</ul></li>
</ol>


<ol class="org-ol">
<li>client - samplify ~/.ssh/config
<ul class="org-ul">
<li>Host ssh-ex
<ul class="org-ul">
<li>HostName 104.236.90.57</li>
<li>User fideloper</li>
<li>IdentitiesOnly yes # where ssh-agent offers many different identities. (optional)</li>
<li>IdentityFile ~/.ssh/id<sub>sshex</sub></li>
<li>PreferredAuthentications publickey # (optional)</li>
</ul></li>
</ul></li>
</ol>

<pre class="example">
drwx------  2 root root  4096 Mar 26 12:47 .ssh
-rw------- .ssh/authorized_keys
</pre>



<p>
ECDSA
</p>
<ul class="org-ul">
<li>secp256r1 (256-bit curve): Equivalent to a 3072-bit RSA key.</li>
<li>secp384r1 (384-bit curve): Equivalent to a 7680-bit RSA key.</li>
<li>secp521r1 (521-bit curve): Equivalent to a 15360-bit RSA key.</li>
<li>More resistant to quantum computer attacks compared to traditional RSA.</li>
</ul>

<p>
Elliptic Curve Cryptography (ECC)
 384-bit ECC key provides similar security as a 7680-bit RSA key.
</p>

<p>
Ed25519 : Equal to a RSA with ~3000-bit keys
</p>
<ul class="org-ul">
<li>excellent security with a fixed key size of 256 bits.</li>
<li>It is highly secure and resistant to side-channel attacks.</li>
</ul>
</div>
</div>

<div id="outline-container-orgca2a192" class="outline-3">
<h3 id="orgca2a192"><span class="section-number-3">5.8.</span> 3) sftp server</h3>
<div class="outline-text-3" id="text-5-8">
<ol class="org-ol">
<li>uncomment /etc/ssh/sshd<sub>config</sub>: Subsystem sftp /usr&#x2026;</li>
<li>for autocompletion at client: echo "net-misc/openssh libedit" &gt;&gt; /etc/portage/package.use/openssh</li>
</ol>
</div>
</div>
<div id="outline-container-orgcbfeb30" class="outline-3">
<h3 id="orgcbfeb30"><span class="section-number-3">5.9.</span> 4) X11 Forwarding</h3>
<div class="outline-text-3" id="text-5-9">
<p>
to start a graphical applications installed on a remote Linux system and forward that application windows
(screen) to the local system
</p>

<ol class="org-ol">
<li>/etc/sshd<sub>config</sub>
<ul class="org-ul">
<li>ForwardX11=yes</li>
</ul></li>
<li>ssh -Y host</li>
</ol>


<p>
ssh -X - is not working:
</p>
<ul class="org-ul">
<li>Warning: untrusted X11 forwarding setup failed: xauth key data not generated</li>
<li>xset: ubable to open display ""</li>
</ul>
</div>
</div>
<div id="outline-container-org5c4bb06" class="outline-3">
<h3 id="org5c4bb06"><span class="section-number-3">5.10.</span> 5) sshfs - client</h3>
<div class="outline-text-3" id="text-5-10">
<ul class="org-ul">
<li>File systems  &#x2014;&gt;  [*] FUSE (Filesystem in Userspace) support</li>
<li>emerge &#x2013;ask net-fs/sshfs</li>
<li>umount: fusermount -u /path/to/local/sshfs/mount</li>
</ul>

<p>
Options for access:
</p>
<ul class="org-ul">
<li>-o allow<sub>other</sub>
<ul class="org-ul">
<li>replace allow<sub>other</sub> with allow<sub>root</sub>, for root).</li>
</ul></li>
<li>-o umask=M
<ul class="org-ul">
<li>set file permissions (octal)</li>
</ul></li>
<li>-o uid=N
<ul class="org-ul">
<li>set file owner</li>
</ul></li>
<li>-o gid=N
<ul class="org-ul">
<li>set file group</li>
</ul></li>
</ul>


<p>
It is recommended to run SSHFS as regular user (not as root).
</p>

<p>
There is your options:
</p>
<ol class="org-ol">
<li>run as root
<ul class="org-ul">
<li>only root can access folder</li>
<li>with allow<sub>other</sub> - you must hide folder as subfolder and set permissions on parent folder
<ul class="org-ul">
<li>chmod o-rwx /mnt</li>
<li>chown root:users /mnt</li>
<li>mkdir /mnt/share</li>
<li>sshfs -o allow<sub>others</sub> -o uid=1000 -o gid=100 target:/mnt/share /mnt/share</li>
</ul></li>
</ul></li>
<li>run as user
<ul class="org-ul">
<li>only user can access folder</li>
<li>root and user can access folder but user can allow access to anyone
<ul class="org-ul">
<li>with /etc/fuse.conf uncomment: user<sub>allow</sub><sub>other</sub></li>
<li>sudo -u user sshfs -o allow<sub>root</sub> -o uid=1000 -o gid=100 target:/mnt/share /mnt/share</li>
</ul></li>
</ul></li>
</ol>

<p>
/etc/fstab:
</p>
<ul class="org-ul">
<li>as root (allow<sub>other</sub>):
<ul class="org-ul">
<li>sshfs#SERVER<sub>USER</sub>@remotehost:/SOURCEDIR <i>home/USER/Music fuse user,<sub>netdev,idmap</sub>=user,transform<sub>symlinks,identityfile</sub>=/home/USER</i>.ssh/id<sub>rsa,allow</sub><sub>other,default</sub><sub>permissions,uid</sub>=1000,gid=1000 0 0</li>
<li>user@host:/remote/path <i>local/path  fuse.sshfs noauto,x-systemd.automount,<sub>netdev,users,idmap</sub>=user,IdentityFile=/home/user</i>.ssh/id<sub>rsa,allow</sub><sub>other,reconnect</sub> 0 0
<ul class="org-ul">
<li>noauto tells it not to mount at boot</li>
<li>x-systemd.automount does the on-demand magic</li>
<li>_netdev tells it that it is a network device, not a block device (without it "No such device" errors might happen)</li>
</ul></li>
</ul></li>
<li>as user:
<ul class="org-ul">
<li>user@host:/remote/path <i>local/path  fuse.sshfs noauto,x-systemd.automount,<sub>netdev,user,idmap</sub>=user,follow<sub>symlinks,identityfile</sub>=/home/user</i>.ssh/id<sub>rsa,allow</sub><sub>other,default</sub><sub>permissions,uid</sub>=USER<sub>ID</sub><sub>N,gid</sub>=USER<sub>GID</sub><sub>N</sub> 0 0</li>
</ul></li>
</ul>

<p>
up:
</p>
<ul class="org-ul">
<li>sshfs -o allow<sub>other</sub> -o uid=1000 -o gid=100 target:/mnt/share /mnt/share</li>
</ul>

<p>
down:
</p>
<ul class="org-ul">
<li>chmod -R g+rwx /mnt/share/* # allow at target to write</li>
<li>fusermount -u /mnt/share # umount</li>
</ul>
</div>
</div>
<div id="outline-container-orga4fef71" class="outline-3">
<h3 id="orga4fef71"><span class="section-number-3">5.11.</span> <span class="todo TODO">TODO</span> Internet over socks</h3>
<div class="outline-text-3" id="text-5-11">
<p>
Viriant 1 - tun - man ssh
</p>
<ul class="org-ul">
<li><a href="https://www.copahost.com/blog/openvpn-in-ubuntu-tun-tap/">https://www.copahost.com/blog/openvpn-in-ubuntu-tun-tap/</a></li>
<li># cat /dev/net/tun
<ul class="org-ul">
<li>cat: /dev/net/tun: File descriptor in bad state</li>
<li>If the output shows “File descriptor in bad state”, then it means it is working correctly.</li>
</ul></li>
</ul>

<p>
Variant 2 - proxychains
</p>
<ul class="org-ul">
<li>ssh -fNTD 127.0.0.1:&lt;local port&gt; username@sshserver
<ul class="org-ul">
<li>-f go backgroound</li>
<li>-N Do not execute a remote command.  This is useful for just for warding ports.</li>
<li>-T Disable pseudo-terminal allocation.</li>
</ul></li>
<li>edit /etc/proxychains.conf :
<ul class="org-ul">
<li>socks5 127.0.0.1 &lt;localport&gt;</li>
<li>proxy<sub>dns</sub></li>
</ul></li>
<li>proxychains &lt;program name&gt;</li>
</ul>


<p>
Variant 2 - tsocks
</p>
</div>
</div>
<div id="outline-container-orga29a232" class="outline-3">
<h3 id="orga29a232"><span class="section-number-3">5.12.</span> DNS over socks</h3>
<div class="outline-text-3" id="text-5-12">
<ul class="org-ul">
<li>net-proxy/dnsproxy</li>
<li><a href="https://github.com/awaw/dnsproxy">https://github.com/awaw/dnsproxy</a></li>
<li>test dnsproxy: dig @127.0.0.1 -p 53000 google.com (dnsutils)</li>
</ul>

<p>
problems: resolv.conf require 53 UDP port
</p>
<ol class="org-ol">
<li>you need to root to redirect to 53 port</li>
<li>UDP is not forwarded with SSH directly</li>
</ol>

<p>
solution:
</p>
<ul class="org-ul">
<li>sudo -u ssh ssh -L 6667:0.0.0.0:6667 -C -o ProxyCommand='nc -X 5 -x 127.0.0.1:1082 %h %p' -p 9067 root@remove<sub>ssh</sub></li>
<li>remote:
<ul class="org-ul">
<li>mkfifo /tmp/fifo</li>
<li>nc -l -p 6667 &lt; /tmp/fifo | nc -u localhost 53000 &gt; /tmp/fifo</li>
</ul></li>
<li>local:
<ul class="org-ul">
<li>socat udp-listen:53,reuseaddr,fork TCP:127.0.0.1:6667 &amp;</li>
<li>(other) # mkfifo /tmp/fifo ; sudo nc -l -u -p 53 &lt; /tmp/fifo | nc localhost 6667 &gt; /tmp/fifo</li>
</ul></li>
</ul>




<ul class="org-ul">
<li><p>
server:
</p>
<ul class="org-ul">
<li>ssh -L 6667:0.0.0:6667 root@remove<sub>ssh</sub> (sudo -u ssh ssh -L 6667:0.0.0.0:6667 -C -o ProxyCommand='nc -X 5</li>
</ul>
<p>
-x 127.0.0.1:1082 %h %p' -p 22 root@remove<sub>ssh</sub>)
</p>
<ul class="org-ul">
<li>socat tcp4-listen:6667,reuseaddr,fork UDP:127.0.0.1:53000</li>
</ul></li>
<li>local:
<ul class="org-ul">
<li>socat udp-listen:53,reuseaddr,fork TCP:127.0.0.1:6667 &amp;</li>
<li>(bad)# mkfifo /tmp/fifo ; sudo nc -l -u -p 53 &lt; /tmp/fifo | nc localhost 6667 &gt; /tmp/fifo</li>
<li>/etc/resolv.conf: nameserver 127.0.0.1</li>
<li>prevent dhcpd overweite /etc/resolv.conf: chattr +i /etc/resolv.conf</li>
</ul></li>
</ul>

<p>
/tmp/fifo
</p>

<p>
<a href="https://superuser.com/questions/53103/udp-traffic-through-ssh-tunnel">https://superuser.com/questions/53103/udp-traffic-through-ssh-tunnel</a>
</p>
</div>
</div>
<div id="outline-container-orgcf2300e" class="outline-3">
<h3 id="orgcf2300e"><span class="section-number-3">5.13.</span> ssh-agent</h3>
<div class="outline-text-3" id="text-5-13">
<ul class="org-ul">
<li>key manager for SSH. It holds your keys and certificates in memory, unencrypted, and ready for use by ssh</li>
<li>runs in the background on your system</li>
</ul>

<p>
<b>do not type password all the time</b>
</p>
<ul class="org-ul">
<li>eval $(ssh-agent) or eval `ssh-agent` # to start agent</li>
<li>ssh-agent -k # to kill agent</li>
<li>ssh-add -l # list private keys currently accessible to the agent ~/.ssh/id<sub>rsa</sub></li>
<li>ssh-add key</li>
<li>ssh-add -D - del -l list</li>
</ul>

<p>
ssh-add without any parameters - it will scan your home directory for some standard keys and add them to your
agent
</p>

<p>
ssh-agent -k # kill daemon
</p>
</div>
</div>

<div id="outline-container-org462cadf" class="outline-3">
<h3 id="org462cadf"><span class="section-number-3">5.14.</span> agent forwarding problem</h3>
<div class="outline-text-3" id="text-5-14">
<p>
security risk: anyone with root access on the remote host can discreetly access your local SSH agent through
the socket. They can use your keys to impersonate you on other machines on the network.
</p>

<p>
How to reduce your risk when agent forwarding:
</p>
<ul class="org-ul">
<li>ssh -A turns on agent forwarding for a single session.</li>
<li>ssh-add -x locks the agent with a password, and ssh-add -X unlocks it</li>
<li>alternative SSH agent that prompts you when it’s being used.</li>
<li>ProxyJump directive: ssh -J bastion.example.com cloud.computer.internal # to connect to
cloud.computer.internal via your bastion.example.com
<ol class="org-ol">
<li>your SSH client uses keys from your agent to connect to bastion.example.com.</li>
<li>Once connected, SSHD on the bastion connects to cloud.computer.internal and hands that connection off to
your local SSH client.</li>
<li>Your local SSH client runs through the handshake again, this time with cloud.computer.internal.</li>
</ol></li>
<li>Older versions of SSH and SSHD (prior to 7.2, released in 2016) don’t support ProxyJump:
<ul class="org-ul">
<li>ssh -o ProxyCommand="ssh bastion.example.com nc %h %p" cloud.computer.internal</li>
</ul></li>
</ul>

<p>
<a href="https://smallstep.com/blog/ssh-agent-explained/">https://smallstep.com/blog/ssh-agent-explained/</a>
</p>
</div>
</div>
<div id="outline-container-orge2641e5" class="outline-3">
<h3 id="orge2641e5"><span class="section-number-3">5.15.</span> ssh-copy-id</h3>
<div class="outline-text-3" id="text-5-15">
<p>
ssh-copy-id user@hostname.example.com -p &lt;port-number&gt;
</p>

<p>
copies the public key of your default identity (use -i identity<sub>file</sub> for other identities) to the remote host.
</p>
</div>
</div>
<div id="outline-container-orge0849ae" class="outline-3">
<h3 id="orge0849ae"><span class="section-number-3">5.16.</span> inside of ssh</h3>
<div class="outline-text-3" id="text-5-16">
<ul class="org-ul">
<li>The client presents a public key to the server.</li>
<li>The server generates and sends a brief, random message, asking the client to sign it using the private key.</li>
<li>The client asks the SSH agent to sign the message and forwards the result back to the server.</li>
<li>The server checks the signature using the client’s public key.</li>
<li>The server now has proof that the client is in possession of their private key.</li>
<li>Later in the handshake process, a set of new, ephemeral and symmetric keys are generated and used to encrypt
the SSH session traffic. These keys may not even last the entire session; a “rekey” event happens at regular
intervals.</li>
</ul>
</div>
</div>

<div id="outline-container-orgf2d000e" class="outline-3">
<h3 id="orgf2d000e"><span class="section-number-3">5.17.</span> old</h3>
<div class="outline-text-3" id="text-5-17">
<p>
В начале - настраиваем сервар на аутентификация по ключу
</p>
<ol class="org-ol">
<li>на клиенте (без пароля): ssh-keygen -o -b 4096 -t rsa -f ~/.ssh/mykey<sub>rsa</sub></li>
<li>на сервере по рутом /etc/ssh/sshd<sub>config</sub>:
<ul class="org-ul">
<li>PermitRootLogin yes</li>
<li>PubkeyAuthentication no</li>
<li>PasswordAuthentication yes</li>
</ul></li>
</ol>
<p>
На клиенте - копируем публичный ключ на сервер в authorized<sub>keys</sub>:
</p>
<ul class="org-ul">
<li>ip = 10.0.0.1 - сервера</li>
<li>scp user@$ip:"~/.ssh/mykey<sub>rsa.pub</sub>" ~/.ssh/authorized<sub>keys</sub></li>
</ul>

<p>
потом на сервере :
</p>
<ul class="org-ul">
<li>PubkeyAuthentication yes</li>
<li>AuthorizedKeysFile      .ssh/authorized<sub>keys</sub></li>
<li>PasswordAuthentication no</li>
<li>UsePAM no - Also verify UsePAM yes is not in the configuration file; it overrides the public key
authentication mechanism. Alternatively PasswordAuthentication or ChallengeResponseAuthentication
directives can be disabled</li>
</ul>

<p>
X: конектится по ssh сразу под тем пользователем под которым хочешь запустить X-приложение
</p>
<ul class="org-ul">
<li>/etc/ssh/sshd<sub>config</sub>
<ul class="org-ul">
<li>X11Forwarding yes</li>
<li>X11DisplayOffset 10</li>
</ul></li>
</ul>

<p>
wine msiexec /i E82.40<sub>CheckPointVPN.msi</sub>
</p>

<p>
<b>SOCKS 5 прокси</b>
ssh -D 8888 user@33.224.56.34
</p>

<p>
<b>restict one command with argument</b>
</p>
<ol class="org-ol">
<li>command="./nuke $SSH<sub>ORIGINAL</sub><sub>COMMAND</sub>",no-port-forwarding,no-x11-forwarding,no-agent-forwarding KEY<sub>TYPE</sub> KEY COMMENT</li>
<li>./nuke:
<ul class="org-ul">
<li>set -euf -o pipefail</li>
<li>echo "$@"</li>
</ul></li>
</ol>

<p>
<b>copy public key to remote machine</b>
</p>
<ul class="org-ul">
<li>ssh-copy-id -i ~/.ssh/id<sub>rsa.pub</sub> 192.168.0.1</li>
</ul>
</div>
</div>

<div id="outline-container-orgc9cec63" class="outline-3">
<h3 id="orgc9cec63"><span class="section-number-3">5.18.</span> githib ~/.ssh/config</h3>
<div class="outline-text-3" id="text-5-18">
<p>
IdentityFile - replace for "ssh -i"
</p>

<pre class="example">
# alias:
Host github.com
    HostName github.com
    Port 22
    User git_username
    IdentityFile ~/.ssh/rsa_id
    PreferredAuthentications publickey
</pre>
</div>
</div>

<div id="outline-container-orgf1b4503" class="outline-3">
<h3 id="orgf1b4503"><span class="section-number-3">5.19.</span> key type</h3>
<div class="outline-text-3" id="text-5-19">
<ul class="org-ul">
<li>RSA - difficulty of factoring large numbers</li>
<li>DSA - no longer recommended.</li>
<li>ECDSA - weak - elliptic curves. Only three key sizes are supported: 256, 384, and 521 (sic!) bits.</li>
<li><p>
ed25519 (EdDS) - new
</p>

<p>
<a href="https://stribika.github.io/2015/01/04/secure-secure-shell.html">https://stribika.github.io/2015/01/04/secure-secure-shell.html</a>
</p></li>
</ul>
</div>
</div>
<div id="outline-container-orga1ad062" class="outline-3">
<h3 id="orga1ad062"><span class="section-number-3">5.20.</span> security</h3>
<div class="outline-text-3" id="text-5-20">
<ul class="org-ul">
<li>Protocol 2                                  	                #Protocol 1 is fundamentally broken</li>
<li>StrictModes yes                                                 #Protects from misconfiguration</li>
</ul>


<p>
Diffie-Hellman key exchange
</p>
<ul class="org-ul">
<li>use 2048-bit or larger primes</li>
</ul>

<p>
RFC4419: The use of multiple moduli inhibits a determined attacker from precalculating moduli exchange values,
and discourages dedication of resources for analysis of any particular modulus.
</p>

<p>
generate new non elliptic-curve primes do this:
</p>
<ul class="org-ul">
<li>ssh-keygen -G moduli-2048.candidates -b 2048</li>
<li>ssh-keygen -T moduli-2048 -f moduli-2048.candidates</li>
<li>cp moduli-2048 /etc/ssh/moduli</li>
</ul>

<p>
soft
</p>
<ul class="org-ul">
<li>sshguard</li>
<li>fail2ban</li>

<li>Logjam Attack <a href="https://weakdh.org/">https://weakdh.org/</a></li>
</ul>

<p>
Stronger sshd<sub>config</sub>:
</p>
<ul class="org-ul">
<li>ClientAliveInterval 60 # seconds</li>
</ul>
</div>
</div>
<div id="outline-container-org274104f" class="outline-3">
<h3 id="org274104f"><span class="section-number-3">5.21.</span> Port Forwarding/Tunneling</h3>
<div class="outline-text-3" id="text-5-21">
<p>
<a href="https://www.techrepublic.com/article/how-to-use-local-and-remote-ssh-port-forwarding/">https://www.techrepublic.com/article/how-to-use-local-and-remote-ssh-port-forwarding/</a>
</p>

<p>
-N - Do not execute a remote command.  This is useful for just forwarding ports.
-f - background
</p>
</div>
<div id="outline-container-org0571d16" class="outline-4">
<h4 id="org0571d16"><span class="section-number-4">5.21.1.</span> Local</h4>
<div class="outline-text-4" id="text-5-21-1">
<p>
local port to conecting ssh mashine
</p>

<p>
-g      Allows remote hosts to connect to local forwarded ports.
</p>

<p>
cons:
</p>
<ul class="org-ul">
<li>TLS certificate validation fails</li>
<li>When the website you are accessing redirects you to another URL, the connection fails because port
forwarding is only valid for exactly this web server. This situation might be a problem when using single
sign-on (SSO), for instance.</li>
</ul>
</div>
<ol class="org-ol">
<li><a id="orgaa2478a"></a>ex<br />
<div class="outline-text-5" id="text-5-21-1-1">
<p>
ssh -L 8080:localhost:80 root@host.com
</p>

<p>
localhost:8080 forwarded to remote address host.com:80.
</p>

<p>
Enables you to access another server from your local computer
</p>
<ul class="org-ul">
<li>port numbers that are less than 1024 or greater than 49151 are reserved for the system</li>
</ul>

<pre class="example">
ssh -L 8080:www.slashdot.org:80 localhost
</pre>


<p>
You will be prompted to enter your user password for the client machine.  You are connecting, via SSH, back to
your client machine, but creating the necessary SSH tunnel to the destination. After that, open up a browser
and point it to <a href="http://localhost:8080">http://localhost:8080</a>. Your browser should automatically redirect you to Slashdot.
</p>

<pre class="example">
ssh -L 9090:example.com:80 admin@server.com
</pre>


<p>
localhost port 9090 will be connected to example.com:80
</p>

<pre class="example">
ssh -L 9090:localhost:3306 admin@server.com
</pre>


<p>
localhost 3306 will be opened as localhost 9090 for access admin@server.com
</p>

<pre class="example">
ssh -L 0.0.0.0:80:site.com:80 -p 9983 root@localhost
</pre>


<p>
create mirror of site.com
</p>
</div>
</li>
</ol>
</div>
<div id="outline-container-org205db21" class="outline-4">
<h4 id="org205db21"><span class="section-number-4">5.21.2.</span> Remote</h4>
<div class="outline-text-4" id="text-5-21-2">
<p>
require: GatewayPorts yes in sshd<sub>config</sub>
</p>

<pre class="example">
ssh -R 9090:example.com:80 admin@server.com
</pre>


<p>
server.com 9090 will be forwardet to example.com 80 which is accessed on local network only of server.com
</p>

<pre class="example">
ssh -R 5900:localhost:5900 USERNAME@192.168.1.192
</pre>


<p>
192.168.1.192 5900 will be forwarded to localhost 5900 with encryption
</p>

<pre class="example">
ssh -R 6066:localhost:22 USERNAME@192.168.1.192
</pre>

<p>
192.168.1.192 6066 will be forwarded to localhost 22 with encryption
</p>
</div>
</div>
<div id="outline-container-orge08efeb" class="outline-4">
<h4 id="orge08efeb"><span class="section-number-4">5.21.3.</span> Dynamic</h4>
<div class="outline-text-4" id="text-5-21-3">
<p>
ssh will act as SOCKS4/5 proxy (Port 1080 is the IANA registered port for SOCKS)
</p>

<pre class="example">
ssh -D 1080 bastion.securecorp.io
</pre>


<p>
localhost 1080 is now SOCKS proxy to bastion.securecorp.io which is work as SOCKS proxy
</p>
</div>
</div>

<div id="outline-container-orgea14aeb" class="outline-4">
<h4 id="orgea14aeb"><span class="section-number-4">5.21.4.</span> examples</h4>
<div class="outline-text-4" id="text-5-21-4">
<p>
vps double socks
</p>
<ul class="org-ul">
<li>ssh -D 1080 local<sub>user</sub>@localhost # create socks proxy on localhost</li>
<li>ssh -R 1080:localhost:1080 root@vps.com # allow access local 1080 port</li>
<li>ssh -L 1080:localhost:1080 -p 49382 root@cps.com # crate local 1080 which will be forwarded to remote 1080</li>
<li></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org72429c7" class="outline-3">
<h3 id="org72429c7"><span class="section-number-3">5.22.</span> Reverse SSH Tunnel</h3>
<div class="outline-text-3" id="text-5-22">
<p>
Require: GatewayPorts yes in sshd<sub>config</sub> ???
</p>

<p>
target:
</p>
<ul class="org-ul">
<li>ssh -fN -R 7010:localhost:23 username@yourMachine</li>
<li>yourMachine:7010 will be forwarded to target:22</li>
</ul>


<p>
<a href="https://jfrog.com/connect/post/reverse-ssh-tunneling-from-start-to-end/">https://jfrog.com/connect/post/reverse-ssh-tunneling-from-start-to-end/</a>
<a href="https://www.marksanborn.net/howto/bypass-firewall-and-nat-with-reverse-ssh-tunnel/">https://www.marksanborn.net/howto/bypass-firewall-and-nat-with-reverse-ssh-tunnel/</a>
</p>
</div>
</div>
<div id="outline-container-org6c9ad97" class="outline-3">
<h3 id="org6c9ad97"><span class="section-number-3">5.23.</span> USE CASES</h3>
<div class="outline-text-3" id="text-5-23">
<p>
compare private and public
</p>
<ul class="org-ul">
<li>diff &lt;( ssh-keygen -y -e -f "id<sub>rsa</sub>" ) &lt;( ssh-keygen -y -e -f "id<sub>rsa.pub</sub>" )</li>
</ul>

<p>
login to directory
</p>
<pre class="example">
ssh root@host -t "cd /directory_wanted ; bash --login"
</pre>


<p>
get sha256 of a keys
</p>
<pre class="example">
ssh-keygen -l -E sha256 -f .ssh/id_rsa
</pre>
</div>
</div>

<div id="outline-container-org76c2e4f" class="outline-3">
<h3 id="org76c2e4f"><span class="section-number-3">5.24.</span> rsync</h3>
<div class="outline-text-3" id="text-5-24">
<p>
allow to resume downloading. Require: have rsync installed on both sides.
</p>
</div>
<div id="outline-container-orgdca80ba" class="outline-4">
<h4 id="orgdca80ba"><span class="section-number-4">5.24.1.</span> troubleshooting</h4>
<div class="outline-text-4" id="text-5-24-1">
<p>
No space left on device (28)
</p>
<pre class="example">
--inplace
</pre>
</div>
</div>
</div>
<div id="outline-container-org364dfdd" class="outline-3">
<h3 id="org364dfdd"><span class="section-number-3">5.25.</span> user with limited permissions</h3>
<div class="outline-text-3" id="text-5-25">
<ol class="org-ol">
<li>/etc/ssh/sshd<sub>config</sub></li>
</ol>
<div class="org-src-container">
<pre class="src src-conf">  Match Group sftp_users
  X11Forwarding no
  AllowTcpForwarding no
  ChrootDirectory /ubuntu <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">user folder</span>
  ForceCommand internal-sftp
</pre>
</div>
<ol class="org-ol">
<li>/etc/passwd:
<ul class="org-ul">
<li>ubuntu:x:1001:1001::/ubuntu:</li>
</ul></li>
<li>folder
<ul class="org-ul">
<li>mkdir /ubuntu</li>
<li>chown root.root <i>ubuntu</i></li>
</ul></li>
</ol>
</div>
</div>
<div id="outline-container-org9b6452c" class="outline-3">
<h3 id="org9b6452c"><span class="section-number-3">5.26.</span> links</h3>
<div class="outline-text-3" id="text-5-26">
<ul class="org-ul">
<li>Памятка пользователям ssh <a href="https://habr.com/en/post/122445/">https://habr.com/en/post/122445/</a></li>
<li><a href="https://en.wikibooks.org/wiki/OpenSSH/Cookbook/Public_Key_Authentication">https://en.wikibooks.org/wiki/OpenSSH/Cookbook/Public_Key_Authentication</a></li>
<li><a href="https://help.ubuntu.com/community/SSH/OpenSSH/Configuring">https://help.ubuntu.com/community/SSH/OpenSSH/Configuring</a></li>
<li>config example <a href="https://stosb.com/blog/explaining-my-configs-sshd_config/">https://stosb.com/blog/explaining-my-configs-sshd_config/</a></li>
</ul>
</div>
</div>

<div id="outline-container-org57dd1f7" class="outline-3">
<h3 id="org57dd1f7"><span class="section-number-3">5.27.</span> ssh over socks5</h3>
<div class="outline-text-3" id="text-5-27">
<ul class="org-ul">
<li>required: net-analyzer/openbsd-netcat</li>
<li>ssh -o ProxyCommand='nc -X 5 -x 127.0.0.1:1081 %h %p' root@host</li>
</ul>
</div>
</div>
<div id="outline-container-orge0e5780" class="outline-3">
<h3 id="orge0e5780"><span class="section-number-3">5.28.</span> problems</h3>
<div class="outline-text-3" id="text-5-28">
<p>
Connection closed by UNKNOWN port 65535
</p>
<ul class="org-ul">
<li>error in ProxyCommand</li>
</ul>
</div>
</div>
<div id="outline-container-org1408c25" class="outline-3">
<h3 id="org1408c25"><span class="section-number-3">5.29.</span> ssh as a tor hidden service <a id="orgbc66187"></a></h3>
<div class="outline-text-3" id="text-5-29">
<ul class="org-ul">
<li>apt update</li>
<li>apt install tor</li>
<li>server /etc/tor/torrc:</li>
</ul>
<div class="org-src-container">
<pre class="src src-conf">ShutdownWaitLength 1 seconds
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">ExcludeNodes {ru}, {cn}, {by}, {kz}, {sy}, {am}, {in} # paranoid</span>
GeoIPExcludeUnknown 1 <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">paranoid</span>
Sandbox 0 <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">not compatible with obfs4</span>
Log notice file /var/log/tor/tor_notices.log
SocksPort 0
ExitRelay 0
BridgeRelay 0
HiddenServiceDir /var/lib/tor/ssh
HiddenServicePort 22 127.0.0.1:22
</pre>
</div>

<p>
Steps:
</p>

<ol class="org-ol">
<li>Client:</li>
</ol>
<div class="org-src-container">
<pre class="src src-sh">openssl genpkey -algorithm x25519 -out key.private.pem
cat key.private.pem | grep -v <span style="color: #95e454;">" PRIVATE KEY"</span> | base64 -d | tail --bytes=32 | base32 | sed <span style="color: #95e454;">'s/=//g'</span> &gt; private.key
openssl pkey -in key.private.pem -pubout | grep -v <span style="color: #95e454;">" PUBLIC KEY"</span> | base64 -d | tail --bytes=32 | base32 | sed <span style="color: #95e454;">'s/=//g'</span> &gt; public.key
<span style="color: #e5786d;">echo</span> <span style="color: #cae682;">KEY_PUB</span>=$(<span style="color: #fa8072;">cat public.key</span>)
</pre>
</div>

<ol class="org-ol">
<li>Server:</li>
<li>&lt;HiddenServiceDir&gt;/authorized<sub>clients</sub>/&lt;user&gt;.auth
<ul class="org-ul">
<li>descriptor:x25519:&lt;public.key&gt;</li>
</ul></li>
<li>mkdir /var/lib/tor/ssh</li>
<li>chmod go-a <i>var/lib</i>
tor/ssh</li>

<li>Client:</li>
<li>torrc: ClientOnionAuthDir /var/lib/tor/userauth</li>
<li>create file: &lt;ClientOnionAuthDir&gt;/&lt;user&gt;.auth<sub>private</sub>
<ul class="org-ul">
<li>&lt;56-char-onion-addr-without-.onion-part&gt;:descriptor:x25519:&lt;private.key&gt;</li>
</ul></li>
</ol>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #cae682;">KEY_USER</span>=ta
<span style="color: #cae682;">ONION</span>=xfe4swdndyhauaxj5di5ewnce2egr7qonn475vvopywonpe76jara2id.onion
<span style="color: #cae682;">PRIVATE</span>=
cat &lt;&lt;EOF &gt; userauth.sh
<span style="color: #ffff00; font-weight: bold;">#!/bin/bash</span>
<span style="color: #ffff00; font-weight: bold;">echo "${ONION:0:56}:descriptor:x25519:$PRIVATE" &gt; /var/lib/tor/userauth/$KEY_USER.auth_private</span>
<span style="color: #ffff00; font-weight: bold;">EOF</span>
</pre>
</div>



<div class="org-src-container">
<pre class="src src-sh"><span style="color: #cae682;">SSH_TOR_PORT</span>=88
<span style="color: #cae682;">SSH_PORT</span>=49382
<span style="color: #cae682;">KEY_USER</span>=ta
<span style="color: #cae682;">KEY_PUB</span>=P66JHL7W3R32O2DJBSGNVNR66JKJAS4KDG5Q4Q4EQM7CVH3X3IGQ
apt update
apt install tor
cat &lt;&lt;EOF &gt; /etc/tor/torrc
<span style="color: #ffff00; font-weight: bold;">RunAsDaemon 1</span>
<span style="color: #ffff00; font-weight: bold;">ShutdownWaitLength 1 seconds</span>
<span style="color: #ffff00; font-weight: bold;">GeoIPExcludeUnknown 0</span>
<span style="color: #ffff00; font-weight: bold;">Sandbox 0 # not compatible with obfs4</span>
<span style="color: #ffff00; font-weight: bold;">Log notice file /var/log/tor/tor_notices.log</span>
<span style="color: #ffff00; font-weight: bold;">SocksPort 0</span>
<span style="color: #ffff00; font-weight: bold;">ExitRelay 0</span>
<span style="color: #ffff00; font-weight: bold;">BridgeRelay 0</span>
<span style="color: #ffff00; font-weight: bold;">HiddenServiceDir /var/lib/tor/ssh</span>
<span style="color: #ffff00; font-weight: bold;">HiddenServicePort $SSH_TOR_PORT 127.0.0.1:$SSH_PORT</span>
<span style="color: #ffff00; font-weight: bold;">EOF</span>
mkdir -p /var/lib/tor/ssh/authorized_clients
chmod -R 700 /var/lib/tor/ssh
chown -R debian-tor:debian-tor /var/lib/tor/ssh
<span style="color: #e5786d;">echo</span> <span style="color: #95e454;">"descriptor:x25519:$KEY_PUB"</span> &gt; /var/lib/tor/ssh/authorized_clients/$<span style="color: #cae682;">KEY_USER</span>.auth
systemctl restart tor
sleep 7
cat /var/lib/tor/ssh/hostname
</pre>
</div>

<p>
<a href="https://www.maths.tcd.ie/~fionn/misc/ssh_hidden_service/">https://www.maths.tcd.ie/~fionn/misc/ssh_hidden_service/</a>
</p>
</div>
</div>

<div id="outline-container-orgad1f13a" class="outline-3">
<h3 id="orgad1f13a"><span class="section-number-3">5.30.</span> ssh systemd service</h3>
<div class="outline-text-3" id="text-5-30">
<div class="org-src-container">
<pre class="src src-conf">[<span style="color: #92a65e; font-weight: bold;">Unit</span>]
<span style="color: #cae682;">Description</span>=Setup a secure tunnel to %I
<span style="color: #cae682;">After</span>=network.target

[<span style="color: #92a65e; font-weight: bold;">Service</span>]
<span style="color: #cae682;">Environment</span>=<span style="color: #95e454;">"LOCAL_ADDR=localhost"</span>
<span style="color: #cae682;">EnvironmentFile</span>=/etc/default/secure-tunnel@%i
<span style="color: #cae682;">ExecStart</span>=/usr/bin/ssh -NT -o ServerAliveInterval=60 -o ExitOnForwardFailure=yes -L ${LOCAL_ADDR}:${LOCAL_PORT}:localhost:${REMOTE_PORT} ${TARGET}

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Restart every &gt;2 seconds to avoid StartLimitInterval failure</span>
<span style="color: #cae682;">RestartSec</span>=5
<span style="color: #cae682;">Restart</span>=always

[<span style="color: #92a65e; font-weight: bold;">Install</span>]
<span style="color: #cae682;">WantedBy</span>=multi-user.target
</pre>
</div>
</div>
</div>
<div id="outline-container-orgbfa3163" class="outline-3">
<h3 id="orgbfa3163"><span class="section-number-3">5.31.</span> rsync over ssh</h3>
<div class="outline-text-3" id="text-5-31">
<p>
Copy from remote to local
</p>
<ul class="org-ul">
<li>rsync required on remote host:</li>
</ul>
<pre class="example">
rsync -avzhP -e "ssh -p 6767" root@41.80.200.1:/home/rtorrent/downloads/Guns* /home/ssh/downloads/
</pre>
</div>
</div>
<div id="outline-container-org5671998" class="outline-3">
<h3 id="org5671998"><span class="section-number-3">5.32.</span> timeouts</h3>
<div class="outline-text-3" id="text-5-32">
<p>
Client side:
</p>
<ul class="org-ul">
<li>ServerAliveInterval 0 : Sets a timeout interval in seconds after which if no data has been received from
the server, ssh will send a message through the encrypted channel to request a response from the server. For
example, set a timeout to 15 seconds.</li>
<li>ServerAliveCountMax 3 : Sets the number of server alive messages which may be sent without ssh command
receiving any messages back from the server. If this threshold is reached while server alive messages are
being sent, ssh will disconnect from the server, terminating the session. The server alive messages are sent
through the encrypted channel and therefore will not be spoofable.</li>
</ul>

<p>
Timeout value = ClientAliveInterval * ClientAliveCountMax
</p>

<p>
Server side:
</p>
<ul class="org-ul">
<li>ClientAliveInterval 0: Sets a timeout interval in seconds (30) after which if no data has been received from
the client, sshd will send a message through the encrypted channel to request a response from the
client. The default is 0, indicating that these messages will not be sent to the client. This option applies
to protocol version 2 only. Send by encrypted channel.</li>
<li>ClientAliveCountMax 3: Sets the number of client alive messages (5) which may be sent without sshd receiving any messages back from the client. If this threshold is reached while client alive messages are being sent, sshd will disconnect the client, terminating the session.</li>
<li>TCPKeepAlive: “yes/no” send keepalive messages (default yes). Send by unencrypted channel.</li>
</ul>

<pre class="example">
-o 'ServerAliveInterval 5' -o 'ServerAliveCountMax 10' -o 'TCPKeepAlive no'
</pre>
</div>
</div>
</div>

<div id="outline-container-org0ae2905" class="outline-2">
<h2 id="org0ae2905"><span class="section-number-2">6.</span> Text User Interface (TUI)</h2>
<div class="outline-text-2" id="text-6">
<p>
dialog
</p>
<ul class="org-ul">
<li>&#x2013;clear - clear the screen</li>
<li></li>
</ul>
<div class="org-src-container">
<pre class="src src-bash">dialog --clear --checklist <span style="color: #95e454;">"Favorite programming languages:"</span> <span style="color: #95e454;">\</span>
10 30 7 1 <span style="color: #95e454;">\</span>
Python on 2 Java off 3 Bash off 4 Perl off 5 Ruby off
</pre>
</div>
</div>
</div>

<div id="outline-container-org1889ee8" class="outline-2">
<h2 id="org1889ee8"><span class="section-number-2">7.</span> jq - JSON parser</h2>
<div class="outline-text-2" id="text-7">
<ul class="org-ul">
<li><a href="https://jqlang.github.io/jq/manual/">https://jqlang.github.io/jq/manual/</a></li>
<li><a href="https://orgmode.org/worg/org-contrib/babel/languages/ob-doc-shell.html">https://orgmode.org/worg/org-contrib/babel/languages/ob-doc-shell.html</a></li>
</ul>
</div>

<div id="outline-container-org0405d1d" class="outline-3">
<h3 id="org0405d1d"><span class="section-number-3">7.1.</span> output format</h3>
<div class="outline-text-3" id="text-7-1">
<p>
By default, jq pretty-prints JSON output.
</p>
<ul class="org-ul">
<li>&#x2013;raw-output / -r	raw JSON or string without quotes</li>
<li>&#x2013;raw-output0	new lines replace with NUL</li>
<li>&#x2013;compact-output / -c:</li>
<li>&#x2013;color-output / -C and &#x2013;monochrome-output / -M:</li>
<li>&#x2013;indent n</li>
<li>&#x2013;tab - use tab instead of spaces</li>
</ul>
</div>
</div>
<div id="outline-container-orgae7a53e" class="outline-3">
<h3 id="orgae7a53e"><span class="section-number-3">7.2.</span> access</h3>
<div class="outline-text-3" id="text-7-2">
<ul class="org-ul">
<li>.[]			get element</li>
<li>".[] | .name" 	access field</li>
<li>" | .name"		map for every</li>
<li>"map(.name)"		map for every</li>
<li>"| keys"		function: get the keys of an object</li>
<li>"| length"		function: get length</li>
<li>map(has("name"))	check key exist and return true or false</li>
<li>min/max</li>
<li>unique</li>
<li>jq '.[] | select(.color=="yellow")' - by condition</li>
<li>.[] | select(.name|test("<sup>o</sup>.")) - by regex match</li>
</ul>
<p>
omit one of the indexes:
</p>
<pre class="example">
echo '[1,2,3,4,5,6,7,8,9,10]' | jq '.[:6]' | jq '.[-2:]' # [ 5, 6 ]
</pre>


<div class="org-src-container">
<pre class="src src-bash"><span style="color: #e5786d;">echo</span> <span style="color: #95e454;">'{"fruit1":{"name":"apple"},"fruit2":{"name":"orange"}}'</span> | jq <span style="color: #95e454;">'.[] | select(.name|test("^o."))'</span>
</pre>
</div>


<div class="org-src-container">
<pre class="src src-bash"><span style="color: #e5786d;">echo</span> <span style="color: #95e454;">'{"fruit":{"name":"apple","color":"green","price":1.20}}'</span> | jq -r <span style="color: #95e454;">'map(has("name"))'</span>
</pre>
</div>

<pre class="example">
[
  true
]
</pre>



<pre class="example" id="org3d8ab25">
{
  "result": {
    "alternatives": [
      {
        "message": {
          "role": "assistant",
          "text": "Согласно документации"
        },
        "status": "ALTERNATIVE_STATUS_FINAL"
      }
    ],
    "usage": {
      "inputTextTokens": "29",
      "completionTokens": "77",
      "totalTokens": "106"
    },
    "modelVersion": "18.01.2024"
  }
}
</pre>

<div class="org-src-container">
<pre class="src src-bash">cat | jq <span style="color: #95e454;">"map(.alternatives)"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb326a4f" class="outline-3">
<h3 id="orgb326a4f"><span class="section-number-3">7.3.</span> merge</h3>
<div class="outline-text-3" id="text-7-3">
<p>
cat Pipfile.lock | jq '.default | (keys | .[]) + (.[].version)'
</p>
</div>
</div>
<div id="outline-container-orga966f41" class="outline-3">
<h3 id="orga966f41"><span class="section-number-3">7.4.</span> building</h3>
<div class="outline-text-3" id="text-7-4">
<ul class="org-ul">
<li>&#x2014;null-input / -n</li>
<li></li>
</ul>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #cae682;">BUCKET_NAME</span>=testbucket
<span style="color: #cae682;">OBJECT_NAME</span>=testworkflow-2.0.1.jar
<span style="color: #cae682;">TARGET_LOCATION</span>=/opt/test/testworkflow-2.0.1.jar

jq -n <span style="color: #95e454;">\</span>
   --arg bn <span style="color: #95e454;">"$BUCKET_NAME"</span> <span style="color: #95e454;">\</span>
   --arg on <span style="color: #95e454;">"$OBJECT_NAME"</span> <span style="color: #95e454;">\</span>
   --arg tl <span style="color: #95e454;">"$TARGET_LOCATION"</span> <span style="color: #95e454;">\</span>
   <span style="color: #95e454;">'{bucketname: $bn, objectname: $on, targetlocation: $tl}'</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgd0f7aae" class="outline-2">
<h2 id="orgd0f7aae"><span class="section-number-2">8.</span> fish</h2>
<div class="outline-text-2" id="text-8">
<ul class="org-ul">
<li>do not use indentation to define code blocks like Python.</li>
<li>fish<sub>indent</sub> -</li>
</ul>
</div>
</div>
<div id="outline-container-orgc3cf0d9" class="outline-2">
<h2 id="orgc3cf0d9"><span class="section-number-2">9.</span> print JSON</h2>
<div class="outline-text-2" id="text-9">
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #cae682;">BUCKET_NAME</span>=testbucket
<span style="color: #cae682;">OBJECT_NAME</span>=testworkflow-2.0.1.jar
<span style="color: #cae682;">TARGET_LOCATION</span>=/opt/test/testworkflow-2.0.1.jar

<span style="color: #cae682;">JSON_FMT</span>=<span style="color: #95e454;">'{"bucketname":"%s","objectname":"%s","targetlocation":"%s"}\n'</span>
<span style="color: #e5786d;">printf</span> <span style="color: #95e454;">"$JSON_FMT"</span> <span style="color: #95e454;">"$BUCKET_NAME"</span> <span style="color: #95e454;">"$OBJECT_NAME"</span> <span style="color: #95e454;">"$TARGET_LOCATION"</span>
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Created: 2025-01-14 Tue 12:52</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
