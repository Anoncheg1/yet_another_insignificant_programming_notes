<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2025-01-14 Tue 12:50 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>&lrm;</title>
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="content" class="content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org8e0250c">1. Key questions:</a></li>
<li><a href="#org5a42f0f">2. most common structures</a>
<ul>
<li><a href="#org827e06f">2.1. json</a></li>
<li><a href="#org53e5bc5">2.2. remove old <span class="underline"><span class="underline">pycache</span></span></a></li>
<li><a href="#orgdec08fd">2.3. sliced windows</a></li>
<li><a href="#org63b653f">2.4. compare row to itself</a></li>
<li><a href="#org07628a4">2.5. group elements in chunks from list</a></li>
<li><a href="#org569dcd6">2.6. flatten list</a></li>
<li><a href="#orgfefc9b0">2.7. count occurances of intems in a list</a></li>
<li><a href="#org198c38f">2.8. dot notation access</a>
<ul>
<li><a href="#orgedde090">2.8.1. SimpleNamespace</a></li>
<li><a href="#org9f3a8a4">2.8.2. dataclass</a></li>
</ul>
</li>
<li><a href="#orgd58b3b3">2.9. fast lookup in ranges</a></li>
<li><a href="#org7ad0f15">2.10. time of execution</a></li>
<li><a href="#org48f8a1e">2.11. call one functions several times</a></li>
<li><a href="#orgf2d72bd">2.12. prepare message for logging as like print</a></li>
<li><a href="#orgaee2b47">2.13. group dictionaries in list</a></li>
<li><a href="#orgd5eafca">2.14. ModuleNotFoundError: No module named</a></li>
</ul>
</li>
<li><a href="#orgde37a92">3. tools 2022 pypi</a>
<ul>
<li><a href="#org74ddf00">3.1. web frameworks</a></li>
<li><a href="#orgea235ef">3.2. additional libraries</a></li>
<li><a href="#org8a8c473">3.3. machine learning frameworks</a></li>
<li><a href="#org975a9db">3.4. cloud platforms do you use? *This question is required.</a></li>
<li><a href="#orgb6f97c9">3.5. ORM(s) do you use together with Python, if any? *This question is required.</a></li>
<li><a href="#org9480762">3.6. Big Data tool(s) do you use, if any?  *This question is required.</a></li>
<li><a href="#org5cdadb4">3.7. Continuous Integration (CI) system(s) do you regularly use? *This question is required.</a></li>
<li><a href="#org9a861f8">3.8. configuration management tools do you use, if any? *This question is required.</a></li>
<li><a href="#org788eaed">3.9. documentation tool do you use?  *This question is required.</a></li>
<li><a href="#org13dedc0">3.10. IDE features</a></li>
<li><a href="#org83eae2a">3.11. isolate Python environments between projects? *This question is required.</a></li>
<li><a href="#org5134a5a">3.12. tools related to Python packaging do you use directly?  *This question is required.</a></li>
<li><a href="#org12e2421">3.13. application dependency management? *This question is required.</a></li>
<li><a href="#org50bf8af">3.14. automated services to update the versions of application dependencies? *This question is required.</a></li>
<li><a href="#orgd1cc296">3.15. installing packages? *This question is required.</a></li>
<li><a href="#org60bef10">3.16. tool(s) do you use to develop Python applications? *This question is required.</a></li>
<li><a href="#org966dd26">3.17. job role(s)? *This question is required.</a></li>
</ul>
</li>
<li><a href="#org5035e6c">4. tools 2024</a></li>
<li><a href="#orgd6dcadc">5. install</a>
<ul>
<li><a href="#orgf425610">5.1. debian</a></li>
<li><a href="#org98c65bb">5.2. issues</a></li>
<li><a href="#orga6be407">5.3. change Python version Ubuntu &amp; Debian</a></li>
</ul>
</li>
<li><a href="#org09d59e4">6. Python theory</a>
<ul>
<li><a href="#orgfb89a16">6.1. Python [ˈpʌɪθ(ə)n] паисэн</a></li>
<li><a href="#orgc94559e">6.2. philosophy</a></li>
<li><a href="#org17a4992">6.3. History</a>
<ul>
<li><a href="#orgded49e4">6.3.1. 3.0</a></li>
</ul>
</li>
<li><a href="#org364fd5f">6.4. Implementations</a></li>
<li><a href="#orgbd5c9d2">6.5. Bytecode:</a></li>
<li><a href="#org83d6792">6.6. terms</a></li>
<li><a href="#org475b70c">6.7. Indentation - Отступ слева and blank lines</a></li>
<li><a href="#org11ea552">6.8. mathematic</a></li>
<li><a href="#org99b0bb3">6.9. WSGI (Web Server Gateway Interface)(whiskey)</a></li>
<li><a href="#orgdfa3133">6.10. pythonic paradigms</a></li>
</ul>
</li>
<li><a href="#orgbe812b0">7. scripting</a>
<ul>
<li><a href="#org8f41adc">7.1. top-level script enironment</a></li>
<li><a href="#org107e052">7.2. command line arguments parsing</a></li>
<li><a href="#org4b3ff21">7.3. python executable</a></li>
<li><a href="#orgd9e2171">7.4. current dir</a></li>
<li><a href="#orgbb57fd0">7.5. unix logger</a></li>
<li><a href="#org2b6233b">7.6. How does python find packages?</a></li>
<li><a href="#orgba5e0c0">7.7. dist-packages and site-packages?</a></li>
<li><a href="#org6e38714">7.8. file size and modification date</a></li>
<li><a href="#org751d2f8">7.9. environment</a></li>
<li><a href="#orge6c5d12">7.10. -m mod - run library module as a script</a>
<ul>
<li><a href="#org48bfd0f">7.10.1. e.g. mymodule/_<sub>main</sub>_<sub>.py</sub>:</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org5689405">8. Data model</a>
<ul>
<li><a href="#orgffd2289">8.1. special types</a></li>
<li><a href="#org11545fb">8.2. theory</a></li>
<li><a href="#orgdb1e6df">8.3. Types build-in </a></li>
<li><a href="#org96b5693">8.4. Truth Value Testing </a></li>
<li><a href="#orgd02ebef">8.5. Shallow and deep copy operations</a></li>
<li><a href="#orgbf61d19">8.6. Why Dict and set use only hashable objects?</a></li>
<li><a href="#orgfd4465f">8.7. Dict hash collisions</a></li>
<li><a href="#org83585f7">8.8. links</a></li>
</ul>
</li>
<li><a href="#org2fa9dfe">9. typed varibles or type hints</a>
<ul>
<li><a href="#orgf1170f8">9.1. typing.Annotated and PEP-593</a>
<ul>
<li><a href="#org84746fe">9.1.1. from typing import get<sub>type</sub><sub>hints</sub></a></li>
<li><a href="#org1223cc4">9.1.2. Use case: A calendar Event model, using pydantic https://github.com/pydantic/pydantic</a></li>
</ul>
</li>
<li><a href="#orged2c87f">9.2. function annotation</a></li>
</ul>
</li>
<li><a href="#org3e7dd12">10. Strings</a>
<ul>
<li><a href="#org43cd78a">10.1. основы</a>
<ul>
<li><a href="#org2e2f896">10.1.1. multiline</a></li>
</ul>
</li>
<li><a href="#org3265882">10.2. <b>A formatted string literal or f-string</b></a></li>
<li><a href="#org1d8021f">10.3. <b>String Formatting Operator</b></a></li>
<li><a href="#orgd854a56">10.4. string literal prefixes</a></li>
<li><a href="#org1630aa1">10.5. raw strings, Unicode, formatted</a></li>
<li><a href="#orgffd2f06">10.6. Efficient String Concatenation</a></li>
<li><a href="#org36e806d">10.7. byte string</a></li>
</ul>
</li>
<li><a href="#org0465053">11. Classes</a>
<ul>
<li><a href="#orgf0e7964">11.1. basic</a></li>
<li><a href="#org45ce01a">11.2. Special Attributes</a></li>
<li><a href="#orgd3fe492">11.3. inheritance</a>
<ul>
<li><a href="#org61afcf3">11.3.1. Constructor</a></li>
<li><a href="#orgc170b3a">11.3.2. Subclassing:</a></li>
<li><a href="#org946107a">11.3.3. built-in functions that work with inheritance:</a></li>
<li><a href="#orgdc2f0d1">11.3.4. example</a></li>
<li><a href="#orgb1f58fc">11.3.5. Multiple inheritance - left-to-right</a></li>
<li><a href="#org5622815">11.3.6. Abstract class (ABC - abstract base class)</a></li>
<li><a href="#org03bbacd">11.3.7. Virtual sublasses</a></li>
<li><a href="#org76751a5">11.3.8. calling parent class constructor</a></li>
</ul>
</li>
<li><a href="#org94b7cb3">11.4. Getters and setters </a></li>
<li><a href="#orge089499">11.5. Polymorphism [pɔlɪˈmɔːfɪzm</a></li>
<li><a href="#org55b1787">11.6. Protocols or emulation</a></li>
<li><a href="#org42fdd14">11.7. private and protected</a></li>
<li><a href="#org734c1e2">11.8. object</a></li>
<li><a href="#orgf947ab0">11.9. Singleton</a>
<ul>
<li><a href="#orgbe0782b">11.9.1. example</a></li>
<li><a href="#org580f17d">11.9.2. шаблон Monostate</a></li>
</ul>
</li>
<li><a href="#org21f0609">11.10. anonumous class</a>
<ul>
<li><a href="#orga5608ea">11.10.1. 1</a></li>
</ul>
</li>
<li><a href="#orgaf7db7d">11.11. replace method</a></li>
</ul>
</li>
<li><a href="#org108edac">12. modules and packages</a>
<ul>
<li><a href="#org82f8cf1">12.1. module special  attributes (Module level "dunders") [-ʌndə(ɹ)]</a></li>
</ul>
</li>
<li><a href="#org1c9f35f">13. functions</a>
<ul>
<li><a href="#org5dfac71">13.1. by value or by reference</a></li>
<li><a href="#orgb129beb">13.2. Types of Аргументы функции</a></li>
<li><a href="#org69420fe">13.3. example</a></li>
<li><a href="#orgf9ad0f3">13.4. arguments, anonymous-lambda, global variables</a></li>
<li><a href="#org7c653f0">13.5. attributes</a></li>
<li><a href="#orgff77067">13.6. function decorators</a></li>
<li><a href="#org7e23248">13.7. build-in</a></li>
<li><a href="#org9ab24d5">13.8. Closure</a></li>
<li><a href="#org50fddb3">13.9. overloading</a></li>
</ul>
</li>
<li><a href="#org67e3e77">14. asterisk(*)</a></li>
<li><a href="#org9d83715">15. with</a>
<ul>
<li><a href="#org504ef4e">15.1. Context manager class TEMPLATE</a></li>
</ul>
</li>
<li><a href="#org03dcb90">16. Operators and control structures</a>
<ul>
<li><a href="#org5ecadba">16.1. basic</a></li>
<li><a href="#orgb2161a9">16.2. Operator Precedence (Приоритет) <i>ˈpresədəns</i></a></li>
<li><a href="#org6b0f224">16.3. value unpacking</a></li>
<li><a href="#orgbb349b3">16.4. if, loops</a></li>
<li><a href="#orge2308ec">16.5. match 3.10</a></li>
<li><a href="#org4256026">16.6. Slicing Sequence</a></li>
</ul>
</li>
<li><a href="#org834b3da">17. Traverse or iteration over containers</a>
<ul>
<li><a href="#orgdbc427f">17.1. iterator object </a></li>
<li><a href="#org526780c">17.2. iterate dictionary</a></li>
</ul>
</li>
<li><a href="#orgc3ba443">18. The Language Reference</a>
<ul>
<li><a href="#org41ed26b">18.1. yield and generator expression </a></li>
<li><a href="#org296d4cf">18.2. yield from</a></li>
<li><a href="#org6be58da">18.3. ex</a></li>
<li><a href="#orgff9bb04">18.4. function decorator</a></li>
<li><a href="#org25eb9ec">18.5. class decorator</a></li>
<li><a href="#org52096d5">18.6. lines</a></li>
<li><a href="#org89141e4">18.7. Indentation</a></li>
<li><a href="#orgfca1e14">18.8. identifier [aɪˈdentɪfaɪər] or names</a></li>
<li><a href="#orgb18ff28">18.9. Keywords Exactly as written here:</a></li>
<li><a href="#org494cd36">18.10. Numeric literals</a>
<ul>
<li><a href="#orgfa64cf6">18.10.1. integers</a></li>
<li><a href="#org08e6e16">18.10.2. float</a></li>
<li><a href="#org9f248a9">18.10.3. Imaginary literals</a></li>
</ul>
</li>
<li><a href="#org4af4b33">18.11. Docstring and comments</a></li>
<li><a href="#org552b5ae">18.12. Simple statements</a></li>
<li><a href="#org6c711cf">18.13. call external process</a>
<ul>
<li><a href="#orgb273893">18.13.1. ex</a></li>
<li><a href="#orgf207bbd">18.13.2. ex: call shell command and get stdout stderr and check return status</a></li>
<li><a href="#org587d1b4">18.13.3. links</a></li>
</ul>
</li>
<li><a href="#org90cd3a4">18.14. Timeout on subprocess readline in Python</a>
<ul>
<li><a href="#orgbb8d7bd">18.14.1. 1</a></li>
<li><a href="#orge33ec79">18.14.2. 2</a></li>
<li><a href="#org484c61e">18.14.3. 3</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org285b8af">19. The Python Standard Library</a>
<ul>
<li><a href="#org3e98dcb">19.1. Major libs:</a></li>
<li><a href="#org960f2e7">19.2. regex - import re, regular</a>
<ul>
<li><a href="#orgf43efe6">19.2.1. methods</a></li>
<li><a href="#org31f02c1">19.2.2. sub example</a></li>
<li><a href="#orgae0811d">19.2.3. get string between substring</a></li>
<li><a href="#org3e367d6">19.2.4. reference</a></li>
<li><a href="#org8de503b">19.2.5. Frequent Sequences:</a></li>
<li><a href="#org182a148">19.2.6. (&#x2026;) - capture to group.</a></li>
<li><a href="#org3ad28bd">19.2.7. Zero-width assertions or lookarounds</a></li>
</ul>
</li>
<li><a href="#orgc5365fe">19.3. datetime</a>
<ul>
<li><a href="#orga3d6fd4">19.3.1. datetime to date</a></li>
<li><a href="#org3af2c54">19.3.2. date to datetime</a></li>
<li><a href="#org90b9943">19.3.3. current time</a></li>
</ul>
</li>
<li><a href="#orgebe4847">19.4. file object</a></li>
<li><a href="#org86f432a">19.5. importlib</a></li>
<li><a href="#org4081dd8">19.6. pprint</a></li>
</ul>
</li>
<li><a href="#org20154af">20. exceptions handling</a>
<ul>
<li><a href="#orgca45733">20.1. syntax</a></li>
<li><a href="#org64fe708">20.2. output</a></li>
<li><a href="#orgc396c85">20.3. hierarchy</a></li>
<li><a href="#orge1c947d">20.4. explanation</a></li>
<li><a href="#org69676b8">20.5. traceback</a></li>
<li><a href="#org764e7de">20.6. simple exception</a></li>
<li><a href="#org248c2da">20.7. examples</a></li>
</ul>
</li>
<li><a href="#orgfb822d8">21. Logging</a>
<ul>
<li><a href="#orge48ec69">21.1. ways to log</a></li>
<li><a href="#org0dbeb34">21.2. terms</a></li>
<li><a href="#orgc282864">21.3. getLogger()</a></li>
<li><a href="#org3db6d82">21.4. stderror</a></li>
<li><a href="#orge6b0be9">21.5. inspection</a></li>
<li><a href="#org7193ffe">21.6. levels</a></li>
</ul>
</li>
<li><a href="#orgbde6af9">22. Collections</a>
<ul>
<li><a href="#org793c6df">22.1. collections.Counter() - dict subclass for counting hashable objects</a></li>
<li><a href="#org348a5d3">22.2. time complexity</a></li>
</ul>
</li>
<li><a href="#org612da48">23. Conventions</a>
<ul>
<li><a href="#org8f353b8">23.1. code style, indentation, naming</a></li>
<li><a href="#org4ac0da7">23.2. 1/2 underscore</a></li>
<li><a href="#orgf237087">23.3. Whitespace in Expressions and Statements</a></li>
<li><a href="#orgfbe30c8">23.4. naming</a></li>
<li><a href="#org1dc1b0e">23.5. docstrings</a>
<ul>
<li><a href="#org133fa3c">23.5.1. ex. simple</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org49d21dd">24. Concurrency</a>
<ul>
<li><a href="#org5b108f9">24.1. select right API</a>
<ul>
<li><a href="#orgc6c02bb">24.1.1. asyncio vs threading</a></li>
</ul>
</li>
<li><a href="#org7cef518">24.2. Process</a></li>
<li><a href="#org9e35013">24.3. Pool of processes</a>
<ul>
<li><a href="#org158dff5">24.3.1. 1</a></li>
<li><a href="#org177ad4f">24.3.2. 2</a></li>
</ul>
</li>
<li><a href="#org9278c7c">24.4. threading</a>
<ul>
<li><a href="#org7658322">24.4.1. examples</a></li>
<li><a href="#org6e184ca">24.4.2. syncronization</a></li>
</ul>
</li>
<li><a href="#org9130bdd">24.5. multiprocessing</a></li>
<li><a href="#org39717b0">24.6. example multiprocess, Threads, othe thread</a></li>
</ul>
</li>
<li><a href="#org2178493">25. асинхронного программирования (asyncio, async, await)</a>
<ul>
<li><a href="#orgc2abcbf">25.1. Limitations</a></li>
<li><a href="#org63291ad">25.2. Best practices</a></li>
<li><a href="#org5782836">25.3. asyncio theory</a></li>
<li><a href="#org4a35126">25.4. terms:</a></li>
<li><a href="#orgbe31a9e">25.5. async and await syntax https://peps.python.org/pep-0492/</a></li>
<li><a href="#org313075d">25.6. hight-level API - asyncio.run</a></li>
<li><a href="#org49a4403">25.7. hight-level API - asyncio.Runner</a></li>
<li><a href="#org9b9e1d0">25.8. low-level API - get<sub>running</sub><sub>loop</sub> &amp; new<sub>event</sub><sub>loop</sub> &amp; run<sub>until</sub><sub>complete</sub></a></li>
<li><a href="#orgc444252">25.9. async with</a></li>
<li><a href="#orgd72b1b6">25.10. async for</a></li>
<li><a href="#org4bf0bea">25.11. <span class="todo TODO">TODO</span> Asynchronous Generators</a></li>
<li><a href="#org7b7a8b9">25.12. Troubleshooting</a></li>
<li><a href="#orga414da5">25.13. links</a></li>
</ul>
</li>
<li><a href="#org1aca607">26. Monkey patch (modification at runtile) Reflective or meta programming</a>
<ul>
<li><a href="#org04fbfad">26.1. theory</a></li>
<li><a href="#orga0115e2">26.2. basic example</a></li>
<li><a href="#org9b083ed">26.3. replace method of class instance</a>
<ul>
<li><a href="#orgb5fb7b6">26.3.1. Monkey patch</a></li>
<li><a href="#org0cae45c">26.3.2. types.MethodType</a></li>
<li><a href="#orgcd370d7">26.3.3. Subclassing</a></li>
</ul>
</li>
<li><a href="#orgd205b1b">26.4. detect event of variable changed</a></li>
<li><a href="#orgd965c47">26.5. inspect.getmembers() vs <span class="underline"><span class="underline">dict</span></span>.items() vs dir()</a></li>
<li><a href="#orgd851d45">26.6. ex replace function</a></li>
<li><a href="#org266623c">26.7. ex replace method of class</a></li>
<li><a href="#orga5b829d">26.8. links</a></li>
</ul>
</li>
<li><a href="#org5b1165a">27. Performance Tips</a>
<ul>
<li><a href="#org81a7df6">27.1. string</a></li>
<li><a href="#org1eb807b">27.2. loop</a></li>
<li><a href="#org3355ac8">27.3. Avoiding dots&#x2026;</a></li>
<li><a href="#orgffd228e">27.4. avoid global variables</a></li>
<li><a href="#orgf5c13c4">27.5. dict</a></li>
</ul>
</li>
<li><a href="#org1436a78">28. decorators</a>
<ul>
<li><a href="#orgc7fa3ef">28.1. ex</a></li>
</ul>
</li>
<li><a href="#org3cf93dc">29. Assert</a></li>
<li><a href="#org4617205">30. Debugging and Profiling</a>
<ul>
<li><a href="#org31b3c9c">30.1. cProfile</a></li>
<li><a href="#org84497aa">30.2. small code measure 1</a></li>
<li><a href="#org0316390">30.3. small code measure 2 </a></li>
<li><a href="#orgeb85a11">30.4. pdb - breakpoint and code investigation</a></li>
<li><a href="#org8ebacb2">30.5. pdb - .pdbrc file </a></li>
<li><a href="#orgc1afd90">30.6. <span class="todo TODO">TODO</span> py-spy, pyinstrument</a></li>
</ul>
</li>
<li><a href="#org34b5297">31. inject</a>
<ul>
<li><a href="#orgda0967f">31.1. Callable</a></li>
<li><a href="#orga6de37c">31.2. links</a></li>
</ul>
</li>
<li><a href="#org8a54254">32. BUILD and PACKAGING</a>
<ul>
<li><a href="#org6ce90e2">32.1. build tools:</a>
<ul>
<li><a href="#org8dbdc5f">32.1.1. hatchling</a></li>
<li><a href="#org88f7378">32.1.2. setuptools</a></li>
<li><a href="#org2f1a565">32.1.3. gpep517 </a></li>
</ul>
</li>
<li><a href="#org7d50e7e">32.2. toml format for pyproject.toml</a>
<ul>
<li><a href="#org7231199">32.2.1. basic</a></li>
<li><a href="#org87c3555">32.2.2. integers</a></li>
<li><a href="#org1bae62f">32.2.3. Dates and Times</a></li>
<li><a href="#org36a13c4">32.2.4. array and table</a></li>
</ul>
</li>
<li><a href="#orgb26a30d">32.3. pyproject.toml</a>
<ul>
<li><a href="#org94203a6">32.3.1. [build-system]</a></li>
<li><a href="#org813e80f">32.3.2. metadata [project] and [project.urls]</a></li>
<li><a href="#org1d3f672">32.3.3. [project.scripts]</a></li>
<li><a href="#orgfe74c2c">32.3.4. dependencies</a></li>
<li><a href="#org2f6a06b">32.3.5. <span class="todo TODO">TODO</span> minimal</a></li>
<li><a href="#orgf7d2089">32.3.6. example</a></li>
</ul>
</li>
<li><a href="#org343b4ce">32.4. build</a></li>
<li><a href="#orgc9155e7">32.5. distutils (old)</a></li>
<li><a href="#org593024a">32.6. terms</a></li>
<li><a href="#orga865ad0">32.7. recommended</a></li>
<li><a href="#org69af755">32.8. Upload to the package distribution service</a>
<ul>
<li><a href="#org42ebddb">32.8.1. <span class="todo TODO">TODO</span> twine</a></li>
<li><a href="#orgdcf1905">32.8.2. <span class="todo TODO">TODO</span> Github actions</a></li>
</ul>
</li>
<li><a href="#orgf8a8f4d">32.9. editable installs PEP660</a></li>
<li><a href="#org81dbf45">32.10. PyPi project name, name normalization and other specifications</a>
<ul>
<li><a href="#org96f48d9">32.10.1. links</a></li>
</ul>
</li>
<li><a href="#orgdabb409">32.11. <span class="todo TODO">TODO</span> src layout vs flat layout</a></li>
<li><a href="#orgc8d1686">32.12. build tool, build system</a></li>
<li><a href="#org15514dd">32.13. build from source</a>
<ul>
<li><a href="#orga4fe9bf">32.13.1. pipdeptree</a></li>
<li><a href="#org1718ab8">32.13.2. troubles</a></li>
</ul>
</li>
<li><a href="#org6b63f93">32.14. links</a></li>
</ul>
</li>
<li><a href="#org10fe166">33. setuptools - build system</a></li>
<li><a href="#org8d8fd4b">34. pip (package manager)</a>
<ul>
<li><a href="#orgaf31882">34.1. release steps</a>
<ul>
<li><a href="#orgc23ea5a">34.1.1. links</a></li>
</ul>
</li>
<li><a href="#orge08ba1d">34.2. wheels</a></li>
<li><a href="#org445a452">34.3. virtualenv</a></li>
<li><a href="#org7191c2a">34.4. venv</a></li>
<li><a href="#orga3f7f4c">34.5. update</a></li>
<li><a href="#orgd7d9f2d">34.6. requirements.txt</a></li>
<li><a href="#org311e380">34.7. errors</a></li>
<li><a href="#org5626ac6">34.8. cache dir</a>
<ul>
<li><a href="#orga2dd17b">34.8.1. links</a></li>
</ul>
</li>
<li><a href="#org24c36d1">34.9. hashes </a></li>
<li><a href="#orgee50edb">34.10. add SSL certificate</a>
<ul>
<li><a href="#orgff915ba">34.10.1. crt(not working)</a></li>
<li><a href="#org558be63">34.10.2. pem(not working)</a></li>
</ul>
</li>
<li><a href="#org8efd31e">34.11. ignore SSL certificates</a></li>
<li><a href="#orgd599664">34.12. proxy</a></li>
<li><a href="#org48d8c91">34.13. <span class="todo TODO">TODO</span> https://packaging.python.org/en/latest/key_projects/</a></li>
<li><a href="#org5ec9881">34.14. ways to freeze dependencies:</a></li>
<li><a href="#orgc322a5c">34.15. pipenv</a>
<ul>
<li><a href="#orgac47a20">34.15.1. Cons: hard to read Pipfile.lock file.</a></li>
<li><a href="#org034824c">34.15.2. steps to create project:</a></li>
<li><a href="#org17b8653">34.15.3. commands</a></li>
</ul>
</li>
<li><a href="#org0810743">34.16. links</a></li>
</ul>
</li>
<li><a href="#orgef9b67c">35. urllib3 and requests library</a>
<ul>
<li><a href="#orgbf1f024">35.1. difference</a></li>
<li><a href="#org859f571">35.2. see raw request</a>
<ul>
<li><a href="#org69bd119">35.2.1. requests</a></li>
<li><a href="#org05b57a3">35.2.2. links</a></li>
</ul>
</li>
<li><a href="#org0ce2474">35.3. problems:</a></li>
<li><a href="#org697d0f4">35.4. links</a></li>
</ul>
</li>
<li><a href="#org612ac8a">36. pdf 2 png</a>
<ul>
<li><a href="#org2ad421f">36.1. pdf2image</a></li>
<li><a href="#org3da8345">36.2. Wand</a></li>
<li><a href="#org9dd1935">36.3. PyMuPDF</a></li>
</ul>
</li>
<li><a href="#orgbecfc9f">37. statsmodels</a>
<ul>
<li><a href="#orgd7c9993">37.1. ACF, PACF</a></li>
<li><a href="#orgfd48553">37.2. bar plot</a></li>
</ul>
</li>
<li><a href="#orgd67c5ec">38. XGBoost</a>
<ul>
<li><a href="#orga4084b6">38.1. usage</a></li>
<li><a href="#org3578fc9">38.2. categorical columns</a>
<ul>
<li><a href="#org5fa37d2">38.2.1. Feature importance between numerical and categorical features</a></li>
</ul>
</li>
<li><a href="#orgdcc5cf3">38.3. gpu support</a></li>
<li><a href="#org8b804d7">38.4. result value from leaf value</a></li>
<li><a href="#org3d0bcf4">38.5. terms</a></li>
<li><a href="#org9eb88d1">38.6. xgb.DMatrix</a>
<ul>
<li><a href="#org09f3578">38.6.1. LibSVM file format</a></li>
</ul>
</li>
<li><a href="#orgeabf73d">38.7. parameters</a></li>
<li><a href="#org62ba369">38.8. print important features</a></li>
<li><a href="#org3e45143">38.9. <span class="todo TODO">TODO</span> prune обрезание деревьев</a></li>
<li><a href="#orgeb267b9">38.10. permutation importance</a></li>
<li><a href="#orgf452d7e">38.11. model to if-else</a></li>
<li><a href="#org4edd940">38.12. Errors</a>
<ul>
<li><a href="#org41712f8">38.12.1. ValueError: setting an array element with a sequence.</a></li>
<li><a href="#org3e81ab3">38.12.2. label must be in [0,1] for logistic regression</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org86bfdaa">39. Natasha &amp; Yargy</a>
<ul>
<li><a href="#org342ca26">39.1. yargy</a>
<ul>
<li><a href="#org172a7dd">39.1.1. yargy.tokenizer</a></li>
<li><a href="#org261b98a">39.1.2. rules</a></li>
<li><a href="#org2dca019">39.1.3. match</a></li>
<li><a href="#orgd15a812">39.1.4. предикаты</a></li>
<li><a href="#orge397fb9">39.1.5. нестандартные формы слова - рулетики</a></li>
<li><a href="#orgcd085ff">39.1.6. ex</a></li>
<li><a href="#orgd9961c7">39.1.7. natasha</a></li>
<li><a href="#orgb43bd5e">39.1.8. console</a></li>
<li><a href="#orgce1a0ab">39.1.9. QT console</a></li>
<li><a href="#org7901995">39.1.10. graphviz</a></li>
<li><a href="#orgefce33b">39.1.11. IPython</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org9ea19a8">40. Stanford NER - Java</a>
<ul>
<li><a href="#org4fcd565">40.1. train</a></li>
<li><a href="#orgcc290b2">40.2. Ttraining data</a></li>
</ul>
</li>
<li><a href="#orga35709d">41. DeepPavlov</a>
<ul>
<li><a href="#orgc8c7d23">41.1. Коммандная-строка</a></li>
<li><a href="#orgb38ffcd">41.2. вспомогательные классы</a></li>
<li><a href="#orgefbbb17">41.3. in code</a></li>
<li><a href="#org4efed65">41.4. installation</a></li>
<li><a href="#org2396d42">41.5. training</a>
<ul>
<li><a href="#org81821fc">41.5.1. dataset<sub>iterators</sub></a></li>
</ul>
</li>
<li><a href="#orgdccb721">41.6. NLP pipeline json config</a>
<ul>
<li><a href="#orgb010d0a">41.6.1. configs</a></li>
<li><a href="#org6a59f12">41.6.2. parsing anal</a></li>
<li><a href="#org05a90ab">41.6.3. json</a></li>
<li><a href="#orga9bd58d">41.6.4. examples</a></li>
</ul>
</li>
<li><a href="#org12fe569">41.7. prerocessors</a>
<ul>
<li><a href="#orgfd8e098">41.7.1. tokenizers</a></li>
<li><a href="#org129a364">41.7.2. Embedder [ɪmˈbede] - Deep contextualized word reprezentation</a></li>
</ul>
</li>
<li><a href="#orgbf21d52">41.8. components</a></li>
<li><a href="#orgae8d7f4">41.9. Models</a></li>
<li><a href="#orgb3aa955">41.10. speelcheking</a>
<ul>
<li><a href="#org97cb03a">41.10.1. Tie vocabulary</a></li>
</ul>
</li>
<li><a href="#org00209dd">41.11. Classification</a>
<ul>
<li><a href="#org7b4e589">41.11.1. bert</a></li>
<li><a href="#org3aabb9e">41.11.2. iterators</a></li>
</ul>
</li>
<li><a href="#orgc46b6ab">41.12. NER - componen</a>
<ul>
<li><a href="#orgb06423c">41.12.1. ner<sub>rus</sub><sub>bert</sub></a></li>
</ul>
</li>
<li><a href="#org96d3d86">41.13. Custom component</a></li>
<li><a href="#org2336e59">41.14. docker</a></li>
<li><a href="#orgf437714">41.15. issues</a></li>
</ul>
</li>
<li><a href="#orgee62bee">42. AllenNLP</a></li>
<li><a href="#org49350a0">43. spaCy</a></li>
<li><a href="#org0d843cb">44. fastText</a>
<ul>
<li><a href="#org61fa01d">44.1. install</a></li>
</ul>
</li>
<li><a href="#org308a406">45. <span class="todo TODO">TODO</span> rusvectores</a></li>
<li><a href="#org12dbb04">46. Natural Language Toolkit (NLTK)</a>
<ul>
<li><a href="#orgc3001fa">46.1. collocations</a></li>
<li><a href="#org447c637">46.2. Association measures for collocations (measure functions)</a></li>
<li><a href="#org5b65f9f">46.3. Taggers</a></li>
<li><a href="#org0d3c2df">46.4. Корпус русского языка</a></li>
</ul>
</li>
<li><a href="#org21dab13">47. pymorphy2</a></li>
<li><a href="#org46ba16e">48. linux NLP</a>
<ul>
<li><a href="#org72e835d">48.1. count max words in line of file</a></li>
</ul>
</li>
<li><a href="#org8ca070b">49. fuzzysearch</a>
<ul>
<li><a href="#org97dc66a">49.1. typesense</a>
<ul>
<li><a href="#orgcbb93a8">49.1.1. pip3 install typesense &#x2013;user</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org9846b0d">50. Audio - librosa</a>
<ul>
<li><a href="#org2462db7">50.1. generic audio characteristics</a></li>
<li><a href="#orga241b9e">50.2. load</a></li>
<li><a href="#orgffdd803">50.3. the Fourier transform - spectrum</a></li>
<li><a href="#org9c5d462">50.4. spectrogram</a></li>
<li><a href="#orgff4957b">50.5. log-Mel spectrogram</a></li>
<li><a href="#org2e84433">50.6. distinguish emotions</a></li>
<li><a href="#orga5dfc09">50.7. links</a></li>
</ul>
</li>
<li><a href="#org6c661cf">51. Audio</a>
<ul>
<li><a href="#org2ecfe02">51.1. terms</a></li>
<li><a href="#orge79a464">51.2. theory</a></li>
<li><a href="#org0273cb1">51.3. The Fourier Transform (spectrum)</a></li>
<li><a href="#org893e4d5">51.4. log-Mel spectrogram</a>
<ul>
<li><a href="#orgd32c658">51.4.1. Log - because</a></li>
</ul>
</li>
<li><a href="#org7969870">51.5. pyo</a></li>
<li><a href="#org8f10e92">51.6. torchaudio</a></li>
<li><a href="#orgbd74279">51.7. ffmpeg-python</a></li>
</ul>
</li>
<li><a href="#org5e2c465">52. Whisper</a>
<ul>
<li><a href="#orgfb6f6dc">52.1. Byte-Pair Encoding (BPE)</a>
<ul>
<li><a href="#org1c6425c">52.1.1. usage</a></li>
</ul>
</li>
<li><a href="#orgd55715f">52.2. model.transcribe(filepath or numpy)</a>
<ul>
<li><a href="#org5705d3c">52.2.1. return</a></li>
</ul>
</li>
<li><a href="#orge5be1a4">52.3. model.decode(mel, options) </a></li>
<li><a href="#org23b68b1">52.4. no<sub>speech</sub><sub>prob</sub> and avg<sub>logprob</sub></a></li>
<li><a href="#orgdc0e7c0">52.5. decode from whisper<sub>word</sub><sub>level</sub> 844</a></li>
<li><a href="#orgd601a16">52.6. main<sub>loop</sub></a></li>
<li><a href="#orgd8fd969">52.7. words timestemps https://github.com/jianfch/stable-ts</a>
<ul>
<li><a href="#org3271445">52.7.1. transcribe format</a></li>
</ul>
</li>
<li><a href="#orgb0609fd">52.8. confidence score</a></li>
<li><a href="#org7e073f5">52.9. <span class="todo TODO">TODO</span> main/notebooks</a></li>
<li><a href="#org1c3a61f">52.10. links</a></li>
</ul>
</li>
<li><a href="#orgc2a2b7a">53. NER USΕ CASES</a>
<ul>
<li><a href="#orgca67f15">53.1. Spelling correction algorithms or  (spell checker) or (comparing a word to a list of words)</a></li>
<li><a href="#org0602e7e">53.2. fuzzy string comparision или Приближённый поиск</a></li>
</ul>
</li>
<li><a href="#org2b54cac">54. Flax and Jax</a></li>
<li><a href="#org61b627b">55. hyperparemeter optimization library <b>test-tube</b></a></li>
<li><a href="#org5c625b9">56. Keras</a>
<ul>
<li><a href="#org0cb6650">56.1. install</a></li>
<li><a href="#orga9d68ce">56.2. API types</a></li>
<li><a href="#org26304dc">56.3. Sequential model</a></li>
<li><a href="#org18b6654">56.4. functional API</a></li>
<li><a href="#orgbcf5508">56.5. Layers</a>
<ul>
<li><a href="#orgd5ccf4d">56.5.1. types</a></li>
<li><a href="#org0ab5ac2">56.5.2. Dense</a></li>
</ul>
</li>
<li><a href="#orga619bcf">56.6. Models</a></li>
<li><a href="#org6905683">56.7. Accuracy:</a></li>
<li><a href="#org88ff2ab">56.8. input shape &amp; text prepare</a></li>
<li><a href="#org7c7808b">56.9. ValueError: Error when checking input: expected input<sub>1</sub> to have 3 dimensions, but got array with shape</a></li>
<li><a href="#orgb885d8c">56.10. merge inputs</a></li>
<li><a href="#org6c43fd1">56.11. convolution</a></li>
<li><a href="#org8e3e273">56.12. character CNN</a></li>
<li><a href="#orgfb5a6c6">56.13. Early stopping</a></li>
<li><a href="#org206c4d0">56.14. plot history</a></li>
<li><a href="#orgdf67262">56.15. ImageDataGenerator class</a></li>
<li><a href="#orgba04cb9">56.16. CNN Rotate</a></li>
<li><a href="#orgb1da0c8">56.17. LSTM</a></li>
</ul>
</li>
<li><a href="#org1c72732">57. Tesseract - Optical Character Recognition</a>
<ul>
<li><a href="#org959803b">57.1. compilation</a></li>
<li><a href="#orgc6b0227">57.2. black and white list</a></li>
<li><a href="#org1bc5546">57.3. notes</a></li>
<li><a href="#org3bd285d">57.4. prepare</a></li>
<li><a href="#orgde99a94">57.5. usage</a></li>
</ul>
</li>
<li><a href="#org854ddfa">58. FEATURE ENGEERING</a>
<ul>
<li><a href="#org7f6ed18">58.1. Featuretools - Aturomatic Feature Engeering</a>
<ul>
<li><a href="#orgb87afc8">58.1.1. variable types</a></li>
<li><a href="#orgf2ccb16">58.1.2. example one-to-many</a></li>
<li><a href="#org82178b6">58.1.3. example many-to-many</a></li>
<li><a href="#org20f621a">58.1.4. oparations</a></li>
<li><a href="#orgc42e388">58.1.5. aggregation primitive - across a parent-child relationship:</a></li>
<li><a href="#orgaed361c">58.1.6. TransformPrimitive - one or more variables from an entity to one new:</a></li>
<li><a href="#org636664c">58.1.7. create primitive</a></li>
<li><a href="#orgccf33db">58.1.8. EXAMPLE from pandas</a></li>
</ul>
</li>
<li><a href="#orgba6e3cd">58.2. <span class="todo TODO">TODO</span> informationsfabirc</a></li>
<li><a href="#org77d4cdb">58.3. <span class="todo TODO">TODO</span> TPOT</a></li>
<li><a href="#orgb20cc1a">58.4. TSFRESH (time sequence)</a></li>
<li><a href="#orgaaa38f9">58.5. ATgfe - new feature</a></li>
</ul>
</li>
<li><a href="#org68787d8">59. support libraries</a></li>
<li><a href="#orgb3b84a0">60. Microsoft nni AutoML framework (stupid shut)</a></li>
<li><a href="#org2b753f6">61. help</a>
<ul>
<li><a href="#org5ec0923">61.1. build-in help</a></li>
</ul>
</li>
<li><a href="#org45e013b">62. IDE</a>
<ul>
<li><a href="#org9079cfb">62.1. EPL</a></li>
<li><a href="#org585fcfe">62.2. PyDev is a Python IDE for Eclipse</a>
<ul>
<li><a href="#orgb4a5c04">62.2.1. features</a></li>
</ul>
</li>
<li><a href="#org6d67735">62.3. Emacs</a>
<ul>
<li><a href="#org1d04a80">62.3.1. python in org mode</a></li>
<li><a href="#org58b80aa">62.3.2. Emacs</a></li>
</ul>
</li>
<li><a href="#org2893e3a">62.4. PyCharm</a>
<ul>
<li><a href="#org0fc7371">62.4.1. installation:</a></li>
<li><a href="#org1d439c5">62.4.2. keys</a></li>
<li><a href="#orgf12b3bd">62.4.3. mirrored environment in remote Docker</a></li>
</ul>
</li>
<li><a href="#orge1e6f91">62.5. ipython</a></li>
<li><a href="#org3b6a0b9">62.6. geany</a></li>
<li><a href="#orgbeb4947">62.7. BlueFish</a></li>
<li><a href="#orgb9471fe">62.8. Eric</a></li>
<li><a href="#org98e7f8e">62.9. Google Colab</a>
<ul>
<li><a href="#orgc085f71">62.9.1. <span class="todo TODO">TODO</span> todo</a></li>
<li><a href="#org480bac8">62.9.2. initial config</a></li>
<li><a href="#org24fcbd1">62.9.3. keys (checked):</a></li>
<li><a href="#org303a988">62.9.4. keys in Internet (emacs IPython console)</a></li>
<li><a href="#org40afdc7">62.9.5. Google Colab Magics</a></li>
<li><a href="#orgfcccd3e">62.9.6. install libraries and system commands</a></li>
<li><a href="#org4c53afb">62.9.7. execute code from google drive</a></li>
<li><a href="#orgb41596d">62.9.8. shell</a></li>
<li><a href="#orgc365f05">62.9.9. gcloud</a></li>
<li><a href="#org6ad4390">62.9.10. gcloud ssh (require billing)</a></li>
<li><a href="#orgda52f29">62.9.11. api</a></li>
<li><a href="#org5fa66e7">62.9.12. upload and download files</a></li>
<li><a href="#org0263dc5">62.9.13. connect ssh (restricted)</a></li>
<li><a href="#orga09014e">62.9.14. connect ssh (unrestricted)</a></li>
<li><a href="#orgcff84d9">62.9.15. Restrictions</a></li>
<li><a href="#orgb2cdd6d">62.9.16. cons</a></li>
</ul>
</li>
<li><a href="#org259c6d3">62.10. Eclipse Theia (IDE)</a></li>
<li><a href="#orgfb34258">62.11. Atom</a></li>
</ul>
</li>
<li><a href="#orge61535e">63. Jupyter Notebook</a>
<ul>
<li><a href="#org9ef089b">63.1. jupyter [ˈʤuːpɪtə] - акцентом на интерактивности производимых вычислений</a></li>
<li><a href="#org8d471ba">63.2. install</a></li>
<li><a href="#org94ba71f">63.3. convert <b>to htmp</b></a></li>
<li><a href="#orgc9780a4">63.4. Widgets</a>
<ul>
<li><a href="#orgd6fcee0">63.4.1. install</a></li>
<li><a href="#orgb1410d9">63.4.2. usage</a></li>
<li><a href="#org046239d">63.4.3. widget abbreviation</a></li>
<li><a href="#org997da3b">63.4.4. widget return type</a></li>
<li><a href="#org789870c">63.4.5. Styling</a></li>
</ul>
</li>
<li><a href="#orge7ca9e4">63.5. Hotkeys:</a></li>
<li><a href="#org4750dc6">63.6. emacs (sucks)</a></li>
<li><a href="#org55c9dec">63.7. in Docker</a></li>
<li><a href="#orgc986c35">63.8. other</a></li>
<li><a href="#org953b6eb">63.9. lab</a>
<ul>
<li><a href="#orgaa00a77">63.9.1. in venv</a></li>
<li><a href="#orgb703e14">63.9.2. Will not respect mounted venv:</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org22acfb9">64. USΕ CASES</a>
<ul>
<li><a href="#org0620053">64.1. NET</a>
<ul>
<li><a href="#org4c9e3f1">64.1.1. REST request</a></li>
<li><a href="#orgdda96c9">64.1.2. email IMAP</a></li>
<li><a href="#orgdaf47d9">64.1.3. email DKIM</a></li>
<li><a href="#orge818d85">64.1.4. urllib SOCKS</a></li>
</ul>
</li>
<li><a href="#org9c858f5">64.2. LISTS</a>
<ul>
<li><a href="#org0f78cb8">64.2.1. all has one value</a></li>
<li><a href="#orgcad41cf">64.2.2. 2D list to 1D dict or list</a></li>
<li><a href="#org27f1cd1">64.2.3. list to string</a></li>
<li><a href="#orgdd85838">64.2.4. replace one with two</a></li>
<li><a href="#org841e18b">64.2.5. remove elements</a></li>
<li><a href="#org459f49b">64.2.6. average</a></li>
<li><a href="#org7f5d12d">64.2.7. [1, -2, 3, -4, 5]</a></li>
<li><a href="#org759eefb">64.2.8. ZIP массивов с разной длинной</a></li>
<li><a href="#orgcd6ed12">64.2.9. Shuffle two lists</a></li>
<li><a href="#org1819354">64.2.10. list of dictionaries</a></li>
<li><a href="#orgb48cfd4">64.2.11. closest in list</a></li>
<li><a href="#org09ad8a8">64.2.12. TIMΕ SEQUENCE</a></li>
<li><a href="#orgbf8774f">64.2.13. split list in chunks</a></li>
</ul>
</li>
<li><a href="#orgc1005f8">64.3. FILES</a>
<ul>
<li><a href="#orgd0a65e0">64.3.1. locking</a></li>
<li><a href="#orgf0dc247">64.3.2. Read JSON</a></li>
<li><a href="#orgc2d0c68">64.3.3. CSV</a></li>
<li><a href="#org23ab52e">64.3.4. read file</a></li>
<li><a href="#orgab1ba23">64.3.5. Export to Excell</a></li>
<li><a href="#org3576827">64.3.6. NameError: name 'A' is not defined</a></li>
<li><a href="#orgcc5ca8e">64.3.7. rename files (list directory)</a></li>
<li><a href="#org43d39c9">64.3.8. current directory</a></li>
</ul>
</li>
<li><a href="#org1fbca1e">64.4. STRINGS</a>
<ul>
<li><a href="#orgdcbf22e">64.4.1. String comparision</a></li>
<li><a href="#orgb89f85e">64.4.2. Remove whitespaces</a></li>
<li><a href="#orga15921d">64.4.3. Unicode</a></li>
<li><a href="#org7e7e1dd">64.4.4. To find all the repeating substring in a given string</a></li>
<li><a href="#org3533739">64.4.5. first substring</a></li>
</ul>
</li>
<li><a href="#orgb1d246d">64.5. DICT</a>
<ul>
<li><a href="#org6aa04c5">64.5.1. del</a></li>
</ul>
</li>
<li><a href="#org78b756e">64.6. argparse: command line arguments</a>
<ul>
<li><a href="#org8ea47ca">64.6.1. terms</a></li>
<li><a href="#org209bade">64.6.2. usage</a></li>
<li><a href="#org6d5357f">64.6.3. optional positional argument</a></li>
</ul>
</li>
<li><a href="#org332642c">64.7. way to terminate</a></li>
<li><a href="#org76abe0f">64.8. JSON</a></li>
<li><a href="#org4d6665c">64.9. NN EQUAL QUANTITY FROM SAMPLES</a></li>
<li><a href="#orgd0b8511">64.10. most common ellement</a></li>
<li><a href="#org1b7fa83">64.11. print numpers</a></li>
<li><a href="#orge1b3667">64.12. SCALE</a></li>
<li><a href="#orge7d97d7">64.13. smoth</a></li>
<li><a href="#orga7d970c">64.14. one-hot encoding</a>
<ul>
<li><a href="#orge035298">64.14.1. we have [1,3] [1,2,3,4], [3,4] -&gt; numbers</a></li>
<li><a href="#org4eac5cf">64.14.2. column of strings</a></li>
</ul>
</li>
<li><a href="#org7b1a1c9">64.15. binary encoding</a></li>
<li><a href="#org546e879">64.16. map encoding</a></li>
<li><a href="#orgf24ad2a">64.17. Accuracy</a></li>
<li><a href="#orgb546fdc">64.18. garbage collect</a></li>
<li><a href="#org74c9dac">64.19. Class <b>loop for member varibles</b></a></li>
<li><a href="#org5a3c82e">64.20. filter special characters</a></li>
<li><a href="#org52b9cd1">64.21. measure time</a></li>
<li><a href="#orgd0ab434">64.22. primes in interval</a></li>
<li><a href="#org3843fea">64.23. unicode characters in interval</a></li>
</ul>
</li>
<li><a href="#org0a5d6ee">65. Flask</a>
<ul>
<li><a href="#orgee7bae4">65.1. terms</a></li>
<li><a href="#orge643b6e">65.2. components</a></li>
<li><a href="#org603a023">65.3. static files and debugging console</a>
<ul>
<li><a href="#org12e8124">65.3.1. get URL</a></li>
<li><a href="#org4e2609d">65.3.2. path and console </a></li>
</ul>
</li>
<li><a href="#orgedf3017">65.4. start, run</a>
<ul>
<li><a href="#org498e266">65.4.1. start $flask run (recommended)</a></li>
<li><a href="#org8ece307">65.4.2. start app.run()</a></li>
<li><a href="#org096c14b">65.4.3. links</a></li>
</ul>
</li>
<li><a href="#orgc76376b">65.5. Quart</a></li>
<li><a href="#org3189492">65.6. GET</a>
<ul>
<li><a href="#org682d430">65.6.1. variables</a></li>
<li><a href="#org6fdc479">65.6.2. parameters ?key=value</a></li>
</ul>
</li>
<li><a href="#org7c14939">65.7. app.route</a></li>
<li><a href="#org6386e0f">65.8. gentoo dependencies</a></li>
<li><a href="#orgf867005">65.9. blueprints</a></li>
<li><a href="#orgb3993f3">65.10. Hello world</a></li>
<li><a href="#org67a079b">65.11. curl</a></li>
<li><a href="#org02b0c8c">65.12. response object</a></li>
<li><a href="#orgc40cc4e">65.13. request object</a>
<ul>
<li><a href="#org93b8c27">65.13.1. get all values</a></li>
</ul>
</li>
<li><a href="#orgdf4c6bb">65.14. Jinja templates</a>
<ul>
<li><a href="#orgb1adbbd">65.14.1. own filters:</a></li>
<li><a href="#orgc2c0be9">65.14.2. links</a></li>
</ul>
</li>
<li><a href="#org3bbca1a">65.15. security</a></li>
<li><a href="#orga58f917">65.16. my projects</a>
<ul>
<li><a href="#org8d0c4ca">65.16.1. testing1</a></li>
<li><a href="#org8401524">65.16.2. testing2</a></li>
<li><a href="#orgc6fab20">65.16.3. file storage</a></li>
</ul>
</li>
<li><a href="#orga0a3cb7">65.17. Flask-2.2.2 hashes </a></li>
<li><a href="#org754033a">65.18. flask-api (bad working)</a></li>
<li><a href="#org39879ee">65.19. flask-restful (old)</a></li>
<li><a href="#org16fa43e">65.20. example</a>
<ul>
<li><a href="#orgc3534cd">65.20.1. image</a></li>
</ul>
</li>
<li><a href="#org261cde1">65.21. swagger</a></li>
<li><a href="#org274e31e">65.22. werkzeug</a></li>
<li><a href="#orga166c0e">65.23. debug</a></li>
<li><a href="#orgd562670">65.24. test</a></li>
<li><a href="#org9776831">65.25. production</a></li>
<li><a href="#orgc78d557">65.26. vulnerabilities</a></li>
<li><a href="#org57f940d">65.27. USECASES</a>
<ul>
<li><a href="#orgd958ca0">65.27.1. check file exist</a></li>
<li><a href="#orgb1a3b6c">65.27.2. call POST method</a></li>
<li><a href="#org4afda2c">65.27.3. call GET method with arguments</a></li>
<li><a href="#orge0785af">65.27.4. print headers</a></li>
<li><a href="#org830b31c">65.27.5. TLS server</a></li>
</ul>
</li>
<li><a href="#orga60b5f3">65.28. async/await and ASGI</a></li>
<li><a href="#orgbf747e6">65.29. use HTTPS</a></li>
<li><a href="#orgdd1cd90">65.30. links</a></li>
</ul>
</li>
<li><a href="#org3361501">66. FastAPI</a>
<ul>
<li><a href="#org18aa4c9">66.1. Interactive API Documentation</a></li>
<li><a href="#orgb705418">66.2. running with uvicorn or gunicorn</a></li>
<li><a href="#orgfc3c90e">66.3. dependencies</a></li>
<li><a href="#orgc7fb830">66.4. swagger</a></li>
<li><a href="#org6a1ebbb">66.5. links</a></li>
</ul>
</li>
<li><a href="#org165101c">67. Databases</a>
<ul>
<li><a href="#org5e29e86">67.1. Database API Specification v2.0 (PEP 249). http://www.python.org/dev/peps/pep-0249/</a></li>
<li><a href="#orgd152afe">67.2. Groonga</a>
<ul>
<li><a href="#org5efabc8">67.2.1. Basic commands:</a></li>
<li><a href="#orgb6fbb34">67.2.2. python</a></li>
</ul>
</li>
<li><a href="#orgf54a1e6">67.3. Oracle</a>
<ul>
<li><a href="#org47fb2a5">67.3.1. sql</a></li>
</ul>
</li>
<li><a href="#org595a2ec">67.4. MySQL</a></li>
<li><a href="#orga90a3be">67.5. Redis</a>
<ul>
<li><a href="#orgb42d0cc">67.5.1. timeout - connection for client to master</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org6b0f574">68. SQLAlchemy - ORM</a></li>
<li><a href="#orgc578998">69. Virtualenv</a>
<ul>
<li><a href="#orgf7ad408">69.1. venv - default module</a></li>
<li><a href="#orgeb11a27">69.2. virtualenv</a></li>
<li><a href="#orga4b940e">69.3. two virtaul environments</a></li>
</ul>
</li>
<li><a href="#org4a311e6">70. ldap</a></li>
<li><a href="#orgcec9e59">71. Containerized development</a></li>
<li><a href="#org0d7c240">72. security</a></li>
<li><a href="#orgbec856c">73. serialization</a>
<ul>
<li><a href="#org96b3d49">73.1. pickle</a></li>
</ul>
</li>
<li><a href="#org84912b0">74. cython</a></li>
<li><a href="#orgb1f4457">75. headles browsers</a></li>
<li><a href="#orgd50c30f">76. selenium</a>
<ul>
<li><a href="#org07b608a">76.1. drivers</a></li>
<li><a href="#org8c97599">76.2. install</a></li>
<li><a href="#orgf4255a0">76.3. python installantion</a></li>
<li><a href="#org9fd800c">76.4. python usage</a></li>
<li><a href="#orgf925771">76.5. links</a></li>
</ul>
</li>
<li><a href="#org496e5c6">77. plot in terminal</a>
<ul>
<li><a href="#org938c226">77.1. plotext</a></li>
</ul>
</li>
<li><a href="#org24ec9cb">78. xml parsing</a></li>
<li><a href="#orgbde9cbc">79. pytest</a>
<ul>
<li><a href="#org3953fc4">79.1. features</a></li>
<li><a href="#orgdf97658">79.2. layout</a></li>
<li><a href="#orgc1168cb">79.3. usage</a></li>
<li><a href="#orgda845cc">79.4. dependencies</a></li>
<li><a href="#org4fa5a54">79.5. fixtures - context for the test</a></li>
<li><a href="#org2b0cbd6">79.6. mock - monkeypatch fixture</a></li>
<li><a href="#orgf063f90">79.7. print</a></li>
<li><a href="#org5433a92">79.8. troubleshooting</a></li>
<li><a href="#org46ae14a">79.9. links</a></li>
</ul>
</li>
<li><a href="#org9166cca">80. <span class="todo TODO">TODO</span> collection of helpers and mock objects https://github.com/simplistix/testfixtures</a></li>
<li><a href="#org77b685d">81. static analysis tools:</a>
<ul>
<li><a href="#org340489b">81.1. security</a></li>
<li><a href="#orgd078f89">81.2. mypy</a>
<ul>
<li><a href="#orgb0b21d1">81.2.1. emacs fix</a></li>
<li><a href="#orgf1e5148">81.2.2. ex</a></li>
<li><a href="#org6abd306">81.2.3. troubleshooting</a></li>
<li><a href="#org8f88d89">81.2.4. links</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org8a404fe">82. release as execuable  - Pyinstaller</a></li>
<li><a href="#org1a0cf27">83. Documentation building with Sphinx</a></li>
<li><a href="#org1323d83">84. troubleshooting</a></li>
</ul>
</div>
</div>
<p>
-<b>- mode: Org; fill-column: 110; coding: utf-8; -</b>-
#+TITLE Python my notes
</p>
<ul class="org-ul">
<li>build in functions <a href="https://docs.python.org/3/library/functions.html">https://docs.python.org/3/library/functions.html</a></li>
<li>pypi <a href="https://pypi.org/">https://pypi.org/</a></li>
<li><a href="https://www.tutorialspoint.com/python3/python_modules.htm">https://www.tutorialspoint.com/python3/python_modules.htm</a></li>
<li>doc <a href="https://docs.python.org/3/contents.html">https://docs.python.org/3/contents.html</a></li>
<li><a href="https://docs.python.org/3/index.html">https://docs.python.org/3/index.html</a></li>
<li>software <a href="https://github.com/vinta/awesome-python">https://github.com/vinta/awesome-python</a></li>
</ul>

<p>
TODO
from os import environ as env
env.get('MYSQL<sub>PASSWORD</sub>')
</p>
<div id="outline-container-org8e0250c" class="outline-2">
<h2 id="org8e0250c"><span class="section-number-2">1.</span> Key questions:</h2>
<div class="outline-text-2" id="text-1">
<ul class="org-ul">
<li>Compilation vs. Interpretation
<ul class="org-ul">
<li>Interpreted Languages</li>
</ul></li>
<li>Dynamic Typing vs. Static Typing
<ul class="org-ul">
<li>Dynamic Typing</li>
</ul></li>
<li>Passing Parameters by Value vs. By Reference
<ul class="org-ul">
<li>Primitive Types: Passed by value, Reference Types: Passed by reference</li>
</ul></li>
<li>Object-Oriented vs. Functional Programming vs procedural
<ul class="org-ul">
<li>Functional: 3, OOP: 5, procedural 4</li>
</ul></li>
<li>function overloading exist or not?
<ul class="org-ul">
<li>does not support function overloading in the traditional sense</li>
</ul></li>
<li>How do closures work?
<ul class="org-ul">
<li>nested functions</li>
</ul></li>
<li>What is the Scope of Variables?
<ul class="org-ul">
<li>Python separate mark for (global and nonlocal)</li>
</ul></li>
<li>Supports multiple inheritance.
<ul class="org-ul">
<li>Support.</li>
</ul></li>
<li>Memory Management: Manual vs. Automatic Garbage Collection
<ul class="org-ul">
<li>gc</li>
</ul></li>
<li>one way to solve problem or many ways to solve?
<ul class="org-ul">
<li>one way</li>
</ul></li>
<li>How Syntax structured with indentation or some characters?
<ul class="org-ul">
<li>indentation</li>
</ul></li>
<li>What paradigms supported? (e.g., imperative, declarative, procedural, functional).</li>
<li>Event-Driven Concurrency (simple) vs Thread-Based Concurrency (compex)
<ul class="org-ul">
<li>Event-driven</li>
</ul></li>
<li>Error Handling: return codes vs handling exception objects
<ul class="org-ul">
<li>exception objects</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org5a42f0f" class="outline-2">
<h2 id="org5a42f0f"><span class="section-number-2">2.</span> most common structures</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org827e06f" class="outline-3">
<h3 id="org827e06f"><span class="section-number-3">2.1.</span> json</h3>
<div class="outline-text-3" id="text-2-1">
<pre class="example">
echo '{some json}' | tr -d '\n\t' | tr -s ' '
</pre>
</div>
</div>
<div id="outline-container-org53e5bc5" class="outline-3">
<h3 id="org53e5bc5"><span class="section-number-3">2.2.</span> remove old <span class="underline"><span class="underline">pycache</span></span></h3>
<div class="outline-text-3" id="text-2-2">
<pre class="example">
find . | grep -E "(/__pycache__$|\.pyc$|\.pyo$)" | tee &gt;(xargs rm -rf)
</pre>
</div>
</div>
<div id="outline-container-orgdec08fd" class="outline-3">
<h3 id="orgdec08fd"><span class="section-number-3">2.3.</span> sliced windows</h3>
<div class="outline-text-3" id="text-2-3">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">from</span> itertools <span style="color: #8ac6f2; font-weight: bold;">import</span> islice

<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">window</span>(seq, n=2):
    <span style="color: #f08080; font-style: italic;">"Returns a sliding window (of width n) over data from the iterable"</span>
    <span style="color: #f08080; font-style: italic;">"   s -&gt; (s0,s1,...s[n-1]), (s1,s2,...,sn), ...                   "</span>
    <span style="color: #cae682;">it</span> = <span style="color: #e5786d;">iter</span>(seq)
    <span style="color: #cae682;">result</span> = <span style="color: #e5786d;">tuple</span>(islice(it, n))
    <span style="color: #8ac6f2; font-weight: bold;">if</span> <span style="color: #e5786d;">len</span>(result) == n:
        <span style="color: #8ac6f2; font-weight: bold;">yield</span> result
    <span style="color: #8ac6f2; font-weight: bold;">for</span> elem <span style="color: #8ac6f2; font-weight: bold;">in</span> it:
        <span style="color: #cae682;">result</span> = result[1:] + (elem,)
        <span style="color: #8ac6f2; font-weight: bold;">yield</span> result

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">or</span>
<span style="color: #cae682;">seq</span> = [0, 1, 2, 3, 4, 5]
<span style="color: #cae682;">window_size</span> = 3

<span style="color: #8ac6f2; font-weight: bold;">for</span> i <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">range</span>(<span style="color: #e5786d;">len</span>(seq) - window_size + 1):
    <span style="color: #e5786d;">print</span>(seq[i: i + window_size])

</pre>
</div>
</div>
</div>
<div id="outline-container-org63b653f" class="outline-3">
<h3 id="org63b653f"><span class="section-number-3">2.4.</span> compare row to itself</h3>
<div class="outline-text-3" id="text-2-4">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> numpy <span style="color: #8ac6f2; font-weight: bold;">as</span> np
<span style="color: #cae682;">a</span> = [0,1,2,3,4,5,6,7,8,9]

<span style="color: #cae682;">r</span> = np.zeros((<span style="color: #e5786d;">len</span>(a),<span style="color: #e5786d;">len</span>(a)))
<span style="color: #8ac6f2; font-weight: bold;">for</span> x <span style="color: #8ac6f2; font-weight: bold;">in</span> a:
    <span style="color: #8ac6f2; font-weight: bold;">for</span> y <span style="color: #8ac6f2; font-weight: bold;">in</span> a:
        <span style="color: #8ac6f2; font-weight: bold;">if</span> y&lt;x:
            <span style="color: #8ac6f2; font-weight: bold;">continue</span> <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">we skip y!</span>
        <span style="color: #cae682;">r</span>[<span style="color: #cae682;">x</span>,<span style="color: #cae682;">y</span>] = x+y

<span style="color: #e5786d;">print</span>(r)
</pre>
</div>

<pre class="example" id="org77ff485">
[[ 0.  1.  2.  3.  4.  5.  6.  7.  8.  9.]
 [ 0.  2.  3.  4.  5.  6.  7.  8.  9. 10.]
 [ 0.  0.  4.  5.  6.  7.  8.  9. 10. 11.]
 [ 0.  0.  0.  6.  7.  8.  9. 10. 11. 12.]
 [ 0.  0.  0.  0.  8.  9. 10. 11. 12. 13.]
 [ 0.  0.  0.  0.  0. 10. 11. 12. 13. 14.]
 [ 0.  0.  0.  0.  0.  0. 12. 13. 14. 15.]
 [ 0.  0.  0.  0.  0.  0.  0. 14. 15. 16.]
 [ 0.  0.  0.  0.  0.  0.  0.  0. 16. 17.]
 [ 0.  0.  0.  0.  0.  0.  0.  0.  0. 18.]]
</pre>
</div>
</div>

<div id="outline-container-org07628a4" class="outline-3">
<h3 id="org07628a4"><span class="section-number-3">2.5.</span> group elements in chunks from list</h3>
<div class="outline-text-3" id="text-2-5">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">chunks</span>(lst, n):
    <span style="color: #f08080; font-style: italic;">"""Yield successive n-sized chunks from lst.</span>
<span style="color: #f08080; font-style: italic;">    The last chunk may be smaller."""</span>
    <span style="color: #8ac6f2; font-weight: bold;">for</span> i <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">range</span>(0, <span style="color: #e5786d;">len</span>(lst), n):
        <span style="color: #8ac6f2; font-weight: bold;">yield</span> lst[i:i + n]

<span style="color: #e5786d;">print</span>(<span style="color: #e5786d;">list</span>(chunks(<span style="color: #e5786d;">range</span>(1, 9), 3)))
</pre>
</div>

<pre class="example">
[range(1, 4), range(4, 7), range(7, 9)]
</pre>
</div>
</div>

<div id="outline-container-org569dcd6" class="outline-3">
<h3 id="org569dcd6"><span class="section-number-3">2.6.</span> flatten list</h3>
<div class="outline-text-3" id="text-2-6">
<pre class="example">
s = [x for xs in s for x in xs]
</pre>
</div>
</div>
<div id="outline-container-orgfefc9b0" class="outline-3">
<h3 id="orgfefc9b0"><span class="section-number-3">2.7.</span> count occurances of intems in a list</h3>
<div class="outline-text-3" id="text-2-7">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">from</span> collections <span style="color: #8ac6f2; font-weight: bold;">import</span> Counter
<span style="color: #cae682;">products</span> = [<span style="color: #95e454;">"Apple"</span>, <span style="color: #95e454;">"Orange"</span>, <span style="color: #95e454;">"Banana"</span>, <span style="color: #95e454;">"Pear"</span>, <span style="color: #95e454;">"Apple"</span>, <span style="color: #95e454;">"Banana"</span>]
<span style="color: #cae682;">element_counts</span> = Counter(products)
<span style="color: #e5786d;">print</span>(element_counts)
</pre>
</div>

<pre class="example">
Counter({'Apple': 2, 'Banana': 2, 'Orange': 1, 'Pear': 1})
</pre>
</div>
</div>

<div id="outline-container-org198c38f" class="outline-3">
<h3 id="org198c38f"><span class="section-number-3">2.8.</span> dot notation access</h3>
<div class="outline-text-3" id="text-2-8">
</div>
<div id="outline-container-orgedde090" class="outline-4">
<h4 id="orgedde090"><span class="section-number-4">2.8.1.</span> SimpleNamespace</h4>
<div class="outline-text-4" id="text-2-8-1">
<pre class="example">
from types import SimpleNamespace
args = SimpleNamespace(**{"vocab_file": "/var/tmp/u/uncased_L-12_H-768_A/vocab.txt"})
print(args.vocab_file)
</pre>
</div>
</div>
<div id="outline-container-org9f3a8a4" class="outline-4">
<h4 id="org9f3a8a4"><span class="section-number-4">2.8.2.</span> dataclass</h4>
<div class="outline-text-4" id="text-2-8-2">
<p>
add
</p>
<ul class="org-ul">
<li>def _<sub>init</sub>_<sub>(self &#x2026;)</sub></li>
<li>def _<sub>repr</sub>_<sub>(self)</sub>:</li>
<li>def _<sub>eq</sub>_<sub>(self, other)</sub>:</li>
<li>def _<sub>ne</sub>/lt/gt&#x2026;_<sub>(self, other)</sub>:</li>
</ul>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">from</span> dataclasses <span style="color: #8ac6f2; font-weight: bold;">import</span> dataclass

<span style="color: #92a65e; font-weight: bold;">@dataclass</span>
<span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">DataClassCard</span>:
    rank: <span style="color: #e5786d;">str</span>
    suit: <span style="color: #e5786d;">str</span>

<span style="color: #cae682;">queen_of_hearts</span> = DataClassCard(<span style="color: #95e454;">'Q'</span>, <span style="color: #95e454;">'Hearts'</span>)
<span style="color: #e5786d;">print</span>(queen_of_hearts.rank)
</pre>
</div>

<pre class="example">
Q
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd58b3b3" class="outline-3">
<h3 id="orgd58b3b3"><span class="section-number-3">2.9.</span> fast lookup in ranges</h3>
<div class="outline-text-3" id="text-2-9">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">find_shard_id</span>(SHARDS, value):
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Flatten the ranges into a list of tuples (start, end, shard_id)</span>
    <span style="color: #cae682;">ranges</span> = [(start, end, shard_id) <span style="color: #8ac6f2; font-weight: bold;">for</span> shard_id, ranges_list <span style="color: #8ac6f2; font-weight: bold;">in</span> SHARDS.items() <span style="color: #8ac6f2; font-weight: bold;">for</span> start, end <span style="color: #8ac6f2; font-weight: bold;">in</span> ranges_list]

    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Sort the ranges by their start values</span>
    ranges.sort(key=<span style="color: #8ac6f2; font-weight: bold;">lambda</span> x: x[0])

    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Perform a binary search on the sorted list</span>
    <span style="color: #cae682;">left</span>, <span style="color: #cae682;">right</span> = 0, <span style="color: #e5786d;">len</span>(ranges) - 1
    <span style="color: #8ac6f2; font-weight: bold;">while</span> left &lt;= right:
        <span style="color: #cae682;">mid</span> = (left + right) // 2
        <span style="color: #8ac6f2; font-weight: bold;">if</span> ranges[mid][0] &lt;= value &lt;= ranges[mid][1]:
            <span style="color: #8ac6f2; font-weight: bold;">return</span> ranges[mid][2]
        <span style="color: #8ac6f2; font-weight: bold;">elif</span> value &lt; ranges[mid][0]:
            <span style="color: #cae682;">right</span> = mid - 1
        <span style="color: #8ac6f2; font-weight: bold;">else</span>:
            <span style="color: #cae682;">left</span> = mid + 1

    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">If no matching range is found, return None</span>
    <span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #e5786d; font-weight: bold;">None</span>

<span style="color: #cae682;">SHARDS</span> = {
    1: ((1, 10), (31, 40)),
    2: ((11, 20), (41, 50)),
    3: ((21, 30), (51, 60))
}

<span style="color: #e5786d;">print</span>(find_shard_id(SHARDS, 25))  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Output: 3</span>
<span style="color: #e5786d;">print</span>(find_shard_id(SHARDS, 7))  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Output: 1</span>
<span style="color: #e5786d;">print</span>(find_shard_id(SHARDS, 61))  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Output: None</span>
</pre>
</div>

<pre class="example">
3
1
None
</pre>
</div>
</div>

<div id="outline-container-org7ad0f15" class="outline-3">
<h3 id="org7ad0f15"><span class="section-number-3">2.10.</span> time of execution</h3>
<div class="outline-text-3" id="text-2-10">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> time

<span style="color: #cae682;">start_time</span> = time.time()
time.sleep(2)
<span style="color: #cae682;">end_time</span> = time.time()

<span style="color: #e5786d;">print</span>(f<span style="color: #95e454;">"Command executed in </span>{end_time - start_time:.2f}<span style="color: #95e454;"> seconds"</span>)

</pre>
</div>

<pre class="example">
Command executed in 2.00 seconds
</pre>
</div>
</div>

<div id="outline-container-org48f8a1e" class="outline-3">
<h3 id="org48f8a1e"><span class="section-number-3">2.11.</span> call one functions several times</h3>
<div class="outline-text-3" id="text-2-11">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">PortScannerPool</span>(<span style="color: #e5786d;">object</span>):
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">scan</span>(  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">NOQA: CFQ002</span>
            <span style="color: #8ac6f2; font-weight: bold;">self</span>, callback, host=<span style="color: #95e454;">"127.0.0.1"</span>, port=22, service=<span style="color: #e5786d; font-weight: bold;">None</span>,
            arguments=<span style="color: #95e454;">"-l root -p root"</span>, stop_at_found=<span style="color: #e5786d; font-weight: bold;">True</span>,
            ctimeout=0, wtimeout=<span style="color: #e5786d; font-weight: bold;">None</span>, threads=1, timeout=0, hang_timeout=40, args_list=<span style="color: #e5786d; font-weight: bold;">None</span>):
        <span style="color: #8ac6f2; font-weight: bold;">if</span> args_list <span style="color: #8ac6f2; font-weight: bold;">is</span> <span style="color: #8ac6f2; font-weight: bold;">not</span> <span style="color: #e5786d; font-weight: bold;">None</span>:
            <span style="color: #cae682;">arg_dict</span> = {<span style="color: #95e454;">'callback'</span>: callback, <span style="color: #95e454;">'host'</span>: host, <span style="color: #95e454;">'port'</span>: port,
                        <span style="color: #95e454;">'service'</span>: service, <span style="color: #95e454;">'arguments'</span>: arguments,
                        <span style="color: #95e454;">'stop_at_found'</span>: stop_at_found, <span style="color: #95e454;">'ctimeout'</span>: ctimeout,
                        <span style="color: #95e454;">'wtimeout'</span>: wtimeout, <span style="color: #95e454;">'threads'</span>: threads,
                        <span style="color: #95e454;">'timeout'</span>: timeout, <span style="color: #95e454;">'hang_timeout'</span>: hang_timeout}
            <span style="color: #8ac6f2; font-weight: bold;">for</span> args <span style="color: #8ac6f2; font-weight: bold;">in</span> args_list:
                arg_dict.update(args)
                <span style="color: #8ac6f2; font-weight: bold;">self</span>.scan(**arg_dict)
            <span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #8ac6f2; font-weight: bold;">self</span>._batch
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf2d72bd" class="outline-3">
<h3 id="orgf2d72bd"><span class="section-number-3">2.12.</span> prepare message for logging as like print</h3>
<div class="outline-text-3" id="text-2-12">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> logging
<span style="color: #8ac6f2; font-weight: bold;">import</span> sys

<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">lprint</span>(*args) -&gt; <span style="color: #e5786d;">str</span>:
    <span style="color: #cae682;">msg</span> = <span style="color: #95e454;">' '</span>.join(<span style="color: #e5786d;">map</span>(<span style="color: #e5786d;">str</span>, args))
    <span style="color: #8ac6f2; font-weight: bold;">return</span> msg.strip()

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">------ main -------</span>
<span style="color: #cae682;">logger</span> = logging.getLogger(<span style="color: #e5786d;">__name__</span>)
logger.setLevel(logging.DEBUG)
<span style="color: #cae682;">handler</span> = logging.StreamHandler(sys.stdout)
logger.addHandler(handler)

logger.debug(lprint([1,23], <span style="color: #95e454;">'sd'</span>))
logger.setLevel(logging.INFO)
logger.debug(lprint([1,23], <span style="color: #95e454;">'sd'</span>))
</pre>
</div>

<pre class="example">
[1, 23] sd
[1, 23] sd
[1, 23] sd
[1, 23] sd
[1, 23] sd
[1, 23] sd
</pre>
</div>
</div>

<div id="outline-container-orgaee2b47" class="outline-3">
<h3 id="orgaee2b47"><span class="section-number-3">2.13.</span> group dictionaries in list</h3>
<div class="outline-text-3" id="text-2-13">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">from</span> itertools <span style="color: #8ac6f2; font-weight: bold;">import</span> groupby

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Sample list of dictionaries</span>
<span style="color: #cae682;">list_of_dicts</span> = [
    {<span style="color: #95e454;">'host'</span>: <span style="color: #95e454;">'A'</span>, <span style="color: #95e454;">'other_key'</span>: <span style="color: #95e454;">'value1'</span>},
    {<span style="color: #95e454;">'host'</span>: <span style="color: #95e454;">'B'</span>, <span style="color: #95e454;">'other_key'</span>: <span style="color: #95e454;">'value2'</span>},
    {<span style="color: #95e454;">'host'</span>: <span style="color: #95e454;">'A'</span>, <span style="color: #95e454;">'other_key'</span>: <span style="color: #95e454;">'value3'</span>},
    {<span style="color: #95e454;">'host'</span>: <span style="color: #95e454;">'C'</span>, <span style="color: #95e454;">'other_key'</span>: <span style="color: #95e454;">'value4'</span>},
    {<span style="color: #95e454;">'host'</span>: <span style="color: #95e454;">'B'</span>, <span style="color: #95e454;">'other_key'</span>: <span style="color: #95e454;">'value5'</span>},
]
<span style="color: #cae682;">sorted_list</span> = <span style="color: #e5786d;">sorted</span>(list_of_dicts, key=<span style="color: #8ac6f2; font-weight: bold;">lambda</span> x: x[<span style="color: #95e454;">'host'</span>])

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Group the sorted list by the 'host' key</span>
<span style="color: #8ac6f2; font-weight: bold;">for</span> host, group <span style="color: #8ac6f2; font-weight: bold;">in</span> groupby(sorted_list, key=<span style="color: #8ac6f2; font-weight: bold;">lambda</span> x: x[<span style="color: #95e454;">'host'</span>]):
    <span style="color: #e5786d;">print</span>(f<span style="color: #95e454;">"Host: </span>{host}<span style="color: #95e454;"> </span>{<span style="color: #e5786d;">list</span>(group)}<span style="color: #95e454;">"</span>)

</pre>
</div>

<pre class="example">
Host: A [{'host': 'A', 'other_key': 'value1'}, {'host': 'A', 'other_key': 'value3'}]
Host: B [{'host': 'B', 'other_key': 'value2'}, {'host': 'B', 'other_key': 'value5'}]
Host: C [{'host': 'C', 'other_key': 'value4'}]
</pre>
</div>
</div>

<div id="outline-container-orgd5eafca" class="outline-3">
<h3 id="orgd5eafca"><span class="section-number-3">2.14.</span> ModuleNotFoundError: No module named</h3>
<div class="outline-text-3" id="text-2-14">
<pre class="example">
import sys
sys.path.insert(0, '../src/')
</pre>
</div>
</div>
</div>

<div id="outline-container-orgde37a92" class="outline-2">
<h2 id="orgde37a92"><span class="section-number-2">3.</span> tools 2022 pypi</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org74ddf00" class="outline-3">
<h3 id="org74ddf00"><span class="section-number-3">3.1.</span> web frameworks</h3>
<div class="outline-text-3" id="text-3-1">
<ul class="org-ul">
<li>Bottle</li>
<li>CherryPy</li>
<li>Django</li>
<li>Falcon</li>
<li>FastAPI</li>
<li>Flask</li>
<li>Hug</li>
<li>Pyramid</li>
<li>Tornado</li>
<li>web2py</li>
</ul>
</div>
</div>
<div id="outline-container-orgea235ef" class="outline-3">
<h3 id="orgea235ef"><span class="section-number-3">3.2.</span> additional libraries</h3>
<div class="outline-text-3" id="text-3-2">
<ul class="org-ul">
<li>aiohttp</li>
<li>Asyncio</li>
<li>httpx</li>
<li>Pillow</li>
<li>Pygame</li>
<li>PyGTK</li>
<li>PyQT</li>
<li>Requests</li>
<li>Six</li>
<li>Tkinter</li>
<li>Twisted</li>
<li>Kivy</li>
<li>wxPython</li>
<li>Scrapy</li>
</ul>
</div>
</div>
<div id="outline-container-org8a8c473" class="outline-3">
<h3 id="org8a8c473"><span class="section-number-3">3.3.</span> machine learning frameworks</h3>
<div class="outline-text-3" id="text-3-3">
<ul class="org-ul">
<li>Gensim</li>
<li>MXNet</li>
<li>NLTK</li>
<li>Theano</li>
</ul>
</div>
</div>
<div id="outline-container-org975a9db" class="outline-3">
<h3 id="org975a9db"><span class="section-number-3">3.4.</span> cloud platforms do you use? *This question is required.</h3>
<div class="outline-text-3" id="text-3-4">
<ul class="org-ul">
<li>AWS</li>
<li>Rackspace</li>
<li>Linode</li>
<li>OpenShift</li>
<li>PythonAnywhere</li>
<li>Heroku</li>
<li>Microsoft Azure</li>
<li>DigitalOcean</li>
<li>Google Cloud Platform</li>
<li>OpenStack</li>
</ul>
</div>
</div>
<div id="outline-container-orgb6f97c9" class="outline-3">
<h3 id="orgb6f97c9"><span class="section-number-3">3.5.</span> ORM(s) do you use together with Python, if any? *This question is required.</h3>
<div class="outline-text-3" id="text-3-5">
<ul class="org-ul">
<li>No database development</li>
<li>Tortoise ORM</li>
<li>Dejavu</li>
<li>Peewee</li>
<li>SQLAlchemy</li>
<li>Django ORM</li>
<li>PonyORM</li>
<li>Raw SQL</li>
<li>SQLObject</li>
</ul>
</div>
</div>
<div id="outline-container-org9480762" class="outline-3">
<h3 id="org9480762"><span class="section-number-3">3.6.</span> Big Data tool(s) do you use, if any?  *This question is required.</h3>
<div class="outline-text-3" id="text-3-6">
<ul class="org-ul">
<li>None</li>
<li>Apache Samza</li>
<li>Apache Kafka</li>
<li>Dask</li>
<li>Apache Beam</li>
<li>Apache Hive</li>
<li>Apache Hadoop/MapReduce</li>
<li>Apache Spark</li>
<li>Apache Tez</li>
<li>Apache Flink</li>
<li>ClickHouse</li>
</ul>
</div>
</div>
<div id="outline-container-org5cdadb4" class="outline-3">
<h3 id="org5cdadb4"><span class="section-number-3">3.7.</span> Continuous Integration (CI) system(s) do you regularly use? *This question is required.</h3>
<div class="outline-text-3" id="text-3-7">
<ul class="org-ul">
<li>CruiseControl</li>
<li>Gitlab CI</li>
<li>Travis CI</li>
<li>TeamCity</li>
<li>Bitbucket Pipelines</li>
<li>AppVeyor</li>
<li>GitHub Actions</li>
<li>Jenkins / Hudson</li>
<li>CircleCI</li>
<li>Bamboo</li>
</ul>
</div>
</div>
<div id="outline-container-org9a861f8" class="outline-3">
<h3 id="org9a861f8"><span class="section-number-3">3.8.</span> configuration management tools do you use, if any? *This question is required.</h3>
<div class="outline-text-3" id="text-3-8">
<ul class="org-ul">
<li>None</li>
<li>Chef</li>
<li>Puppet</li>
<li>Custom solution</li>
<li>Ansible</li>
<li>Salt</li>
</ul>
</div>
</div>
<div id="outline-container-org788eaed" class="outline-3">
<h3 id="org788eaed"><span class="section-number-3">3.9.</span> documentation tool do you use?  *This question is required.</h3>
<div class="outline-text-3" id="text-3-9">
<ul class="org-ul">
<li>I don’t use any documentation tools</li>
<li>Sphinx and furo - Sphinx theme (example <a href="https://github.com/simplistix/testfixtures">https://github.com/simplistix/testfixtures</a>)</li>
<li>MKDocs</li>
<li>Doxygen</li>
</ul>
</div>
</div>

<div id="outline-container-org13dedc0" class="outline-3">
<h3 id="org13dedc0"><span class="section-number-3">3.10.</span> IDE features</h3>
<div class="outline-text-3" id="text-3-10">
<ul class="org-ul">
<li>use Version Control Systems 	use Version Control Systems: Often 	use Version Control Systems: From timeto time 	use Version Control Systems: Never orAlmost never</li>
<li>use Issue Trackers 	use Issue Trackers: Often 	use Issue Trackers: From timeto time 	use Issue Trackers: Never orAlmost never</li>
<li>use code coverage 	use code coverage: Often 	use code coverage: From timeto time 	use code coverage: Never orAlmost never</li>
<li>use code linting (programs that analyze code for potential errors) 	use code linting (programs that analyze code for potential errors): Often 	use code linting (programs that analyze code for potential errors): From timeto time 	use code linting (programs that analyze code for potential errors): Never orAlmost never</li>
<li>use Continuous Integration tools 	use Continuous Integration tools: Often 	use Continuous Integration tools: From timeto time 	use Continuous Integration tools: Never orAlmost never</li>
<li>use optional type hinting 	use optional type hinting: Often 	use optional type hinting: From timeto time 	use optional type hinting: Never orAlmost never</li>
<li>use NoSQL databases 	use NoSQL databases: Often 	use NoSQL databases: From timeto time 	use NoSQL databases: Never orAlmost never</li>
<li>use autocompletion in your editor 	use autocompletion in your editor: Often 	use autocompletion in your editor: From timeto time 	use autocompletion in your editor: Never orAlmost never</li>
<li>run / debug or edit code on remote machines (remote hosts, VMs, etc.) 	run / debug or edit code on remote machines (remote hosts, VMs, etc.): Often 	run / debug or edit code on remote machines (remote hosts, VMs, etc.): From timeto time 	run / debug or edit code on remote machines (remote hosts, VMs, etc.): Never orAlmost never</li>
<li>use SQL databases 	use SQL databases : Often 	use SQL databases : From timeto time 	use SQL databases : Never orAlmost never</li>
<li>use a Python profiler 	use a Python profiler: Often 	use a Python profiler: From timeto time 	use a Python profiler: Never orAlmost never</li>
<li>use Python virtual environments for your projects 	use Python virtual environments for your projects: Often 	use Python virtual environments for your projects: From timeto time 	use Python virtual environments for your projects: Never orAlmost never</li>
<li>use a debugger 	use a debugger: Often 	use a debugger: From timeto time 	use a debugger: Never orAlmost never</li>
<li>write tests for your code 	write tests for your code: Often 	write tests for your code: From timeto time 	write tests for your code: Never orAlmost never</li>
<li>refactor your code 	refactor your code: Often 	refactor your code: From timeto time 	refactor your code: Never orAlmost never</li>
</ul>
</div>
</div>
<div id="outline-container-org83eae2a" class="outline-3">
<h3 id="org83eae2a"><span class="section-number-3">3.11.</span> isolate Python environments between projects? *This question is required.</h3>
<div class="outline-text-3" id="text-3-11">
<ul class="org-ul">
<li>virtualenv</li>
<li>venv</li>
<li>virtualenvwrapper</li>
<li>hatch</li>
<li>Poetry</li>
<li>pipenv</li>
<li>Conda</li>
</ul>
</div>
</div>
<div id="outline-container-org5134a5a" class="outline-3">
<h3 id="org5134a5a"><span class="section-number-3">3.12.</span> tools related to Python packaging do you use directly?  *This question is required.</h3>
<div class="outline-text-3" id="text-3-12">
<ul class="org-ul">
<li>pip</li>
<li>Conda</li>
<li>pipenv</li>
<li>Poetry</li>
<li>venv (standard library)</li>
<li>virtualenv</li>
<li>flit</li>
<li>tox</li>
<li>PDM</li>
<li>twine</li>
<li>Containers (eg: via Docker)</li>
<li>Virtual machines</li>
<li>Workplace specific proprietary solution</li>
</ul>
</div>
</div>
<div id="outline-container-org12e2421" class="outline-3">
<h3 id="org12e2421"><span class="section-number-3">3.13.</span> application dependency management? *This question is required.</h3>
<div class="outline-text-3" id="text-3-13">
<ul class="org-ul">
<li>None</li>
<li>pipenv</li>
<li>poetry</li>
<li>pip-tools</li>
</ul>
</div>
</div>
<div id="outline-container-org50bf8af" class="outline-3">
<h3 id="org50bf8af"><span class="section-number-3">3.14.</span> automated services to update the versions of application dependencies? *This question is required.</h3>
<div class="outline-text-3" id="text-3-14">
<ul class="org-ul">
<li>None</li>
<li>Dependabot</li>
<li>PyUp</li>
<li>Custom tools, e.g. a cron job or scheduled CI task</li>
<li>No, my application dependencies are updated manually</li>
</ul>
</div>
</div>
<div id="outline-container-orgd1cc296" class="outline-3">
<h3 id="orgd1cc296"><span class="section-number-3">3.15.</span> installing packages? *This question is required.</h3>
<div class="outline-text-3" id="text-3-15">
<ul class="org-ul">
<li>None</li>
<li>pip</li>
<li>easy<sub>install</sub></li>
<li>Conda</li>
<li>Poetry</li>
<li>pip-sync</li>
<li>pipx</li>
</ul>
</div>
</div>
<div id="outline-container-org60bef10" class="outline-3">
<h3 id="org60bef10"><span class="section-number-3">3.16.</span> tool(s) do you use to develop Python applications? *This question is required.</h3>
<div class="outline-text-3" id="text-3-16">
<ul class="org-ul">
<li>None / I'm not sure</li>
<li>Setuptools</li>
<li>build</li>
<li>Wheel</li>
<li>Enscons</li>
<li>pex</li>
<li>Flit</li>
<li>Poetry</li>
<li>conda-build</li>
<li>maturin</li>
<li>PDM-PEP517</li>
</ul>
</div>
</div>
<div id="outline-container-org966dd26" class="outline-3">
<h3 id="org966dd26"><span class="section-number-3">3.17.</span> job role(s)? *This question is required.</h3>
<div class="outline-text-3" id="text-3-17">
<ul class="org-ul">
<li>Architect</li>
<li>QA engineer</li>
<li>Business analyst</li>
<li>DBA</li>
<li>CIO / CEO / CTO</li>
<li>Technical support</li>
<li>Technical writer</li>
<li>Team lead</li>
<li>Systems analyst</li>
<li>Data analyst</li>
<li>Product manager</li>
<li>Developer / Programmer</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org5035e6c" class="outline-2">
<h2 id="org5035e6c"><span class="section-number-2">4.</span> tools 2024</h2>
<div class="outline-text-2" id="text-4">
<p>
Experience with at least one direction:
</p>
<ul class="org-ul">
<li>Data Governance,</li>
<li>MLOps,</li>
<li>Computer Vision,</li>
<li>NLP (Natural Language Processing),</li>
<li>LLM (Large Language Models)</li>
<li>Reinforcement Learning:</li>

<li>Computer Vision tools: EasyOCR, Tesseract, AWS Textract, Azure Computer Vision, Google OCR, PaddleOCR,
MMOCR, YOLO, etc.)</li>
<li>NLP: tokenization, named entity recognition, classification, sentiment analysis, word embeddings (NLTK,
spaCy, scikit-learn, transfomers, etc.)</li>
<li>Reinforcement learning tools: KerasRL, Pyqlearning, Tensorforce, RL<sub>Coach</sub>, TFAgents, Stable Baselines,
mushroomRL, RLlib, Dopamine, SpinningUp, garage, Acme, coax, SURREAL)</li>
<li>Relational (PostgreSQL, MySQL, ClickHouse, Snowflake, etc.) and Non-Relational databases (Hive, AWS Aurora, etc.)</li>
<li>Experience in one or more Cloud Technologies (AWS, GCP, Azure)</li>
<li>Experience with Message brokers (Kafka, RabbitMQ, AWS Kinesis, etc.)</li>
</ul>

<p>
Data validation tools: Pydantic
</p>

<p>
database ORM migration tools: alembic.sqlalchemy.org
</p>
</div>
</div>
<div id="outline-container-orgd6dcadc" class="outline-2">
<h2 id="orgd6dcadc"><span class="section-number-2">5.</span> install</h2>
<div class="outline-text-2" id="text-5">
<p>
pip3 install &#x2013;upgrade pip &#x2013;user
</p>
</div>
<div id="outline-container-orgf425610" class="outline-3">
<h3 id="orgf425610"><span class="section-number-3">5.1.</span> debian</h3>
<div class="outline-text-3" id="text-5-1">
<ol class="org-ol">
<li>visit <a href="https://www.python.org/downloads/">https://www.python.org/downloads/</a></li>
<li>apt install gpg</li>
<li>gpg &#x2013;recv-keys 64E628F8D684696D</li>
<li>cd <i>usr/local/src</i></li>
<li>wget <a href="https://www.python.org/ftp/python/3.11.9/Python-3.11.9.tar.xz">https://www.python.org/ftp/python/3.11.9/Python-3.11.9.tar.xz</a></li>
<li>wget <a href="https://www.python.org/ftp/python/3.11.9/Python-3.11.9.tar.xz.asc">https://www.python.org/ftp/python/3.11.9/Python-3.11.9.tar.xz.asc</a></li>
<li>gpg &#x2013;verify Python-3.11.9.tar.xz.asc</li>
<li>tar xpf Python-3.11.9.tar.xz</li>
<li>apt-get install apt install libbz2-dev libffi-dev libssl-dev zlib1g-dev?</li>
<li>cat README.rst
<ul class="org-ul">
<li>./configure &#x2013;with-zlib &#x2013;with-openssl</li>
<li>make &amp;&amp; make install</li>
</ul></li>

<li>useradd &#x2013;home=/home/hug &#x2013;create-home &#x2013;shell /bin/bash &#x2013;user-group hug</li>
<li>sudo -u hub bash</li>
<li>pip install &#x2026;</li>
</ol>
</div>
</div>

<div id="outline-container-org98c65bb" class="outline-3">
<h3 id="org98c65bb"><span class="section-number-3">5.2.</span> issues</h3>
<div class="outline-text-3" id="text-5-2">
<p>
no module named zlib
</p>
<pre class="example">
apt-get install zlib-dev
</pre>


<p>
pip is configured with locations that require TLS/SSL, however the ssl module in Python is not available
</p>
<pre class="example">
apt-get install apt install libbz2-dev libffi-dev libssl-dev
./configure &amp;&amp; make &amp;&amp; make install
</pre>
</div>
</div>

<div id="outline-container-orga6be407" class="outline-3">
<h3 id="orga6be407"><span class="section-number-3">5.3.</span> change Python version Ubuntu &amp; Debian</h3>
<div class="outline-text-3" id="text-5-3">
<p>
update-alternatives &#x2013;install /usr/bin/python python /usr/bin/python3.8 1
echo 1 | update-alternatives &#x2013;config python
</p>
</div>
</div>
</div>

<div id="outline-container-org09d59e4" class="outline-2">
<h2 id="org09d59e4"><span class="section-number-2">6.</span> Python theory</h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-orgfb89a16" class="outline-3">
<h3 id="orgfb89a16"><span class="section-number-3">6.1.</span> Python [ˈpʌɪθ(ə)n] паисэн</h3>
<div class="outline-text-3" id="text-6-1">
<ul class="org-ul">
<li>interpreted</li>
<li>code readability</li>
<li>indentation instead of curly braces</li>
<li>designed to be highly extensible</li>
<li>garbage collector</li>
<li>functions are first class citizens</li>
<li>multiple inheritance</li>
<li>all parameters (arguments) are passed by reference</li>
<li>nothing in Python makes it possible to enforce data hiding</li>
<li>all classes inherit from object</li>
</ul>

<p>
Multi-paradigm:
</p>
<ul class="org-ul">
<li>imperative</li>
<li>procedural</li>
<li>object-oriented</li>
<li>functional (in the Lisp tradition) - (itertools and functools) - borrowed from Haskell and Standard ML</li>
<li>reflective</li>
<li>aspect-oriented programming  by metaprogramming[42] and metaobjects (magic methods)</li>
<li>dynamic name resolution (late binding) ?????????</li>
</ul>

<p>
Typing discipline:
</p>
<ul class="org-ul">
<li>Duck</li>
<li>dynamic</li>
<li>gradual (since 3.5) - mey be defined with type(static) or not(dynamic).</li>
<li>strong</li>
</ul>

<p>
Python and <b>CPython</b> are managed by the <i>non-profit</i> <b>Python Software Foundation</b>.
</p>

<p>
<b>The Python Standard Library</b> 3.6
</p>
<ul class="org-ul">
<li>string processing (regular expressions, Unicode, calculating differences between files)</li>
<li>Internet protocols (HTTP, FTP, SMTP, XML-RPC, POP, IMAP, CGI programming)</li>
<li>software engineering (unit testing, logging, profiling, parsing Python code)</li>
<li>operating system interfaces (system calls, filesystems, TCP/IP sockets)</li>
</ul>
</div>
</div>
<div id="outline-container-orgc94559e" class="outline-3">
<h3 id="orgc94559e"><span class="section-number-3">6.2.</span> philosophy</h3>
<div class="outline-text-3" id="text-6-2">
<p>
document <b>Zen of Python (PEP 20)</b>
</p>
<ul class="org-ul">
<li>Beautiful is better than ugly</li>
<li>Explicit is better than implicit</li>
<li>Simple is better than complex</li>
<li>Complex is better than complicated</li>
<li>Readability counts</li>
<li>Errors should never pass silently. Unless explicitly silenced.</li>
<li>There should be one&#x2013; and preferably only one &#x2013;obvious way to do it.</li>
<li>If the implementation is hard to explain, it's a <b>bad idea</b>. If the implementation is easy to explain, it <b>may
be</b> a good idea.</li>
<li>Namespaces are one honking great idea &#x2013; let's do more of those!</li>
</ul>

<p>
Other
</p>
<ul class="org-ul">
<li>"there should be one—and preferably only one—obvious way to do it"</li>
<li>goal -  keeping it fun to use ( spam and eggs instead of the standard foo and bar)</li>
<li>pythonic - related to style (code is pythonic )</li>
<li>Pythonists, Pythonistas, and Pythoneers - питонутые</li>
</ul>

<p>
<a href="https://peps.python.org/pep-0020/#id3">https://peps.python.org/pep-0020/#id3</a>
</p>
</div>
</div>
<div id="outline-container-org17a4992" class="outline-3">
<h3 id="org17a4992"><span class="section-number-3">6.3.</span> History</h3>
<div class="outline-text-3" id="text-6-3">
<p>
Every revision of Python enjoys performance improvements over the previous version.
</p>

<ul class="org-ul">
<li>1989</li>
<li>2000 - <b>Python 2.0</b> - cycle-detecting garbage collector and support for Unicode</li>
<li>2008 - <b>Python 3.0</b> - not completely backward-compatible - include the 2to3 utility, which automates (at
least partially) the translation of Python 2 code to Python 3.</li>
<li>2009 Python 3.1 ordered dictionaries,</li>
<li>2015 Python 3.5 typed varibles</li>
<li>2016 Python 3.6 asyncio, Formatted string literals (f-strings), Syntax for variable annotations.
<ul class="org-ul">
<li>PEP523 API to make frame evaluation pluggable at the C level.</li>
</ul></li>
</ul>

<p>
3.7
</p>
<ul class="org-ul">
<li>built-in breakpoint() function that calls pdb. before was: import pdb; pdb.set<sub>trace</sub>()</li>
<li>@dataclass - class annotations shugar</li>
<li>contextvars module -  mechanism for managing Thread-local context variables, similar to thread-local storage (TLS), PEP 550</li>
<li>from dataclasses import dataclass @dataclass - comes with basic functionality already implemented:
instantiate, print, and compare data class instances</li>
</ul>

<p>
3.8
</p>
<ul class="org-ul">
<li>Positional-Only Parameter: pow(x, y, z=None, /)</li>
<li>Assignment Expressions: if (match := pattern.search(data)) is not None: - This feature allows developers to
assign values to variables within an expression.</li>
<li>f"{a=}", f"Square has area of {(area := length**2)} perimeter of {(perimeter := length*4)}"</li>
<li>new SyntaxWarnings: when to choose is over ==, miss a comma in a list</li>
</ul>

<p>
3.9
</p>
<ul class="org-ul">
<li>Merge (|) and update (|=) added to dict library to compliment dict.update() method and {**d1, **d2}.</li>
<li>Added str.removeprefix(prefix) and str.removesuffix(suffix) to easily remove unneeded sections of a string.</li>
<li>More Flexible Decorators: Traditionally, a decorator has had to be a named, callable object, usually a
function or a class. PEP 614 allows decorators to be any callable expression.
<ul class="org-ul">
<li>before: decorator: '@' dotted<sub>name</sub> [ '(' [arglist] ')' ] NEWLINE</li>
<li>after: decorator: '@' namedexpr<sub>test</sub> NEWLINE</li>
</ul></li>
<li>typehints: list[int] do not require import typing;</li>
<li>Annotated[int, ctype("char")] -  integer that should be considered as a char type in C.</li>
<li>Better time zones handling.</li>
<li>The new parser based on PEG was introduced, making it easier to add new syntax to the language.</li>
</ul>

<p>
3.10
</p>
<ul class="org-ul">
<li>Structural pattern matching (PEP 634) was added, providing a way to match against and destructure data structures.
<ul class="org-ul">
<li>match command.split():    case [action, obj]: # interpret action, obj</li>
</ul></li>
<li>The new Parenthesized context managers syntax (PEP 618) was introduced, making it easier to write context
managers using less boilerplate code.</li>
<li>Improved error messages and error recovery were added to the parser, making it easier to debug syntax errors.</li>
<li>Parenthesized Context Managers: This feature improves the readability of with statements by allowing
developers to use parentheses. with (open("test<sub>file1.txt</sub>", "w") as test,  open("test<sub>file2.txt</sub>", "w") as test2):</li>
</ul>

<p>
3.11
</p>
<ul class="org-ul">
<li>The built-in pip package installer was upgraded to version 21.0, providing new features and improvements to
package management.</li>
<li>Improved error messages and error handling were added to the interpreter, making it easier to understand and
recover from runtime errors.</li>
<li>Some of the built-in modules were updated and improved, including the asyncio and typing modules.</li>
<li>Better hash randomization: This improves the security of Python by making it more difficult for attackers to
exploit hash-based algorithms that are used for various operations such as dictionary lookups.</li>
<li>package has been deprecated</li>
</ul>

<p>
3.12
</p>
<ul class="org-ul">
<li><b>distutils</b> removed</li>
<li>allow perf - linux profiler, new API for profilers,  sys.monitoring</li>
<li>buffer protocol -  access to the raw region of memory</li>
<li>type-hits:
<ul class="org-ul">
<li>TypedDict - source of types.  for typing **kwargs</li>
<li>doesn't need to import TypeVar. func[T] syntax to indicate generic type references</li>
<li>@override decorator can be used to flag methods that override methods in a parent</li>
</ul></li>
<li><p>
concurrency preparing:
</p>
<ul class="org-ul">
<li>Immortal objects - to implement other optimizations (like avoiding copy-on-write)</li>
<li>subinterpreters - the ability to have multiple instances of an interpreter, each with its own GIL, no</li>
</ul>
<p>
end-user interface to subinterpreters.
</p>
<ul class="org-ul">
<li>asyncio is larger and faster</li>
</ul></li>
<li>sqlite3 module: command-line interface has been added to the</li>
<li>unittest: Add a &#x2013;durations command line option, showing the N slowest test cases</li>
</ul>

<p>
3.13
</p>
<ul class="org-ul">
<li>Just-In-Time (JIT) Compiler - translates specialized bytecode into machine code at runtime</li>
<li>Free-Threaded Mode - disables the Global Interpreter Lock (GIL)</li>
<li>random in CLI</li>
</ul>
</div>

<div id="outline-container-orgded49e4" class="outline-4">
<h4 id="orgded49e4"><span class="section-number-4">6.3.1.</span> 3.0</h4>
<div class="outline-text-4" id="text-6-3-1">
<ul class="org-ul">
<li>Old feature removal: old-style classes, string exceptions, and implicit relative imports are no longer supported.</li>
<li>exceptions now need the as keyword, exec as <b>var</b></li>
<li><b>with</b> is now built in and no longer needs to be imported from <span class="underline"><span class="underline">future</span></span>.</li>
<li>range: xrange() from Python 2 has been replaced by range(). The original range() behavior is no longer available.</li>
<li><b>print</b> changed</li>
<li><b>input</b></li>
<li>all text content such as strings are Unicode by default</li>
<li>/ -&gt; float, in 2.0 it was integer. // operator added.</li>
<li>Python 2.7 cannot be  translation  to Python 3.</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org364fd5f" class="outline-3">
<h3 id="org364fd5f"><span class="section-number-3">6.4.</span> Implementations</h3>
<div class="outline-text-3" id="text-6-4">
<p>
<b>CPython</b>, the reference implementation of Python
</p>
<ul class="org-ul">
<li>interpreter and a compiler as it compiles Python code into bytecode before interpreting it</li>
<li>(GIL) problem - only one thread may be processing Python bytecode at any one time
<ul class="org-ul">
<li>One thread may be waiting for a client to reply, and another may be waiting for a database query to execute,
while the third thread is actually processing Python code.</li>
<li>Concurrency can only be achieved with separate CPython interpreter processes managed by a multitasking
operating system</li>
</ul></li>
</ul>

<p>
implementations that are known to be compatible with a given version of the language are IronPython, Jython and PyPy.
</p>
<ul class="org-ul">
<li><b>IronPython</b> -C#- use JIT- targeting the .NET Framework and Mono. created here known not to work under CPython</li>
<li><b>PyPy</b> -  just-in-time compiler. written completely in Python.</li>
<li>Jython - Python in Java for the Java platform</li>
</ul>

<p>
CPython based:
</p>
<ul class="org-ul">
<li><b>Cython</b> - translates a Python script into C and makes direct C-level API calls into the Python interpreter</li>
</ul>

<p>
<b>Stackless Python</b> - a significant fork of CPython that implements microthreads; it does not use the C memory
stack, thus allowing massively concurrent programs.
</p>

<p>
<b>Numba</b> - NumPy-aware optimizing runtime compiler for Python
</p>

<p>
<b>MicroPython</b> - Python for microcontrollers (runs on the pyboard and the BBC Microbit)
</p>

<p>
Jython and IronPython - do not have a GIL and so multithreaded execution for a CPU-bound python application
 will work.  These platforms are always playing catch-up with new language features or library features, so
 unfortunately
</p>

<p>
<b>Pythran</b>, a static Python-to-C++ extension compiler for a subset of the language, mostly targeted at
 numerical computation. Pythran can be (and is probably best) used as an additional backend for NumPy code in
 Cython.
</p>


<p>
<b>mypyc</b>, a static Python-to-C extension compiler, based on the mypy static Python analyser. Like Cython's pure
 Python mode, mypyc can make use of PEP-484 type annotations to optimise code for static types. Cons: no
 support for low-level optimisations and typing, opinionated Python type interpretation, reduced Python
 compatibility and introspection after compilation
</p>

<p>
<b>Nuitka</b>, a static Python-to-C extension compiler.
</p>
<ul class="org-ul">
<li>Pros: highly language compliant, reasonable performance gains, support for static application linking
(similar to cython<sub>freeze</sub> but with the ability to bundle library dependencies into a self-contained
executable)</li>
<li>Cons: no support for low-level optimisations and typing</li>
</ul>

<p>
<b>Brython</b> is an implementation of Python 3 for client-side web programming (in JavaScript). It provides a
 subset of Python 3 standard library combined with access to DOM objects. It is packaged in Gentoo as
 dev-python/brython.
</p>
</div>
</div>




<div id="outline-container-orgbd5c9d2" class="outline-3">
<h3 id="orgbd5c9d2"><span class="section-number-3">6.5.</span> Bytecode:</h3>
<div class="outline-text-3" id="text-6-5">
<ul class="org-ul">
<li>Java is compiled into bytecode and then executed by the JVM.</li>
<li>C language is compiled into object code, and then becomes the executable file after the linker</li>
<li>Python is first converted to the bytecode and then executed via ceval.c. The interpreter directly
executes thetranslated instruction set.</li>
</ul>

<p>
Bytecide is a set of instructions for a virtual machine which is called the Python Virtual Machine
(PVM).
</p>

<p>
The PVM is an interpreter that runs the bytecode.
</p>

<p>
The bytecode is platform-independent, but PVM is specific to the target machine. <b>.pyc</b> file.
</p>

<p>
The bytecode files are stored in a folder named <span class="underline"><span class="underline">pycache</span></span>. This folder is automatically created
when you try to import another file that you created.
</p>

<p>
manually create it: manually create it: python -m compileall file<sub>1.py</sub> &#x2026; file<sub>n.py</sub>
</p>
</div>
</div>
<div id="outline-container-org83d6792" class="outline-3">
<h3 id="org83d6792"><span class="section-number-3">6.6.</span> terms</h3>
<div class="outline-text-3" id="text-6-6">
<p>
<b>binding</b> the name to the object - x = 2 - (generic) name x receives a reference to a separate, dynamically
 allocated object of numeric (int) type of value 2
</p>
</div>
</div>
<div id="outline-container-org475b70c" class="outline-3">
<h3 id="org475b70c"><span class="section-number-3">6.7.</span> Indentation - Отступ слева and blank lines</h3>
<div class="outline-text-3" id="text-6-7">
<p>
Количество отступов не важно.
</p>

<p>
if True:
    print "Answer" // both prints called  <b>suite</b> and <b>header line</b> with : - if
    print "True"
else:
    print "Answer"
    print "False"
</p>

<p>
Blank Lines - ignored
</p>

<p>
semicolon ( ; ) allows multiple statements
</p>

<p>
Внутри:
</p>
<ul class="org-ul">
<li>INDENT - token означающий начало нового блока</li>
<li>DEDENT - конец блока.</li>
</ul>
</div>
</div>
<div id="outline-container-org11ea552" class="outline-3">
<h3 id="org11ea552"><span class="section-number-3">6.8.</span> mathematic</h3>
<div class="outline-text-3" id="text-6-8">
<ul class="org-ul">
<li><b>арифметика произвольной точности</b> длина чисел ограничена только объёмом доступной памяти</li>
<li>Extensive mathematics library, and the third-party library NumPy that further extends the native capabilities</li>
<li>a &lt; b &lt; c - support</li>
</ul>
</div>
</div>

<div id="outline-container-org99b0bb3" class="outline-3">
<h3 id="org99b0bb3"><span class="section-number-3">6.9.</span> WSGI (Web Server Gateway Interface)(whiskey)</h3>
<div class="outline-text-3" id="text-6-9">
<ul class="org-ul">
<li>calling convention for web servers to forward requests to web applications or frameworks written in the
Python programming language.</li>
<li>like Java's "servlet" API.</li>
<li>WSGI middleware components, which implement both sides of the API, typically in Python code.</li>
</ul>
</div>
</div>
<div id="outline-container-orgdfa3133" class="outline-3">
<h3 id="orgdfa3133"><span class="section-number-3">6.10.</span> pythonic paradigms</h3>
<div class="outline-text-3" id="text-6-10">
<ul class="org-ul">
<li><b>Context managers</b> - object for <b>with</b> with _<sub>enter</sub>_<sub>()</sub>, _<sub>exit</sub>_<sub>()</sub> or _<sub>aenter</sub>_<sub>()</sub> and _<sub>aexit</sub>_<sub>()</sub> methods.</li>
<li><b>while else</b> - else clause is only executed when your while condition becomes false. If you break out of the
loop, or if an exception is raised, it won't be executed.</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgbe812b0" class="outline-2">
<h2 id="orgbe812b0"><span class="section-number-2">7.</span> scripting</h2>
<div class="outline-text-2" id="text-7">
</div>
<div id="outline-container-org8f41adc" class="outline-3">
<h3 id="org8f41adc"><span class="section-number-3">7.1.</span> top-level script enironment</h3>
<div class="outline-text-3" id="text-7-1">
<ul class="org-ul">
<li><a href="https://docs.python.org/3.9/library/inspect.html">https://docs.python.org/3.9/library/inspect.html</a></li>
<li><a href="https://docs.python.org/3/library/functions.html?highlight=__file">https://docs.python.org/3/library/functions.html?highlight=__file</a>__</li>
<li><a href="https://docs.python.org/3/reference/import.html">https://docs.python.org/3/reference/import.html</a></li>
<li><a href="https://geek-university.com/python/display-module-content/">https://geek-university.com/python/display-module-content/</a></li>
</ul>

<p>
<b>_<sub>name</sub>__</b> - equal to '<span class="underline"><span class="underline">main</span></span>' when as a script or "python -m" or from an interactive prompt. '<span class="underline"><span class="underline">main</span></span>' is
 the name of the scope in which top-level code executes.
</p>

<p>
if <span class="underline"><span class="underline">name</span></span> == "<span class="underline"><span class="underline">main</span></span>": - not execute when imported
</p>

<p>
<b>_<sub>file</sub>__</b> - full path to module file
</p>
</div>
</div>

<div id="outline-container-org107e052" class="outline-3">
<h3 id="org107e052"><span class="section-number-3">7.2.</span> command line arguments parsing</h3>
<div class="outline-text-3" id="text-7-2">
<p>
import sys
</p>

<p>
print 'Number of arguments:', len(sys.argv), 'arguments.'
print 'Argument List:', str(sys.argv)
</p>

<p>
getopt module for better
</p>
</div>
</div>
<div id="outline-container-org4b3ff21" class="outline-3">
<h3 id="org4b3ff21"><span class="section-number-3">7.3.</span> python executable</h3>
<div class="outline-text-3" id="text-7-3">
<ul class="org-ul">
<li>-c cmd : program passed in as string (terminates option list)</li>
<li>-m mod : run library module as a script (terminates option list)</li>
<li>-O : remove assert and <span class="underline"><span class="underline">debug</span></span>-dependent statements; add .opt-1 before .pyc extension; also
PYTHONOPTIMIZE=x</li>
<li>-OO : do -O changes and also discard docstrings; add .opt-2 before .pyc extension</li>
<li>-s     : don't add user site directory to sys.path; also PYTHONNOUSERSITE. Disable <i>home/u2</i>.local/lib/python3.8/site-packages</li>
<li>-S     : don't imply 'import site' on initialization
<ul class="org-ul">
<li>/usr/lib/python38.zip</li>
<li>/usr/lib/python3.8</li>
<li>/usr/lib/python3.8/lib-dynload</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-orgd9e2171" class="outline-3">
<h3 id="orgd9e2171"><span class="section-number-3">7.4.</span> current dir</h3>
<div class="outline-text-3" id="text-7-4">
<p>
script<sub>dir</sub>=os.path.dirname(os.path.abspath(<span class="underline"><span class="underline">file</span></span>))
</p>
</div>
</div>
<div id="outline-container-orgbb57fd0" class="outline-3">
<h3 id="orgbb57fd0"><span class="section-number-3">7.5.</span> unix logger</h3>
<div class="outline-text-3" id="text-7-5">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">init_logger</span>(level, logfile_path: <span style="color: #e5786d;">str</span> = <span style="color: #e5786d; font-weight: bold;">None</span>):
    <span style="color: #f08080; font-style: italic;">"""</span>
<span style="color: #f08080; font-style: italic;">    stderr  WARNING ERROR and CRITICAL</span>
<span style="color: #f08080; font-style: italic;">    stdout &lt; WARNING</span>

<span style="color: #f08080; font-style: italic;">    :param logfile_path:</span>
<span style="color: #f08080; font-style: italic;">    :param level: level for stdout</span>
<span style="color: #f08080; font-style: italic;">    :return:</span>
<span style="color: #f08080; font-style: italic;">    """</span>

    <span style="color: #cae682;">formatter</span> = logging.Formatter(<span style="color: #95e454;">'mkbsftp [%(asctime)s] %(levelname)-6s %(message)s'</span>)
    <span style="color: #cae682;">logger</span> = logging.getLogger(<span style="color: #e5786d;">__name__</span>)
    logger.setLevel(level)  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">debug - lowest</span>
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">log file</span>
    <span style="color: #8ac6f2; font-weight: bold;">if</span> logfile_path <span style="color: #8ac6f2; font-weight: bold;">is</span> <span style="color: #8ac6f2; font-weight: bold;">not</span> <span style="color: #e5786d; font-weight: bold;">None</span>:
        <span style="color: #cae682;">h0</span> = logging.FileHandler(logfile_path)
        h0.setLevel(level)
        h0.setFormatter(formatter)
        logger.addHandler(h0)
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">stdout -- python3 script.py 2&gt;/dev/null | xargs</span>
    <span style="color: #cae682;">h1</span> = logging.StreamHandler(sys.stdout)
    h1.setLevel(level)  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">level may be changed</span>
    h1.addFilter(<span style="color: #8ac6f2; font-weight: bold;">lambda</span> record: record.levelno &lt; logging.WARNING)
    h1.setFormatter(formatter)
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">stderr -- python3 script.py 2&gt;&amp;1 &gt;/dev/null | xargs</span>
    <span style="color: #cae682;">h2</span> = logging.StreamHandler(sys.stderr)
    h2.setLevel(logging.WARNING)  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">fixed level</span>
    h2.setFormatter(formatter)

    logger.addHandler(h1)
    logger.addHandler(h2)
    <span style="color: #8ac6f2; font-weight: bold;">return</span> logger
</pre>
</div>
</div>
</div>

<div id="outline-container-org2b6233b" class="outline-3">
<h3 id="org2b6233b"><span class="section-number-3">7.6.</span> How does python find packages?</h3>
<div class="outline-text-3" id="text-7-6">
<p>
<b>sys.path</b> - Initialized from the environment variable PYTHONPATH, plus an installation-dependent default.
</p>

<p>
find module:
</p>
<ul class="org-ul">
<li>import imp</li>
<li>imp.find<sub>module</sub>('numpy')</li>
</ul>
</div>
</div>
<div id="outline-container-orgba5e0c0" class="outline-3">
<h3 id="orgba5e0c0"><span class="section-number-3">7.7.</span> dist-packages and site-packages?</h3>
<div class="outline-text-3" id="text-7-7">
<ul class="org-ul">
<li>dist-packages is a Debian-specific convention that is also present in its derivatives, like Ubuntu. Modules
are installed to dist-packages when they come from the Debian package manager. This is to reduce conflict
between the system Python, and any from-source Python build you might install manually.</li>
</ul>

<p>
<a href="https://wiki.debian.org/Python">https://wiki.debian.org/Python</a>
</p>
</div>
</div>
<div id="outline-container-org6e38714" class="outline-3">
<h3 id="org6e38714"><span class="section-number-3">7.8.</span> file size and modification date</h3>
<div class="outline-text-3" id="text-7-8">
<pre class="example">
os.stat(pf).st_size
os.stat(pf).st_mtime
</pre>
</div>
</div>

<div id="outline-container-org751d2f8" class="outline-3">
<h3 id="org751d2f8"><span class="section-number-3">7.9.</span> environment</h3>
<div class="outline-text-3" id="text-7-9">
<p>
os.environ  - dictionary
</p>

<p>
try &#x2026; except KeyError: - no variable in dictionary
</p>

<p>
os.environ.get('FLASK<sub>SOME</sub><sub>STAFF</sub>') - None if no key
</p>

<p>
if
</p>
<pre class="example">
export BBB ; python
os.environ['BBB'] # KeyError
</pre>


<pre class="example">
DEBUG = os.environ.get('DEBUG', False) # sed DEBUG to  True of False
</pre>
</div>
</div>
<div id="outline-container-orge6c5d12" class="outline-3">
<h3 id="orge6c5d12"><span class="section-number-3">7.10.</span> -m mod - run library module as a script</h3>
<div class="outline-text-3" id="text-7-10">
<p>
<a href="https://peps.python.org/pep-0338/">https://peps.python.org/pep-0338/</a>
</p>
<ul class="org-ul">
<li>_<sub>name</sub>__ is always '<span class="underline"><span class="underline">main</span></span>'</li>
</ul>
</div>

<div id="outline-container-org48bfd0f" class="outline-4">
<h4 id="org48bfd0f"><span class="section-number-4">7.10.1.</span> e.g. mymodule/_<sub>main</sub>_<sub>.py</sub>:</h4>
<div class="outline-text-4" id="text-7-10-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> argparse

<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">main</span>():
    <span style="color: #cae682;">parser</span> = argparse.ArgumentParser()
    parser.add_argument(<span style="color: #95e454;">"-p"</span>, <span style="color: #95e454;">"--port"</span>, action=<span style="color: #95e454;">"store"</span>, default=<span style="color: #95e454;">"8080"</span>)
    parser.add_argument(<span style="color: #95e454;">"--host"</span>, action=<span style="color: #95e454;">"store"</span>, default=<span style="color: #95e454;">"0.0.0.0"</span>)
    <span style="color: #cae682;">args</span> = parser.parse_args()
    <span style="color: #cae682;">port</span> = <span style="color: #e5786d;">int</span>(args.port)
    <span style="color: #cae682;">host</span> = <span style="color: #e5786d;">str</span>(args.host)
    app.run(host=host, port=port, debug=<span style="color: #e5786d; font-weight: bold;">False</span>)
    <span style="color: #8ac6f2; font-weight: bold;">return</span> 0

<span style="color: #8ac6f2; font-weight: bold;">if</span> <span style="color: #e5786d;">__name__</span>==<span style="color: #95e454;">"__main__"</span>:
    main()

</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-org5689405" class="outline-2">
<h2 id="org5689405"><span class="section-number-2">8.</span> Data model</h2>
<div class="outline-text-2" id="text-8">
<p>
Five standard data types −
</p>
<ul class="org-ul">
<li>Numbers</li>
<li>String</li>
<li>List :list - []</li>
<li>Tuple :tuple - ()</li>
<li>Dictionary :dict - {}</li>
<li>Callable :callable</li>
<li>:object</li>
</ul>
</div>

<div id="outline-container-orgffd2289" class="outline-3">
<h3 id="orgffd2289"><span class="section-number-3">8.1.</span> special types</h3>
<div class="outline-text-3" id="text-8-1">
<p>
<a href="https://docs.python.org/3/reference/datamodel.html">https://docs.python.org/3/reference/datamodel.html</a>
</p>
<ul class="org-ul">
<li>None - a single value</li>
<li>NotImplemented - Numeric methods and rich comparison methods should return this value if they do not
implement the operation for the operands provided.</li>
<li>Ellipsis - accessed through the literal &#x2026; or the built-in name Ellipsis.</li>
<li>numbers.Number</li>
<li>Sequences - represent finite ordered sets indexed by non-negative numbers (len() for sequence)
<ul class="org-ul">
<li>mutable: lists, Byte Arrays</li>
<li>immutable: str, tuple, bytes</li>
</ul></li>
<li>Set types -
<ul class="org-ul">
<li>Sets - mutable</li>
<li>Frozen sets - frozenset()</li>
</ul></li>
<li>Mappings - indexet by [2:3], have <b>del</b> and</li>
<li>Callable
<ul class="org-ul">
<li>Instance methods</li>
<li>Generator functions -  function or method which uses the yield statement
<ul class="org-ul">
<li>when called, always returns an iterator object</li>
</ul></li>
<li>Coroutine functions - async def - when called, returns a coroutine object</li>
<li>Asynchronous generator functions</li>
<li>Built-in functions</li>
<li>Built-in methods</li>
<li>Classes - factories for new instances of themselves</li>
<li>Class Instances - can be made callable by defining a _<sub>call</sub>_<sub>()</sub> method in their class.</li>
</ul></li>
<li>Modules <span class="underline"><span class="underline">name</span></span> The module’s name, <span class="underline"><span class="underline">doc</span></span>, <span class="underline"><span class="underline">file</span></span> - The pathname of the file from which the module was
loaded,_<sub>annotations</sub>__, <span class="underline"><span class="underline">dict</span></span> is the module’s namespace as a dictionary object.</li>
<li>Custom classes -</li>
<li>Class instances</li>
</ul>
</div>
</div>



<div id="outline-container-org11545fb" class="outline-3">
<h3 id="org11545fb"><span class="section-number-3">8.2.</span> theory</h3>
<div class="outline-text-3" id="text-8-2">
<ul class="org-ul">
<li>everything is an <b>object</b>, even classes. (Von Neumann’s model of a  “stored program computer”)</li>
<li>object has <b>identity</b>, a <b>type</b> and a <b>value</b></li>
<li><b>identity</b> - address in memory, never changed once created instance
<ul class="org-ul">
<li>id(object)  = identity</li>
<li>x is y - compare identities x is not y</li>
</ul></li>
<li><b>type</b> or class
<ul class="org-ul">
<li>type()</li>
</ul></li>
<li><b>value</b> of some objects can change - <b>mutable</b> <b>immutable</b> - even if refered object inside mutable
<ul class="org-ul">
<li>numbers, strings and tuples are immutable</li>
<li>dictionaries and lists are mutable</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-orgdb1e6df" class="outline-3">
<h3 id="orgdb1e6df"><span class="section-number-3">8.3.</span> Types build-in <a id="org5d1bb12"></a></h3>
<div class="outline-text-3" id="text-8-3">
<ul class="org-ul">
<li><b>None</b> - name to access single object - to signify the absence of a value = false.</li>

<li><b>NotImplemented</b> - name to access single object - <span class="underline">Numeric methods</span> and rich <span class="underline">comparison methods</span> should
return this value if they do not implement the operation for the operands provided. = true.</li>
<li><b>Ellipsis</b> - single object with name to access - <b>&#x2026;</b> or <b>Ellipsis</b> = true</li>
<li><b>numbers.Number</b> - immutable
<ul class="org-ul">
<li>numbers.Integral
<ul class="org-ul">
<li>Integers (<b>int</b>) - unlimited range</li>
<li>Booleans (<b>bool</b>) - 0 and 1, in most contextes  "False" or "True"</li>
</ul></li>
<li>numbers.Real (<b>float</b>) - underlying machine architecture определеяет accepted range and handling of
overflow</li>
<li>numbers.Complex (<b>complex</b>) - z.real and z.imag  - pair of machine-level double precision floating point numbers</li>
</ul></li>

<li>Sequences - finite ordered sets <b>len()</b> - index <b>a[i]</b>: 0 to n-1; <b>min(s), max(s)</b> ; <b>s * n</b> - n copies of s ;
<b>s + t</b> concatenation; <b>x in s</b> - True if an item of s is equal to x
<ul class="org-ul">
<li>Immutable sequences - <b>list.index(obj)</b>
<ul class="org-ul">
<li><b>str</b> - UTF-8 - s[0] = string with length 1(code point).  <b>ord(s)</b> - <span class="underline">code point</span> to 0 - 10FFFF ;
<b>chr(i)</b> int to integer.; <b>str.encode()</b> -&gt; bytes.decode() &lt;-</li>
<li><b>Tuple</b> - неизменяемый (), (1,) (1,'23') any type.</li>
<li><b>range()</b></li>
<li><b>Bytes</b> -  items are 8-bit byte = 1-255 - literal <b>xb'ab'</b> ; <b>bytes()</b> - creates;</li>
</ul></li>
<li>Mutable unhashable - <b>del list[0]</b> - без первого -
<ul class="org-ul">
<li><b>List</b> - изменяемый [1,'3'] any type.</li>
<li>Byte Array - bytearray - <b>bytearray()</b></li>
<li>memoryview</li>
</ul></li>
</ul></li>

<li>Set types - unordered - finite sets of unique - immutable - compare by == ; has <b>len()</b>
<ul class="org-ul">
<li><b>set</b> - mutable - <span class="underline">items must be imutable</span> <b>x in set</b> <b>for x in set</b> - {'h', 'o', 'l', 'e'}</li>
<li><b>frozenset</b> -  immutable and hashable -  it can be used again as an element of another set</li>
</ul></li>
<li>Mappings - finite sets,  finctions: del a[k], len()
<ul class="org-ul">
<li><b>Dictionary</b> - mutable - Keys are unique within a dictionary - indexed by nearly arbitrary values -<sub>Keys</sub>
must be immutable_ - {2 : 'Zara', 'Age' : 7, 'Class' : 'First'} dict[3] = "my" # Add new entry</li>
</ul></li>

<li>Callable types -  to which  call operation  can be applied - код, который можеть быть вызван
<ul class="org-ul">
<li>User-defined functions</li>
<li>Instance methods: read-only attributes:</li>
<li>Generator functions - function which returns a generator iterator. It looks like a normal function except
that it contains <b>yield</b> expressions ??????</li>
<li>Coroutine functions -  <b>async def</b> - returns a coroutine object ???</li>
<li>Asynchronous generator functions</li>
<li>Built-in functions - len()  and math.sin()  (math is a standard built-in module)</li>
<li>Built-in methods alist.append()</li>
<li>Classes - act as factories for new instances of themselves. arguments of the call are passed to _<sub>new</sub>_<sub>()</sub></li>
<li>Class Instances - may be callable by defining a _<sub>call</sub>_<sub>()</sub> method</li>
</ul></li>
<li>Modules</li>
<li>Custom classes</li>
</ul>
</div>
</div>

<div id="outline-container-org96b5693" class="outline-3">
<h3 id="org96b5693"><span class="section-number-3">8.4.</span> Truth Value Testing <a id="org795df65"></a></h3>
<div class="outline-text-3" id="text-8-4">
<ul class="org-ul">
<li><a href="https://docs.python.org/3/library/stdtypes.html">https://docs.python.org/3/library/stdtypes.html</a></li>
</ul>
<p>
false:
</p>
<ul class="org-ul">
<li>None and False.</li>
<li>zero of any numeric type: 0, 0.0, 0j, Decimal(0), Fraction(0, 1)</li>
<li>empty sequences and collections: '', (), [], {}, set(), range(0)</li>
</ul>
</div>
</div>

<div id="outline-container-orgd02ebef" class="outline-3">
<h3 id="orgd02ebef"><span class="section-number-3">8.5.</span> Shallow and deep copy operations</h3>
<div class="outline-text-3" id="text-8-5">
<ul class="org-ul">
<li>import copy</li>
<li>copy.copy(x)    Return a shallow copy of x.</li>
<li>copy.deepcopy(x[, memo])    Return a deep copy of x.</li>
<li>calss own copy: _<sub>copy</sub>_<sub>()</sub> and _<sub>deepcopy</sub>_<sub>()</sub></li>
</ul>
</div>
</div>
<div id="outline-container-orgbf61d19" class="outline-3">
<h3 id="orgbf61d19"><span class="section-number-3">8.6.</span> Why Dict and set use only hashable objects?</h3>
<div class="outline-text-3" id="text-8-6">
<p>
Hash function used to address value by a key.
</p>

<p>
There is tradeoff what should be brokern: hash function that will not mirror changed of mutable object or dict
 and set that will not allow not hashable objects.
</p>

<p>
Solutions:
</p>
<ul class="org-ul">
<li>freeze mutable to imutable, ex. list to typle</li>
</ul>

<p>
Set:
</p>
<ul class="org-ul">
<li>bucket<sub>index</sub> = self.<sub>hash</sub>(element) % self.size</li>
<li>sets are resized when the load factor (the ratio of the number of elements to the number of buckets)
exceeds a certain threshold.</li>
</ul>

<p>
To allow set to use other hash function hash function of kept object should be modified or whole Set class
 should be reimplemented.
</p>
</div>
</div>
<div id="outline-container-orgfd4465f" class="outline-3">
<h3 id="orgfd4465f"><span class="section-number-3">8.7.</span> Dict hash collisions</h3>
<div class="outline-text-3" id="text-8-7">
<ul class="org-ul">
<li>Replaceas “hash” with “hashlib”</li>
<li>Chaining: When two different elements hash to the same bucket (a collision), Python uses chaining to store these elements in a linked list within that bucket.</li>
<li>Open Addressing: Python also uses open addressing techniques to handle collisions, where the next available slot is used to store the element.</li>
<li>performance monitoring</li>
</ul>
</div>
</div>
<div id="outline-container-org83585f7" class="outline-3">
<h3 id="org83585f7"><span class="section-number-3">8.8.</span> links</h3>
<div class="outline-text-3" id="text-8-8">
<ul class="org-ul">
<li><a href="https://docs.python.org/3/reference/datamodel.html">https://docs.python.org/3/reference/datamodel.html</a></li>
<li><a href="https://docs.python.org/3/library/stdtypes.html">https://docs.python.org/3/library/stdtypes.html</a></li>
<li>object by name or by link: muttable immutalbe 2019 <a href="https://realpython.com/pointers-in-python/">https://realpython.com/pointers-in-python/</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org2fa9dfe" class="outline-2">
<h2 id="org2fa9dfe"><span class="section-number-2">9.</span> typed varibles or type hints</h2>
<div class="outline-text-2" id="text-9">
<ul class="org-ul">
<li><a href="https://docs.python.org/3/library/typing.html">https://docs.python.org/3/library/typing.html</a></li>
<li>from typing import Dict, Tuple, Sequence, Any, Union, Tuple, Callable, TypeVar, Generic</li>
</ul>
<pre class="example">
variable_name: type
</pre>
</div>

<div id="outline-container-orgf1170f8" class="outline-3">
<h3 id="orgf1170f8"><span class="section-number-3">9.1.</span> typing.Annotated and PEP-593</h3>
<div class="outline-text-3" id="text-9-1">
<p>
data models, validation, serialization, UI
</p>

<p>
v: Annotated[T, *x]
</p>
<ul class="org-ul">
<li>v: a “name” (variable, function parameter, . . . )</li>
<li>T: a valid type</li>
<li>x: at least one metadata (or annotation), passed in a variadic way.  The metadata can be used for either
static analysis or at runtime.</li>
</ul>

<p>
Ignorable: When a tool or a library does not support annotations or encounters an unknown annotation it should just
 ignore it and treat annotated type as the underlying type.
</p>

<p>
stored in obj._<sub>annotations</sub>__
</p>
</div>
<div id="outline-container-org84746fe" class="outline-4">
<h4 id="org84746fe"><span class="section-number-4">9.1.1.</span> from typing import get<sub>type</sub><sub>hints</sub></h4>
<div class="outline-text-4" id="text-9-1-1">
<pre class="example">
@dataclass
class Point:
  x: int
  y: Annotated[int, Label("ordinate")]
{'x': &lt;class 'int'&gt;, 'y': typing.Annotated[int, Label('ordinate')]}
</pre>
</div>
</div>
<div id="outline-container-org1223cc4" class="outline-4">
<h4 id="org1223cc4"><span class="section-number-4">9.1.2.</span> Use case: A calendar Event model, using pydantic <a href="https://github.com/pydantic/pydantic">https://github.com/pydantic/pydantic</a></h4>
<div class="outline-text-4" id="text-9-1-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">from</span> pydantic <span style="color: #8ac6f2; font-weight: bold;">import</span> BaseModel
<span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">Event</span>(BaseModel):
    summary: <span style="color: #e5786d;">str</span>
    description: <span style="color: #e5786d;">str</span> | <span style="color: #e5786d; font-weight: bold;">None</span> = <span style="color: #e5786d; font-weight: bold;">None</span>
    start_at: datetime | <span style="color: #e5786d; font-weight: bold;">None</span> = <span style="color: #e5786d; font-weight: bold;">None</span>
    end_at: datetime | <span style="color: #e5786d; font-weight: bold;">None</span> = <span style="color: #e5786d; font-weight: bold;">None</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">-- Validation on datetime fields (using Pydantic)</span>


<span style="color: #8ac6f2; font-weight: bold;">from</span> pydantic <span style="color: #8ac6f2; font-weight: bold;">import</span> AfterValidator

<span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">Event</span>(BaseModel):
    summary: <span style="color: #e5786d;">str</span>
    description: <span style="color: #e5786d;">str</span> | <span style="color: #e5786d; font-weight: bold;">None</span> = <span style="color: #e5786d; font-weight: bold;">None</span>
    start_at: <span style="color: #cae682;">Annotated</span>[datetime | <span style="color: #e5786d; font-weight: bold;">None</span>, AfterValidator(tz_aware)] = <span style="color: #e5786d; font-weight: bold;">None</span>
    end_at: <span style="color: #cae682;">Annotated</span>[datetime | <span style="color: #e5786d; font-weight: bold;">None</span>, AfterValidator(tz_aware)] = <span style="color: #e5786d; font-weight: bold;">None</span>

<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">tz_aware</span>(d: datetime) -&gt; datetime:
    <span style="color: #8ac6f2; font-weight: bold;">if</span> d.tzinfo <span style="color: #8ac6f2; font-weight: bold;">is</span> <span style="color: #e5786d; font-weight: bold;">None</span> <span style="color: #8ac6f2; font-weight: bold;">or</span> d.tzinfo.utcoffset(d) <span style="color: #8ac6f2; font-weight: bold;">is</span> <span style="color: #e5786d; font-weight: bold;">None</span>:
        <span style="color: #8ac6f2; font-weight: bold;">raise</span> <span style="color: #92a65e; font-weight: bold;">ValueError</span> (<span style="color: #95e454;">"expecting a TZ-aware datetime"</span>)
    <span style="color: #8ac6f2; font-weight: bold;">return</span> d

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">-- iCalendar serialization support</span>

<span style="color: #cae682;">TZDatetime</span> = Annotated[datetime, AfterValidator(tz_aware)]

<span style="color: #8ac6f2; font-weight: bold;">from</span> . <span style="color: #8ac6f2; font-weight: bold;">import</span> ical

<span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">Event</span>(BaseModel):
    summary: Annotated[<span style="color: #e5786d;">str</span>, ical.Serializer(label=<span style="color: #95e454;">"summary"</span>)]
    description: <span style="color: #cae682;">Annotated</span>[<span style="color: #e5786d;">str</span> | <span style="color: #e5786d; font-weight: bold;">None</span>, ical.Serializer(label=<span style="color: #95e454;">"description"</span>)] = <span style="color: #e5786d; font-weight: bold;">None</span>
    start_at: <span style="color: #cae682;">Annotated</span>[TZDatetime | <span style="color: #e5786d; font-weight: bold;">None</span>, ical.Serializer(label=<span style="color: #95e454;">"dtstart"</span>)] = <span style="color: #e5786d; font-weight: bold;">None</span>
    end_at: <span style="color: #cae682;">Annotated</span>[TZDatetime | <span style="color: #e5786d; font-weight: bold;">None</span>, ical.Serializer(label=<span style="color: #95e454;">"dtend"</span>)] = <span style="color: #e5786d; font-weight: bold;">None</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">module: ical</span>
<span style="color: #92a65e; font-weight: bold;">@dataclass</span>
<span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">Serializer</span>:
    label: <span style="color: #e5786d;">str</span>

    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">serialize</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>, value: Any) -&gt; <span style="color: #e5786d;">str</span>:
        <span style="color: #8ac6f2; font-weight: bold;">if</span> <span style="color: #e5786d;">isinstance</span>(value, datetime):
            <span style="color: #cae682;">value</span> = value.astimezone(timezone.utc).strftime(<span style="color: #95e454;">"%Y%m%dT%H%M%SZ"</span>)
        <span style="color: #8ac6f2; font-weight: bold;">return</span> f<span style="color: #95e454;">"</span>{<span style="color: #8ac6f2; font-weight: bold;">self</span>.label.upper()}<span style="color: #95e454;">:</span>{value}<span style="color: #95e454;">"</span>


<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">serialize_event</span>(obj: Event) -&gt; <span style="color: #e5786d;">str</span>:
    <span style="color: #cae682;">lines</span> = []
    <span style="color: #8ac6f2; font-weight: bold;">for</span> name, a, _ <span style="color: #8ac6f2; font-weight: bold;">in</span> get_annotations(obj, Serializer):
        <span style="color: #8ac6f2; font-weight: bold;">if</span> (value := <span style="color: #e5786d;">getattr</span>(obj, name, <span style="color: #e5786d; font-weight: bold;">None</span>)) <span style="color: #8ac6f2; font-weight: bold;">is</span> <span style="color: #8ac6f2; font-weight: bold;">not</span> <span style="color: #e5786d; font-weight: bold;">None</span>:
            lines.append(a.serialize(value))
    <span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #95e454;">"</span><span style="color: #e5786d; font-weight: bold;">\n</span><span style="color: #95e454;">"</span>.join([<span style="color: #95e454;">"BEGIN:VEVENT"</span>] + lines + [<span style="color: #95e454;">"END:VEVENT"</span>])
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">console rendering</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">&gt;&gt;&gt; evt = Event(</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">... summary="FOSDEM",</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">... start_at=datetime(2024, 2, 3, 9, 00, 0, tzinfo=ZoneInfo("Europe/Brussels")),</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">... end_at=datetime(2024, 2, 4, 17, 00, 0, tzinfo=ZoneInfo("Europe/Brussels")),</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">... )</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">&gt;&gt;&gt; print(ical.serialize_event(evt))</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">BEGIN:VEVENT</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">SUMMARY:FOSDEM</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">DTSTART:20240203T080000Z</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">DTEND:20240204T160000Z</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">END:VEVENT</span>

</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orged2c87f" class="outline-3">
<h3 id="orged2c87f"><span class="section-number-3">9.2.</span> function annotation</h3>
<div class="outline-text-3" id="text-9-2">
<pre class="example">
def function_name(parameter1: type) -&gt; return_type:
</pre>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">from</span> typing <span style="color: #8ac6f2; font-weight: bold;">import</span> Dict

<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">get_first_name</span>(full_name: <span style="color: #e5786d;">str</span>) -&gt; <span style="color: #e5786d;">str</span>:
    <span style="color: #8ac6f2; font-weight: bold;">return</span> full_name.split(<span style="color: #95e454;">" "</span>)[0]

<span style="color: #cae682;">fallback_name</span>: Dict[<span style="color: #e5786d;">str</span>, <span style="color: #e5786d;">str</span>] = {
    <span style="color: #95e454;">"first_name"</span>: <span style="color: #95e454;">"UserFirstName"</span>,
    <span style="color: #95e454;">"last_name"</span>: <span style="color: #95e454;">"UserLastName"</span>
}

<span style="color: #cae682;">raw_name</span>: <span style="color: #e5786d;">str</span> = <span style="color: #e5786d;">input</span>(<span style="color: #95e454;">"Please enter your name: "</span>)
<span style="color: #cae682;">first_name</span>: <span style="color: #e5786d;">str</span> = get_first_name(raw_name)

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">If the user didn't type anything in, use the fallback name</span>
<span style="color: #8ac6f2; font-weight: bold;">if</span> <span style="color: #8ac6f2; font-weight: bold;">not</span> first_name:
    <span style="color: #cae682;">first_name</span> = get_first_name(fallback_name)

<span style="color: #e5786d;">print</span>(f<span style="color: #95e454;">"Hi, </span>{first_name}<span style="color: #95e454;">!"</span>)
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org3e7dd12" class="outline-2">
<h2 id="org3e7dd12"><span class="section-number-2">10.</span> Strings</h2>
<div class="outline-text-2" id="text-10">
<p>
<b>Quotation [kwəʊˈteɪʃn] fot string</b>: single ('), double (") and triple (''' or """) quotes to denote string
 literals
</p>
</div>
<div id="outline-container-org43cd78a" class="outline-3">
<h3 id="org43cd78a"><span class="section-number-3">10.1.</span> основы</h3>
<div class="outline-text-3" id="text-10-1">
<ul class="org-ul">
<li>“str” is a built-in type.</li>
<li>“string” is a module in the Python Standard Library. For providing constants and classes that aid in string
manipulation. Constants: string.ascii<sub>letters</sub>, string.digits, string.punctuation, etc.</li>
</ul>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #cae682;">S</span> = <span style="color: #95e454;">'str'</span>; <span style="color: #cae682;">S</span> = <span style="color: #95e454;">"str"</span>; <span style="color: #cae682;">S</span> = <span style="color: #95e454;">'''str'''</span>;

<span style="color: #cae682;">para_str</span> = <span style="color: #95e454;">"""this is a long string that is made up of</span>
<span style="color: #95e454;">several lines and non-printable characters such as</span>
<span style="color: #95e454;">TAB ( </span><span style="color: #e5786d; font-weight: bold;">\t</span><span style="color: #95e454;"> ) and they will show up that way when displayed.</span>
<span style="color: #95e454;">NEWLINEs within the string, whether explicitly given like</span>
<span style="color: #95e454;">this within the brackets [ </span><span style="color: #e5786d; font-weight: bold;">\n</span><span style="color: #95e454;"> ], or just a NEWLINE within</span>
<span style="color: #95e454;">the variable assignment will also show up."""</span>
</pre>
</div>
</div>

<div id="outline-container-org2e2f896" class="outline-4">
<h4 id="org2e2f896"><span class="section-number-4">10.1.1.</span> multiline</h4>
<div class="outline-text-4" id="text-10-1-1">
<ol class="org-ol">
<li>s = """My Name is Pankajin Developers community."""</li>
<li>s =  ('asd' 'asd') = asdasd</li>
<li>backslash</li>
</ol>
<pre class="example">
s = "My Name is Pankaj. " \
    "website in Developers community."
</pre>

<ol class="org-ol">
<li>s = ' '.join(("My Name is Pankaj. I am the owner of", "JournalDev.com and"))</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-org3265882" class="outline-3">
<h3 id="org3265882"><span class="section-number-3">10.2.</span> <b>A formatted string literal or f-string</b></h3>
<div class="outline-text-3" id="text-10-2">
<ul class="org-ul">
<li><a href="https://peps.python.org/pep-0498/">https://peps.python.org/pep-0498/</a></li>
<li><a href="https://docs.python.org/3/library/string.html#formatstrings">https://docs.python.org/3/library/string.html#formatstrings</a></li>
</ul>
<p>
equivalent to format()
</p>

<ul class="org-ul">
<li>'!s' calls str() on the expression</li>
<li>'!r' calls repr() on the expression</li>
<li>'!a' calls ascii() on the expression.</li>
</ul>


<pre class="example">
&gt;&gt;&gt; name = "Fred"
&gt;&gt;&gt; f"He said his name is {name!r}." # repr() is equivalent to !r
"He said his name is 'Fred'."
</pre>

<p>
Символов после запятой
</p>
<pre class="example">
&gt;&gt;&gt; width = 10
&gt;&gt;&gt; precision = 4
&gt;&gt;&gt; value = decimal.Decimal("12.34567")
&gt;&gt;&gt; f"result: {value:{width}.{precision}}"  # nested fields
'result:      12.35'
</pre>

<p>
Форматирование даты:
</p>
<pre class="example">
&gt;&gt;&gt; today = datetime(year=2017, month=1, day=27)
&gt;&gt;&gt; f"{today:%B %d, %Y}"  # using date format specifier
'January 27, 2017'
&gt;&gt;&gt; number = 1024
&gt;&gt;&gt; f"{number:#0x}"  # using integer format specifier
'0x400'
</pre>

<p>
format:
</p>
<pre class="example">
&gt;&gt;&gt; '{:,}'.format(1234567890)
'1,234,567,890'
&gt;&gt;&gt; 'Correct answers: {:.2%}'.format(19/22)
'Correct answers: 86.36%'
</pre>
</div>
</div>

<div id="outline-container-org1d8021f" class="outline-3">
<h3 id="org1d8021f"><span class="section-number-3">10.3.</span> <b>String Formatting Operator</b></h3>
<div class="outline-text-3" id="text-10-3">
<ul class="org-ul">
<li>print ("My name is %s and weight is %d kg!" % ('Zara', 21))</li>
</ul>
</div>
</div>
<div id="outline-container-orgd854a56" class="outline-3">
<h3 id="orgd854a56"><span class="section-number-3">10.4.</span> string literal prefixes</h3>
<div class="outline-text-3" id="text-10-4">
<ul class="org-ul">
<li><a href="https://www.python.org/dev/peps/pep-0414/">https://www.python.org/dev/peps/pep-0414/</a></li>
</ul>
<p>
str or strings -  immutable sequences of Unicode code points.
</p>
<dl class="org-dl">
<dt>r' R' raw strings</dt><dd>Raw strings do not treat the backslash as a special character at all. print (r'C:\\nowhere')</dd>
<dt>b' B' bytes (NOT str)</dt><dd>may only contain ASCII characters</dd>
<dt>(no term)</dt><dd>::</dd>
</dl>
</div>
</div>


<div id="outline-container-org1630aa1" class="outline-3">
<h3 id="org1630aa1"><span class="section-number-3">10.5.</span> raw strings, Unicode, formatted</h3>
<div class="outline-text-3" id="text-10-5">
<ul class="org-ul">
<li>r'string' - treat backslashes as literal characters</li>
<li>f'string' or F'string' - f"He said his name is {name!r}." - formatted</li>
</ul>
</div>
</div>
<div id="outline-container-orgffd2f06" class="outline-3">
<h3 id="orgffd2f06"><span class="section-number-3">10.6.</span> Efficient String Concatenation</h3>
<div class="outline-text-3" id="text-10-6">
<ul class="org-ul">
<li>concatination at runtime</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">Fastest:</span>
<span style="color: #cae682;">s</span>= <span style="color: #95e454;">''</span>.join([`num` <span style="color: #8ac6f2; font-weight: bold;">for</span> num <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">xrange</span>(loop_count)])

<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">g</span>():
    <span style="color: #cae682;">sb</span> = []
    <span style="color: #8ac6f2; font-weight: bold;">for</span> i <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">range</span>(30):
        sb.append(<span style="color: #95e454;">"abcdefg"</span>[i%7])

    <span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #95e454;">''</span>.join(sb)

<span style="color: #e5786d;">print</span> g()   <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">abcdefgabcdefgabcdefgabcdefgab</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org36e806d" class="outline-3">
<h3 id="org36e806d"><span class="section-number-3">10.7.</span> byte string</h3>
<div class="outline-text-3" id="text-10-7">
<p>
b''
</p>
<ul class="org-ul">
<li>byte string tp unicode :  str.decode()</li>
<li>unicode to byte string: str.encode('')</li>
</ul>



<p>
Your string is already encoded with some encoding. Before encoding it to ascii, you must decode it first.
Python is implicity trying to decode it (That's why you get a UnicodeDecodeError not UnicodeEncodeError).
</p>
</div>
</div>
</div>
<div id="outline-container-org0465053" class="outline-2">
<h2 id="org0465053"><span class="section-number-2">11.</span> Classes</h2>
<div class="outline-text-2" id="text-11">
<ul class="org-ul">
<li>Class object - support two kinds of operations: attribute references and instantiation.</li>
<li>Instance object - attribute references - data and methods</li>
</ul>

<p>
there is <b>data attributes</b> correspond to “instance variables” in Smalltalk, and to “data members” in C++. - -
static varible - shared by each instance.
</p>
<ul class="org-ul">
<li>instance varibles may be reassigned</li>
<li>instance methods may be reassigned to any method or function. it is just an alias</li>
</ul>


<p>
object - parent for all classes
</p>
<ul class="org-ul">
<li>_<sub>class</sub>__ - class of instance</li>
<li>_<sub>init</sub>__</li>
<li>_<sub>new</sub>__</li>
<li>_<sub>init</sub><sub>subclass</sub>__</li>
<li>'<span class="underline"><span class="underline">delattr</span></span>', '<span class="underline"><span class="underline">dir</span></span>', '<span class="underline"><span class="underline">doc</span></span>', '<span class="underline"><span class="underline">eq</span></span>', '<span class="underline"><span class="underline">format</span></span>', '<span class="underline"><span class="underline">ge</span></span>', '<span class="underline"><span class="underline">getattribute</span></span>', '<span class="underline"><span class="underline">gt</span></span>',
'<span class="underline"><span class="underline">hash</span></span>', '<span class="underline"><span class="underline">le</span></span>', '<span class="underline"><span class="underline">lt</span></span>', '<span class="underline"><span class="underline">ne</span></span>', '<span class="underline"><span class="underline">reduce</span></span>',
'<span class="underline"><span class="underline">reduce<sub>ex</sub></span></span>', '<span class="underline"><span class="underline">repr</span></span>', '<span class="underline"><span class="underline">setattr</span></span>', '<span class="underline"><span class="underline">sizeof</span></span>', '<span class="underline"><span class="underline">str</span></span>', '<span class="underline"><span class="underline">subclasshook</span></span>'</li>
</ul>
</div>

<div id="outline-container-orgf0e7964" class="outline-3">
<h3 id="orgf0e7964"><span class="section-number-3">11.1.</span> basic</h3>
<div class="outline-text-3" id="text-11-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">MyClass</span>:
        <span style="color: #cae682;">a</span>=<span style="color: #e5786d; font-weight: bold;">None</span>
<span style="color: #cae682;">c</span> = MyClass()
c.<span style="color: #cae682;">a</span> = 3 <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">instance</span>

<span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">MyClass</span>:
    <span style="color: #f08080; font-style: italic;">"""MyClass.i and MyClass.f are valid attribute references"""</span>
    <span style="color: #cae682;">i</span> = 12345 <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">class value</span>
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">__init__</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>, a):
        <span style="color: #8ac6f2; font-weight: bold;">self</span>.<span style="color: #cae682;">i</span> = a <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">create new object value</span>
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">f</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>):
        <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"f"</span>)

<span style="color: #cae682;">x</span> = MyClass(2) <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">instance ERROR!</span>
x.<span style="color: #cae682;">a</span> = 3; <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">data attibute</span>

<span style="color: #e5786d;">print</span>(x.a)
<span style="color: #e5786d;">print</span>(x.i)
<span style="color: #e5786d;">print</span>(MyClass.i)
<span style="color: #e5786d;">print</span>(x.f)
<span style="color: #e5786d;">print</span>(MyClass.f)
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">MyClass.f and x.f &#8212; it is a method object, not a function object.</span>
</pre>
</div>

<pre class="example">
3
2
12345
&lt;bound method MyClass.f of &lt;__main__.MyClass object at 0x7f37165d4790&gt;&gt;
&lt;function MyClass.f at 0x7f37165c5440&gt;
</pre>



<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">Dog</span>:
    <span style="color: #cae682;">kind</span> = <span style="color: #95e454;">'canine'</span>         <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">class variable shared by all instances</span>
    <span style="color: #cae682;">tricks</span> = []             <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">static!</span>

    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">__init__</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>, name):
        <span style="color: #8ac6f2; font-weight: bold;">self</span>.<span style="color: #cae682;">name</span> = name    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">instance variable unique to each instance</span>

<span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">-------------- class method</span>
: <span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">C</span>:
:    @<span style="color: #e5786d;">classmethod</span>
:    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">f</span>(cls, arg1, arg2, ...): ...
<span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">May be called for class C.f() or for instance C().f() For derived class</span>
<span style="color: #fa8072;">#                  </span><span style="color: #99968b; font-style: italic;">derived class object is passed as the implied first argument.</span>
</pre>
</div>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">A</span>:
    <span style="color: #cae682;">c</span> = 0
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">meth</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>):
        <span style="color: #8ac6f2; font-weight: bold;">self</span>.<span style="color: #cae682;">c</span> = 3
<span style="color: #cae682;">a</span> = A()
a.meth()
<span style="color: #e5786d;">print</span>(A.c, a.c)
</pre>
</div>

<pre class="example">
0 3
None
</pre>
</div>
</div>

<div id="outline-container-org45ce01a" class="outline-3">
<h3 id="org45ce01a"><span class="section-number-3">11.2.</span> Special Attributes</h3>
<div class="outline-text-3" id="text-11-2">
<ul class="org-ul">
<li>instance._<sub>class</sub>__ - The class to which a class instance belongs.</li>
<li>class._<sub>mro</sub>__ or mro() - This attribute is a tuple of classes that are considered when looking for base classes
during method resolution.</li>
<li>class._<sub>subclasses</sub>_<sub>()</sub> - Each class keeps a list of weak references to its immediate subclasses.</li>
</ul>


<p>
Class
-<span class="underline"><span class="underline">name</span></span> The class name.
</p>
<ul class="org-ul">
<li>_<sub>module</sub>__ The name of the module in which the class was defined.</li>
<li>_<sub>dict</sub>__ The dictionary containing the class’s namespace.</li>
<li>_<sub>bases</sub>__ A tuple containing the base classes, in the order of their occurrence in the base class list.</li>
<li>_<sub>doc</sub>__ The class’s documentation string, or None if undefined.</li>
<li>_<sub>annotations</sub>__ A dictionary containing variable annotations collected during class body execution. For best
practices on working with <span class="underline"><span class="underline">annotations</span></span>, please see Annotations Best Practices.</li>
<li>_<sub>new</sub>_<sub>(cls,&#x2026;)</sub> - static method - special-cased so you need not declare it as such. The return value of
_<sub>new</sub>_<sub>()</sub> should be the new object instance (usually an instance of cls).
<ul class="org-ul">
<li>typically: super()._<sub>new</sub>_<sub>(cls[, &#x2026;])</sub> with appropriate arguments and then modifying the newly-created
instance as necessary before returning it.</li>
<li>then the new instance’s _<sub>init</sub>_<sub>()</sub> method will be invoked</li>
</ul></li>
<li>_<sub>call</sub>_<sub>(self,&#x2026;)</sub></li>
</ul>

<p>
Class instances
</p>
<ul class="org-ul">
<li>super() - Return a proxy object that delegates method calls to a parent or sibling class of type
<ul class="org-ul">
<li></li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-orgd3fe492" class="outline-3">
<h3 id="orgd3fe492"><span class="section-number-3">11.3.</span> inheritance</h3>
<div class="outline-text-3" id="text-11-3">
</div>
<div id="outline-container-org61afcf3" class="outline-4">
<h4 id="org61afcf3"><span class="section-number-4">11.3.1.</span> Constructor</h4>
<div class="outline-text-4" id="text-11-3-1">
<ul class="org-ul">
<li>classes whose base class is object should not call super()._<sub>init</sub>_<sub>()</sub></li>
<li>class inherited from object by default</li>
<li>you should never write a class that inherits from object and doesn't have an <span class="underline"><span class="underline">init</span></span> method</li>
</ul>

<p>
designed for cooperative inheritance:
class CoopFoo:
    def _<sub>init</sub>_<sub>(self, *args, **kwargs)</sub>:
        super()._<sub>init</sub>_<sub>(*args, **kwargs)</sub>  # forwards all unused arguments
</p>

<p>
super(type, object-or-type)
</p>
<ul class="org-ul">
<li>type - get parent or sibling of type</li>
<li>object-or-type.mro() determines the method resolution order to be searched</li>
</ul>

<p>
super(self._<sub>class</sub>__, self) == super()
</p>
</div>
</div>
<div id="outline-container-orgc170b3a" class="outline-4">
<h4 id="orgc170b3a"><span class="section-number-4">11.3.2.</span> Subclassing:</h4>
<div class="outline-text-4" id="text-11-3-2">
<ul class="org-ul">
<li>direct - a - b</li>
<li>indirect - a - b - c</li>
<li>virtual - abstract base class</li>
</ul>

<pre class="example">
class SubClassName (ParentClass1[, ParentClass2, ...]):
   'Optional class documentation string'
   class_suite
</pre>
</div>
</div>
<div id="outline-container-org946107a" class="outline-4">
<h4 id="org946107a"><span class="section-number-4">11.3.3.</span> built-in functions that work with inheritance:</h4>
<div class="outline-text-4" id="text-11-3-3">
<ul class="org-ul">
<li><b>isinstance(obj, int)</b> -  True only if obj._<sub>class</sub>__ is int or some class derived from int</li>
<li><b>issubclass(bool, int)</b> - True since bool is a subclass of int</li>
<li>type(ins) == a._<sub>class</sub>__</li>
<li>type(ins) <b>is</b> Class<sub>name</sub></li>
<li>isinstance(ins, Class<sub>name</sub>)</li>
<li>issubclass(ins._<sub>class</sub>__, Class<sub>name</sub>)</li>
<li>class.mro() - get class._<sub>mro</sub>__ attribute</li>
</ul>
</div>
</div>

<div id="outline-container-orgdc2f0d1" class="outline-4">
<h4 id="orgdc2f0d1"><span class="section-number-4">11.3.4.</span> example</h4>
<div class="outline-text-4" id="text-11-3-4">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">aa</span>():
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">__init__</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>, aaa, vv):
        <span style="color: #8ac6f2; font-weight: bold;">self</span>.<span style="color: #cae682;">aaa</span> = aaa
        <span style="color: #8ac6f2; font-weight: bold;">self</span>.<span style="color: #cae682;">vv</span> = vv

    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">get</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>):
        <span style="color: #e5786d;">print</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>.aaa + <span style="color: #8ac6f2; font-weight: bold;">self</span>.vv)

<span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">bb</span>(aa):
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">__init__</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>, aaa, *args, **kwargs):
        <span style="color: #e5786d;">super</span>().__init__(aaa, *args, **kwargs)
        <span style="color: #8ac6f2; font-weight: bold;">self</span>.<span style="color: #cae682;">aaa</span> = aaa +<span style="color: #95e454;">'asd'</span>


<span style="color: #cae682;">s</span> = bb(<span style="color: #95e454;">'aa'</span>, <span style="color: #95e454;">'vv'</span>)
s.get()
&gt;&gt; aaasdvv
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb1f58fc" class="outline-4">
<h4 id="orgb1f58fc"><span class="section-number-4">11.3.5.</span> Multiple inheritance - left-to-right</h4>
<div class="outline-text-4" id="text-11-3-5">
<ul class="org-ul">
<li>Method Resolution Order (MRO) (какой метод вызывать из родителей) changes dynamically to support cooperative
calls to super()   (<b>class._<sub>mro</sub>__</b>) (obj._<sub>class</sub>__._<sub>mro</sub>__)</li>
</ul>


<p>
_<sub>spam</sub> textually replaced with _classname_<sub>spam</sub> - в родительском классе при наследовании
</p>
</div>
</div>

<div id="outline-container-org5622815" class="outline-4">
<h4 id="org5622815"><span class="section-number-4">11.3.6.</span> Abstract class (ABC - abstract base class)</h4>
<div class="outline-text-4" id="text-11-3-6">
<ul class="org-ul">
<li><a href="https://www.python.org/dev/peps/pep-3119/">https://www.python.org/dev/peps/pep-3119/</a></li>
<li>Numbers <a href="https://www.python.org/dev/peps/pep-3141/">https://www.python.org/dev/peps/pep-3141/</a></li>
<li>abc <a href="https://docs.python.org/3/library/abc.html">https://docs.python.org/3/library/abc.html</a></li>
</ul>

<p>
Notes:
</p>
<ul class="org-ul">
<li>Dynamically adding abstract methods to a class, or attempting to modify the abstraction status of
a method or class once it is created, are not supported.</li>
</ul>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">from</span> abc <span style="color: #8ac6f2; font-weight: bold;">import</span> ABCMeta

<span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">MyABC</span>(metaclass=ABCMeta):
    <span style="color: #92a65e; font-weight: bold;">@abstractmethod</span>
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">foo</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>): <span style="color: #8ac6f2; font-weight: bold;">pass</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">or</span>
<span style="color: #8ac6f2; font-weight: bold;">from</span> abc <span style="color: #8ac6f2; font-weight: bold;">import</span> ABC

<span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">MyABC</span>(ABC):
    <span style="color: #92a65e; font-weight: bold;">@abstractmethod</span>
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">foo</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>): <span style="color: #8ac6f2; font-weight: bold;">pass</span>

<span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">B</span>(A):
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">__init__</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>, first_name, last_name, salary):
        <span style="color: #e5786d;">super</span>().__init__(first_name, last_name) <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">if A has __init__</span>
        <span style="color: #8ac6f2; font-weight: bold;">self</span>.<span style="color: #cae682;">salary</span> = salary
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">foo</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>):
        <span style="color: #8ac6f2; font-weight: bold;">return</span> true
</pre>
</div>
</div>
</div>

<div id="outline-container-org03bbacd" class="outline-4">
<h4 id="org03bbacd"><span class="section-number-4">11.3.7.</span> Virtual sublasses</h4>
<div class="outline-text-4" id="text-11-3-7">
<p>
Virtual subclass - subclass and their descendants of ABC. Made with <span class="underline">register</span> method which overloading
 isinstance() and issubclass()
</p>

<pre class="example">
class MyABC(metaclass=ABCMeta):    pass
MyABC.register(tuple)
assert issubclass(tuple, MyABC) # tuple is virtual subclass of MyABC now
</pre>
</div>
</div>
<div id="outline-container-org76751a5" class="outline-4">
<h4 id="org76751a5"><span class="section-number-4">11.3.8.</span> calling parent class constructor</h4>
</div>
</div>
<div id="outline-container-org94b7cb3" class="outline-3">
<h3 id="org94b7cb3"><span class="section-number-3">11.4.</span> Getters and setters <a id="org7faf470"></a></h3>
<div class="outline-text-3" id="text-11-4">
<ul class="org-ul">
<li>no private variables</li>
</ul>

<p>
<b>@property</b> - pythonic way
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">Celsius</span>:
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">__init__</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>, temperature = 0):
        <span style="color: #8ac6f2; font-weight: bold;">self</span>.<span style="color: #cae682;">temperature</span> = temperature

    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">to_fahrenheit</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>):
        <span style="color: #8ac6f2; font-weight: bold;">return</span> (<span style="color: #8ac6f2; font-weight: bold;">self</span>.temperature * 1.8) + 32

    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">get_temperature</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>):
        <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"Getting value"</span>)
        <span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #8ac6f2; font-weight: bold;">self</span>._temperature

    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">set_temperature</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>, value):
        <span style="color: #8ac6f2; font-weight: bold;">if</span> value &lt; -273:
            <span style="color: #8ac6f2; font-weight: bold;">raise</span> <span style="color: #92a65e; font-weight: bold;">ValueError</span>(<span style="color: #95e454;">"Temperature below -273 is not possible"</span>)
        <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"Setting value"</span>)
        <span style="color: #8ac6f2; font-weight: bold;">self</span>.<span style="color: #cae682;">_temperature</span> = value

    <span style="color: #cae682;">temperature</span> = <span style="color: #e5786d;">property</span>(get_temperature,set_temperature)

&gt;&gt;&gt; c.temperature
Getting value
0
&gt;&gt;&gt; c.<span style="color: #cae682;">temperature</span> = 37
Setting value


<span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">----------- OR ------</span>
<span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">Celsius</span>:
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">__init__</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>, temperature = 0):
        <span style="color: #8ac6f2; font-weight: bold;">self</span>.<span style="color: #cae682;">temperature</span> = temperature

    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">to_fahrenheit</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>):
        <span style="color: #8ac6f2; font-weight: bold;">return</span> (<span style="color: #8ac6f2; font-weight: bold;">self</span>.temperature * 1.8) + 32

    @<span style="color: #e5786d;">property</span>
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">temperature</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>):
        <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"Getting value"</span>)
        <span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #8ac6f2; font-weight: bold;">self</span>._temperature

    <span style="color: #92a65e; font-weight: bold;">@temperature.setter</span>
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">temperature</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>, value):
        <span style="color: #8ac6f2; font-weight: bold;">if</span> value &lt; -273:
            <span style="color: #8ac6f2; font-weight: bold;">raise</span> <span style="color: #92a65e; font-weight: bold;">ValueError</span>(<span style="color: #95e454;">"Temperature below -273 is not possible"</span>)
        <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"Setting value"</span>)
        <span style="color: #8ac6f2; font-weight: bold;">self</span>.<span style="color: #cae682;">_temperature</span> = value

</pre>
</div>
</div>
</div>
<div id="outline-container-orge089499" class="outline-3">
<h3 id="orge089499"><span class="section-number-3">11.5.</span> Polymorphism [pɔlɪˈmɔːfɪzm</h3>
<div class="outline-text-3" id="text-11-5">
<p>
<b>inheritance for shared behavior, not for polymorphism</b>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">Square</span>(<span style="color: #e5786d;">object</span>):
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">draw</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>, canvas): <span style="color: #8ac6f2; font-weight: bold;">pass</span>

<span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">Circle</span>(<span style="color: #e5786d;">object</span>):
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">draw</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>, canvas): <span style="color: #8ac6f2; font-weight: bold;">pass</span>

<span style="color: #cae682;">shapes</span> = [Square(), Circle()]
<span style="color: #8ac6f2; font-weight: bold;">for</span> shape <span style="color: #8ac6f2; font-weight: bold;">in</span> shapes:
    shape.draw(<span style="color: #95e454;">'canvas'</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-org55b1787" class="outline-3">
<h3 id="org55b1787"><span class="section-number-3">11.6.</span> Protocols or emulation</h3>
<div class="outline-text-3" id="text-11-6">
<ul class="org-ul">
<li><a href="https://docs.python.org/3/reference/datamodel.html">https://docs.python.org/3/reference/datamodel.html</a></li>
</ul>
<p>
Это переопределение скрытых методов, которые позволяют использовать класс в конструкциях.
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Protocol</th>
<th scope="col" class="org-left">Methods</th>
<th scope="col" class="org-left">Supports syntax</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Sequence</td>
<td class="org-left">slice in <span class="underline"><span class="underline">getitem</span></span> etc.</td>
<td class="org-left">seq[1:2]</td>
</tr>

<tr>
<td class="org-left">Iterators</td>
<td class="org-left">_<sub>iter</sub>__, next</td>
<td class="org-left">for x in coll:</td>
</tr>

<tr>
<td class="org-left">Comparision</td>
<td class="org-left">_<sub>eq</sub>__, <span class="underline"><span class="underline">gt</span></span> etc.</td>
<td class="org-left">x == y, x &gt; y</td>
</tr>

<tr>
<td class="org-left">Numeric</td>
<td class="org-left">_<sub>add</sub>__, <span class="underline"><span class="underline">sub</span></span>, <span class="underline"><span class="underline">and</span></span>, etc.</td>
<td class="org-left">x+y, x-y, x&amp;y ..</td>
</tr>

<tr>
<td class="org-left">String like</td>
<td class="org-left">_<sub>str</sub>__, <span class="underline"><span class="underline">unicode</span></span>, <span class="underline"><span class="underline">repr</span></span></td>
<td class="org-left">print(x)</td>
</tr>

<tr>
<td class="org-left">Attribute access</td>
<td class="org-left">_<sub>getattr</sub>__, <span class="underline"><span class="underline">setattr</span></span></td>
<td class="org-left">obj.attr</td>
</tr>

<tr>
<td class="org-left">Context managers</td>
<td class="org-left">_<sub>enter</sub>__, <span class="underline"><span class="underline">exit</span></span></td>
<td class="org-left">with open('a.txt') as f:f.read()</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org42fdd14" class="outline-3">
<h3 id="org42fdd14"><span class="section-number-3">11.7.</span> private and protected</h3>
<div class="outline-text-3" id="text-11-7">
<ul class="org-ul">
<li>public - all</li>
<li>Protected: _property</li>
<li>Provate: _<sub>property</sub></li>
</ul>
</div>
</div>
<div id="outline-container-org734c1e2" class="outline-3">
<h3 id="org734c1e2"><span class="section-number-3">11.8.</span> object</h3>
<div class="outline-text-3" id="text-11-8">
<p>
object() or object - base for all clases
</p>

<p>
dir(object())
</p>

<p>
['<span class="underline"><span class="underline">class</span></span>', '<span class="underline"><span class="underline">delattr</span></span>', '<span class="underline"><span class="underline">dir</span></span>', '<span class="underline"><span class="underline">doc</span></span>', '<span class="underline"><span class="underline">eq</span></span>', '<span class="underline"><span class="underline">format</span></span>', '<span class="underline"><span class="underline">ge</span></span>', '<span class="underline"><span class="underline">getattribute</span></span>',
'<span class="underline"><span class="underline">gt</span></span>', '<span class="underline"><span class="underline">hash</span></span>', '<span class="underline"><span class="underline">init</span></span>', '<span class="underline"><span class="underline">init<sub>subclass</sub></span></span>', '<span class="underline"><span class="underline">le</span></span>', '<span class="underline"><span class="underline">lt</span></span>', '<span class="underline"><span class="underline">ne</span></span>', '<span class="underline"><span class="underline">new</span></span>', '<span class="underline"><span class="underline">reduce</span></span>',
'<span class="underline"><span class="underline">reduce<sub>ex</sub></span></span>', '<span class="underline"><span class="underline">repr</span></span>', '<span class="underline"><span class="underline">setattr</span></span>', '<span class="underline"><span class="underline">sizeof</span></span>', '<span class="underline"><span class="underline">str</span></span>', '<span class="underline"><span class="underline">subclasshook</span></span>']
</p>

<ul class="org-ul">
<li>_<sub>dict</sub>__ − Dictionary containing the class's namespace.</li>
<li>_<sub>doc</sub>__ - docstring</li>
<li>_<sub>init</sub>__ - constructor</li>
<li>_<sub>str</sub>__ - toString() - Return a string version of object</li>
<li>_<sub>name</sub>_ - Class name</li>
<li>_<sub>module</sub>__ - Module name in which the class is defined. This attribute is "<span class="underline"><span class="underline">main</span></span>" in interactive mode.</li>
<li>_<sub>bases</sub>__ − A possibly empty tuple containing the base classes, in the order of their occurrence in the base class list.</li>
<li>_<sub>hash</sub>__' - hashcode()</li>
<li>_<sub>repr</sub>__ - string printable representation of an object</li>
</ul>
</div>
</div>

<div id="outline-container-orgf947ab0" class="outline-3">
<h3 id="orgf947ab0"><span class="section-number-3">11.9.</span> Singleton</h3>
<div class="outline-text-3" id="text-11-9">
<ul class="org-ul">
<li>simple</li>
<li>отложенный</li>
<li>Singleton на уровне модуля - Все модули по умолчанию являются синглетонами</li>
</ul>
</div>
<div id="outline-container-orgbe0782b" class="outline-4">
<h4 id="orgbe0782b"><span class="section-number-4">11.9.1.</span> example</h4>
<div class="outline-text-4" id="text-11-9-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">Singleton</span>(<span style="color: #e5786d;">object</span>):
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">__new__</span>(cls):
        <span style="color: #8ac6f2; font-weight: bold;">if</span> <span style="color: #8ac6f2; font-weight: bold;">not</span> <span style="color: #e5786d;">hasattr</span>(cls, <span style="color: #95e454;">'instance'</span>):
            cls.<span style="color: #cae682;">instance</span> = <span style="color: #e5786d;">super</span>(Singleton, cls).__new__(cls)
        <span style="color: #8ac6f2; font-weight: bold;">return</span> cls.instance
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">&#1054;&#1090;&#1083;&#1086;&#1078;&#1077;&#1085;&#1085;&#1099;&#1081; &#1101;&#1082;&#1079;&#1077;&#1084;&#1087;&#1083;&#1103;&#1088; &#1074; Singleton</span>
<span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">Singleton</span>:
    <span style="color: #cae682;">__instance</span> = <span style="color: #e5786d; font-weight: bold;">None</span>
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">__init__</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>):
        <span style="color: #8ac6f2; font-weight: bold;">if</span> <span style="color: #8ac6f2; font-weight: bold;">not</span> Singleton.__instance:
            <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">" __init__ method called.."</span>)
        <span style="color: #8ac6f2; font-weight: bold;">else</span>:
            <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"Instance already created:"</span>, <span style="color: #8ac6f2; font-weight: bold;">self</span>.getInstance())
    @<span style="color: #e5786d;">classmethod</span>
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">getInstance</span>(cls):
        <span style="color: #8ac6f2; font-weight: bold;">if</span> <span style="color: #8ac6f2; font-weight: bold;">not</span> cls.__instance:
            cls.<span style="color: #cae682;">__instance</span> = Singleton()
        <span style="color: #8ac6f2; font-weight: bold;">return</span> cls.__instance
</pre>
</div>
</div>
</div>
<div id="outline-container-org580f17d" class="outline-4">
<h4 id="org580f17d"><span class="section-number-4">11.9.2.</span> шаблон Monostate</h4>
<div class="outline-text-4" id="text-11-9-2">
<p>
чтобы экземпляры имели одно и то же состояние
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">Borg</span>:
   <span style="color: #cae682;">__shared_state</span> = {<span style="color: #95e454;">"1"</span>: <span style="color: #95e454;">"2"</span>}
   <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">__init__</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>):
      <span style="color: #8ac6f2; font-weight: bold;">self</span>.<span style="color: #cae682;">x</span> = 1
      <span style="color: #8ac6f2; font-weight: bold;">self</span>.<span style="color: #e5786d;">__dict__</span> = <span style="color: #8ac6f2; font-weight: bold;">self</span>.__shared_state
      <span style="color: #8ac6f2; font-weight: bold;">pass</span>
<span style="color: #cae682;">b</span> = Borg()
<span style="color: #cae682;">b1</span> = Borg()
b.<span style="color: #cae682;">x</span> = 4
<span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"Borg Object 'b': "</span>, b) <span style="color: #fa8072;">## </span><span style="color: #99968b; font-style: italic;">b and b1 are distinct objects</span>
<span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"Borg Object 'b1': "</span>, b1)
<span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"Object State 'b':"</span>, b.<span style="color: #e5786d;">__dict__</span>)<span style="color: #fa8072;">## </span><span style="color: #99968b; font-style: italic;">b and b1 share same state</span>
<span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"Object State 'b1':"</span>, b1.<span style="color: #e5786d;">__dict__</span>)
&gt;&gt; (<span style="color: #95e454;">"Borg Object 'b': "</span>, &lt;__main__.Borg instance at 0x10baa5a70&gt;)
&gt;&gt; (<span style="color: #95e454;">"Borg Object 'b1': "</span>, &lt;__main__.Borg instance at 0x10baa5638&gt;)
&gt;&gt; (<span style="color: #95e454;">"Object State 'b':"</span>, {<span style="color: #95e454;">'1'</span>: <span style="color: #95e454;">'2'</span>, <span style="color: #95e454;">'x'</span>: 4})
&gt;&gt; (<span style="color: #95e454;">"Object State 'b1':"</span>, {<span style="color: #95e454;">'1'</span>: <span style="color: #95e454;">'2'</span>, <span style="color: #95e454;">'x'</span>: 4})
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org21f0609" class="outline-3">
<h3 id="org21f0609"><span class="section-number-3">11.10.</span> anonumous class</h3>
<div class="outline-text-3" id="text-11-10">
<ul class="org-ul">
<li><a href="https://docs.python.org/3/library/types.html#types.SimpleNamespace">https://docs.python.org/3/library/types.html#types.SimpleNamespace</a></li>
<li><a href="https://docs.python.org/3/library/collections.html#collections.namedtuple">https://docs.python.org/3/library/collections.html#collections.namedtuple</a></li>
</ul>
</div>
<div id="outline-container-orga5608ea" class="outline-4">
<h4 id="orga5608ea"><span class="section-number-4">11.10.1.</span> 1</h4>
<div class="outline-text-4" id="text-11-10-1">
<p>
class Bunch(dict):
    <span class="underline"><span class="underline">getattr</span></span>, <span class="underline"><span class="underline">setattr</span></span> = dict.get, dict._<sub>setitem</sub>__
</p>

<p>
dict(x=1,y=2) or {'x':1,'y':2}
</p>

<p>
Bunch(dict())
</p>
</div>
</div>
</div>
<div id="outline-container-orgaf7db7d" class="outline-3">
<h3 id="orgaf7db7d"><span class="section-number-3">11.11.</span> replace method</h3>
<div class="outline-text-3" id="text-11-11">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">A</span>():
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">cc</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>):
        <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"cc"</span>)

<span style="color: #cae682;">c</span> = A.cc

<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">ff</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>):
    <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"ff"</span>)
    c(<span style="color: #8ac6f2; font-weight: bold;">self</span>)

A.<span style="color: #cae682;">cc</span> = ff
<span style="color: #cae682;">a</span> = A()
a.cc()
</pre>
</div>

<pre class="example">
ff
cc
</pre>



<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">A</span>():
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">cc</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>):
        <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"cc"</span>)

<span style="color: #cae682;">a</span> = A()
<span style="color: #cae682;">c</span> = a.cc

<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">ff</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>):
    <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"ff"</span>)
    c()

A.<span style="color: #cae682;">cc</span> = ff
<span style="color: #cae682;">a</span> = A()
a.cc()
</pre>
</div>

<pre class="example">
ff
cc
</pre>
</div>
</div>
</div>

<div id="outline-container-org108edac" class="outline-2">
<h2 id="org108edac"><span class="section-number-2">12.</span> modules and packages</h2>
<div class="outline-text-2" id="text-12">
<ul class="org-ul">
<li>module - file</li>
<li>package - folder - must have: <span class="underline"><span class="underline">init</span></span>.py to be able to import folder as a module.</li>
<li>_<sub>main</sub>_<sub>.py</sub> - allow to execute folder: python -m folder</li>
</ul>

<p>
module can define
</p>
<ul class="org-ul">
<li>functions</li>
<li>classes</li>
<li>variables</li>
<li>runnable code.</li>
</ul>

<p>
<b>When a module is imported (anyhow) into a script, the code in the top-level portion of a module is executed
only once.</b>
</p>

<p>
Import whole file - обращаться с файлом -
</p>
<pre class="example">
import module1[, module2[,... moduleN]
import support   #just a file support.py

support.print_func("Zara")
</pre>


<p>
Import specific thing from file <b>to access without module</b>
</p>
<pre class="example">
from modname import name1[, name2[, ... nameN]]
from modname import *
</pre>


<p>
_<sub>name</sub>__ - name of this module.
</p>

<p>
<b>Locating Modules</b>:
</p>
<ul class="org-ul">
<li>current dir</li>
<li>PYTHONPATH - shell variable -  list of directories</li>
<li>default path. On UNIX   <i>usr/local/lib/python3</i></li>
</ul>

<p>
build-in functions
</p>
<ul class="org-ul">
<li><b>dir(math)</b> - list of strings containing the names defined by a module or in current</li>
<li><b>locals()</b> - within a function, it will return all the names that can be accessed locally from that function
(dictionary)</li>
<li><b>global()</b> return dictionary type</li>
<li><b>reload(module)</b> reexecute the top-level code of module.</li>
</ul>

<p>
To make all of your functions available when you have imported Phone:
</p>
<pre class="example">
from Pots import Pots
from Isdn import Isdn
from G3 import G3
</pre>


<p>
<b>Main</b>
</p>
<pre class="example">
def main(args):pass
if __name__ == '__main__':  #name of module-namespace. '__main__' for - $python a.py
    import sys
    main(sys.argv)
    quit()
</pre>
</div>
<div id="outline-container-org82f8cf1" class="outline-3">
<h3 id="org82f8cf1"><span class="section-number-3">12.1.</span> module special  attributes (Module level "dunders") [-ʌndə(ɹ)]</h3>
<div class="outline-text-3" id="text-12-1">
<ul class="org-ul">
<li>_<sub>name</sub>__</li>
<li>_<sub>doc</sub>__</li>
<li>_<sub>dict</sub>__ - module’s namespace as a dictionary object</li>
<li>_<sub>file</sub>__ - is the pathname of the file from which the module was loaded, if it was loaded from a file.</li>
<li>_<sub>annotations</sub>__ - optional - dictionary containing variable annotations collected during module body execution</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org1c9f35f" class="outline-2">
<h2 id="org1c9f35f"><span class="section-number-2">13.</span> functions</h2>
<div class="outline-text-2" id="text-13">
<ul class="org-ul">
<li>python does not support method overloading</li>
<li>Можно объявлять функции внутри функций</li>
<li>Функции видят область где они определены, а не где вызваны.</li>
<li>Если функция ничего не возвращает, то возвращает <b>None</b></li>
<li>Функция может возвращать return a, b = (a,b) котороые присваиваются нескольким переменным : a,b =
c()</li>
</ul>
</div>
<div id="outline-container-org5dfac71" class="outline-3">
<h3 id="org5dfac71"><span class="section-number-3">13.1.</span> by value or by reference</h3>
<div class="outline-text-3" id="text-13-1">
<p>
by value:
</p>
<ul class="org-ul">
<li>immutable:
<ul class="org-ul">
<li>strings</li>
<li>integers</li>
<li>tuples</li>
<li>others&#x2026;</li>
</ul></li>
</ul>

<p>
by reference:
</p>
<ul class="org-ul">
<li>muttable:
<ul class="org-ul">
<li>objects</li>
<li>lists, sets, dicts</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-orgb129beb" class="outline-3">
<h3 id="orgb129beb"><span class="section-number-3">13.2.</span> Types of Аргументы функции</h3>
<div class="outline-text-3" id="text-13-2">
<ul class="org-ul">
<li>Positional arguments (first, second, third=None, fourth=None) (first, second) - positional, (third,
fourth) - Keyword arguments</li>
<li>Keyword arguments - printinfo( age = 50, name = "miki" ) - order does not metter</li>
<li>Default arguments -  def printinfo( name, age = 35 ):</li>
<li>Variable-length or Arbitrary Argument Lists positional arguments</li>
</ul>
<pre class="example">
def printinfo( arg1, *vartuple ):
  for var in vartuple:
     print (var)
printinfo (1, 'asd','d31', 'cv')
</pre>

<ul class="org-ul">
<li>Variable-length or Arbitrary Argument Lists Keyword arguments</li>
</ul>
<pre class="example">
def save_ranking(**kwargs):
  print(kwargs)
save_ranking(first='ming', second='alice', fourth='wilson', third='tom', fifth='roy')
&gt;&gt;&gt; {'first': 'ming', 'second': 'alice', 'fourth': 'wilson', 'third': 'tom', 'fifth': 'roy'}
</pre>

<ul class="org-ul">
<li>both</li>
</ul>
<pre class="example">
def save_ranking(*args, **kwargs):
save_ranking('ming', 'alice', 'tom', fourth='wilson', fifth='roy')
</pre>
</div>
</div>
<div id="outline-container-org69420fe" class="outline-3">
<h3 id="org69420fe"><span class="section-number-3">13.3.</span> example</h3>
<div class="outline-text-3" id="text-13-3">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">functionname</span>( parameters:<span style="color: #e5786d;">type</span> ) -&gt; return_type:
   <span style="color: #f08080; font-style: italic;">"function_docstring"</span>
   function_suite
   <span style="color: #8ac6f2; font-weight: bold;">return</span> [expression]


<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">readit</span>(<span style="color: #e5786d;">file</span> :<span style="color: #e5786d;">str</span>, fun :<span style="color: #e5786d;">callable</span>) -&gt;<span style="color: #e5786d;">list</span>:
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf9ad0f3" class="outline-3">
<h3 id="orgf9ad0f3"><span class="section-number-3">13.4.</span> arguments, anonymous-lambda, global variables</h3>
<div class="outline-text-3" id="text-13-4">
<p>
<b>Anonymous Functions</b>: - one-line version of a function
</p>
<pre class="example">
lambda [arg1 [,arg2,.....argn]]:expression
(lambda x, y: x + y)(1, 2)
</pre>


<p>
<b>global variables</b> can be accessesd from all functions (except lambda??? - working in console)
</p>

<pre class="example">
# global Money  # Uncomment to replace local Money to global.
  Money = Money + 1 #local
</pre>
</div>
</div>

<div id="outline-container-org7c653f0" class="outline-3">
<h3 id="org7c653f0"><span class="section-number-3">13.5.</span> attributes</h3>
<div class="outline-text-3" id="text-13-5">
<p>
User-defined function
</p>
<ul class="org-ul">
<li>_<sub>doc</sub>__</li>
<li>_<sub>name</sub>__</li>
<li>_<sub>qualname</sub>__</li>
<li>_<sub>module</sub>__</li>
<li>_<sub>defaults</sub>__</li>
<li>_<sub>code</sub>__</li>
<li>_<sub>globals</sub>__</li>
<li>_<sub>dict</sub>__</li>
<li>_<sub>closure</sub>__</li>
<li>_<sub>annotations</sub>__</li>
<li><p>
_<sub>kwdefaults</sub>__
</p>

<p>
Instance methods: read-only attributes:
</p></li>
<li>_<sub>self</sub>__ - class instance object</li>
<li>_<sub>func</sub>__ - function object</li>
<li>_<sub>module</sub>__ - name of the module the method was defined in</li>
</ul>
</div>
</div>
<div id="outline-container-orgff77067" class="outline-3">
<h3 id="orgff77067"><span class="section-number-3">13.6.</span> function decorators</h3>
<div class="outline-text-3" id="text-13-6">
<ul class="org-ul">
<li><a href="https://docs.python.org/3/glossary.html#term-decorator">https://docs.python.org/3/glossary.html#term-decorator</a></li>
<li><a href="https://www.thecodeship.com/patterns/guide-to-python-function-decorators/">https://www.thecodeship.com/patterns/guide-to-python-function-decorators/</a></li>
</ul>
<p>
function that get one function and returning another function
</p>
<ul class="org-ul">
<li>when you need to extend the functionality of functions that you don't want to modify</li>
<li>@classmethod</li>
</ul>

<p>
Typically used to catch exceptions in wrapper
</p>

<div class="org-src-container">
<pre class="src src-python">  <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">p_decorate</span>(f):
     <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">inner</span>(name): <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">wrapper</span>
         <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">do something here!</span>
         f() <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">we call wrapped function</span>
     <span style="color: #8ac6f2; font-weight: bold;">return</span> inner

  <span style="color: #cae682;">my_get_text</span> = p_decorate(get_text) <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">&#1086;&#1073;&#1077;&#1088;&#1090;&#1099;&#1074;&#1072;&#1077;&#1084;, &#1090;&#1077;&#1087;&#1077;&#1088;&#1100;</span>
  my_get_text(<span style="color: #95e454;">"John"</span>) <span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">&#1086; &#1073;&#1077;&#1088;&#1090;&#1082;&#1072; &#1074;&#1077;&#1088;&#1085;&#1077;&#1090; &#1080; &#1074;&#1099;&#1079;&#1086;&#1074;&#1077;&#1090; &#1074;&#1083;&#1086;&#1078;&#1077;&#1085;&#1085;&#1091;&#1102;</span>

  <span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">syntactic sugar</span>
  <span style="color: #92a65e; font-weight: bold;">@p_decorate</span>
  <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">get_text</span>(name):
     <span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #95e454;">"bla "</span> + name

  <span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">-------------</span>
  <span style="color: #cae682;">get_text</span> = div_decorate(p_decorate(strong_decorate(get_text)))
  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Equal to</span>
  <span style="color: #92a65e; font-weight: bold;">@div_decorate</span>
  <span style="color: #92a65e; font-weight: bold;">@p_decorate</span>
  <span style="color: #92a65e; font-weight: bold;">@strong_decorate</span>

  <span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">-------------- Passing arguments to decorators ------</span>
  <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">tags</span>(tag_name):
      <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">tags_decorator</span>(func):
          <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">func_wrapper</span>(name):
              <span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #95e454;">"&lt;{0}&gt;{1}&lt;/{0}&gt;"</span>.<span style="color: #e5786d;">format</span>(tag_name, func(name))
          <span style="color: #8ac6f2; font-weight: bold;">return</span> func_wrapper
      <span style="color: #8ac6f2; font-weight: bold;">return</span> tags_decorator

  <span style="color: #92a65e; font-weight: bold;">@tags</span>(<span style="color: #95e454;">"p"</span>)
  <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">get_text</span>(name):
      <span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #95e454;">"Hello "</span>+name
  <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">get_text</span>(name):
</pre>
</div>
</div>
</div>
<div id="outline-container-org7e23248" class="outline-3">
<h3 id="org7e23248"><span class="section-number-3">13.7.</span> build-in</h3>
<div class="outline-text-3" id="text-13-7">
<p>
<a href="https://docs.python.org/3/library/functions.html">https://docs.python.org/3/library/functions.html</a>
</p>
<dl class="org-dl">
<dt>abs(x)</dt><dd>absolute value</dd>
<dt>all(iterable)</dt><dd>all elements of the iterable are true or empty = true</dd>
<dt>any(iterable)</dt><dd>any element is true or empty = false</dd>
<dt>ascii(object)</dt><dd>printable representation of an object</dd>
<dt>breakpoint(*args, **kws)</dt><dd>drops you into the debugger at the call site. calls sys.breakpointhook() which
calls calls pdb.set<sub>trace</sub>()</dd>
<dt>callable(object)</dt><dd>if the object - callable type - true. (classes are callable )</dd>
<dt>@classmethod</dt><dd>function decorator. May be called for class C.f() or for instance C().f() For derived class
derived class object is passed as the implied first argument.</dd>
</dl>
<pre class="example">
class C:
   @classmethod
   def f(cls, arg1, arg2, ...): ...
</pre>

<dl class="org-dl">
<dt>compile(source, filename, mode, flags=0, dont<sub>inherit</sub>=False, optimize=-1)</dt><dd>into code or AST object - can
be executed by exec() or eval(). Mode - 'exec' if source consists of a sequence of statements. 'eval' if
it consists of a single expression</dd>
<dt>delattr(object, name)</dt><dd>like setattr() - delattr(x, 'foobar') is equivalent to del x.foobar.</dd>
<dt>divmod(a, b)</dt><dd>ab-two (non complex) numbers =  quotient and remainder when using integer division</dd>
<dt>enumerate(iterable, start=0)</dt><dd>return iterator which returns tuple (0, arg1), (1,arg1) ..</dd>
<dt>eval(expression, globals=None, locals=None)</dt><dd>string is parsed and evaluated as a Python expression .  The
globals() and locals() functions returns the current global and local dictionary, respectively, which may
be useful to pass around for use by eval() or exec().</dd>
<dt>exec(object[, globals[, locals]])</dt><dd>object must be either a string or a code object. Be aware that the
return and yield statements may not be used outside of function definitions even within the context of
code passed to the exec() function. The return value is None.</dd>
<dt>filter(function, iterable)</dt><dd>Construct an iterator from those elements of iterable for which function returns true.</dd>
<dt>getattr(object, name[, default])</dt><dd>eturn the value of the named attribute of object.  <i>name</i> must be a
string or <i>AttributeError</i> is raised</dd>
<dt>setattr(object, name, value)</dt><dd>assigns the value to the attribute, provided the object allows it</dd>
<dt>globals()</dt><dd>dictionary representing the current global symbol table (inside a function or method, this is
the module where it is defined, not the module from which it is called)x</dd>
<dt>hasattr(object, string name)</dt><dd>result is True if the string is the name of one of the object’s attributes, False if not</dd>
<dt>hash(object)</dt><dd>Hash values are integers. Object _<sub>hash</sub>_<sub>()</sub> method.</dd>
<dt>id(object)</dt><dd>“identity” of an object - integer. Unique and constant during life time. Two objects with
non-overlapping lifetimes may have the same id() value.</dd>
<dt>isinstance(object, classinfo)</dt><dd>True if object is an instance of the classinfo argument.</dd>
<dt>issubclass(class, classinfo)</dt><dd>true if <span class="underline">class</span> is a subclass of <span class="underline">classinfo</span>.  class is considered a subclass
of itself</dd>
<dt>iter(object[, sentinel])</dt><dd>1) Return an iterator object. _<sub>iter</sub>_<sub>()</sub> or _<sub>getitem</sub>_<sub>()</sub> 2) object must be a
callable object _<sub>next</sub>_<sub>()</sub> if the value returned is equal to sentinel, StopIteration will be raised</dd>
<dt>next(iterator[, default])</dt><dd>_<sub>next</sub>_<sub>()</sub> If <b>default</b> is given, it is returned if the iterator is exhausted</dd>
<dt>len(s)</dt><dd>.</dd>
<dt>map(function, iterable, &#x2026;)</dt><dd>Return an iterator that applies function to every item of iterable. May be
applied in parallel to may iterable.</dd>
<dt>max/min(iterable, *[, key, default])</dt><dd>.</dd>
<dt>max/min(arg1, arg2, *args[, key])</dt><dd>largest item in an iterable or the largest of two or more arguments</dd>
<dt>memoryview(obj)</dt><dd>memory view” object</dd>
<dt>pow(x, y[, z])</dt><dd>(x** y) % z</dd>
<dt>repr(object)</dt><dd>_<sub>repr</sub>_<sub>()</sub> method - printable representation of an object</dd>
<dt>reversed(seq)</dt><dd>_<sub>reversed</sub>_<sub>()</sub> method or support <b>sequence protocol</b> (the _<sub>len</sub>_<sub>()</sub> method and the
_<sub>getitem</sub>_<sub>()</sub></dd>
<dt>round(number[, ndigits])</dt><dd>number rounded to ndigits precision after the decimal point</dd>
<dt>sorted(iterable, *, key=None, reverse=False)</dt><dd>sorted list []  from the items in iterable</dd>
<dt>@staticmethod</dt><dd>method into a static method.</dd>
<dt>sum(iterable[, start])</dt><dd>returns the total</dd>
<dt>super([type[, object-or-type]])</dt><dd>Return a proxy object that delegates method calls to a parent/parents or sibling class of type</dd>
<dt>vars([object])</dt><dd>_<sub>dict</sub>__ attribute for a module, class, instance, or any other object</dd>
<dt>zip(*iterables)</dt><dd>Make an iterator of tuples that aggregates elements from each of the iterables.
<ul class="org-ul">
<li>list(zip([1, 2, 3],[1, 2, 3])) = [(1, 1), (2, 2), (3, 3)]</li>
<li>unzip: list(zip(*zip([1, 2, 3],[1, 2, 3]))) = [(1, 2, 3), (1, 2, 3)]</li>
</ul></dd>
<dt>_<sub>import</sub>_<sub>(name, globals=None, locals=None, fromlist=(), level=0)</sub></dt><dd>not needed in everyday Python
programming</dd>
</dl>
<hr />
<dl class="org-dl">
<dt>class bool([x])</dt><dd>standard truth testing procedure see <a href="#org795df65">8.4</a></dd>
<dt>class bytearray([source[, encoding[, errors]]])</dt><dd>-mutable If it is a string, you must also give the
encoding - it will use str.encode()</dd>
<dt>class bytes([source[, encoding[, errors]]])</dt><dd>-immutable</dd>
<dt>class complex([real[, imag]])</dt><dd>complex('1+2j'). - default - 0j</dd>
<dt>class dict(**kwarg)</dt><dd>dict(one=1, two=2, three=3) = {'one': 1, 'two': 2, 'three': 3}; dict([('two', 2),
('one', 1), ('three', 3)])</dd>
<dt>class dict(mapping, **kwarg)</dt><dd>????</dd>
<dt>class dict(iterable, **kwarg)</dt><dd>dict(zip(['one', 'two', 'three'], [1, 2, 3]))</dd>
<dt>class float([x])</dt><dd>from a number or string x.</dd>
<dt>class frozenset([iterable])</dt><dd>see <a href="#org5d1bb12">8.3</a>.</dd>
<dt>class int([x])</dt><dd>x._<sub>int</sub>_<sub>()</sub> or x._<sub>trunc</sub>_<sub>()</sub>.</dd>
<dt>class int(x, base=10)</dt><dd>.</dd>
<dt>class list([iterable])</dt><dd>.</dd>
<dt>class object</dt><dd>Return a new featureless object.</dd>
<dt>class property(fget=None, fset=None, fdel=None, doc=None)</dt><dd></dd>

<dt>class range(stop)</dt><dd></dd>

<dt>class range(start, stop[, step])</dt><dd>immutable sequence type</dd>
<dt>class set([iterable])</dt><dd>.</dd>
<dt>class slice(stop)</dt><dd>.</dd>
<dt>class str(object='')</dt><dd>.</dd>
<dt>class str(object=b'', encoding='utf-8', errors='strict')</dt><dd>.</dd>
<dt>tuple([iterable])</dt><dd>.</dd>
<dt>class type(object)</dt><dd>object._<sub>class</sub>__</dd>
<dt>class type(name, bases, dict)</dt><dd>.</dd>
</dl>

<hr />
<dl class="org-dl">
<dt>input([prompt])</dt><dd>return input input from stdin.</dd>
<dt>open(file, mode='r', buffering=-1, encoding=None, errors=None, newline=None, closefd=True, opener=None)</dt><dd>Open
file and return a corresponding file object.</dd>
<dt>print(*objects, sep=' ', end='\n', file=sys.stdout, flush=False)</dt><dd>to file or sys.stdout</dd>
<dt>dir([object])</dt><dd>list of valid attributes for that object. or list of names in the current local
scope. _<sub>dir</sub>_<sub>()</sub> - method called - dir() - Is supplied primarily as a convenience for use at
an interactive prompt</dd>
<dt>help([object])</dt><dd>built-in help system</dd>
<dt>locals()</dt><dd>the current local symbol table</dd>
</dl>
<hr />
<dl class="org-dl">
<dt>bin(x)</dt><dd>bin(3) -&gt; '0b11'</dd>
<dt>chr(i)</dt><dd>Return the string representing a character = i - Unicode code</dd>
<dt>hex(x)</dt><dd>hex(255) = '0xff'</dd>
<dt>format(value[, format<sub>spec</sub>])</dt><dd><a href="https://docs.python.org/3/library/string.html#formatspec">https://docs.python.org/3/library/string.html#formatspec</a></dd>
<dt>oct(x)</dt><dd>Convert an integer number to an octal string prefixed with “0o”.</dd>
<dt>ord(c)</dt><dd>c - string representing one Unicode character. Return integer.</dd>
</dl>
</div>
</div>
<div id="outline-container-org9ab24d5" class="outline-3">
<h3 id="org9ab24d5"><span class="section-number-3">13.8.</span> Closure</h3>
<div class="outline-text-3" id="text-13-8">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">compose_greet_func</span>(name):
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">get_message</span>():
        <span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #95e454;">"Hello there "</span>+name+<span style="color: #95e454;">"!"</span>

    <span style="color: #8ac6f2; font-weight: bold;">return</span> get_message

<span style="color: #cae682;">greet</span> = compose_greet_func(<span style="color: #95e454;">"John"</span>)
<span style="color: #e5786d;">print</span>(greet())
</pre>
</div>
</div>
</div>
<div id="outline-container-org50fddb3" class="outline-3">
<h3 id="org50fddb3"><span class="section-number-3">13.9.</span> overloading</h3>
<div class="outline-text-3" id="text-13-9">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">from</span> functools <span style="color: #8ac6f2; font-weight: bold;">import</span> singledispatch

<span style="color: #92a65e; font-weight: bold;">@singledispatch</span>
<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">func</span>(arg1, arg2):
    <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"default implementation of func - "</span>, arg1, arg2)

<span style="color: #92a65e; font-weight: bold;">@func.register</span>
<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">func_impl_1</span>(arg1: <span style="color: #e5786d;">str</span>, arg2):
    <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"Implementation of func with first argument as string - "</span>, arg1, arg2)

<span style="color: #92a65e; font-weight: bold;">@func.register</span>
<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">func_impl_2</span>(arg1: <span style="color: #e5786d;">int</span>, arg2):
    <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"Implementation of func with first argument as int - "</span>, arg1, arg2)


func(1, <span style="color: #95e454;">"hello"</span>)
func(<span style="color: #95e454;">"test"</span>, <span style="color: #95e454;">"hello"</span>)
func(1.34, <span style="color: #95e454;">"hi"</span>)

</pre>
</div>

<pre class="example">
Implementation of func with first argument as int -  1 hello
Implementation of func with first argument as string -  test hello
default implementation of func -  1.34 hi
</pre>
</div>
</div>
</div>

<div id="outline-container-org67e3e77" class="outline-2">
<h2 id="org67e3e77"><span class="section-number-2">14.</span> asterisk(*)</h2>
<div class="outline-text-2" id="text-14">
<ol class="org-ol">
<li>For multiplication and power operations.
<ul class="org-ul">
<li>2*3 = 6</li>
<li>2**3 = 8</li>
</ul></li>
<li>For repeatedly extending the list-type containers.
<ul class="org-ul">
<li>(0,) * 100</li>
</ul></li>
<li>For using the variadic arguments. "Packaging"  - def save<sub>ranking</sub>(*args, **kwargs):
<ul class="org-ul">
<li>*args - tuple</li>
<li>**kwargs - dict</li>
</ul></li>
<li>For unpacking the containers.(so-called “unpacking”) чтобы передать список в  variadic arguments</li>
</ol>
<pre class="example">
def product(*numbers):
product(*[2, 3, 5, 7, 11, 13])
</pre>


<ol class="org-ol">
<li>for arguments of function. all after * - keyword ony, after / - positional or keyword only</li>
</ol>
<pre class="example">
def another_strange_function(a, b, /, c, *, d):
</pre>
</div>
</div>
<div id="outline-container-org9d83715" class="outline-2">
<h2 id="org9d83715"><span class="section-number-2">15.</span> with</h2>
<div class="outline-text-2" id="text-15">
<p>
with ContexManager() as c1, ContexManager() as c2:
</p>
</div>

<div id="outline-container-org504ef4e" class="outline-3">
<h3 id="org504ef4e"><span class="section-number-3">15.1.</span> Context manager class TEMPLATE</h3>
<div class="outline-text-3" id="text-15-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">DatabaseConnection</span>(<span style="color: #e5786d;">object</span>):
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">__enter__</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>):
        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">make a database connection and return it</span>
        ...
        <span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #8ac6f2; font-weight: bold;">self</span>.dbconn

    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">__exit__</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>, exc_type, exc_val, exc_tb):
        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">make sure the dbconnection gets closed</span>
        <span style="color: #8ac6f2; font-weight: bold;">self</span>.dbconn.close()
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org03dcb90" class="outline-2">
<h2 id="org03dcb90"><span class="section-number-2">16.</span> Operators and control structures</h2>
<div class="outline-text-2" id="text-16">
<p>
Ternary operation:    a if condition else b
</p>
</div>
<div id="outline-container-org5ecadba" class="outline-3">
<h3 id="org5ecadba"><span class="section-number-3">16.1.</span> basic</h3>
<div class="outline-text-3" id="text-16-1">
<p>
<b>Arithmetic</b>
</p>
<ul class="org-ul">
<li>+ - *</li>
<li>/ - 9/2 = 4,5 - Division</li>
<li>% - 9%2 = 1 - Modulus - returns remainder</li>
<li>** - Exponent</li>
<li>// - Floor Division 9 //2 = 4     -9/2 = -5</li>
<li>+= -= *= /= %= **= //=</li>
</ul>


<p>
<b>Comparison</b>
<code>= !</code> &lt;&gt; &gt; &lt; &gt;= &lt;=
</p>

<p>
<b>Bitwise</b>
</p>
<ul class="org-ul">
<li>&amp;</li>
<li>|</li>
<li>^ - XOR</li>
<li>~ - ~a  = 1100 0011</li>
<li>&lt;&lt; - a&lt;&lt;2 = 1111 0000</li>
<li>&gt;&gt;</li>
</ul>

<p>
<b>Logical</b> - AND - OR - NOT
</p>

<p>
<b>Membership</b> - in,  not in
</p>

<p>
<b>Identity Operators</b> ( point to the same object) - is,  is not
</p>
</div>
</div>

<div id="outline-container-orgb2161a9" class="outline-3">
<h3 id="orgb2161a9"><span class="section-number-3">16.2.</span> Operator Precedence (Приоритет) <i>ˈpresədəns</i></h3>
<div class="outline-text-3" id="text-16-2">
<p>
<a href="https://docs.python.org/3/reference/expressions.html#operator-precedence">https://docs.python.org/3/reference/expressions.html#operator-precedence</a>
</p>

<ol class="org-ol">
<li>Binding or parenthesized expression, list display, dictionary display, set display
<ul class="org-ul">
<li>(expressions&#x2026;),</li>
<li>[expressions&#x2026;], {key: value&#x2026;}, {expressions&#x2026;}</li>
</ul></li>
<li>Subscription, slicing, call, attribute reference
<ul class="org-ul">
<li>x[index], x[index:index], x(arguments&#x2026;), x.attribute</li>
</ul></li>
<li>await x - Await expression</li>
<li>** - Exponentiation [5]</li>
<li>+x, -x, ~x - Positive, negative, bitwise NOT</li>
<li>*, @, <i>, /</i>, % - Multiplication, matrix multiplication, division, floor division, remainder [6]</li>
<li>+, - - Addition and subtraction</li>
<li>&lt;&lt;, &gt;&gt; - Shifts</li>
<li>&amp; - Bitwise AND</li>
<li>^ - Bitwise XOR</li>
<li>| - Bitwise OR</li>
<li>in, not in, is, is not, &lt;, &lt;=, &gt;, &gt;=, !=, == - Comparisons, including membership tests and identity tests</li>
<li>not x - Boolean NOT</li>
<li>and - Boolean AND</li>
<li>or - Boolean OR</li>
<li>if – else - Conditional expression</li>
<li>lambda - Lambda expression</li>
<li>:= - Assignment expression</li>
</ol>

<p>
old:
</p>
<ol class="org-ol">
<li>**</li>
<li>~ + - unary</li>
<li>* / % //</li>
<li>+ -</li>
<li>&gt;&gt; &lt;&lt;</li>
<li>&amp;</li>
<li>^ |</li>
<li>&lt;= &lt; &gt; &gt;=</li>
<li>&lt;&gt; <code>= !</code> Equality operators</li>
<li>= %= /= //= -= += *= **= Assignment operators</li>
<li>is is not</li>
<li>in not in</li>
<li>not or and - Logical operators</li>
</ol>
</div>
</div>

<div id="outline-container-org6b0f224" class="outline-3">
<h3 id="org6b0f224"><span class="section-number-3">16.3.</span> value unpacking</h3>
<div class="outline-text-3" id="text-16-3">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #cae682;">x</span>=(<span style="color: #95e454;">"v1"</span>, <span style="color: #95e454;">"v2"</span>)
<span style="color: #cae682;">a</span>,<span style="color: #cae682;">b</span> = x
<span style="color: #e5786d;">print</span> a,b
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">v1 v2</span>

<span style="color: #cae682;">T</span>=(1,)
<span style="color: #cae682;">b</span>,=T
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">b= 1</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbb349b3" class="outline-3">
<h3 id="orgbb349b3"><span class="section-number-3">16.4.</span> if, loops</h3>
<div class="outline-text-3" id="text-16-4">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">if</span> expression1:
    statement(s)
<span style="color: #8ac6f2; font-weight: bold;">elif</span> statement(s):
    statement(s)

<span style="color: #8ac6f2; font-weight: bold;">while</span> expression:
   statement(s)

<span style="color: #8ac6f2; font-weight: bold;">while</span> count &lt; 5:
   <span style="color: #e5786d;">print</span> count, <span style="color: #95e454;">" is  less than 5"</span>
   <span style="color: #cae682;">count</span> = count + 1
<span style="color: #8ac6f2; font-weight: bold;">else</span>:  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">when the condition becomes false or at the end</span>
   <span style="color: #e5786d;">print</span> count, <span style="color: #95e454;">" is not less than 5"</span>

<span style="color: #8ac6f2; font-weight: bold;">for</span> iterating_var <span style="color: #8ac6f2; font-weight: bold;">in</span> sequence:
   statements(s)
<span style="color: #8ac6f2; font-weight: bold;">else</span>: <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">when no break encountered</span>
   <span style="color: #e5786d;">print</span> num, <span style="color: #95e454;">'is a prime number'</span>


<span style="color: #8ac6f2; font-weight: bold;">break</span> <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Terminates the loop</span>
<span style="color: #8ac6f2; font-weight: bold;">continue</span> <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">skip the remainder</span>
<span style="color: #8ac6f2; font-weight: bold;">pass</span> <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">null operation - just stupid empty operator - nothing else.</span>

<span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">Compcat loops, double loop</span>
[<span style="color: #e5786d;">print</span>(x,y) <span style="color: #8ac6f2; font-weight: bold;">for</span> x <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">range</span>(1000) <span style="color: #8ac6f2; font-weight: bold;">for</span> y <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">range</span>(x, <span style="color: #e5786d;">len</span>(<span style="color: #e5786d;">range</span>(1000)))]
[g <span style="color: #8ac6f2; font-weight: bold;">for</span> g <span style="color: #8ac6f2; font-weight: bold;">in</span> [x[<span style="color: #95e454;">'whole_word_timestamps'</span>] <span style="color: #8ac6f2; font-weight: bold;">for</span> x <span style="color: #8ac6f2; font-weight: bold;">in</span> whisper_stable_result]] <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">list created everyloop</span>

<span style="color: #8ac6f2; font-weight: bold;">for</span> item <span style="color: #8ac6f2; font-weight: bold;">in</span> array: array2.append (item)
</pre>
</div>
</div>
</div>

<div id="outline-container-orge2308ec" class="outline-3">
<h3 id="orge2308ec"><span class="section-number-3">16.5.</span> match 3.10</h3>
<div class="outline-text-3" id="text-16-5">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #cae682;">command</span> = <span style="color: #e5786d;">input</span>(<span style="color: #95e454;">"What are you doing next? "</span>)

<span style="color: #8ac6f2; font-weight: bold;">match</span> command.split():
    <span style="color: #8ac6f2; font-weight: bold;">case</span> [action]:
        ... <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">interpret single-verb action</span>
    <span style="color: #8ac6f2; font-weight: bold;">case</span> [action, obj]:
        ... <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">interpret action, obj</span>
    <span style="color: #8ac6f2; font-weight: bold;">case</span> [<span style="color: #95e454;">"quit"</span>]:
        <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"Goodbye!"</span>)
        quit_game()

</pre>
</div>
</div>
</div>
<div id="outline-container-org4256026" class="outline-3">
<h3 id="org4256026"><span class="section-number-3">16.6.</span> Slicing Sequence</h3>
<div class="outline-text-3" id="text-16-6">
<ul class="org-ul">
<li>a[i:j] - i to j</li>
<li>s[i:j:k] - slice i to j with step k;</li>
</ul>

<p>
s = range(10) - [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
</p>
<ul class="org-ul">
<li>s[-2] - = 8</li>
<li>s[1:] - [1, 2, 3, 4, 5, 6, 7, 8, 9]</li>
<li>s[1::] - [1, 2, 3, 4, 5, 6, 7, 8, 9]</li>
<li>s[:2] - [0, 1]</li>
<li>s[:-2] - [0, 1, 2, 3, 4, 5, 6, 7]</li>
<li>s[-2:] - [8, 9]</li>
<li>s[::2] - [0, 2, 4, 6, 8]</li>
<li>s[::-1] -[9, 8, 7, 6, 5, 4, 3, 2, 1, 0]</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org834b3da" class="outline-2">
<h2 id="org834b3da"><span class="section-number-2">17.</span> Traverse or iteration over containers</h2>
<div class="outline-text-2" id="text-17">
<ul class="org-ul">
<li>see <a href="#orgb78d8da">18.1</a></li>
</ul>
</div>
<div id="outline-container-orgdbc427f" class="outline-3">
<h3 id="orgdbc427f"><span class="section-number-3">17.1.</span> iterator object <a id="org6092d13"></a></h3>
<div class="outline-text-3" id="text-17-1">
<p>
From simple to complex:
</p>
<ol class="org-ol">
<li><b>Iterable</b> - Object that can be used in <b>for</b>, zip, map, in statements - must have _<sub>iter</sub>_<sub>()</sub></li>
<li><b>Iterator</b> - Object with  _<sub>iter</sub>_<sub>()</sub> and _<sub>next</sub>_<sub>()</sub>. iterator is also iterable.</li>
<li><b>generator</b> - method with <b>yield</b> that magically create <b>iterator</b>, usable in next().</li>
</ol>

<p>
built-in methods
</p>
<ul class="org-ul">
<li>iter(object) - create Iterable object from <b>list</b></li>
<li>iter(object, sentinel) - if the value of _<sub>next</sub>_<sub>()</sub> is equal to sentinel, StopIteration will be raised.</li>
<li>next(iterator) - call _<sub>next</sub>_<sub>()</sub> method of object.</li>
<li>next(iterator, default)</li>
</ul>

<p>
Behind the scenes <b>for</b> statement calls <b>iter()</b>- <b>iterator object</b>
</p>
<ul class="org-ul">
<li>_<sub>next</sub>_<sub>()</sub> - when nothig left -  raises a StopIteration exception.</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">remove in loop: https://docs.python.org/3/reference/compound_stmts.html#the-for-statement</span>
<span style="color: #8ac6f2; font-weight: bold;">for</span> f <span style="color: #8ac6f2; font-weight: bold;">in</span> ret[:]:
  ret.remove(f)

<span style="color: #8ac6f2; font-weight: bold;">for</span> element <span style="color: #8ac6f2; font-weight: bold;">in</span> [1, 2, 3]:
    <span style="color: #e5786d;">print</span>(element)
<span style="color: #8ac6f2; font-weight: bold;">for</span> element <span style="color: #8ac6f2; font-weight: bold;">in</span> (1, 2, 3):
    <span style="color: #e5786d;">print</span>(element)
<span style="color: #8ac6f2; font-weight: bold;">for</span> key <span style="color: #8ac6f2; font-weight: bold;">in</span> {<span style="color: #95e454;">'one'</span>:1, <span style="color: #95e454;">'two'</span>:2}:
    <span style="color: #e5786d;">print</span>(key)
<span style="color: #8ac6f2; font-weight: bold;">for</span> char <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #95e454;">"123"</span>:
    <span style="color: #e5786d;">print</span>(char)
<span style="color: #8ac6f2; font-weight: bold;">for</span> line <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">open</span>(<span style="color: #95e454;">"myfile.txt"</span>):
    <span style="color: #e5786d;">print</span>(line, end=<span style="color: #95e454;">''</span>)


<span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">Reverse</span>: <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">add iterator behavior to your classes</span>
    <span style="color: #f08080; font-style: italic;">"""Iterator for looping over a sequence backwards."""</span>
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">__init__</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>, data):
        <span style="color: #8ac6f2; font-weight: bold;">self</span>.<span style="color: #cae682;">data</span> = data
        <span style="color: #8ac6f2; font-weight: bold;">self</span>.<span style="color: #cae682;">index</span> = <span style="color: #e5786d;">len</span>(data)

    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">__iter__</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>):
        <span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #8ac6f2; font-weight: bold;">self</span>

    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">__next__</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>):
        <span style="color: #8ac6f2; font-weight: bold;">if</span> <span style="color: #8ac6f2; font-weight: bold;">self</span>.index == 0:
            <span style="color: #8ac6f2; font-weight: bold;">raise</span> <span style="color: #92a65e; font-weight: bold;">StopIteration</span>
        <span style="color: #8ac6f2; font-weight: bold;">self</span>.<span style="color: #cae682;">index</span> = <span style="color: #8ac6f2; font-weight: bold;">self</span>.index - 1
        <span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #8ac6f2; font-weight: bold;">self</span>.data[<span style="color: #8ac6f2; font-weight: bold;">self</span>.index]

<span style="color: #cae682;">rev</span> = Reverse(<span style="color: #95e454;">'spam'</span>)
<span style="color: #8ac6f2; font-weight: bold;">for</span> char <span style="color: #8ac6f2; font-weight: bold;">in</span> rev:
    <span style="color: #e5786d;">print</span>(char)

<span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">compact form</span>
&gt;&gt;&gt; <span style="color: #cae682;">t</span> = {x: x*x <span style="color: #8ac6f2; font-weight: bold;">for</span> x <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">range</span>(0, 4)}
&gt;&gt;&gt; <span style="color: #e5786d;">print</span>(t)
{0: 0, 1: 1, 2: 4, 3: 9}
</pre>
</div>
</div>
</div>
<div id="outline-container-org526780c" class="outline-3">
<h3 id="org526780c"><span class="section-number-3">17.2.</span> iterate dictionary</h3>
<div class="outline-text-3" id="text-17-2">
<ul class="org-ul">
<li>for key in a<sub>dict</sub>:</li>
<li>for item in a<sub>dict.items</sub>(): - tuple</li>
<li>for key, value in a<sub>dict.items</sub>():</li>
<li>for key in a<sub>dict.keys</sub>():</li>
<li>for value in a<sub>dict.values</sub>():</li>
</ul>

<p>
Since Python 3.6, dictionaries are ordered data structures, so if you use Python 3.6 (and beyond), you’ll be
able to sort the items of any dictionary by using sorted() and with the help of a dictionary comprehension:
</p>
<ul class="org-ul">
<li>sorted<sub>income</sub> = {k: incomes[k] for k in sorted(incomes)}</li>
<li>sorted() - sort keys</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgc3ba443" class="outline-2">
<h2 id="orgc3ba443"><span class="section-number-2">18.</span> The Language Reference</h2>
<div class="outline-text-2" id="text-18">
<ul class="org-ul">
<li><a href="https://docs.python.org/3/reference/">https://docs.python.org/3/reference/</a></li>
</ul>
</div>
<div id="outline-container-org41ed26b" class="outline-3">
<h3 id="org41ed26b"><span class="section-number-3">18.1.</span> yield and generator expression <a id="orgb78d8da"></a></h3>
<div class="outline-text-3" id="text-18-1">
<p>
form of coroutine
</p>

<ul class="org-ul">
<li>(expression comp<sub>for</sub>) - (x*y for x in range(10) for y in range(x, x+10)) =
&lt;generator object&gt;</li>
</ul>

<p>
Yield - используется для создания генератора. используется для создания лопа.
</p>
<ul class="org-ul">
<li>используется только в функции.</li>
<li>как return только останавливается после возврата если в лупе или в других случаях</li>
<li>async def - asynchronous generator - not iterable - &lt;async<sub>generator</sub> object -(Coroutine objects)</li>
<li>async gen - not implement <span class="underline"><span class="underline">iter</span></span> and <span class="underline"><span class="underline">next</span></span> methods</li>
</ul>
</div>
</div>
<div id="outline-container-org296d4cf" class="outline-3">
<h3 id="org296d4cf"><span class="section-number-3">18.2.</span> yield from</h3>
<div class="outline-text-3" id="text-18-2">
<p>
allow to
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">gen_list1</span>(iterable):
    <span style="color: #8ac6f2; font-weight: bold;">for</span> i <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">list</span>(iterable):
        <span style="color: #8ac6f2; font-weight: bold;">yield</span> i

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">equal to:</span>
<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">gen_list2</span>(iterable):
    <span style="color: #8ac6f2; font-weight: bold;">yield</span> <span style="color: #8ac6f2; font-weight: bold;">from</span> <span style="color: #e5786d;">list</span>(iterable)

</pre>
</div>
</div>
</div>
<div id="outline-container-org6be58da" class="outline-3">
<h3 id="org6be58da"><span class="section-number-3">18.3.</span> ex</h3>
<div class="outline-text-3" id="text-18-3">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">agen</span>():
    <span style="color: #8ac6f2; font-weight: bold;">for</span> n <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">range</span>(1, 10):
          <span style="color: #8ac6f2; font-weight: bold;">yield</span> n

[1, 2, 3, 4, 5, 6, 7, 8, 9]


<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">a</span>():
    <span style="color: #8ac6f2; font-weight: bold;">for</span> n <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">range</span>(1, 3):
          <span style="color: #8ac6f2; font-weight: bold;">yield</span> n
<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">agen</span>():
    <span style="color: #8ac6f2; font-weight: bold;">for</span> n <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">range</span>(1, 7):
          <span style="color: #8ac6f2; font-weight: bold;">yield</span> <span style="color: #8ac6f2; font-weight: bold;">from</span> a()

[1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2]

<span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">-------------------------</span>
<span style="color: #8ac6f2; font-weight: bold;">async def</span> <span style="color: #cae682; font-weight: bold;">ticker</span>(delay, to):
    <span style="color: #f08080; font-style: italic;">"""Yield numbers from 0 to *to* every *delay* seconds."""</span>
    <span style="color: #8ac6f2; font-weight: bold;">for</span> i <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">range</span>(to):
        <span style="color: #8ac6f2; font-weight: bold;">yield</span> i
        <span style="color: #8ac6f2; font-weight: bold;">await</span> asyncio.sleep(delay)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgff9bb04" class="outline-3">
<h3 id="orgff9bb04"><span class="section-number-3">18.4.</span> function decorator</h3>
<div class="outline-text-3" id="text-18-4">
<p>
#+name example<sub>1</sub>
</p>
<div class="org-src-container">
<pre class="src src-python">    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">hello</span>(func):
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">inner</span>():
        <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"Hello "</span>)
        func()
    <span style="color: #8ac6f2; font-weight: bold;">return</span> inner

<span style="color: #92a65e; font-weight: bold;">@hello</span>
<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">name</span>():
    <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"Alice"</span>)
</pre>
</div>

<p>
#+name exampl<sub>2</sub>
</p>
<div class="org-src-container">
<pre class="src src-python">    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">star</span>(n):
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">decorate</span>(fn):
        <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">wrapper</span>(*args, **kwargs):
            <span style="color: #e5786d;">print</span>(n*<span style="color: #95e454;">'*'</span>)
            <span style="color: #cae682;">result</span> = fn(*args, **kwargs)
            <span style="color: #e5786d;">print</span>(result)
            <span style="color: #e5786d;">print</span>(n*<span style="color: #95e454;">'*'</span>)
            <span style="color: #8ac6f2; font-weight: bold;">return</span> result
        <span style="color: #8ac6f2; font-weight: bold;">return</span> wrapper
    <span style="color: #8ac6f2; font-weight: bold;">return</span> decorate


<span style="color: #92a65e; font-weight: bold;">@star</span>(5)
<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">add</span>(a, b):
    <span style="color: #8ac6f2; font-weight: bold;">return</span> a + b


add(10, 20)
</pre>
</div>
</div>
</div>
<div id="outline-container-org25eb9ec" class="outline-3">
<h3 id="org25eb9ec"><span class="section-number-3">18.5.</span> class decorator</h3>
<div class="outline-text-3" id="text-18-5">
<ul class="org-ul">
<li>print(f._<sub>name</sub>__) of wrapper</li>
<li><p>
print(f._<sub>doc</sub>__)  of wrapper
</p>

<p>
#+name ex1
</p>
<div class="org-src-container">
<pre class="src src-python">     <span style="color: #8ac6f2; font-weight: bold;">from</span> functools <span style="color: #8ac6f2; font-weight: bold;">import</span> wraps

     <span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">Star</span>:
         <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">__init__</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>, n):
             <span style="color: #8ac6f2; font-weight: bold;">self</span>.<span style="color: #cae682;">n</span> = n

         <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">__call__</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>, fn):
             <span style="color: #92a65e; font-weight: bold;">@wraps</span>(fn) <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">addition to fix f.__name__ and __doc__</span>
             <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">wrapper</span>(*args, **kwargs):
                 <span style="color: #e5786d;">print</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>.n*<span style="color: #95e454;">'*'</span>)
                 <span style="color: #cae682;">result</span> = fn(*args, **kwargs)
                 <span style="color: #e5786d;">print</span>(result)
                 <span style="color: #e5786d;">print</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>.n*<span style="color: #95e454;">'*'</span>)
                 <span style="color: #8ac6f2; font-weight: bold;">return</span> result
             <span style="color: #8ac6f2; font-weight: bold;">return</span> wrapper

     <span style="color: #92a65e; font-weight: bold;">@Star</span>(5)
     <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">add</span>(a, b):
         <span style="color: #8ac6f2; font-weight: bold;">return</span> a + b

     <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">or</span>
     <span style="color: #cae682;">add</span> = Star(5)(add)

     add(10, 20)


</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-org52096d5" class="outline-3">
<h3 id="org52096d5"><span class="section-number-3">18.6.</span> lines</h3>
<div class="outline-text-3" id="text-18-6">
<p>
<b>new line</b>
</p>
<ul class="org-ul">
<li>Конец строки - Unix LF, Windows CR LF, Macintosh CR - All of these forms can be used equally, regardless of
platform</li>
<li>In Python - C conventions for newline characters - \n - ASCII LF</li>
</ul>

<p>
<b>Comments</b>
</p>
<pre class="example">
# - line
""" comment """ - multiline
</pre>


<p>
<b>Line joining</b> - cannot carry a comment
</p>
<pre class="example">
if 1900 &lt; year &lt; 2100 and 1 &lt;= month &lt;= 12 \
  and 1 &lt;= day &lt;= 31 and 0 &lt;= hour &lt; 24 # Looks like a valid date
</pre>


<p>
<b>Implicit line joining</b>
</p>
<pre class="example">
month_names = ['Januari', 'Februari', 'Maart',      #you can
               'Oktober', 'November', 'December']   #do it
</pre>


<p>
<b>Blank line</b> - contains only spaces, tabs, formfeeds(FFor \f) and possibly a comment
</p>
</div>
</div>

<div id="outline-container-org89141e4" class="outline-3">
<h3 id="org89141e4"><span class="section-number-3">18.7.</span> Indentation</h3>
<div class="outline-text-3" id="text-18-7">
<ul class="org-ul">
<li>Leading whitespace (spaces and tabs)</li>
<li>determine the grouping of statements</li>
<li><b>TabError</b> - if a source file mixes tabs and spaces in a way that makes the meaning dependent on the worth
of a tab in spaces</li>
</ul>

<p>
Tabs are replaced - 1-7
</p>
</div>
</div>

<div id="outline-container-orgfca1e14" class="outline-3">
<h3 id="orgfca1e14"><span class="section-number-3">18.8.</span> identifier [aɪˈdentɪfaɪər] or names</h3>
<div class="outline-text-3" id="text-18-8">
<p>
[A-Za-z<sub>(0-9 except for firest char)</sub>] - case sensitive
</p>
<ul class="org-ul">
<li>and unicode <a href="https://www.dcl.hpi.uni-potsdam.de/home/loewis/table-3131.html">https://www.dcl.hpi.uni-potsdam.de/home/loewis/table-3131.html</a></li>
</ul>

<p>
Reserved classes of identifiers
</p>
<ul class="org-ul">
<li>_*</li>
<li>\_\_\*\_\_</li>
<li>_<sub>*</sub></li>
</ul>
</div>
</div>

<div id="outline-container-orgb18ff28" class="outline-3">
<h3 id="orgb18ff28"><span class="section-number-3">18.9.</span> Keywords Exactly as written here:</h3>
<div class="outline-text-3" id="text-18-9">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">False</td>
<td class="org-left">await</td>
<td class="org-left">else</td>
<td class="org-left">import</td>
<td class="org-left">pass</td>
</tr>

<tr>
<td class="org-left">None</td>
<td class="org-left">break</td>
<td class="org-left">except</td>
<td class="org-left">in</td>
<td class="org-left">raise</td>
</tr>

<tr>
<td class="org-left">True</td>
<td class="org-left">class</td>
<td class="org-left">finally</td>
<td class="org-left">is</td>
<td class="org-left">return</td>
</tr>

<tr>
<td class="org-left">and</td>
<td class="org-left">continue</td>
<td class="org-left">for</td>
<td class="org-left">lambda</td>
<td class="org-left">try</td>
</tr>

<tr>
<td class="org-left">as</td>
<td class="org-left">def</td>
<td class="org-left">from</td>
<td class="org-left">nonlocal</td>
<td class="org-left">while</td>
</tr>

<tr>
<td class="org-left">assert</td>
<td class="org-left">del</td>
<td class="org-left">global</td>
<td class="org-left">not</td>
<td class="org-left">with</td>
</tr>

<tr>
<td class="org-left">async</td>
<td class="org-left">elif</td>
<td class="org-left">if</td>
<td class="org-left">or</td>
<td class="org-left">yield</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org494cd36" class="outline-3">
<h3 id="org494cd36"><span class="section-number-3">18.10.</span> Numeric literals</h3>
<div class="outline-text-3" id="text-18-10">
<ul class="org-ul">
<li>integers</li>
<li>floating point numbers - 3.14    10.    .001    1e100    3.14e-10    0e0    3.14<sub>15</sub><sub>93</sub></li>
<li>imaginary numbers ????? - 3.14j   10.j    10j     .001j   1e100j   3.14e-10j   3.14<sub>15</sub><sub>93j</sub></li>
</ul>

<p>
-1 - expression composed of the unary operator ‘-‘ and the literal 1
</p>
</div>

<div id="outline-container-orgfa64cf6" class="outline-4">
<h4 id="orgfa64cf6"><span class="section-number-4">18.10.1.</span> integers</h4>
<div class="outline-text-4" id="text-18-10-1">
<p>
integer      ::=  decinteger | bininteger | octinteger | hexinteger
decinteger   ::=  nonzerodigit (["<span class="underline">"] digit)* | "0"+ (["</span>"] "0")*
bininteger   ::=  "0" ("b" | "B") (["<span class="underline">"] bindigit)+
octinteger   ::=  "0" ("o" | "O") (["</span>"] octdigit)+
hexinteger   ::=  "0" ("x" | "X") (["_"] hexdigit)+
nonzerodigit ::=  "1"&#x2026;"9"
digit        ::=  "0"&#x2026;"9"
bindigit     ::=  "0" | "1"
octdigit     ::=  "0"&#x2026;"7"
hexdigit     ::=  digit | "a"&#x2026;"f" | "A"&#x2026;"F"
</p>
</div>
</div>

<div id="outline-container-org08e6e16" class="outline-4">
<h4 id="org08e6e16"><span class="section-number-4">18.10.2.</span> float</h4>
<div class="outline-text-4" id="text-18-10-2">
<ul class="org-ul">
<li>floatnumber   ::=  pointfloat | exponentfloat</li>
<li>pointfloat    ::=  [digitpart] fraction | digitpart "."</li>
<li>exponentfloat ::=  (digitpart | pointfloat) exponent</li>
<li>digitpart     ::=  digit (["_"] digit)*</li>
<li>fraction      ::=  "." digitpart</li>
<li>exponent      ::=  ("e" | "E") ["+" | "-"] digitpart</li>
</ul>

<p>
3.14    10.    .001    1e100    3.14e-10    0e0    3.14<sub>15</sub><sub>93</sub>
</p>
</div>
</div>
<div id="outline-container-org9f248a9" class="outline-4">
<h4 id="org9f248a9"><span class="section-number-4">18.10.3.</span> Imaginary literals</h4>
<div class="outline-text-4" id="text-18-10-3">
<p>
imagnumber ::=  (floatnumber | digitpart) ("j" | "J")
</p>

<p>
3.14j   10.j    10j     .001j   1e100j   3.14e-10j   3.14<sub>15</sub><sub>93j</sub>
</p>
</div>
</div>
</div>

<div id="outline-container-org4af4b33" class="outline-3">
<h3 id="org4af4b33"><span class="section-number-3">18.11.</span> Docstring and comments</h3>
<div class="outline-text-3" id="text-18-11">
<p>
first thing in a class/function/module
</p>

<p>
'''
This is a multiline
comment.
'''
</p>
</div>
</div>
<div id="outline-container-org552b5ae" class="outline-3">
<h3 id="org552b5ae"><span class="section-number-3">18.12.</span> Simple statements</h3>
<div class="outline-text-3" id="text-18-12">
<ul class="org-ul">
<li>assert</li>
<li>pass</li>
<li>del</li>
<li>return</li>
<li>yield????</li>
<li>raise - without argument - re-raise the exception in try except</li>
<li>break</li>
<li>continue</li>
<li>import</li>
<li>global indentifiers** - tell pareser to treat identifier as global. Когда есть функция и глобальные переменные</li>
<li>nonlocal indentifier** - когда есть функция внутри функции. переменные в первой функции - не глобальные и не
локальные</li>
</ul>
</div>
</div>

<div id="outline-container-org6c711cf" class="outline-3">
<h3 id="org6c711cf"><span class="section-number-3">18.13.</span> call external process</h3>
<div class="outline-text-3" id="text-18-13">
<p>
if shell=True you cannot use array of arguments
</p>
</div>
<div id="outline-container-orgb273893" class="outline-4">
<h4 id="orgb273893"><span class="section-number-4">18.13.1.</span> ex</h4>
<div class="outline-text-4" id="text-18-13-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">-- 1</span>
<span style="color: #8ac6f2; font-weight: bold;">import</span> os
os.system(<span style="color: #95e454;">"echo Hello World"</span>)
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">can no pass input</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">-- 2</span>
<span style="color: #8ac6f2; font-weight: bold;">import</span> os
<span style="color: #cae682;">pipe</span>=os.popen(<span style="color: #95e454;">"dir *.md"</span>)
<span style="color: #e5786d;">print</span> (pipe.read())

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">-- 2</span>
<span style="color: #8ac6f2; font-weight: bold;">import</span> subprocess
subprocess.Popen(<span style="color: #95e454;">"echo Hello World"</span>, shell=<span style="color: #e5786d; font-weight: bold;">True</span>, stdout=subprocess.PIPE).stdout.read()

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">-- 3 old</span>
<span style="color: #8ac6f2; font-weight: bold;">import</span> subprocess
subprocess.call(<span style="color: #95e454;">"echo Hello World"</span>, shell=<span style="color: #e5786d; font-weight: bold;">True</span>)

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">-- 4</span>
<span style="color: #8ac6f2; font-weight: bold;">import</span> subprocess
<span style="color: #e5786d;">print</span>(subprocess.run(<span style="color: #95e454;">"echo Hello World"</span>, shell=<span style="color: #e5786d; font-weight: bold;">True</span>))

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">-- 5</span>
<span style="color: #8ac6f2; font-weight: bold;">import</span> subprocess
(<span style="color: #cae682;">ls_status</span>, <span style="color: #cae682;">ls_output</span>) = subprocess.getstatusoutput(ls_command)

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">-- 6</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">returns output as byte string</span>
<span style="color: #cae682;">returned_output</span> = subprocess.check_output(cmd)
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">using decode() function to convert byte string to string</span>
<span style="color: #e5786d;">print</span>(<span style="color: #95e454;">'Current date is:'</span>, returned_output.decode(<span style="color: #95e454;">"utf-8"</span>))

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">-- 7 with timeout</span>
<span style="color: #8ac6f2; font-weight: bold;">import</span> subprocess
<span style="color: #cae682;">DELAY</span> = 10
<span style="color: #cae682;">po</span> = subprocess.Popen([<span style="color: #95e454;">"sleep 1; echo 'asd</span><span style="color: #e5786d; font-weight: bold;">\n</span><span style="color: #95e454;">asd'"</span>], shell=<span style="color: #e5786d; font-weight: bold;">True</span>, stdout=subprocess.PIPE)
po.wait(DELAY)
<span style="color: #e5786d;">print</span>(po.stdout.read().decode(<span style="color: #95e454;">'utf-8'</span>))
<span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"ok"</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf207bbd" class="outline-4">
<h4 id="orgf207bbd"><span class="section-number-4">18.13.2.</span> ex: call shell command and get stdout stderr and check return status</h4>
<div class="outline-text-4" id="text-18-13-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> subprocess

<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">run_command</span>(command):
    <span style="color: #8ac6f2; font-weight: bold;">try</span>:
        <span style="color: #cae682;">result</span> = subprocess.run(command, shell=<span style="color: #e5786d; font-weight: bold;">True</span>, capture_output=<span style="color: #e5786d; font-weight: bold;">True</span>, text=<span style="color: #e5786d; font-weight: bold;">True</span>)
        <span style="color: #cae682;">stdout</span> = result.stdout.strip()
        <span style="color: #cae682;">stderr</span> = result.stderr.strip()
        <span style="color: #cae682;">returncode</span> = result.returncode
        <span style="color: #8ac6f2; font-weight: bold;">return</span> stdout, stderr, returncode
    <span style="color: #8ac6f2; font-weight: bold;">except</span> <span style="color: #92a65e; font-weight: bold;">Exception</span> <span style="color: #8ac6f2; font-weight: bold;">as</span> e:
        <span style="color: #e5786d;">print</span>(f<span style="color: #95e454;">"Error: </span>{e}<span style="color: #95e454;">"</span>)
        <span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #e5786d; font-weight: bold;">None</span>, <span style="color: #e5786d; font-weight: bold;">None</span>, <span style="color: #e5786d; font-weight: bold;">None</span>

<span style="color: #cae682;">command</span> = <span style="color: #95e454;">"ls -l"</span>
<span style="color: #cae682;">stdout</span>, <span style="color: #cae682;">stderr</span>, <span style="color: #cae682;">returncode</span> = run_command(command)

<span style="color: #8ac6f2; font-weight: bold;">if</span> returncode == 0:
    <span style="color: #e5786d;">print</span>(f<span style="color: #95e454;">"Command '</span>{command}<span style="color: #95e454;">' executed successfully."</span>)
    <span style="color: #e5786d;">print</span>(f<span style="color: #95e454;">"stdout: </span>{stdout}<span style="color: #95e454;">"</span>)
<span style="color: #8ac6f2; font-weight: bold;">else</span>:
    <span style="color: #e5786d;">print</span>(f<span style="color: #95e454;">"Command '</span>{command}<span style="color: #95e454;">' failed with return code </span>{returncode}<span style="color: #95e454;">."</span>)
    <span style="color: #e5786d;">print</span>(f<span style="color: #95e454;">"stderr: </span>{stderr}<span style="color: #95e454;">"</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-org587d1b4" class="outline-4">
<h4 id="org587d1b4"><span class="section-number-4">18.13.3.</span> links</h4>
<div class="outline-text-4" id="text-18-13-3">
<p>
<a href="https://docs.python.org/3/library/subprocess.html">https://docs.python.org/3/library/subprocess.html</a>
</p>
</div>
</div>
</div>
<div id="outline-container-org90cd3a4" class="outline-3">
<h3 id="org90cd3a4"><span class="section-number-3">18.14.</span> Timeout on subprocess readline in Python</h3>
<div class="outline-text-3" id="text-18-14">
</div>
<div id="outline-container-orgbb8d7bd" class="outline-4">
<h4 id="orgbb8d7bd"><span class="section-number-4">18.14.1.</span> 1</h4>
<div class="outline-text-4" id="text-18-14-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> asyncio

<span style="color: #8ac6f2; font-weight: bold;">async def</span> <span style="color: #cae682; font-weight: bold;">read_stdout</span>(process):
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Read from the stdout pipe</span>
    <span style="color: #8ac6f2; font-weight: bold;">while</span> <span style="color: #e5786d; font-weight: bold;">True</span>:
        <span style="color: #cae682;">line</span> = <span style="color: #8ac6f2; font-weight: bold;">await</span> process.stdout.readline()
        <span style="color: #8ac6f2; font-weight: bold;">if</span> <span style="color: #8ac6f2; font-weight: bold;">not</span> line:
            <span style="color: #8ac6f2; font-weight: bold;">break</span>
        <span style="color: #8ac6f2; font-weight: bold;">yield</span> line.decode().strip()


<span style="color: #8ac6f2; font-weight: bold;">async def</span> <span style="color: #cae682; font-weight: bold;">main</span>():
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Create a subprocess</span>
    <span style="color: #cae682;">process</span> = <span style="color: #8ac6f2; font-weight: bold;">await</span> asyncio.create_subprocess_exec(<span style="color: #95e454;">'ls'</span>, stdout=asyncio.subprocess.PIPE, stderr=asyncio.subprocess.PIPE)

    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Set the timeout in seconds</span>
    <span style="color: #cae682;">timeout</span> = 10

    <span style="color: #8ac6f2; font-weight: bold;">try</span>:
        <span style="color: #8ac6f2; font-weight: bold;">while</span> <span style="color: #e5786d; font-weight: bold;">True</span>:
            <span style="color: #cae682;">line</span> = <span style="color: #8ac6f2; font-weight: bold;">await</span> asyncio.wait_for(read_stdout(process).__anext__(), timeout=timeout)
            <span style="color: #8ac6f2; font-weight: bold;">if</span> <span style="color: #8ac6f2; font-weight: bold;">not</span> line:
                <span style="color: #8ac6f2; font-weight: bold;">break</span>
            <span style="color: #e5786d;">print</span>(line)
    <span style="color: #8ac6f2; font-weight: bold;">except</span> asyncio.<span style="color: #92a65e; font-weight: bold;">TimeoutError</span>:
        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">If no data is available within the timeout, handle it</span>
        <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"Timeout occurred"</span>)
    <span style="color: #8ac6f2; font-weight: bold;">finally</span>:
        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Ensure the subprocess is terminated if necessary</span>
        <span style="color: #8ac6f2; font-weight: bold;">if</span> process.returncode <span style="color: #8ac6f2; font-weight: bold;">is</span> <span style="color: #e5786d; font-weight: bold;">None</span>:
            process.terminate()
            <span style="color: #8ac6f2; font-weight: bold;">await</span> process.wait()

asyncio.run(main())
</pre>
</div>
</div>
</div>
<div id="outline-container-orge33ec79" class="outline-4">
<h4 id="orge33ec79"><span class="section-number-4">18.14.2.</span> 2</h4>
<div class="outline-text-4" id="text-18-14-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> asyncio

<span style="color: #8ac6f2; font-weight: bold;">async def</span> <span style="color: #cae682; font-weight: bold;">_read_stdout</span>(process):
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Read from the stdout pipe</span>
    <span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #8ac6f2; font-weight: bold;">await</span> process.stdout.readline()

<span style="color: #8ac6f2; font-weight: bold;">async def</span> <span style="color: #cae682; font-weight: bold;">read_stdout</span>(process, timeout):
    <span style="color: #8ac6f2; font-weight: bold;">while</span> <span style="color: #e5786d; font-weight: bold;">True</span>:
        <span style="color: #cae682;">line</span> = <span style="color: #8ac6f2; font-weight: bold;">await</span> asyncio.wait_for(_read_stdout(process),
                                      timeout=timeout)
        <span style="color: #8ac6f2; font-weight: bold;">if</span> line:
            <span style="color: #8ac6f2; font-weight: bold;">yield</span> line.decode().strip()
        <span style="color: #8ac6f2; font-weight: bold;">else</span>:
            <span style="color: #8ac6f2; font-weight: bold;">break</span>

<span style="color: #8ac6f2; font-weight: bold;">async def</span> <span style="color: #cae682; font-weight: bold;">main</span>():
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Create a subprocess</span>
    <span style="color: #cae682;">process</span> = <span style="color: #8ac6f2; font-weight: bold;">await</span> asyncio.create_subprocess_exec(
        <span style="color: #95e454;">'ls'</span>,
        stdout=asyncio.subprocess.PIPE,
        stderr=asyncio.subprocess.PIPE)

    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Set the timeout in seconds</span>
    <span style="color: #cae682;">timeout</span> = 1

    <span style="color: #8ac6f2; font-weight: bold;">try</span>:
        <span style="color: #8ac6f2; font-weight: bold;">async for</span> line <span style="color: #8ac6f2; font-weight: bold;">in</span> read_stdout(process, timeout):
            <span style="color: #e5786d;">print</span>(line)

    <span style="color: #8ac6f2; font-weight: bold;">except</span> asyncio.<span style="color: #92a65e; font-weight: bold;">TimeoutError</span>:
        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">If no data is available within the timeout, handle it</span>
        <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"Timeout occurred"</span>)
    <span style="color: #8ac6f2; font-weight: bold;">finally</span>:
        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Ensure the subprocess is terminated if necessary</span>
        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">may spawn: child process pid 1701 exit status already read:  will report returncode 255</span>
        <span style="color: #8ac6f2; font-weight: bold;">if</span> process.returncode <span style="color: #8ac6f2; font-weight: bold;">is</span> <span style="color: #e5786d; font-weight: bold;">None</span>: <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">if TimeoutError also</span>
            process.terminate()
            <span style="color: #8ac6f2; font-weight: bold;">await</span> process.wait()

asyncio.run(main())

</pre>
</div>
</div>
</div>
<div id="outline-container-org484c61e" class="outline-4">
<h4 id="org484c61e"><span class="section-number-4">18.14.3.</span> 3</h4>
<div class="outline-text-4" id="text-18-14-3">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">+begin_src python :results output :exports both :session s1</span>
<span style="color: #8ac6f2; font-weight: bold;">import</span> asyncio

<span style="color: #8ac6f2; font-weight: bold;">async def</span> <span style="color: #cae682; font-weight: bold;">_read_stdout</span>(process):
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Read from the stdout pipe</span>
    <span style="color: #cae682;">line</span> = <span style="color: #8ac6f2; font-weight: bold;">await</span> process.stdout.readline()
    <span style="color: #8ac6f2; font-weight: bold;">if</span> line <span style="color: #8ac6f2; font-weight: bold;">is</span> <span style="color: #8ac6f2; font-weight: bold;">not</span> <span style="color: #e5786d; font-weight: bold;">None</span>:
        <span style="color: #8ac6f2; font-weight: bold;">return</span> line.decode().strip()
    <span style="color: #8ac6f2; font-weight: bold;">else</span>:
        <span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #e5786d; font-weight: bold;">None</span>

<span style="color: #8ac6f2; font-weight: bold;">async def</span> <span style="color: #cae682; font-weight: bold;">read_lines</span>():
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Create a subprocess</span>
    <span style="color: #cae682;">args</span> = [<span style="color: #95e454;">'ls'</span>, <span style="color: #95e454;">'-al'</span>]
    <span style="color: #cae682;">process</span> = <span style="color: #8ac6f2; font-weight: bold;">await</span> asyncio.create_subprocess_exec(
        *args, <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">'ls', '-al',</span>
        stdout=asyncio.subprocess.PIPE,
        stderr=asyncio.subprocess.PIPE)

    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Set the timeout in seconds</span>
    <span style="color: #cae682;">timeout</span> = 1
    <span style="color: #cae682;">lines</span> = []
    <span style="color: #8ac6f2; font-weight: bold;">try</span>:
        <span style="color: #8ac6f2; font-weight: bold;">while</span> <span style="color: #e5786d; font-weight: bold;">True</span>:
            <span style="color: #cae682;">line</span> = <span style="color: #8ac6f2; font-weight: bold;">await</span> asyncio.wait_for(_read_stdout(process),
                                      timeout=timeout)
            <span style="color: #8ac6f2; font-weight: bold;">if</span> line <span style="color: #8ac6f2; font-weight: bold;">is</span> <span style="color: #e5786d; font-weight: bold;">None</span>:
                <span style="color: #8ac6f2; font-weight: bold;">break</span>
            lines.append(line)

    <span style="color: #8ac6f2; font-weight: bold;">except</span> asyncio.<span style="color: #92a65e; font-weight: bold;">TimeoutError</span>:
        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">If no data is available within the timeout, handle it</span>
        <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"Timeout occurred"</span>)
    <span style="color: #8ac6f2; font-weight: bold;">finally</span>:
        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Ensure the subprocess is terminated if necessary</span>
        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">may spawn: child process pid 1701 exit status already read:  will report returncode 255</span>
        <span style="color: #8ac6f2; font-weight: bold;">if</span> process.returncode <span style="color: #8ac6f2; font-weight: bold;">is</span> <span style="color: #e5786d; font-weight: bold;">None</span>: <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">if TimeoutError also</span>
            process.terminate()
            <span style="color: #8ac6f2; font-weight: bold;">await</span> process.wait()
    <span style="color: #8ac6f2; font-weight: bold;">return</span> lines

<span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"</span><span style="color: #e5786d; font-weight: bold;">\n</span><span style="color: #95e454;">"</span>.join(asyncio.run(read_lines())))
</pre>
</div>

<p>
#+end<sub>src</sub>
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org285b8af" class="outline-2">
<h2 id="org285b8af"><span class="section-number-2">19.</span> The Python Standard Library</h2>
<div class="outline-text-2" id="text-19">
<ul class="org-ul">
<li>ref <a href="https://docs.python.org/3/library/index.html#library-index">https://docs.python.org/3/library/index.html#library-index</a></li>
<li>tutorial <a href="https://docs.python.org/3/tutorial/stdlib.html">https://docs.python.org/3/tutorial/stdlib.html</a></li>
</ul>
</div>

<div id="outline-container-org3e98dcb" class="outline-3">
<h3 id="org3e98dcb"><span class="section-number-3">19.1.</span> Major libs:</h3>
<div class="outline-text-3" id="text-19-1">
<ul class="org-ul">
<li>os - portable way of using operating system dependent functionality - files, Command Line Arguments,
Environment Variables
<ul class="org-ul">
<li>shutil - higher level interface for files</li>
<li>glob - file lists from directory</li>
</ul></li>
<li>logging</li>
<li>threading - multi-threading</li>
<li>collections - !!!</li>
<li>re - regular expression</li>
<li>math</li>
<li>statistics</li>
<li>datetime</li>
<li>zlib, gzip, bz2, lzma, zipfile and tarfile.</li>
<li>timeit - performance test</li>
<li>profile and pstats - tools for identifying time critical sections in larger blocks of code</li>
<li>doctest - module provides a tool for scanning a module and validating tests embedded in a program’s
docstrings.</li>
<li>unittest</li>
<li>json</li>
<li>sqlite3</li>
<li>Internationalization supported by: gettext, locale, and the codecs package</li>
</ul>
</div>
</div>
<div id="outline-container-org960f2e7" class="outline-3">
<h3 id="org960f2e7"><span class="section-number-3">19.2.</span> regex - import re, regular</h3>
<div class="outline-text-3" id="text-19-2">
<ul class="org-ul">
<li><a href="https://docs.python.org/3/howto/regex.html">https://docs.python.org/3/howto/regex.html</a></li>
</ul>
<p>
import re
</p>
<dl class="org-dl">
<dt>match</dt><dd>если от начала строки совпадает. Возращает объект MatchObject
<dl class="org-dl">
<dt>fullmatch</dt><dd>whole string match</dd>
</dl></dd>
<dt>search</dt><dd>до первого вхождения в строке</dd>
<dt>compile(pattern)</dt><dd>"Компилирует" регулярное выражение, заданное в качестве строки в объект для
последующей работы.</dd>
<dt>sub</dt><dd>replace substring</dd>
</dl>

<p>
Флаги:
</p>
<ul class="org-ul">
<li>re.DOTALL - '.' в регексе означает любой символ кроме пробела, с re.DOTALL включая пробел</li>
<li>re.IGNORECASE</li>
</ul>
</div>
<div id="outline-container-orgf43efe6" class="outline-4">
<h4 id="orgf43efe6"><span class="section-number-4">19.2.1.</span> methods</h4>
<div class="outline-text-4" id="text-19-2-1">
<ul class="org-ul">
<li>re.compile(re-pattern) -&gt; re.Pattern - prepare pattern.</li>
<li>search(pattern, string) -&gt; re.Match or None - Searches for  first location.</li>
<li>re.match(pattern, string) -&gt; re.Match or None - Match string to pattern from begining.</li>
<li>re.fullmatch(pattern, string) -&gt; re.Match or None - Match to whole string.</li>
<li>findall() -&gt; List[str] - Finds all occurrences of the pattern in the string.</li>
<li>inditer() -&gt; yield re.Match - Finds all occurrences of the pattern in the string, returning an iterator yielding match objects.</li>
<li>split() -&gt; List[str] - Splits the string by the pattern.</li>
<li>re.sub(re-pattern, repl, src-string) -&gt; str - Replacing the leftmost non-overlapping occurrences</li>
</ul>
</div>
</div>
<div id="outline-container-org31f02c1" class="outline-4">
<h4 id="org31f02c1"><span class="section-number-4">19.2.2.</span> sub example</h4>
<div class="outline-text-4" id="text-19-2-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> re

<span style="color: #cae682;">regex</span> = re.<span style="color: #e5786d;">compile</span>(<span style="color: #95e454;">'[^&#1072;-&#1103;&#1040;-&#1071;&#1105;&#1025;/-//,. ]'</span>)
<span style="color: #cae682;">reg_pu</span> = re.<span style="color: #e5786d;">compile</span>(<span style="color: #95e454;">'[,]'</span>)
<span style="color: #cae682;">reg_pu2</span> = re.<span style="color: #e5786d;">compile</span>(r<span style="color: #95e454;">'\.([&#1072;-&#1103;&#1040;-&#1071;&#1105;&#1025;])'</span>) <span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">.a = '. a'</span>

<span style="color: #cae682;">s</span> = reg_pu.sub(<span style="color: #95e454;">' '</span>, data[<span style="color: #95e454;">'naznach'</span>])
<span style="color: #cae682;">s</span> = reg_pu2.sub(r<span style="color: #95e454;">'. \1'</span>, s)
<span style="color: #cae682;">nf</span> = regex.sub(<span style="color: #95e454;">' '</span>, s).lower().split()

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">-----------------</span>
<span style="color: #8ac6f2; font-weight: bold;">import</span> re

<span style="color: #cae682;">s</span> = <span style="color: #95e454;">'asdds https://alalal.com'</span>
<span style="color: #cae682;">m</span> = re.search(<span style="color: #95e454;">'https.*'</span>)
<span style="color: #8ac6f2; font-weight: bold;">if</span> m:
  <span style="color: #cae682;">sp</span> = m.span()
  <span style="color: #cae682;">sub</span> = s[sp[0]:sp[1]]


</pre>
</div>
</div>
</div>


<div id="outline-container-orgae0811d" class="outline-4">
<h4 id="orgae0811d"><span class="section-number-4">19.2.3.</span> get string between substring</h4>
<div class="outline-text-4" id="text-19-2-3">
<p>
res = re.search("123(.*)789", "123456789)
res.group(1) # 456
</p>
</div>
</div>
<div id="outline-container-org3e367d6" class="outline-4">
<h4 id="org3e367d6"><span class="section-number-4">19.2.4.</span> reference</h4>
<div class="outline-text-4" id="text-19-2-4">
<ul class="org-ul">
<li>intro <a href="https://docs.python.org/3/howto/regex.html">https://docs.python.org/3/howto/regex.html</a></li>
<li>reference full, sequences: <a href="https://docs.python.org/3/library/re.html">https://docs.python.org/3/library/re.html</a></li>
</ul>

<p>
metacharacters: . ^ $ * + ? { } [ ] \ | ( )
</p>
</div>
</div>

<div id="outline-container-org8de503b" class="outline-4">
<h4 id="org8de503b"><span class="section-number-4">19.2.5.</span> Frequent Sequences:</h4>
<div class="outline-text-4" id="text-19-2-5">
<ul class="org-ul">
<li>\d - Matches any decimal digit; this is equivalent to the class [0-9].</li>
<li>\D - Matches any non-digit character; this is equivalent to the class [<sup>0</sup>-9].</li>
<li>\s - Matches any whitespace character; this is equivalent to the class [ \t\n\r\f\v].</li>
<li>&sect; - Matches any non-whitespace character; this is equivalent to the class [^ \t\n\r\f\v].</li>
<li>\w - Matches any alphanumeric character; this is equivalent to the class [a-zA-Z0-9_].</li>
<li>\W - Matches any non-alphanumeric character; this is equivalent to the class [<sup>a</sup>-zA-Z0-9_].</li>
<li>\A - Matches only the start of the entire string. Regardless of the multiline flag.
<ul class="org-ul">
<li>(^) - match the start of each line in a multiline string if the re.MULTILINE flag is used.</li>
</ul></li>
<li>\Z - Matches only at the end of the string.</li>
</ul>
</div>
</div>

<div id="outline-container-org182a148" class="outline-4">
<h4 id="org182a148"><span class="section-number-4">19.2.6.</span> (&#x2026;) - capture to group.</h4>
<div class="outline-text-4" id="text-19-2-6">
<ul class="org-ul">
<li>(?&#x2026;) - usually do not create a new group</li>
<li>(?aiLmsux) - create group, One or more letters from set aiLmsux, match empty string.
<ul class="org-ul">
<li>used to specify flags within the regular expression.</li>
<li>can only be used at the start of the expression.</li>
<li>(?-flags:pattern) - disable flags</li>
<li>(?flags1-flags2:pattern) - enable flags1 and disable flags2</li>
<li>(?flags) - “global flags”. Apply the specified flags to the entire regular expression.</li>
<li>r'(?i)cat' - applies case-insensitive matching and match Cat, CAT and cat.</li>
</ul></li>
<li>(?:&#x2026;) - don't create group.</li>
<li>(?&gt;&#x2026;) - atomic group, ‘&#x2026;’ is atomic unit.
<ul class="org-ul">
<li>No Backtracking: Once an atomic group has matched, it throws away all backtracking positions within
itself. This prevents the regex engine from trying alternative matches within that group if subsequent
parts of the pattern fail.</li>
<li>Improve performance in specific cases.</li>
<li>“a(bc|b)c” - match both "abc" and "abcc".</li>
<li>a(?&gt;bc|b)c - match "abcc" because once bc matches, the engine discards the backtracking positions and
cannot try just b if the subsequent c fails.</li>
<li>(?&gt;.*). fail to match, atomic group</li>
</ul></li>
<li>(?P&lt;name&gt;&#x2026;) - set name to group.
<ul class="org-ul">
<li>ex. (?P&lt;quote&gt;['"]).*?</li>
<li>Ways to reference it: (?P=quote)
<ul class="org-ul">
<li>(?P&lt;quote&gt;['"]).*?, \1</li>
<li>m.group('quote'), m.end('quote')</li>
<li>like: re.sub(repl=\g&lt;quote&gt; / \g&lt;1&gt; / \1)</li>
</ul></li>
</ul></li>
<li>(?P=name) - reference to group</li>
<li>(?#&#x2026;) - comment</li>
<li>(?=&#x2026;) - lookahead. no capturing. “Isaac (?=Asimov)” will match 'Isaac ' only if it’s followed by 'Asimov'.</li>
<li>(?!&#x2026;) - negative lookahed. “Isaac (?!Asimov)” will match 'Isaac ' only if it’s not followed by 'Asimov'.</li>
<li>(?&lt;=&#x2026;) - lookbehind. (?&lt;=abc)def will find a match in 'abcdef',
<ul class="org-ul">
<li>contained pattern must only match strings of some fixed length: “abc” or “a|b” are allowed, but “a*” and
“a{3,4}” are not.</li>
</ul></li>
<li>(?&lt;!&#x2026;) - negative lookbehind.</li>
<li>(?(id/name)yes-pattern|no-pattern) -  if the group with given id or name exists, try to match with yes-pattern.</li>
</ul>
</div>
</div>

<div id="outline-container-org3ad28bd" class="outline-4">
<h4 id="org3ad28bd"><span class="section-number-4">19.2.7.</span> Zero-width assertions or lookarounds</h4>
<div class="outline-text-4" id="text-19-2-7">
<p>
presence or absence of a pattern without including it in the match.
</p>
<ul class="org-ul">
<li>only check if a condition is met at the current position</li>
</ul>
<p>
types:
</p>
<ol class="org-ol">
<li>(?=pattern)	Lookahead</li>
<li>(?&lt;=foo)	Lookbehind</li>
<li>(?!foo)	Negative Lookahead</li>
<li>(?&lt;!foo)	Negative Lookbehind</li>
</ol>

<p>
(?&lt;!infarct) - Matches any string that is not preceded by the word “infarct”.
</p>
</div>
</div>
</div>

<div id="outline-container-orgc5365fe" class="outline-3">
<h3 id="orgc5365fe"><span class="section-number-3">19.3.</span> datetime</h3>
<div class="outline-text-3" id="text-19-3">
</div>
<div id="outline-container-orga3d6fd4" class="outline-4">
<h4 id="orga3d6fd4"><span class="section-number-4">19.3.1.</span> datetime to date</h4>
<div class="outline-text-4" id="text-19-3-1">
<p>
d.date()
</p>
</div>
</div>
<div id="outline-container-org3af2c54" class="outline-4">
<h4 id="org3af2c54"><span class="section-number-4">19.3.2.</span> date to datetime</h4>
</div>

<div id="outline-container-org90b9943" class="outline-4">
<h4 id="org90b9943"><span class="section-number-4">19.3.3.</span> current time</h4>
<div class="outline-text-4" id="text-19-3-3">
<p>
datetime.datetime.now()
</p>
<ul class="org-ul">
<li>.time() or date()</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgebe4847" class="outline-3">
<h3 id="orgebe4847"><span class="section-number-3">19.4.</span> file object</h3>
<div class="outline-text-3" id="text-19-4">
<p>
<a href="https://docs.python.org/3/library/filesys.html">https://docs.python.org/3/library/filesys.html</a>
</p>
<ul class="org-ul">
<li>os - lower level than Python "file objects"</li>
<li>os.path — Common pathname manipulations</li>
<li>shutil — High-level file operations</li>
<li>tempfile — Generate temporary files and directories</li>
<li>Built-in function open() - returns "file object"</li>
<li></li>
</ul>

<p>
file object
</p>
<ul class="org-ul">
<li></li>
</ul>
</div>
</div>

<div id="outline-container-org86f432a" class="outline-3">
<h3 id="org86f432a"><span class="section-number-3">19.5.</span> importlib</h3>
<div class="outline-text-3" id="text-19-5">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> importlib
<span style="color: #cae682;">itertools</span> = importlib.import_module(<span style="color: #95e454;">'itertools'</span>)

<span style="color: #cae682;">g</span> = importlib.import_module(<span style="color: #95e454;">'t'</span>)
g.v
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">from g import v # ERROR</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org4081dd8" class="outline-3">
<h3 id="org4081dd8"><span class="section-number-3">19.6.</span> pprint</h3>
<div class="outline-text-3" id="text-19-6">
<p>
pprint.pp(dict/list/file/stdout, indent=4)
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #cae682;">d</span> = {<span style="color: #95e454;">'hostnames'</span>: [{<span style="color: #95e454;">'name'</span>: <span style="color: #95e454;">''</span>, <span style="color: #95e454;">'type'</span>: <span style="color: #95e454;">''</span>}],
     <span style="color: #95e454;">'addresses'</span>: {<span style="color: #95e454;">'ipv4'</span>:<span style="color: #95e454;">'49.248.21.1'</span>}}
<span style="color: #8ac6f2; font-weight: bold;">import</span> pprint
pprint.pp(d, indent=2, width=20)
</pre>
</div>

<pre class="example">
{ 'hostnames': [ { 'name': '',
                   'type': ''}],
  'addresses': { 'ipv4': '49.248.21.1'}}
</pre>


<p>
with logger
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">from</span> pprint <span style="color: #8ac6f2; font-weight: bold;">import</span> pformat
<span style="color: #8ac6f2; font-weight: bold;">import</span> logging

logging.basicConfig(level=logging.DEBUG, <span style="color: #e5786d;">format</span>=<span style="color: #95e454;">'%(levelname)-8s %(message)s'</span>)

<span style="color: #cae682;">data</span> = [{<span style="color: #95e454;">'hello'</span>: <span style="color: #95e454;">'there'</span>}, {<span style="color: #95e454;">'foo'</span>: <span style="color: #95e454;">'bar'</span>}]

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Use pformat to get a string representation</span>
<span style="color: #cae682;">formatted_data</span> = pformat(data)

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Log the formatted data</span>
logging.debug(formatted_data)
</pre>
</div>

<pre class="example">
DEBUG    [{'hello': 'there'}, {'foo': 'bar'}]
</pre>
</div>
</div>
</div>

<div id="outline-container-org20154af" class="outline-2">
<h2 id="org20154af"><span class="section-number-2">20.</span> exceptions handling</h2>
<div class="outline-text-2" id="text-20">
</div>
<div id="outline-container-orgca45733" class="outline-3">
<h3 id="orgca45733"><span class="section-number-3">20.1.</span> syntax</h3>
<div class="outline-text-3" id="text-20-1">
<pre class="example">
try:
</pre>

<ul class="org-ul">
<li># Code that may raise an exception</li>
</ul>
<pre class="example">
except ExceptionType:
</pre>

<ul class="org-ul">
<li># Code to handle the exception</li>
</ul>
<pre class="example">
else:
</pre>

<ul class="org-ul">
<li># Code to execute when no exceptions are raised</li>
</ul>
<pre class="example">
finally:
</pre>

<ul class="org-ul">
<li># Code to execute regardless of exceptions</li>
</ul>

<p>
Words: *try, except, else, finally, raise
</p>
</div>
</div>
<div id="outline-container-org64fe708" class="outline-3">
<h3 id="org64fe708"><span class="section-number-3">20.2.</span> output</h3>
<div class="outline-text-3" id="text-20-2">
<ul class="org-ul">
<li>syntax errors - repeats the offending line and displays a little ‘arrow’ pointing</li>
<li>exceptions
<ul class="org-ul">
<li>last line indicates what happened: <b>stack traceback</b> and <b>ExceptionType: detail based on the type and what
caused it</b></li>
<li>exception may have exception’s <b>argument</b></li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-orgc396c85" class="outline-3">
<h3 id="orgc396c85"><span class="section-number-3">20.3.</span> hierarchy</h3>
<div class="outline-text-3" id="text-20-3">
<ul class="org-ul">
<li><b>BaseException</b> - root exception</li>
<li><b>Exception</b> - non-system-exiting exceptions are derived from this class</li>
<li><b>Warning</b> -    warnings.warn("Warning&#x2026;&#x2026;&#x2026;..Message")</li>
</ul>
<div class="org-src-container">
<pre class="src src-text">BaseException
 &#9500;&#9472;&#9472; BaseExceptionGroup
 &#9500;&#9472;&#9472; GeneratorExit
 &#9500;&#9472;&#9472; KeyboardInterrupt
 &#9500;&#9472;&#9472; SystemExit
 &#9492;&#9472;&#9472; Exception
      &#9500;&#9472;&#9472; ArithmeticError
      &#9474;    &#9500;&#9472;&#9472; FloatingPointError
      &#9474;    &#9500;&#9472;&#9472; OverflowError
      &#9474;    &#9492;&#9472;&#9472; ZeroDivisionError
      &#9500;&#9472;&#9472; AssertionError
      &#9500;&#9472;&#9472; AttributeError
      &#9500;&#9472;&#9472; BufferError
      &#9500;&#9472;&#9472; EOFError
      &#9500;&#9472;&#9472; ExceptionGroup [BaseExceptionGroup]
      &#9500;&#9472;&#9472; ImportError
      &#9474;    &#9492;&#9472;&#9472; ModuleNotFoundError
      &#9500;&#9472;&#9472; LookupError
      &#9474;    &#9500;&#9472;&#9472; IndexError
      &#9474;    &#9492;&#9472;&#9472; KeyError
      &#9500;&#9472;&#9472; MemoryError
      &#9500;&#9472;&#9472; NameError
      &#9474;    &#9492;&#9472;&#9472; UnboundLocalError
      &#9500;&#9472;&#9472; OSError
      &#9474;    &#9500;&#9472;&#9472; BlockingIOError
      &#9474;    &#9500;&#9472;&#9472; ChildProcessError
      &#9474;    &#9500;&#9472;&#9472; ConnectionError
      &#9474;    &#9474;    &#9500;&#9472;&#9472; BrokenPipeError
      &#9474;    &#9474;    &#9500;&#9472;&#9472; ConnectionAbortedError
      &#9474;    &#9474;    &#9500;&#9472;&#9472; ConnectionRefusedError
      &#9474;    &#9474;    &#9492;&#9472;&#9472; ConnectionResetError
      &#9474;    &#9500;&#9472;&#9472; FileExistsError
      &#9474;    &#9500;&#9472;&#9472; FileNotFoundError
      &#9474;    &#9500;&#9472;&#9472; InterruptedError
      &#9474;    &#9500;&#9472;&#9472; IsADirectoryError
      &#9474;    &#9500;&#9472;&#9472; NotADirectoryError
      &#9474;    &#9500;&#9472;&#9472; PermissionError
      &#9474;    &#9500;&#9472;&#9472; ProcessLookupError
      &#9474;    &#9492;&#9472;&#9472; TimeoutError
      &#9500;&#9472;&#9472; ReferenceError
      &#9500;&#9472;&#9472; RuntimeError
      &#9474;    &#9500;&#9472;&#9472; NotImplementedError
      &#9474;    &#9492;&#9472;&#9472; RecursionError
      &#9500;&#9472;&#9472; StopAsyncIteration
      &#9500;&#9472;&#9472; StopIteration
      &#9500;&#9472;&#9472; SyntaxError
      &#9474;    &#9492;&#9472;&#9472; IndentationError
      &#9474;         &#9492;&#9472;&#9472; TabError
      &#9500;&#9472;&#9472; SystemError
      &#9500;&#9472;&#9472; TypeError
      &#9500;&#9472;&#9472; ValueError
      &#9474;    &#9492;&#9472;&#9472; UnicodeError
      &#9474;         &#9500;&#9472;&#9472; UnicodeDecodeError
      &#9474;         &#9500;&#9472;&#9472; UnicodeEncodeError
      &#9474;         &#9492;&#9472;&#9472; UnicodeTranslateError
      &#9492;&#9472;&#9472; Warning
           &#9500;&#9472;&#9472; BytesWarning
           &#9500;&#9472;&#9472; DeprecationWarning
           &#9500;&#9472;&#9472; EncodingWarning
           &#9500;&#9472;&#9472; FutureWarning
           &#9500;&#9472;&#9472; ImportWarning
           &#9500;&#9472;&#9472; PendingDeprecationWarning
           &#9500;&#9472;&#9472; ResourceWarning
           &#9500;&#9472;&#9472; RuntimeWarning
           &#9500;&#9472;&#9472; SyntaxWarning
           &#9500;&#9472;&#9472; UnicodeWarning
           &#9492;&#9472;&#9472; UserWarning
</pre>
</div>
</div>
</div>
<div id="outline-container-orge1c947d" class="outline-3">
<h3 id="orge1c947d"><span class="section-number-3">20.4.</span> explanation</h3>
<div class="outline-text-3" id="text-20-4">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">try</span>:
    <span style="color: #cae682;">foo</span> = <span style="color: #e5786d;">open</span>(<span style="color: #95e454;">"foo.txt"</span>)
<span style="color: #8ac6f2; font-weight: bold;">except</span> <span style="color: #92a65e; font-weight: bold;">IOError</span>:
    <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"error"</span>)
<span style="color: #8ac6f2; font-weight: bold;">else</span>: <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">if no exception in try block</span>
    <span style="color: #e5786d;">print</span>(foo.read())
<span style="color: #8ac6f2; font-weight: bold;">finally</span>: <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">always</span>
    <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"finished"</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-org69676b8" class="outline-3">
<h3 id="org69676b8"><span class="section-number-3">20.5.</span> traceback</h3>
<div class="outline-text-3" id="text-20-5">
<p>
two ways
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> traceback
<span style="color: #8ac6f2; font-weight: bold;">import</span> sys

<span style="color: #8ac6f2; font-weight: bold;">try</span>:
    do_stuff()
<span style="color: #8ac6f2; font-weight: bold;">except</span> <span style="color: #92a65e; font-weight: bold;">Exception</span>:
    <span style="color: #e5786d;">print</span>(traceback.format_exc())
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">or</span>
    <span style="color: #e5786d;">print</span>(sys.exc_info()[0])
</pre>
</div>
</div>
</div>
<div id="outline-container-org764e7de" class="outline-3">
<h3 id="org764e7de"><span class="section-number-3">20.6.</span> simple exception</h3>
<div class="outline-text-3" id="text-20-6">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">LimitException</span>(<span style="color: #92a65e; font-weight: bold;">Exception</span>):
    <span style="color: #8ac6f2; font-weight: bold;">pass</span>

<span style="color: #8ac6f2; font-weight: bold;">try</span>:
    <span style="color: #8ac6f2; font-weight: bold;">raise</span> LimitException(1)
<span style="color: #8ac6f2; font-weight: bold;">except</span> LimitException <span style="color: #8ac6f2; font-weight: bold;">as</span> e:
    <span style="color: #e5786d;">print</span>(<span style="color: #e5786d;">dir</span>(e))
    <span style="color: #e5786d;">print</span>(e.args[0])
</pre>
</div>

<pre class="example">
['__cause__', '__class__', '__context__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__setstate__', '__sizeof__', '__str__', '__subclasshook__', '__suppress_context__', '__traceback__', '__weakref__', 'add_note', 'args', 'with_traceback']
1
</pre>
</div>
</div>

<div id="outline-container-org248c2da" class="outline-3">
<h3 id="org248c2da"><span class="section-number-3">20.7.</span> examples</h3>
<div class="outline-text-3" id="text-20-7">
<div class="org-src-container">
<pre class="src src-python">  <span style="color: #8ac6f2; font-weight: bold;">try</span>:
      <span style="color: #cae682;">x</span> = <span style="color: #e5786d;">int</span>(<span style="color: #e5786d;">input</span>(<span style="color: #95e454;">"Please enter a number: "</span>))
      <span style="color: #8ac6f2; font-weight: bold;">break</span>
  <span style="color: #8ac6f2; font-weight: bold;">except</span> <span style="color: #92a65e; font-weight: bold;">ValueError</span>:
      <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"Oops!  That was no valid number.  Try again..."</span>)

  <span style="color: #8ac6f2; font-weight: bold;">except</span> (<span style="color: #92a65e; font-weight: bold;">RuntimeError</span>, <span style="color: #92a65e; font-weight: bold;">TypeError</span>, <span style="color: #92a65e; font-weight: bold;">NameError</span>):
      <span style="color: #8ac6f2; font-weight: bold;">pass</span>
  <span style="color: #8ac6f2; font-weight: bold;">except</span> <span style="color: #92a65e; font-weight: bold;">OSError</span> <span style="color: #8ac6f2; font-weight: bold;">as</span> err:
      <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"OS error: {0}"</span>.<span style="color: #e5786d;">format</span>(err)
      <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"Unexpected error:"</span>, sys.exc_info()[0])
  <span style="color: #8ac6f2; font-weight: bold;">except</span>: <span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">any . with extreme caution!</span>
      <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"B"</span>)
      <span style="color: #8ac6f2; font-weight: bold;">raise</span>          <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">re-raise the exception</span>



  <span style="color: #8ac6f2; font-weight: bold;">try</span>:
      <span style="color: #8ac6f2; font-weight: bold;">raise</span> <span style="color: #92a65e; font-weight: bold;">Exception</span>(<span style="color: #95e454;">'spam'</span>, <span style="color: #95e454;">'eggs'</span>)
  <span style="color: #8ac6f2; font-weight: bold;">except</span> <span style="color: #92a65e; font-weight: bold;">OSError</span>:
      <span style="color: #e5786d;">print</span>(<span style="color: #e5786d;">type</span>(inst))    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">the exception instance</span>
      <span style="color: #e5786d;">print</span>(inst.args)     <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">arguments stored in .args</span>
      <span style="color: #e5786d;">print</span>(inst)          <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">__str__ allows args to be printed directl</span>
  <span style="color: #8ac6f2; font-weight: bold;">else</span>:
      <span style="color: #e5786d;">print</span>(arg, <span style="color: #95e454;">'has'</span>, <span style="color: #e5786d;">len</span>(f.readlines()), <span style="color: #95e454;">'lines'</span>)
      f.close()



  <span style="color: #8ac6f2; font-weight: bold;">try</span>:
  ...         result = x / y
  ...     <span style="color: #8ac6f2; font-weight: bold;">except</span> <span style="color: #92a65e; font-weight: bold;">ZeroDivisionError</span>:
  ...         <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"division by zero!"</span>)
  ...     <span style="color: #8ac6f2; font-weight: bold;">else</span>:                           <span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">no exception</span>
  ...         <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"result is"</span>, result)
  ...     <span style="color: #8ac6f2; font-weight: bold;">finally</span>:                        <span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">always Even with &#1085;&#1077;&#1086;&#1078;&#1080;&#1076;&#1072;&#1085;&#1085;&#1099;&#1084; exception.</span>
  ...         <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"executing finally clause"</span>)


  <span style="color: #8ac6f2; font-weight: bold;">with</span> <span style="color: #e5786d;">open</span>(<span style="color: #95e454;">"myfile.txt"</span>) <span style="color: #8ac6f2; font-weight: bold;">as</span> f: <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">f is always closed, even if a problem was encountered</span>
      <span style="color: #8ac6f2; font-weight: bold;">for</span> line <span style="color: #8ac6f2; font-weight: bold;">in</span> f:
          <span style="color: #e5786d;">print</span>(line, end=<span style="color: #95e454;">""</span>)


        <span style="color: #8ac6f2; font-weight: bold;">try</span>:
            obj = <span style="color: #8ac6f2; font-weight: bold;">self</span>.method_number_list[method_number](image)
            <span style="color: #8ac6f2; font-weight: bold;">self</span>.OUTPUT_OBJ = obj.OUTPUT_OBJ
        <span style="color: #8ac6f2; font-weight: bold;">except</span> <span style="color: #92a65e; font-weight: bold;">Exception</span> <span style="color: #8ac6f2; font-weight: bold;">as</span> e:
            <span style="color: #8ac6f2; font-weight: bold;">if</span> <span style="color: #e5786d;">hasattr</span>(e, <span style="color: #95e454;">'message'</span>):
                <span style="color: #8ac6f2; font-weight: bold;">self</span>.OUTPUT_OBJ = {<span style="color: #95e454;">"qc"</span>: 3, <span style="color: #95e454;">"exception"</span>: e.message}
            <span style="color: #8ac6f2; font-weight: bold;">else</span>:
                <span style="color: #8ac6f2; font-weight: bold;">self</span>.OUTPUT_OBJ = {<span style="color: #95e454;">"qc"</span>: 3, <span style="color: #95e454;">"exception"</span>: <span style="color: #e5786d;">str</span>(<span style="color: #e5786d;">type</span>(e).<span style="color: #e5786d;">__name__</span>) + <span style="color: #95e454;">" : "</span> + <span style="color: #e5786d;">str</span>(e.args)}

</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgfb822d8" class="outline-2">
<h2 id="orgfb822d8"><span class="section-number-2">21.</span> Logging</h2>
<div class="outline-text-2" id="text-21">
<ul class="org-ul">
<li><a href="https://docs.python.org/3/library/logging.html">https://docs.python.org/3/library/logging.html</a></li>
</ul>

<p>
import logging
</p>
</div>

<div id="outline-container-orge48ec69" class="outline-3">
<h3 id="orge48ec69"><span class="section-number-3">21.1.</span> ways to log</h3>
<div class="outline-text-3" id="text-21-1">
<ol class="org-ol">
<li>loggers: logger = logging.getLogger(name) ; logger.warning("as")</li>
<li>root logger: logging.warning('Watch out!')</li>
</ol>

<pre class="example">
logging.basicConfig(level=logging.NOTSET)
root_logger = logging.getLogger()
</pre>

<p>
or
</p>
<pre class="example">
logger = logging.getLogger(__name__)
logger.setLevel(logging.NOTSET)
</pre>
</div>
</div>
<div id="outline-container-org0dbeb34" class="outline-3">
<h3 id="org0dbeb34"><span class="section-number-3">21.2.</span> terms</h3>
<div class="outline-text-3" id="text-21-2">
<dl class="org-dl">
<dt>handlers</dt><dd>send the log records (created by loggers) to the appropriate destination.</dd>
<dt>records</dt><dd>log records (created by loggers)</dd>
<dt>loggers</dt><dd>expose the interface that application code directly uses.</dd>
<dt>Filters</dt><dd>provide a finer grained facility for determining which log records to output.</dd>
<dt>Formatters</dt><dd>specify the layout of log records in the final output.</dd>
</dl>
</div>
</div>
<div id="outline-container-orgc282864" class="outline-3">
<h3 id="orgc282864"><span class="section-number-3">21.3.</span> getLogger()</h3>
<div class="outline-text-3" id="text-21-3">
<p>
Multiple calls to getLogger(<b>name</b>) with the same name will always return a reference to the same Logger object.
</p>

<p>
<b>name</b> - period-separated hierarchical value, like foo.bar.baz
</p>
</div>
</div>
<div id="outline-container-org3db6d82" class="outline-3">
<h3 id="org3db6d82"><span class="section-number-3">21.4.</span> stderror</h3>
<div class="outline-text-3" id="text-21-4">
<p>
deafult:
</p>
<ul class="org-ul">
<li>out stderr</li>
<li>level = WARNING</li>
</ul>
</div>
</div>
<div id="outline-container-orge6b0be9" class="outline-3">
<h3 id="orge6b0be9"><span class="section-number-3">21.5.</span> inspection</h3>
<div class="outline-text-3" id="text-21-5">
<p>
get all loggers:
</p>
<pre class="example">
[print(name) for name in logging.root.manager.loggerDict]
</pre>

<p>
logger properties:
</p>
<ul class="org-ul">
<li>logger.level</li>
<li>logger.handlers</li>
<li>logger.filters</li>
<li>logger.root.handlers[0].formatter.<sub>fmt</sub> - formatter</li>
<li>logger.root.handlers[0].formatter.default<sub>time</sub><sub>format</sub></li>
</ul>

<p>
root logger: logging.root or logging.getLogger()
</p>
</div>
</div>
<div id="outline-container-org7193ffe" class="outline-3">
<h3 id="org7193ffe"><span class="section-number-3">21.6.</span> levels</h3>
<div class="outline-text-3" id="text-21-6">
<ul class="org-ul">
<li>CRITICAL	50</li>
<li>ERROR		40</li>
<li>WARNING	30</li>
<li>INFO		20</li>
<li>DEBUG		10</li>
<li>NOTSET	0</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgbde6af9" class="outline-2">
<h2 id="orgbde6af9"><span class="section-number-2">22.</span> Collections</h2>
<div class="outline-text-2" id="text-22">
<ul class="org-ul">
<li>Abstract Base Classes <a href="https://docs.python.org/3/library/collections.abc.html">https://docs.python.org/3/library/collections.abc.html</a></li>
</ul>
</div>
<div id="outline-container-org793c6df" class="outline-3">
<h3 id="org793c6df"><span class="section-number-3">22.1.</span> collections.Counter() - dict subclass for counting hashable objects</h3>
<div class="outline-text-3" id="text-22-1">
<pre class="example">
import collections
cnt = Counter()
cnt[word] += 1
most_common(n)
</pre>

<p>
Return a list of the n most common elements and their counts from the most common to the least.
</p>
</div>
</div>
<div id="outline-container-org348a5d3" class="outline-3">
<h3 id="org348a5d3"><span class="section-number-3">22.2.</span> time complexity</h3>
<div class="outline-text-3" id="text-22-2">
<p>
O -  provides an upper bound on the growth rate of the function.
</p>

<p>
x in c:
</p>
<ul class="org-ul">
<li>list - O(n)</li>
<li>dict - O(1) O(n)</li>
<li>set - O(1) O(n)</li>
</ul>

<p>
set
</p>
<ul class="org-ul">
<li>list - O(1) O(1)</li>
<li>collections.deque - O(1) O(1) - append</li>
<li>dict - O(1) O(n)</li>
</ul>

<p>
get
</p>
<ul class="org-ul">
<li>list - O(1) O(1)</li>
<li>collections.deque - O(1) O(1) - pop</li>
<li>dict - O(1) O(n)</li>
</ul>

<p>
<a href="https://wiki.python.org/moin/TimeComplexity">https://wiki.python.org/moin/TimeComplexity</a>
</p>
</div>
</div>
</div>
<div id="outline-container-org612da48" class="outline-2">
<h2 id="org612da48"><span class="section-number-2">23.</span> Conventions</h2>
<div class="outline-text-2" id="text-23">
</div>
<div id="outline-container-org8f353b8" class="outline-3">
<h3 id="org8f353b8"><span class="section-number-3">23.1.</span> code style, indentation, naming</h3>
<div class="outline-text-3" id="text-23-1">
<ul class="org-ul">
<li><a href="https://www.python.org/dev/peps/">https://www.python.org/dev/peps/</a></li>
<li>code style <a href="https://www.python.org/dev/peps/pep-0008/">https://www.python.org/dev/peps/pep-0008/</a></li>
</ul>

<p>
Indentation:
</p>
<ul class="org-ul">
<li>4 spaces per indentation level.</li>
<li>Spaces are the preferred indentation method.</li>
</ul>

<p>
Limit all lines to a maximum of 79 characters.
</p>

<p>
Surround top-level function and class definitions with two blank lines.
</p>

<p>
Method definitions inside a class are surrounded by a single blank line.
</p>


<p>
Inside class:
</p>
<ul class="org-ul">
<li>capitalizing method names</li>
<li>prefixing data attribute names with a small unique string (perhaps just an underscore)</li>
<li>using verbs for methods and nouns for data attributes.</li>
</ul>

<p>
naming conventions
</p>
<ul class="org-ul">
<li><a href="https://www.python.org/dev/peps/pep-0008/">https://www.python.org/dev/peps/pep-0008/</a></li>
<li>Modules should have short, all-lowercase names. Underscores can be used in the module name if it improves
readability.</li>
<li>Python packages should also have short, all-lowercase names, although the use of underscores is discouraged.</li>
<li>Class Names - CapWords convention</li>
<li>function names - lowercase with words separated by underscores as necessary to improve readability</li>
</ul>
</div>
</div>
<div id="outline-container-org4ac0da7" class="outline-3">
<h3 id="org4ac0da7"><span class="section-number-3">23.2.</span> 1/2 underscore</h3>
<div class="outline-text-3" id="text-23-2">
<p>
Single Underscore: PEP-0008: _single<sub>leading</sub><sub>underscore</sub>: weak "internal use" indicator. E.g. from M import * does not import objects whose name starts with an underscore.
</p>

<p>
Double Underscore: <a href="https://docs.python.org/3/tutorial/classes.html#private-variables">https://docs.python.org/3/tutorial/classes.html#private-variables</a>
</p>
<ul class="org-ul">
<li>Any identifier of the form _<sub>spam</sub> (at least two leading underscores, at most one trailing underscore) is
textually replaced with _classname_<sub>spam</sub>, where classname is the current class name with leading
underscore(s) stripped. This mangling is done without regard to the syntactic position of the identifier, so
it can be used to define class-private instance and class variables, methods, variables stored in globals,
and even variables stored in instances. private to this class on instances of other classes.</li>
<li>Name mangling is intended to give classes an easy way to define “private” instance variables and methods,
without having to worry about instance variables defined by derived classes, or mucking with instance
variables by code outside the class. Note that the mangling rules are designed mostly to avoid accidents; it
still is possible for a determined soul to access or modify a variable that is considered private. ( as a way
to ensure that the name will not overlap with a similar name in another class.)</li>
</ul>
</div>
</div>

<div id="outline-container-orgf237087" class="outline-3">
<h3 id="orgf237087"><span class="section-number-3">23.3.</span> Whitespace in Expressions and Statements</h3>
<div class="outline-text-3" id="text-23-3">
<div class="org-src-container">
<pre class="src src-python">Yes: spam(ham[1], {eggs: 2})
No:  spam ( ham [ 1 ], { eggs: 2 } )
z
Yes: <span style="color: #8ac6f2; font-weight: bold;">if</span> x == 4: <span style="color: #e5786d;">print</span> x, y; <span style="color: #cae682;">x</span>, <span style="color: #cae682;">y</span> = y, x
No:  <span style="color: #8ac6f2; font-weight: bold;">if</span> x == 4 : <span style="color: #e5786d;">print</span> x , y ; <span style="color: #cae682;">x</span> , <span style="color: #cae682;">y</span> = y , x

YES:
<span style="color: #cae682;">i</span> = i + 1
<span style="color: #cae682;">submitted</span> += 1
<span style="color: #cae682;">x</span> = x*2 - 1
<span style="color: #cae682;">hypot2</span> = x*x + y*y
<span style="color: #cae682;">c</span> = (a+b) * (a-b)

<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">munge</span>(<span style="color: #e5786d;">input</span>: AnyStr): ...
<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">munge</span>() -&gt; AnyStr: ...

<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">complex</span>(real, imag=0.0):
<span style="color: #8ac6f2; font-weight: bold;">return</span> magic(r=real, i=imag)


<span style="color: #8ac6f2; font-weight: bold;">if</span> foo == <span style="color: #95e454;">'blah'</span>:
    do_blah_thing()
do_one()
do_two()
do_three()

<span style="color: #cae682;">FILES</span> = [
    <span style="color: #95e454;">'setup.cfg'</span>,
    <span style="color: #95e454;">'tox.ini'</span>,
    ]
initialize(FILES,
           error=<span style="color: #e5786d; font-weight: bold;">True</span>,
           )

No:
<span style="color: #cae682;">FILES</span> = [<span style="color: #95e454;">'setup.cfg'</span>, <span style="color: #95e454;">'tox.ini'</span>,]
initialize(FILES, error=<span style="color: #e5786d; font-weight: bold;">True</span>,)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfbe30c8" class="outline-3">
<h3 id="orgfbe30c8"><span class="section-number-3">23.4.</span> naming</h3>
<div class="outline-text-3" id="text-23-4">
<p>
case sensitive
</p>

<ul class="org-ul">
<li>Class names start with an uppercase letter. All other identifiers start with a lowercase letter.</li>
<li>Starting an identifier with a single leading underscore indicates that the identifier is <b>private</b> = _i</li>
<li>two leading underscores indicates a strongly private identifier = _<sub>i</sub></li>
<li>Never use the characters 'l' (lowercase letter el), 'O' (uppercase letter oh), or 'I' (uppercase letter eye)
as single character variable names.</li>
</ul>

<p>
<b>Package and Module Names</b> - all-lowercase names. _ - не рекомендуется. C/C++ module has a leading underscore
 (e.g. _socket). <a href="https://peps.python.org/pep-0423/">https://peps.python.org/pep-0423/</a>
</p>

<p>
<b>Class Names</b> - CapWords, or CamelCase
</p>

<p>
<b>functions and varibles</b> Function and varibles names should be lowercase, with words separated by underscores as necessary
to improve readability.
</p>

<ul class="org-ul">
<li>Always use <b>self</b> for the first argument to instance methods.</li>
<li>Always use <b>cls</b> for the first argument to class methods.</li>
</ul>

<p>
<b>Constants</b> MAX<sub>OVERFLOW</sub>
</p>

<p>
PEP8
</p>
<ul class="org-ul">
<li>modules (filenames) should have short, all-lowercase names, and they can contain underscores;</li>
<li>packages (directories) should have short, all-lowercase names, preferably without underscores;</li>
<li>classes should use the CapWords convention.</li>
</ul>
</div>
</div>


<div id="outline-container-org1dc1b0e" class="outline-3">
<h3 id="org1dc1b0e"><span class="section-number-3">23.5.</span> docstrings</h3>
<div class="outline-text-3" id="text-23-5">
<p>
<b>Docstring</b> is a first thing in a <b>module</b>, <b>function</b>, <b>class</b>, or <b>method</b> definition. ( <span class="underline"><span class="underline">doc</span></span> special
 attribute).
</p>
<ul class="org-ul">
<li>Docstring Conventions <a href="https://peps.python.org/pep-0257/">https://peps.python.org/pep-0257/</a></li>
<li><a href="https://peps.python.org/pep-0258/">https://peps.python.org/pep-0258/</a></li>
</ul>

<p>
Convs.:
</p>
<ul class="org-ul">
<li>Phrase ending in a period.</li>
<li>(""" """) are used even though the string fits on one line.</li>
<li>The closing quotes are on the same line as the opening quotes</li>
<li>There’s no blank line either before or after the docstring.</li>
<li>It prescribes the function or method’s effect as a command (“Do this”, “Return that”), not as a description;
e.g. don’t write “Returns the pathname …”.</li>
<li>Multiline: 1. summary 2. blank 3. more elaborate description</li>
</ul>
</div>
<div id="outline-container-org133fa3c" class="outline-4">
<h4 id="org133fa3c"><span class="section-number-4">23.5.1.</span> ex. simple</h4>
<div class="outline-text-4" id="text-23-5-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">kos_root</span>():
    <span style="color: #f08080; font-style: italic;">"""Return the pathname of the KOS root directory."""</span>

<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">complex</span>(real=0.0, imag=0.0):
    <span style="color: #f08080; font-style: italic;">"""Form a complex number.</span>

<span style="color: #f08080; font-style: italic;">    Keyword arguments:</span>
<span style="color: #f08080; font-style: italic;">    real -- the real part (default 0.0)</span>
<span style="color: #f08080; font-style: italic;">    imag -- the imaginary part (default 0.0)</span>
<span style="color: #f08080; font-style: italic;">    """</span>
    <span style="color: #8ac6f2; font-weight: bold;">if</span> imag == 0.0 <span style="color: #8ac6f2; font-weight: bold;">and</span> real == 0.0:
        <span style="color: #8ac6f2; font-weight: bold;">return</span> complex_zero

</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-org49d21dd" class="outline-2">
<h2 id="org49d21dd"><span class="section-number-2">24.</span> Concurrency</h2>
<div class="outline-text-2" id="text-24">
<p>
<a href="https://docs.python.org/3/library/concurrency.html">https://docs.python.org/3/library/concurrency.html</a>
Notes:
</p>
<ul class="org-ul">
<li><b>Preferred approach</b> is to concentrate all access to a resource in a single thread and then use the <b>queue</b></li>
</ul>
<p>
module to feed that thread with requests from other threads.
</p>
<ul class="org-ul">
<li>GIL - mutex - preventing multiple threads from executing Python bytecodes at once on multiple cores
<ul class="org-ul">
<li><a href="https://docs.python.org/3/c-api/init.html#thread-state-and-the-global-interpreter-lock">https://docs.python.org/3/c-api/init.html#thread-state-and-the-global-interpreter-lock</a></li>
<li><a href="https://wiki.python.org/moin/GlobalInterpreterLock">https://wiki.python.org/moin/GlobalInterpreterLock</a></li>
</ul></li>
</ul>

<p>
coroutine (сопрограмма) - components that allow execution to be suspended and resumed, their sates are saved
</p>

<p>
concurrent.futures - high-level interface for asynchronously executing callables. Any yield from chain of
 calls ends with a yield (fundamental mechanism).
</p>
</div>
<div id="outline-container-org5b108f9" class="outline-3">
<h3 id="org5b108f9"><span class="section-number-3">24.1.</span> select right API</h3>
<div class="outline-text-3" id="text-24-1">
<p>
problems:
</p>
<ul class="org-ul">
<li>CPU-Bound Program</li>
<li>I/O-bound problem - spends most of its time waiting for external operations</li>
</ul>

<p>
types:
</p>
<ul class="org-ul">
<li>multiprocessing - creating a new instance of the Python interpreter to run on each CPU and then farming out
part of your program to run on it.</li>
<li>threading - Pre-emptive multitasking, The operating system decides when to switch tasks.
<ul class="org-ul">
<li>hard to code, race conditions</li>
</ul></li>
<li>one thread</li>
<li>Coroutines - Cooperative multitasking - The tasks decide when to give up control.
<ul class="org-ul">
<li>asyncio</li>
</ul></li>
</ul>

<p>
modules:
</p>
<ul class="org-ul">
<li><b>threading</b> - Thread-based parallelism - fast - better for I/O-bound applications due to the Global Interpreter Lock</li>
<li><b>multiprocessing</b> — Process-based parallelism - slow - better for CPU-bound applications</li>
<li><b>concurrent.futures</b> - high-level interface for asynchronously executing callables ThreadPoolExecutor or
ProcessPoolExecutor.</li>
<li><b>subprocess</b> - it’s the recommended option when you need to run multiple processes in parallel or call an
external program or external command from inside your Python code. spawn new processes, connect to their
input/output/error pipes, and obtain their return codes</li>
<li><b>sched</b> - event scheduler</li>
<li><b>queue</b> - useful in threaded programming when information must be exchanged safely between multiple thread</li>
<li><b>asyncio</b> - coroutine-based concurrency(Cooperative multitasking) The tasks decide when to give up control.</li>
</ul>


<div id="org529c9cd" class="figure">
<p><img src="https://superfastpython.com/wp-content/uploads/2022/07/Python-Concurrency-API-Decision-Tree.jpg" alt="Python-Concurrency-API-Decision-Tree.jpg" />
</p>
</div>


<div id="orgd9c1268" class="figure">
<p><img src="https://superfastpython.com/wp-content/uploads/2022/07/Python-Concurrency-API-Pools-vs-Executors.png" alt="Python-Concurrency-API-Pools-vs-Executors.png" />
</p>
</div>


<div id="orge4f5f20" class="figure">
<p><img src="https://superfastpython.com/wp-content/uploads/2022/07/Python-Concurrency-API-Worker-Pool-vs-Class.png" alt="Python-Concurrency-API-Worker-Pool-vs-Class.png" />
</p>
</div>
</div>
<div id="outline-container-orgc6c02bb" class="outline-4">
<h4 id="orgc6c02bb"><span class="section-number-4">24.1.1.</span> asyncio vs threading</h4>
<div class="outline-text-4" id="text-24-1-1">
<p>
Use asyncio for:
</p>
<ul class="org-ul">
<li>I/O-bound tasks</li>
<li>Non-blocking operations</li>
<li>Scalable concurrent execution of many tasks</li>
<li>Simplified asynchronous programming</li>
</ul>
<p>
Use threading for:
</p>
<ul class="org-ul">
<li>I/O-bound tasks with blocking operations</li>
<li>Tasks that require parallelism but are not heavily CPU-bound</li>
<li>Easier integration with existing synchronous code</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org7cef518" class="outline-3">
<h3 id="org7cef518"><span class="section-number-3">24.2.</span> Process</h3>
<div class="outline-text-3" id="text-24-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">from</span> multiprocessing <span style="color: #8ac6f2; font-weight: bold;">import</span> Process
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">not daemon don't allow to have subprocess</span>
<span style="color: #cae682;">proc</span>: Process = Process(target=<span style="color: #8ac6f2; font-weight: bold;">self</span>.perform_job, args=(job, queue), daemon=<span style="color: #e5786d; font-weight: bold;">False</span>)
proc.start()
proc.join(WAIT_FOR_THREAD)  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">seconds</span>
<span style="color: #8ac6f2; font-weight: bold;">if</span> proc.is_alive():
  <span style="color: #8ac6f2; font-weight: bold;">pass</span>

</pre>
</div>
</div>
</div>
<div id="outline-container-org9e35013" class="outline-3">
<h3 id="org9e35013"><span class="section-number-3">24.3.</span> Pool of processes</h3>
<div class="outline-text-3" id="text-24-3">
<ul class="org-ul">
<li>cannot work with lambdas because of pickle used internaly</li>
<li>def <span class="underline"><span class="underline">enter</span></span> : self.<sub>check</sub><sub>running</sub>()</li>
<li>def <span class="underline"><span class="underline">exit</span></span> : self.terminate()</li>
<li>r = executor.apply<sub>async</sub> ; r.get() - use for debug.</li>
</ul>

<p>
lambdas not supported to apply. Functions should be defined before Pool creation.
</p>

<p>
cons:
</p>
<ul class="org-ul">
<li>impossible to catch result of callback</li>
<li>impossible to pass function to func with additional argument</li>
<li>require if <span class="underline"><span class="underline">name</span></span> == '<span class="underline"><span class="underline">main</span></span>': construction</li>
</ul>
</div>
<div id="outline-container-org158dff5" class="outline-4">
<h4 id="org158dff5"><span class="section-number-4">24.3.1.</span> 1</h4>
<div class="outline-text-4" id="text-24-3-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">from</span> multiprocessing.pool <span style="color: #8ac6f2; font-weight: bold;">import</span> Pool
<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">callback_result</span>(result):
   <span style="color: #e5786d;">print</span>(result)
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Pool</span>
<span style="color: #cae682;">pool</span> = Pool(processes=2)  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">clear leaked memory with process death</span>

<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">aa2</span>(x):
    <span style="color: #8ac6f2; font-weight: bold;">return</span> x

pool.apply_async(aa2, args=(1,), callback=callback_result)
pool.close()
pool.join()
</pre>
</div>
</div>
</div>

<div id="outline-container-org177ad4f" class="outline-4">
<h4 id="org177ad4f"><span class="section-number-4">24.3.2.</span> 2</h4>
<div class="outline-text-4" id="text-24-3-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">from</span> multiprocessing <span style="color: #8ac6f2; font-weight: bold;">import</span> Pool
<span style="color: #8ac6f2; font-weight: bold;">import</span> time

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Worker function that simulates some work</span>
<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">worker</span>(num):
    time.sleep(1)  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Simulate work</span>
    <span style="color: #8ac6f2; font-weight: bold;">return</span> num * 2


<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Callback function to process results</span>
<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">callback</span>(result):
    <span style="color: #e5786d;">print</span>(f<span style="color: #95e454;">"Received result: </span>{result}<span style="color: #95e454;">"</span>)

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Create a pool of 4 worker processes</span>
<span style="color: #cae682;">pool</span> = Pool(processes=4)
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Submit tasks to the pool and specify the callback function</span>
<span style="color: #8ac6f2; font-weight: bold;">for</span> i <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">range</span>(10):
    pool.apply_async(worker, args=(i,), callback=callback)
    <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"sd"</span>)

pool.close()
pool.join()

</pre>
</div>

<pre class="example" id="org0223ec7">
Received result: 0
Received result: 4
Received result: 6
Received result: 2
Received result: 8
Received result: 14
Received result: 10
Received result: 12
Received result: 16
Received result: 18
</pre>
</div>
</div>
</div>

<div id="outline-container-org9278c7c" class="outline-3">
<h3 id="org9278c7c"><span class="section-number-3">24.4.</span> threading</h3>
<div class="outline-text-3" id="text-24-4">
<p>
Daemon - daemon thread will shut down immediately when the program exits. default=False
</p>


<p>
Python (CPython) is not optimized for thread framework.You can keep allocating more resources and it
will try spawning/queuing new threads and overloading the cores. You need to make a design change
here:
</p>

<p>
Process based design:
</p>
<ul class="org-ul">
<li>Either use the multiprocessing module</li>
<li>Make use of rabbitmq and make this task run separately</li>
<li>Spawn a subprocess</li>
</ul>

<p>
Or if you still want to stick to threads:
</p>
<ul class="org-ul">
<li>Switch to PyPy (faster compared to CPython)</li>
<li>Switch to PyPy-STM (totally does away with GIL)</li>
</ul>
</div>



<div id="outline-container-org7658322" class="outline-4">
<h4 id="org7658322"><span class="section-number-4">24.4.1.</span> examples</h4>
<div class="outline-text-4" id="text-24-4-1">
</div>
<ol class="org-ol">
<li><a id="org067d16c"></a>ThreadPoolExecutor - many function for several workers<br />
<div class="outline-text-5" id="text-24-4-1-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">get_degree1</span>(angle):
    <span style="color: #8ac6f2; font-weight: bold;">return</span> a

<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">get_degree2</span>(angle):
    <span style="color: #8ac6f2; font-weight: bold;">return</span> a

<span style="color: #8ac6f2; font-weight: bold;">import</span> concurrent.futures
<span style="color: #8ac6f2; font-weight: bold;">with</span> concurrent.futures.ThreadPoolExecutor(max_workers=5) <span style="color: #8ac6f2; font-weight: bold;">as</span> executor:
    <span style="color: #cae682;">futures1</span> = executor.submit(get_degree1, x) <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">started</span>
    <span style="color: #cae682;">futures2</span> = executor.submit(get_degree2, x) <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">started</span>
    <span style="color: #cae682;">data</span> = future1.result()
    <span style="color: #cae682;">data</span> = future1.result()

</pre>
</div>
</div>
</li>
<li><a id="org7a0bed7"></a>ThreadPoolExecutor - one function for several workers<br />
<div class="outline-text-5" id="text-24-4-1-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">get_degree</span>(angle):
   <span style="color: #8ac6f2; font-weight: bold;">return</span> a

<span style="color: #8ac6f2; font-weight: bold;">import</span> concurrent.futures
<span style="color: #cae682;">angles</span>: <span style="color: #e5786d;">list</span> = []
<span style="color: #8ac6f2; font-weight: bold;">with</span> concurrent.futures.ThreadPoolExecutor(max_workers=5) <span style="color: #8ac6f2; font-weight: bold;">as</span> executor:
    <span style="color: #cae682;">futures</span> = {executor.submit(get_degree, x): x <span style="color: #8ac6f2; font-weight: bold;">for</span> x <span style="color: #8ac6f2; font-weight: bold;">in</span> degrees}
    <span style="color: #8ac6f2; font-weight: bold;">for</span> future <span style="color: #8ac6f2; font-weight: bold;">in</span> concurrent.futures.as_completed(futures):
        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">futures[future] # degree</span>
        <span style="color: #cae682;">data</span> = future.result()
        angles.append(data)
</pre>
</div>
</div>
</li>
<li><a id="org61cb01f"></a><b>Custom thread</b><br />
<div class="outline-text-5" id="text-24-4-1-3">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">from</span> threading <span style="color: #8ac6f2; font-weight: bold;">import</span> Thread

<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">foo</span>(bar):
    <span style="color: #e5786d;">print</span> <span style="color: #95e454;">'hello {0}'</span>.<span style="color: #e5786d;">format</span>(bar)
    <span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #95e454;">"foo"</span>

<span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">ThreadWithReturnValue</span>(Thread):
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">__init__</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>, group=<span style="color: #e5786d; font-weight: bold;">None</span>, target=<span style="color: #e5786d; font-weight: bold;">None</span>, name=<span style="color: #e5786d; font-weight: bold;">None</span>,
                 args=(), kwargs={}, Verbose=<span style="color: #e5786d; font-weight: bold;">None</span>):
        Thread.__init__(<span style="color: #8ac6f2; font-weight: bold;">self</span>, group, target, name, args, kwargs)
        <span style="color: #8ac6f2; font-weight: bold;">self</span>.<span style="color: #cae682;">_return</span> = <span style="color: #e5786d; font-weight: bold;">None</span>
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">run</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>):
        <span style="color: #e5786d;">print</span>(<span style="color: #e5786d;">type</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>._target))
        <span style="color: #8ac6f2; font-weight: bold;">if</span> <span style="color: #8ac6f2; font-weight: bold;">self</span>._target <span style="color: #8ac6f2; font-weight: bold;">is</span> <span style="color: #8ac6f2; font-weight: bold;">not</span> <span style="color: #e5786d; font-weight: bold;">None</span>:
            <span style="color: #8ac6f2; font-weight: bold;">self</span>.<span style="color: #cae682;">_return</span> = <span style="color: #8ac6f2; font-weight: bold;">self</span>._target(*<span style="color: #8ac6f2; font-weight: bold;">self</span>._args,
                                                **<span style="color: #8ac6f2; font-weight: bold;">self</span>._kwargs)
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">join</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>, *args):
        Thread.join(<span style="color: #8ac6f2; font-weight: bold;">self</span>, *args)
        <span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #8ac6f2; font-weight: bold;">self</span>._return

<span style="color: #cae682;">twrv</span> = ThreadWithReturnValue(target=foo, args=(<span style="color: #95e454;">'world!'</span>,))

twrv.start()
<span style="color: #e5786d;">print</span> twrv.join()   <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">prints foo</span>
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-org6e184ca" class="outline-4">
<h4 id="org6e184ca"><span class="section-number-4">24.4.2.</span> syncronization</h4>
<div class="outline-text-4" id="text-24-4-2">
<p>
<b>with</b> - acquire() and release()
</p>
<ul class="org-ul">
<li>Lock, RLock, Condition, Semaphore, and BoundedSemaphore</li>
</ul>
</div>
<ol class="org-ol">
<li><a id="org05a4f31"></a>Lock and RLock (recurrent version)<br />
<div class="outline-text-5" id="text-24-4-2-1">
<p>
threading.Lock
</p>
</div>
</li>
<li><a id="org8d59187"></a>Condition object - barrier<br />
<div class="outline-text-5" id="text-24-4-2-2">
<ul class="org-ul">
<li>cv = threading.Condition()</li>
<li>cv.wait() - stop</li>
<li>cv.notifyAll() - resume all in wait</li>
</ul>
</div>
</li>
<li><a id="org85306cd"></a>Semaphore Objects - protected section<br />
<div class="outline-text-5" id="text-24-4-2-3">
<p>
maxconnections = 5
pool<sub>sema</sub> = BoundedSemaphore(value=maxconnections)
</p>

<p>
with pool<sub>sema</sub>:
    conn = connectdb()
</p>
</div>
</li>
<li><a id="org375532c"></a>Barrier Objects - by number<br />
<div class="outline-text-5" id="text-24-4-2-4">
<p>
b = Barrier(2, timeout=5) # 2 - numper of parties
</p>

<p>
b.wait()
</p>

<p>
b.wait()
</p>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-org9130bdd" class="outline-3">
<h3 id="org9130bdd"><span class="section-number-3">24.5.</span> multiprocessing</h3>
<div class="outline-text-3" id="text-24-5">
<div class="org-src-container">
<pre class="src src-python"> <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">get_degree</span>(angle):
      <span style="color: #8ac6f2; font-weight: bold;">return</span> a

<span style="color: #8ac6f2; font-weight: bold;">from</span> multiprocessing <span style="color: #8ac6f2; font-weight: bold;">import</span> Process, Manager
    <span style="color: #cae682;">manager</span> = Manager()
    <span style="color: #cae682;">angles</span> = manager.<span style="color: #e5786d;">list</span>()  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">result angles!</span>
    <span style="color: #cae682;">pool</span> = []
    <span style="color: #8ac6f2; font-weight: bold;">for</span> x <span style="color: #8ac6f2; font-weight: bold;">in</span> degrees:
        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">angles.append(get_degree(x))</span>
        <span style="color: #cae682;">p</span> = Process(target=get_degree, args=(x, angles))
        pool.append(p)
        p.start()
    <span style="color: #8ac6f2; font-weight: bold;">for</span> p2 <span style="color: #8ac6f2; font-weight: bold;">in</span> pool:
        p2.join()

</pre>
</div>

<div class="org-src-container">
<pre class="src src-python">  <span style="color: #cae682;">manager</span> = mp.Manager()
  <span style="color: #cae682;">return_dict</span> = manager.<span style="color: #e5786d;">dict</span>()
  <span style="color: #cae682;">jobs</span> = []
  <span style="color: #8ac6f2; font-weight: bold;">for</span> i <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">range</span>(<span style="color: #e5786d;">len</span>(fileslist)):
      <span style="color: #cae682;">p</span> = mp.Process(target=PageProcessing, args=(i, return_dict, fileslist[i],))
      jobs.append(p)
      p.start()

  <span style="color: #8ac6f2; font-weight: bold;">for</span> proc <span style="color: #8ac6f2; font-weight: bold;">in</span> jobs:
      proc.join() <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">&#1078;&#1076;&#1077;&#1084; &#1079;&#1072;&#1074;&#1077;&#1088;&#1096;&#1077;&#1085;&#1080;&#1077; &#1082;&#1072;&#1078;&#1076;&#1086;&#1075;&#1086;</span>

</pre>
</div>
</div>
</div>
<div id="outline-container-org39717b0" class="outline-3">
<h3 id="org39717b0"><span class="section-number-3">24.6.</span> example multiprocess, Threads, othe thread</h3>
<div class="outline-text-3" id="text-24-6">
<div class="org-src-container">
<pre class="src src-python">    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">main_processing</span>(filelist) -&gt; <span style="color: #e5786d;">list</span>:
        <span style="color: #f08080; font-style: italic;">""" Multithread page processing</span>

<span style="color: #f08080; font-style: italic;">        :param filelist: # &#1092;&#1072;&#1081;&#1083;&#1099; PNG &#1089;&#1090;&#1088;&#1072;&#1085;&#1080;&#1094; PDF &#1074;&#1093;&#1086;&#1076;&#1103;&#1097;&#1077;&#1075;&#1086; &#1092;&#1072;&#1081;&#1083;&#1072;</span>
<span style="color: #f08080; font-style: italic;">        :return: {procnum:(procnum, new_obj.OUTPUT_OBJ), ....}</span>
<span style="color: #f08080; font-style: italic;">        """</span>

        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">import multiprocessing as mp</span>
        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">manager = mp.Manager()</span>
        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">return_dict = manager.dict()</span>
        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">jobs = []</span>

        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">for i in range(len(filelist)):</span>
        <span style="color: #fa8072;">#     </span><span style="color: #99968b; font-style: italic;">p = mp.Process(target=page_processing, args=(i, return_dict, filelist[i]))</span>
        <span style="color: #fa8072;">#     </span><span style="color: #99968b; font-style: italic;">jobs.append(p)</span>
        <span style="color: #fa8072;">#     </span><span style="color: #99968b; font-style: italic;">p.start()</span>
        <span style="color: #fa8072;">#</span>
        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">for proc in jobs:</span>
        <span style="color: #fa8072;">#     </span><span style="color: #99968b; font-style: italic;">proc.join()</span>

        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Threads</span>
        <span style="color: #8ac6f2; font-weight: bold;">import</span> concurrent.futures
        <span style="color: #cae682;">return_dict</span>: <span style="color: #e5786d;">list</span> = []
        <span style="color: #8ac6f2; font-weight: bold;">with</span> concurrent.futures.ThreadPoolExecutor(max_workers=2) <span style="color: #8ac6f2; font-weight: bold;">as</span> executor:
            <span style="color: #cae682;">futures</span> = {executor.submit(page_processing, i, x): x <span style="color: #8ac6f2; font-weight: bold;">for</span> i, x <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">enumerate</span>(filelist)}
            <span style="color: #8ac6f2; font-weight: bold;">for</span> future <span style="color: #8ac6f2; font-weight: bold;">in</span> concurrent.futures.as_completed(futures):
                <span style="color: #cae682;">data</span> = future.result()
                return_dict.append(data)

        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">One Thread Debug</span>
        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">from threading import Thread</span>
        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">thread: Thread = Thread(target=page_processing, args=(0, filelist[0]))</span>
        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">thread.start()</span>
        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">thread.join()</span>

        <span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #e5786d;">list</span>(return_dict)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2178493" class="outline-2">
<h2 id="org2178493"><span class="section-number-2">25.</span> асинхронного программирования (asyncio, async, await)</h2>
<div class="outline-text-2" id="text-25">
</div>
<div id="outline-container-orgc2abcbf" class="outline-3">
<h3 id="orgc2abcbf"><span class="section-number-3">25.1.</span> Limitations</h3>
<div class="outline-text-3" id="text-25-1">
<ul class="org-ul">
<li>timeout for asyncio run available only at top level in file.</li>
<li>time.sleep(400) breaks asyncio. Use asyncio.sleep()</li>
<li>losing of exceptions in subprocesses like Pool.</li>
</ul>
</div>
</div>
<div id="outline-container-org63291ad" class="outline-3">
<h3 id="org63291ad"><span class="section-number-3">25.2.</span> Best practices</h3>
<div class="outline-text-3" id="text-25-2">
<ul class="org-ul">
<li>to use a top-level try/except block to catch any unhandled exceptions across all tasks.
<ul class="org-ul">
<li>use asyncio.gather with return<sub>exceptions</sub>=True</li>
</ul></li>
<li>Ensure that long-running loops are scheduled onto the event loop using methods like loop.call<sub>soon</sub> or by
breaking them into smaller tasks to avoid halting the event loop.
<ul class="org-ul">
<li>use asyncio.wait with return<sub>when</sub>=asyncio.FIRST<sub>COMPLETED</sub> to wait until the first task completes.</li>
</ul></li>
<li>Consider keeping a single event loop instance if necessary. Aviod subloops.</li>
<li>Use asyncio.wait<sub>for</sub> to set timeouts for tasks, which helps prevent tasks from running
indefinitely. Also, use task.cancel() to cancel tasks that are no longer needed or have timed out.</li>
<li>Avoid functions with long-running loops within coroutines</li>
</ul>
</div>
</div>
<div id="outline-container-org5782836" class="outline-3">
<h3 id="org5782836"><span class="section-number-3">25.3.</span> asyncio theory</h3>
<div class="outline-text-3" id="text-25-3">
<ul class="org-ul">
<li><a href="http://hoad.io/blog/playing-with-asyncio/">http://hoad.io/blog/playing-with-asyncio/</a></li>
<li><a href="https://habr.com/ru/post/337420/">https://habr.com/ru/post/337420/</a></li>
</ul>

<p>
IO-bound and high-level structured network code. synchronize concurrent code;
</p>

<p>
Any function that calls <b>await</b> needs to be marked with <b>async</b>.
</p>

<p>
async as a flag to Python telling it that the function about to be defined uses await.
</p>

<p>
async with statement, which creates a context manager from an object you would normally await.
</p>

<p>
cons:
</p>
<ul class="org-ul">
<li>all of the advantages of cooperative multitasking get thrown away if one of the tasks doesn’t cooperate.</li>
</ul>

<p>
asyncio.run - ideally only be called once
</p>
</div>
</div>

<div id="outline-container-org4a35126" class="outline-3">
<h3 id="org4a35126"><span class="section-number-3">25.4.</span> terms:</h3>
<div class="outline-text-3" id="text-25-4">
<ul class="org-ul">
<li>Event Loop - low level the core of every asyncio application, high level: asyncio.run()</li>
<li>Coroutines (coro) - (<b>async def</b> statement or generator iterator <b>yield</b> or <b>yield from</b>). internally,
coroutines are a special kind of generators, every await is suspended by a yield somewhere down the chain of
await calls (please refer to PEP 3156 for a detailed explanation).
<ul class="org-ul">
<li><b>async def</b> - <b>native coroutines</b></li>
<li><b>yield</b> or <b>yield from</b> - <b>generator-based coroutines</b></li>
</ul></li>
<li><p>
awaitable object or <b>awaitable proxy object</b> - used for <b>await</b> &#x2026;
</p>
<ul class="org-ul">
<li><b>native coroutine</b></li>
<li><b>generator-based coroutine</b></li>
<li>An object with an <span class="underline"><span class="underline">await</span></span> method (<b>Future-like</b>) returning an iterator. enable Future objects in await statements, the</li>
</ul>
<p>
only change is to add <span class="underline"><span class="underline">await</span></span> = <span class="underline"><span class="underline">iter</span></span> line to asyncio.Future class.
</p></li>
<li><b>await</b> accept <b>awaitable object</b> as an argument. Should be used only in <b>async def</b>.</li>
</ul>
</div>
</div>

<div id="outline-container-orgbe31a9e" class="outline-3">
<h3 id="orgbe31a9e"><span class="section-number-3">25.5.</span> async and await syntax <a href="https://peps.python.org/pep-0492/">https://peps.python.org/pep-0492/</a></h3>
<div class="outline-text-3" id="text-25-5">
<p>
princeples:
</p>
<ul class="org-ul">
<li>should not be tied to any specific <b>Event Loop</b> implementation (asyncio.events.AbstractEventLoop)</li>
<li><b>yield</b> as a signal to the scheduler, indicating that the coroutine will be waiting until an event (such as
IO) is completed.</li>
<li><b>async def</b> can contain <b>await</b> expressions.</li>
<li>SyntaxError to have <b>yield</b> or <b>yield from</b> expressions in an <b>async def</b> function.</li>
<li>Regular generators, when called, return a <b>generator object</b>; similarly, coroutines return a <b>coroutine object</b>.</li>
<li>decorator <b>@types.coroutine</b> clearly define makes generators a <b>coroutine object</b>, generator-based coroutine.</li>
</ul>
</div>
</div>

<div id="outline-container-org313075d" class="outline-3">
<h3 id="org313075d"><span class="section-number-3">25.6.</span> hight-level API - asyncio.run</h3>
<div class="outline-text-3" id="text-25-6">
<p>
just create new loop and execute one task in it
</p>
<pre class="example">
with Runner(debug=debug) as runner:
       return runner.run(main)
</pre>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> time
<span style="color: #cae682;">start_time</span> = time.time()

<span style="color: #8ac6f2; font-weight: bold;">import</span> asyncio
<span style="color: #8ac6f2; font-weight: bold;">async def</span> <span style="color: #cae682; font-weight: bold;">main</span>():
    <span style="color: #8ac6f2; font-weight: bold;">await</span> asyncio.sleep(2)
    <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">'hello'</span>)
    <span style="color: #8ac6f2; font-weight: bold;">return</span> 2

<span style="color: #e5786d;">print</span> (asyncio.run(main()))
<span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"--- %s seconds ---"</span> % (time.time() - start_time))
<span style="color: #e5786d;">print</span> (asyncio.run(main()))
<span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"--- %s seconds ---"</span> % (time.time() - start_time))
</pre>
</div>

<pre class="example">
hello
2
--- 2.0029571056365967 seconds ---
hello
2
--- 4.005870580673218 seconds ---
</pre>
</div>
</div>

<div id="outline-container-org49a4403" class="outline-3">
<h3 id="org49a4403"><span class="section-number-3">25.7.</span> hight-level API - asyncio.Runner</h3>
<div class="outline-text-3" id="text-25-7">
<p>
create loop and ContextVars -
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> time
<span style="color: #cae682;">start_time</span> = time.time()

<span style="color: #8ac6f2; font-weight: bold;">import</span> asyncio
<span style="color: #8ac6f2; font-weight: bold;">async def</span> <span style="color: #cae682; font-weight: bold;">main</span>():
    <span style="color: #8ac6f2; font-weight: bold;">await</span> asyncio.sleep(2)
    <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">'hello'</span>)
    <span style="color: #8ac6f2; font-weight: bold;">return</span> 2

<span style="color: #8ac6f2; font-weight: bold;">with</span> asyncio.Runner() <span style="color: #8ac6f2; font-weight: bold;">as</span> runner:
    <span style="color: #e5786d;">print</span> (runner.run(main()))
    <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"--- %s seconds ---"</span> % (time.time() - start_time))
    <span style="color: #e5786d;">print</span> (runner.run(main()))
    <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"--- %s seconds ---"</span> % (time.time() - start_time))
</pre>
</div>

<pre class="example">
hello
2
--- 2.003290891647339 seconds ---
hello
2
--- 4.006376266479492 seconds ---
</pre>
</div>
</div>

<div id="outline-container-org9b9e1d0" class="outline-3">
<h3 id="org9b9e1d0"><span class="section-number-3">25.8.</span> low-level API - get<sub>running</sub><sub>loop</sub> &amp; new<sub>event</sub><sub>loop</sub> &amp; run<sub>until</sub><sub>complete</sub></h3>
<div class="outline-text-3" id="text-25-8">
<p>
timeout=40 available only at top level, not inside ss() normal function
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> asyncio
<span style="color: #8ac6f2; font-weight: bold;">async def</span> <span style="color: #cae682; font-weight: bold;">run_command</span>():
    <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"asd"</span>)


<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">ss</span>():
    <span style="color: #8ac6f2; font-weight: bold;">try</span>:
        <span style="color: #cae682;">loop</span> = asyncio.get_running_loop()
    <span style="color: #8ac6f2; font-weight: bold;">except</span> <span style="color: #92a65e; font-weight: bold;">RuntimeError</span>:
        <span style="color: #cae682;">loop</span> = asyncio.new_event_loop()
        asyncio.set_event_loop(loop)

    loop.run_until_complete(run_command(), timeout=40) <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">cause: RuntimeWarning: Enable tracemalloc to get the object allocation traceback</span>
    <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"sdff1"</span>)
    asyncio.run(run_command())
    <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"sdff2"</span>)

ss()
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">OR JUST</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">asyncio.run(run_command()) # out created or exiten loop used</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> asyncio
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">import time</span>
<span style="color: #8ac6f2; font-weight: bold;">async def</span> <span style="color: #cae682; font-weight: bold;">run_command2</span>():
    <span style="color: #8ac6f2; font-weight: bold;">await</span> asyncio.sleep(22)
    <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"222"</span>)
    <span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #95e454;">"ggg"</span>

<span style="color: #8ac6f2; font-weight: bold;">async def</span> <span style="color: #cae682; font-weight: bold;">run_command</span>():
    <span style="color: #8ac6f2; font-weight: bold;">try</span>:
        <span style="color: #cae682;">line</span> = <span style="color: #8ac6f2; font-weight: bold;">await</span> asyncio.wait_for(run_command2(),
                                      timeout=1.0)
    <span style="color: #8ac6f2; font-weight: bold;">except</span> <span style="color: #92a65e; font-weight: bold;">TimeoutError</span>:
        <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">'timeout!'</span>)
    <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"asd"</span>, line)

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">def ss():</span>
<span style="color: #fa8072;">#     </span><span style="color: #99968b; font-style: italic;"># try:</span>
<span style="color: #fa8072;">#     </span><span style="color: #99968b; font-style: italic;">#     loop = asyncio.get_running_loop()</span>
<span style="color: #fa8072;">#     </span><span style="color: #99968b; font-style: italic;"># except RuntimeError:</span>
<span style="color: #fa8072;">#     </span><span style="color: #99968b; font-style: italic;">#     loop = asyncio.new_event_loop()</span>
<span style="color: #fa8072;">#     </span><span style="color: #99968b; font-style: italic;">#     asyncio.set_event_loop(loop)</span>

<span style="color: #fa8072;">#     </span><span style="color: #99968b; font-style: italic;"># loop.run_until_complete(run_command()) # , timeout=40 cause: RuntimeWarning: Enable tracemalloc to get the object allocation traceback</span>
<span style="color: #fa8072;">#     </span><span style="color: #99968b; font-style: italic;"># print("sdff1")</span>
<span style="color: #fa8072;">#     </span><span style="color: #99968b; font-style: italic;">asyncio.run(run_command())</span>
<span style="color: #fa8072;">#     </span><span style="color: #99968b; font-style: italic;">print("sdff2")</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">ss()</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">OR JUST</span>
asyncio.run(run_command()) <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">out created or exiten loop used</span>
</pre>
</div>

<pre class="example">
asd
sdff1
asd
sdff2
asd
</pre>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> asyncio

<span style="color: #8ac6f2; font-weight: bold;">async def</span> <span style="color: #cae682; font-weight: bold;">eternity</span>():
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Sleep for one hour</span>
    <span style="color: #8ac6f2; font-weight: bold;">await</span> asyncio.sleep(3600)
    <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">'yay!'</span>)

<span style="color: #8ac6f2; font-weight: bold;">async def</span> <span style="color: #cae682; font-weight: bold;">main</span>():
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Wait for at most 1 second</span>
    <span style="color: #8ac6f2; font-weight: bold;">try</span>:
        <span style="color: #8ac6f2; font-weight: bold;">await</span> asyncio.wait_for(eternity(), timeout=1.0)
    <span style="color: #8ac6f2; font-weight: bold;">except</span> <span style="color: #92a65e; font-weight: bold;">TimeoutError</span>:
        <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">'timeout!'</span>)

asyncio.run(main())

</pre>
</div>

<pre class="example">
timeout!
</pre>
</div>
</div>

<div id="outline-container-orgc444252" class="outline-3">
<h3 id="orgc444252"><span class="section-number-3">25.9.</span> async with</h3>
<div class="outline-text-3" id="text-25-9">
<p>
Object with _<sub>aenter</sub>_<sub>()</sub> and  _<sub>aexit</sub>_<sub>()</sub>
</p>
<ul class="org-ul">
<li>lets Python programs perform asynchronous calls when entering and exiting a runtime context</li>
<li>easy to implement proper database transaction managers for coroutines.</li>
</ul>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">create and use an asynchronous context manager</span>
<span style="color: #8ac6f2; font-weight: bold;">async with</span> AsyncContextManager() <span style="color: #8ac6f2; font-weight: bold;">as</span> manager:
        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">...</span>

<span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">Equal to:</span>
<span style="color: #cae682;">manager</span> = <span style="color: #8ac6f2; font-weight: bold;">await</span> AsyncContextManager()
<span style="color: #8ac6f2; font-weight: bold;">try</span>:
        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">...</span>
<span style="color: #8ac6f2; font-weight: bold;">finally</span>: <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">see for correct: https://peps.python.org/pep-0492/#new-syntax</span>
        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">close or exit the context manager</span>
        <span style="color: #8ac6f2; font-weight: bold;">await</span> manager.close()



<span style="color: #8ac6f2; font-weight: bold;">async with</span> lock:
    ...
instead of:

<span style="color: #8ac6f2; font-weight: bold;">with</span> (<span style="color: #8ac6f2; font-weight: bold;">yield</span> <span style="color: #8ac6f2; font-weight: bold;">from</span> lock):
    ...




<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">easy to implement proper database transaction managers for coroutines:</span>
<span style="color: #8ac6f2; font-weight: bold;">async def</span> <span style="color: #cae682; font-weight: bold;">commit</span>(session, data):
    ...

    <span style="color: #8ac6f2; font-weight: bold;">async with</span> session.transaction():
        ...
        <span style="color: #8ac6f2; font-weight: bold;">await</span> session.update(data)
        ...
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd72b1b6" class="outline-3">
<h3 id="orgd72b1b6"><span class="section-number-3">25.10.</span> async for</h3>
<div class="outline-text-3" id="text-25-10">
<p>
Object with
</p>
<ul class="org-ul">
<li>_<sub>aiter</sub>_<sub>()</sub> - returns <b>asynchronous iterator</b> object</li>
<li>_<sub>anext</sub>_<sub>()</sub> - returns <b>awaitable</b>. can rise StopAsyncIteration exception.</li>
</ul>

<p>
Makes it possible to perform asynchronous calls in iterators. see <a href="#org6092d13">17.1</a>
</p>

<p>
aiter() - built-in. Equivalent to calling x._<sub>aiter</sub>_<sub>()</sub>.
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">AsyncIterable</span>:
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">__aiter__</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>):
        <span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #8ac6f2; font-weight: bold;">self</span>

    <span style="color: #8ac6f2; font-weight: bold;">async def</span> <span style="color: #cae682; font-weight: bold;">__anext__</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>):
        <span style="color: #cae682;">data</span> = <span style="color: #8ac6f2; font-weight: bold;">await</span> <span style="color: #8ac6f2; font-weight: bold;">self</span>.fetch_data()
        <span style="color: #8ac6f2; font-weight: bold;">if</span> data:
            <span style="color: #8ac6f2; font-weight: bold;">return</span> data
        <span style="color: #8ac6f2; font-weight: bold;">else</span>:
            <span style="color: #8ac6f2; font-weight: bold;">raise</span> <span style="color: #92a65e; font-weight: bold;">StopAsyncIteration</span>

    <span style="color: #8ac6f2; font-weight: bold;">async def</span> <span style="color: #cae682; font-weight: bold;">fetch_data</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>):
        ...

<span style="color: #8ac6f2; font-weight: bold;">async for</span> TARGET <span style="color: #8ac6f2; font-weight: bold;">in</span> ITER:
    BLOCK
<span style="color: #8ac6f2; font-weight: bold;">else</span>:
    BLOCK2
</pre>
</div>
</div>
</div>
<div id="outline-container-org4bf0bea" class="outline-3">
<h3 id="org4bf0bea"><span class="section-number-3">25.11.</span> <span class="todo TODO">TODO</span> Asynchronous Generators</h3>
<div class="outline-text-3" id="text-25-11">
<p>
<a href="https://peps.python.org/pep-0525/">https://peps.python.org/pep-0525/</a>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">async def</span> <span style="color: #cae682; font-weight: bold;">asyncgen</span>():  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">an asynchronous generator function</span>
    <span style="color: #8ac6f2; font-weight: bold;">await</span> asyncio.sleep(0.1)
    <span style="color: #8ac6f2; font-weight: bold;">yield</span> 42

<span style="color: #8ac6f2; font-weight: bold;">async for</span> i <span style="color: #8ac6f2; font-weight: bold;">in</span> asyncgen():
    <span style="color: #e5786d;">print</span>(i)
</pre>
</div>

<p>
with FastAPI
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">from</span> collections.abc <span style="color: #8ac6f2; font-weight: bold;">import</span> AsyncGenerator
<span style="color: #8ac6f2; font-weight: bold;">async def</span> <span style="color: #cae682; font-weight: bold;">get_redis_pool</span>() -&gt; AsyncGenerator[Int]:
    <span style="color: #8ac6f2; font-weight: bold;">yield</span> Int(1)

<span style="color: #8ac6f2; font-weight: bold;">async def</span> <span style="color: #cae682; font-weight: bold;">get_redis</span>(r: Redis = Depends(get_redis_pool)) -&gt; Redis:
    <span style="color: #8ac6f2; font-weight: bold;">return</span> r

</pre>
</div>
</div>
</div>

<div id="outline-container-org7b7a8b9" class="outline-3">
<h3 id="org7b7a8b9"><span class="section-number-3">25.12.</span> Troubleshooting</h3>
<div class="outline-text-3" id="text-25-12">
<pre class="example">
RuntimeWarning: coroutine 'sleep' was never awaited   asyncio.sleep(22)
RuntimeWarning: Enable tracemalloc to get the object allocation traceback
</pre>

<p>
Solution
</p>
</div>
</div>
<div id="outline-container-orga414da5" class="outline-3">
<h3 id="orga414da5"><span class="section-number-3">25.13.</span> links</h3>
<div class="outline-text-3" id="text-25-13">
<p>
<a href="https://docs.python.org/3/library/asyncio.html">https://docs.python.org/3/library/asyncio.html</a>
</p>
</div>
</div>
</div>
<div id="outline-container-org1aca607" class="outline-2">
<h2 id="org1aca607"><span class="section-number-2">26.</span> Monkey patch (modification at runtile) Reflective or meta programming</h2>
<div class="outline-text-2" id="text-26">
<ul class="org-ul">
<li>instance.attribute = 23</li>
</ul>
</div>
<div id="outline-container-org04fbfad" class="outline-3">
<h3 id="org04fbfad"><span class="section-number-3">26.1.</span> theory</h3>
<div class="outline-text-3" id="text-26-1">
<dl class="org-dl">
<dt>Monkey Patching</dt><dd>is about modifying existing code at runtime. Ofter just reassing. (Ruby and Python)</dd>
<dt>Reflection</dt><dd>is about examining and modifying the structure and behavior of a program at runtime.</dd>
<dt>Metaprogramming</dt><dd>is about writing code that can manipulate other code at compile time or runtime.</dd>
</dl>
</div>
</div>

<div id="outline-container-orga0115e2" class="outline-3">
<h3 id="orga0115e2"><span class="section-number-3">26.2.</span> basic example</h3>
<div class="outline-text-3" id="text-26-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Without reflection</span>
<span style="color: #cae682;">obj</span> = Foo()
obj.hello()

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">With reflection</span>
<span style="color: #cae682;">obj</span> = <span style="color: #e5786d;">globals</span>()[<span style="color: #95e454;">"Foo"</span>]()
<span style="color: #e5786d;">getattr</span>(obj, <span style="color: #95e454;">"hello"</span>)()

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">With eval</span>
<span style="color: #e5786d;">eval</span>(<span style="color: #95e454;">"Foo().hello()"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org9b083ed" class="outline-3">
<h3 id="org9b083ed"><span class="section-number-3">26.3.</span> replace method of class instance</h3>
<div class="outline-text-3" id="text-26-3">
</div>
<div id="outline-container-orgb5fb7b6" class="outline-4">
<h4 id="orgb5fb7b6"><span class="section-number-4">26.3.1.</span> Monkey patch</h4>
<div class="outline-text-4" id="text-26-3-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">from</span> somemodule <span style="color: #8ac6f2; font-weight: bold;">import</span> testMOD

<span style="color: #cae682;">mytest</span> = testMOD()

<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">alternativeFunc</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>, variable):
    <span style="color: #cae682;">var</span> = variable
    <span style="color: #8ac6f2; font-weight: bold;">self</span>.<span style="color: #cae682;">something</span> = var + 1.2

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Replace the method</span>
testMOD.<span style="color: #cae682;">testFunc</span> = alternativeFunc

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Now, calling mytest.testFunc will execute alternativeFunc</span>
mytest.testFunc(12)
</pre>
</div>
</div>
</div>
<div id="outline-container-org0cae45c" class="outline-4">
<h4 id="org0cae45c"><span class="section-number-4">26.3.2.</span> types.MethodType</h4>
<div class="outline-text-4" id="text-26-3-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> types

<span style="color: #8ac6f2; font-weight: bold;">from</span> somemodule <span style="color: #8ac6f2; font-weight: bold;">import</span> testMOD

<span style="color: #cae682;">mytest</span> = testMOD()

<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">alternativeFunc</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>, variable):
    <span style="color: #cae682;">var</span> = variable
    <span style="color: #8ac6f2; font-weight: bold;">self</span>.<span style="color: #cae682;">something</span> = var + 1.2

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Replace the method using types.MethodType</span>
mytest.<span style="color: #cae682;">testFunc</span> = types.MethodType(alternativeFunc, mytest)

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Now, calling mytest.testFunc will execute alternativeFunc</span>
mytest.testFunc(12)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcd370d7" class="outline-4">
<h4 id="orgcd370d7"><span class="section-number-4">26.3.3.</span> Subclassing</h4>
<div class="outline-text-4" id="text-26-3-3">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">from</span> somemodule <span style="color: #8ac6f2; font-weight: bold;">import</span> testMOD

<span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">MyTestMOD</span>(testMOD):
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">testFunc</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>, variable):
        <span style="color: #cae682;">var</span> = variable
        <span style="color: #8ac6f2; font-weight: bold;">self</span>.<span style="color: #cae682;">something</span> = var + 1.2

<span style="color: #cae682;">mytest</span> = MyTestMOD()
mytest.testFunc(12)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgd205b1b" class="outline-3">
<h3 id="orgd205b1b"><span class="section-number-3">26.4.</span> detect event of variable changed</h3>
<div class="outline-text-3" id="text-26-4">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">ExistingClass</span>:
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">__init__</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>, value):
        <span style="color: #8ac6f2; font-weight: bold;">self</span>.<span style="color: #cae682;">value</span> = value


<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">value_getter</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>):
    <span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #8ac6f2; font-weight: bold;">self</span>._value
<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">value_setter</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>, value):
    <span style="color: #e5786d;">print</span>(f<span style="color: #95e454;">"Value changed </span>{value}<span style="color: #95e454;">"</span>)
    <span style="color: #8ac6f2; font-weight: bold;">self</span>.<span style="color: #cae682;">_value</span> = value

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Monkey patch the ExistingClass to add the property setter</span>
ExistingClass.<span style="color: #cae682;">value</span> = <span style="color: #e5786d;">property</span>(value_getter, value_setter)

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Create an instance of ExistingClass</span>
<span style="color: #cae682;">obj</span> = ExistingClass(10)

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Change the value of obj</span>
obj.<span style="color: #cae682;">value</span> = 20
<span style="color: #e5786d;">print</span>(obj.value)
</pre>
</div>

<pre class="example">
Value changed 10
Value changed 20
20
</pre>
</div>
</div>

<div id="outline-container-orgd965c47" class="outline-3">
<h3 id="orgd965c47"><span class="section-number-3">26.5.</span> inspect.getmembers() vs <span class="underline"><span class="underline">dict</span></span>.items() vs dir()</h3>
<div class="outline-text-3" id="text-26-5">
<ul class="org-ul">
<li>dir() and inspect.getmembers() are basically the same,</li>
<li>_<sub>dict</sub>__ is the complete namespace including metaclass attributes.</li>
</ul>
</div>
</div>
<div id="outline-container-orgd851d45" class="outline-3">
<h3 id="orgd851d45"><span class="section-number-3">26.6.</span> ex replace function</h3>
<div class="outline-text-3" id="text-26-6">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> werkzeug.serving
<span style="color: #8ac6f2; font-weight: bold;">import</span> functools

<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">wrap_function</span>(oldfunction, newfunction):
    <span style="color: #92a65e; font-weight: bold;">@functools.wraps</span>(oldfunction)
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">run</span>(*args): <span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">, **kwargs</span>
        <span style="color: #8ac6f2; font-weight: bold;">return</span> newfunction(oldfunction, *args) <span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">, **kwargs</span>
    <span style="color: #8ac6f2; font-weight: bold;">return</span> run

<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">generate_adhoc_ssl_pair2</span>(oldfunc, parameter=<span style="color: #e5786d; font-weight: bold;">None</span>):
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Do some processing or something to customize the parameters to pass</span>
    <span style="color: #cae682;">c</span>, <span style="color: #cae682;">k</span> = oldfunc(parameter)
    <span style="color: #e5786d;">print</span>(c, c.public_key().public_numbers())
    <span style="color: #8ac6f2; font-weight: bold;">return</span> c,k


werkzeug.serving.<span style="color: #cae682;">generate_adhoc_ssl_pair</span> = wrap_function(
        werkzeug.serving.generate_adhoc_ssl_pair, generate_adhoc_ssl_pair2)

</pre>
</div>
</div>
</div>
<div id="outline-container-org266623c" class="outline-3">
<h3 id="org266623c"><span class="section-number-3">26.7.</span> ex replace method of class</h3>
<div class="outline-text-3" id="text-26-7">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> werkzeug.serving

<span style="color: #cae682;">oldfunc</span> = werkzeug.serving.BaseWSGIServer.__init__

<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">myinit</span>(*args, **kwargs):
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Do some processing or something to customize the parameters to pass</span>
    oldfunc(*args, **kwargs)
    <span style="color: #e5786d;">print</span>(<span style="color: #e5786d;">dir</span>(args[0].ssl_context))

werkzeug.serving.BaseWSGIServer.<span style="color: #cae682;">__init__</span> = myinit

</pre>
</div>
</div>
</div>
<div id="outline-container-orga5b829d" class="outline-3">
<h3 id="orga5b829d"><span class="section-number-3">26.8.</span> links</h3>
<div class="outline-text-3" id="text-26-8">
<p>
<a href="https://docs.python.org/3/c-api/reflection.html">https://docs.python.org/3/c-api/reflection.html</a>
</p>
</div>
</div>
</div>
<div id="outline-container-org5b1165a" class="outline-2">
<h2 id="org5b1165a"><span class="section-number-2">27.</span> Performance Tips</h2>
<div class="outline-text-2" id="text-27">
<p>
<a href="https://wiki.python.org/moin/PythonSpeed/PerformanceTips">https://wiki.python.org/moin/PythonSpeed/PerformanceTips</a>
</p>
</div>
<div id="outline-container-org81a7df6" class="outline-3">
<h3 id="org81a7df6"><span class="section-number-3">27.1.</span> string</h3>
<div class="outline-text-3" id="text-27-1">
<ul class="org-ul">
<li>Avoid:
<ul class="org-ul">
<li>out = "&lt;html&gt;" + head + prologue + query + tail + "&lt;/html&gt;"</li>
</ul></li>
<li>Instead, use
<ul class="org-ul">
<li>out = "&lt;html&gt;%s%s%s%s&lt;/html&gt;" % (head, prologue, query, tail)</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org1eb807b" class="outline-3">
<h3 id="org1eb807b"><span class="section-number-3">27.2.</span> loop</h3>
<div class="outline-text-3" id="text-27-2">
<ul class="org-ul">
<li>map(function, list)</li>
<li>iterator = (s.upper() for s in oldlist)</li>
</ul>
</div>
</div>


<div id="outline-container-org3355ac8" class="outline-3">
<h3 id="org3355ac8"><span class="section-number-3">27.3.</span> Avoiding dots&#x2026;</h3>
<div class="outline-text-3" id="text-27-3">
<ul class="org-ul">
<li><a href="https://docs.python.org/3.8/library/functions.html">https://docs.python.org/3.8/library/functions.html</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgffd228e" class="outline-3">
<h3 id="orgffd228e"><span class="section-number-3">27.4.</span> avoid global variables</h3>
</div>
<div id="outline-container-orgf5c13c4" class="outline-3">
<h3 id="orgf5c13c4"><span class="section-number-3">27.5.</span> dict</h3>
<div class="outline-text-3" id="text-27-5">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #cae682;">wdict</span> = {}
<span style="color: #8ac6f2; font-weight: bold;">for</span> word <span style="color: #8ac6f2; font-weight: bold;">in</span> words:
    <span style="color: #8ac6f2; font-weight: bold;">if</span> word <span style="color: #8ac6f2; font-weight: bold;">not</span> <span style="color: #8ac6f2; font-weight: bold;">in</span> wdict:
        <span style="color: #cae682;">wdict</span>[word] = 0
    <span style="color: #cae682;">wdict</span>[word] += 1

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Use:</span>

<span style="color: #cae682;">wdict</span> = {}
<span style="color: #8ac6f2; font-weight: bold;">for</span> word <span style="color: #8ac6f2; font-weight: bold;">in</span> words:
    <span style="color: #8ac6f2; font-weight: bold;">try</span>:
        <span style="color: #cae682;">wdict</span>[word] += 1
    <span style="color: #8ac6f2; font-weight: bold;">except</span> <span style="color: #92a65e; font-weight: bold;">KeyError</span>:
        <span style="color: #cae682;">wdict</span>[word] = 1

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">or:</span>
<span style="color: #cae682;">wdict</span> = {}
<span style="color: #cae682;">get</span> = wdict.get
<span style="color: #8ac6f2; font-weight: bold;">for</span> word <span style="color: #8ac6f2; font-weight: bold;">in</span> words:
    <span style="color: #cae682;">wdict</span>[word] = get(word, 0) + 1

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">or:</span>
wdict.setdefault(key, []).append(new_element)

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">or:</span>
<span style="color: #8ac6f2; font-weight: bold;">from</span> collections <span style="color: #8ac6f2; font-weight: bold;">import</span> defaultdict

<span style="color: #cae682;">wdict</span> = defaultdict(<span style="color: #e5786d;">int</span>)
<span style="color: #8ac6f2; font-weight: bold;">for</span> word <span style="color: #8ac6f2; font-weight: bold;">in</span> words:
    <span style="color: #cae682;">wdict</span>[word] += 1

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1436a78" class="outline-2">
<h2 id="org1436a78"><span class="section-number-2">28.</span> decorators</h2>
<div class="outline-text-2" id="text-28">
<ul class="org-ul">
<li>@property - <a href="#org7faf470">11.4</a> - function became read-only variable (getter)</li>
<li>@staticmethod - to static method, dont uses <b>self</b></li>
<li>@classmethod - it receives the class object as the first parameter instead of an instance of the class. May
be called for class C.f() or for instance C().f(), self.f(). Used for singleton.</li>
</ul>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Class Method</td>
<td class="org-left">Static Method</td>
</tr>
</tbody>
</table>
<p>
;;
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Defined as Mutable via inheritance</td>
<td class="org-left">Immutable via inheritance</td>
</tr>

<tr>
<td class="org-left">The first parameter as cls is to be taken in the class method.</td>
<td class="org-left">not needed</td>
</tr>
</tbody>
</table>


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Accession or modification of class state is done in a class method.</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Class methods are bound to know about class and access it.</td>
<td class="org-left">dont knew about class</td>
</tr>
</tbody>
</table>
</div>

<div id="outline-container-orgc7fa3ef" class="outline-3">
<h3 id="orgc7fa3ef"><span class="section-number-3">28.1.</span> ex</h3>
<div class="outline-text-3" id="text-28-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">d</span>(c):
   <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">'d'</span>, c)

<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">dec_2</span>(a):
    <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">'dec_2'</span>, a)
    <span style="color: #8ac6f2; font-weight: bold;">return</span> d


<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">dec_1</span>():
    <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">'dec_1'</span>)
    <span style="color: #8ac6f2; font-weight: bold;">return</span> dec_2


<span style="color: #92a65e; font-weight: bold;">@dec_1</span>()
<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">f</span>(v):
    <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">'f'</span>)

<span style="color: #e5786d;">print</span>(<span style="color: #95e454;">'s'</span>)
f(2)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3cf93dc" class="outline-2">
<h2 id="org3cf93dc"><span class="section-number-2">29.</span> Assert</h2>
<div class="outline-text-2" id="text-29">
<pre class="example">
assert Expression[, Arguments]
</pre>

<p>
If the expression is false, Python raises an <b>AssertionError</b> exception. Python uses <b>ArgumentExpression</b> as the
argument for the AssertionError.
</p>

<pre class="example">
assert False, "Error here"
</pre>


<p>
python.exe - The ``-O`` switch removes assert statements, the ``-OO`` switch removes both assert statements
and <span class="underline"><span class="underline">doc</span></span> strings.
</p>
</div>
</div>


<div id="outline-container-org4617205" class="outline-2">
<h2 id="org4617205"><span class="section-number-2">30.</span> Debugging and Profiling</h2>
<div class="outline-text-2" id="text-30">
<p>
<a href="https://habr.com/en/company/mailru/blog/201594/">https://habr.com/en/company/mailru/blog/201594/</a>
Profiling - сбор характеристик работы программы
</p>
<ul class="org-ul">
<li>Ручное
<ul class="org-ul">
<li>метод пристального взгляда - сложно оценить трудозатраты и результат</li>
<li>Ручное - подтвердить или опровергнуть гипотезу узкого места
<ul class="org-ul">
<li>time - Unix tool</li>
</ul></li>
</ul></li>
<li>статистический statistical профайлер - через маленькие промежутки времени берётся указатель на текущую
выполняемую функцию
<ul class="org-ul">
<li>gprof - Unix tool C, Pascal, or Fortran77</li>
<li>их не много</li>
</ul></li>
<li>событийный (deterministic, event-based) профайлер - отслеживает все вызовы функций, возвраты, исключения и
замеряет интервалы между этими событиями - возможно замедление работы программы в два и более раз
<ul class="org-ul">
<li>Python standard library provides:
<ul class="org-ul">
<li>profile - if cProfile is not available</li>
<li>cProfile</li>
</ul></li>
</ul></li>
<li>debugging</li>
</ul>
</div>
<div id="outline-container-org31b3c9c" class="outline-3">
<h3 id="org31b3c9c"><span class="section-number-3">30.1.</span> cProfile</h3>
<div class="outline-text-3" id="text-30-1">
<p>
primitive calls - without recursion
</p>
<dl class="org-dl">
<dt>ncalls</dt><dd>for the number of calls</dd>
<dt>tottime</dt><dd>time spent inside without subfunctions</dd>
<dt>percall</dt><dd>tottime/tottime</dd>
<dt>cumtime</dt><dd>time spent in this and all subfunctions and in recursion</dd>
<dt>percall</dt><dd>cumtime/ncalls</dd>
</dl>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> cProfile
<span style="color: #8ac6f2; font-weight: bold;">import</span> re
cProfile.run(<span style="color: #95e454;">'re.compile("foo|bar")'</span>, filename=<span style="color: #95e454;">'restats'</span>)
<span style="color: #fa8072;">#  </span><span style="color: #99968b; font-style: italic;">pstats.Stats class reads profile results from a file and formats them in various ways.</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">python -m cProfile [-o output_file] [-s sort_order] (-m module | myscript.py)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org84497aa" class="outline-3">
<h3 id="org84497aa"><span class="section-number-3">30.2.</span> small code measure 1</h3>
<div class="outline-text-3" id="text-30-2">
<p>
python3 -m timeit '"-".join(str(n) for n in range(100))'
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">test</span>():
    <span style="color: #f08080; font-style: italic;">"""Stupid test function"""</span>
    <span style="color: #cae682;">L</span> = [i <span style="color: #8ac6f2; font-weight: bold;">for</span> i <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">range</span>(100)]

<span style="color: #8ac6f2; font-weight: bold;">if</span> <span style="color: #e5786d;">__name__</span> == <span style="color: #95e454;">'__main__'</span>:
    <span style="color: #8ac6f2; font-weight: bold;">import</span> timeit
    <span style="color: #e5786d;">print</span>(timeit.timeit(<span style="color: #95e454;">"test()"</span>, setup=<span style="color: #95e454;">"from __main__ import test"</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-org0316390" class="outline-3">
<h3 id="org0316390"><span class="section-number-3">30.3.</span> small code measure 2 <a id="org6f854bc"></a></h3>
<div class="outline-text-3" id="text-30-3">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> time
<span style="color: #cae682;">start_time</span> = time.time()
main()
<span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"--- %s seconds ---"</span> % (time.time() - start_time))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgeb85a11" class="outline-3">
<h3 id="orgeb85a11"><span class="section-number-3">30.4.</span> pdb - breakpoint and code investigation</h3>
<div class="outline-text-3" id="text-30-4">
<pre class="example">
python3 -m pdb app.py arg1 arg2
</pre>

<ul class="org-ul">
<li>built-in breakpoint() function that calls pdb.</li>
</ul>


<p>
pdb commands: <a href="https://docs.python.org/3/library/pdb.html">https://docs.python.org/3/library/pdb.html</a>
</p>
<ul class="org-ul">
<li>s(step)	dive in</li>
<li>n(next)	step over</li>
<li>unt(il) [lineno]</li>
<li>r(eturn)</li>
<li>c(ontinue)</li>

<li>l .		List the source code around the current line or continue list</li>
<li>b		list breakpoints</li>
<li>clear	Clear a breakpoint by its index.</li>

<li>where	Display the current call stack.</li>
<li>args		Print the argument list of the current function.</li>

<li>p/pp		evaluate expression
<ul class="org-ul">
<li>p locals()</li>
<li>p globals()</li>
</ul></li>
<li>run/quit</li>
</ul>
</div>
</div>


<div id="outline-container-org8ebacb2" class="outline-3">
<h3 id="org8ebacb2"><span class="section-number-3">30.5.</span> pdb - .pdbrc file <a id="orgf065ffa"></a></h3>
<div class="outline-text-3" id="text-30-5">
<p>
steps:
</p>
<ol class="org-ol">
<li>create ~/.pdbrc</li>
<li>python -m pdb file.py</li>
</ol>
<div class="org-src-container">
<pre class="src src-python">b /usr/lib/python3.12/site-packages/redis/cluster.py:1145
commands 1
pp redis_node, connection, command
end
<span style="color: #8ac6f2; font-weight: bold;">continue</span>
</pre>
</div>


<p>
commands:
</p>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">b /usr/lib/python3.12/site-packages/redis/cluster.py:1145</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">commands 1</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">pp redis_node, connection, command</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">end</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">b /usr/lib/python3.12/site-packages/redis/cluster.py:1143</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;"># b /usr/lib/python3.12/site-packages/redis/connection.py:275</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">commands 1</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">pp asking, command, target_node, self.nodes_manager.nodes_cache.values()</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">end</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">b /usr/lib/python3.12/site-packages/redis/cluster.py:1152</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">commands 1</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">p "wwwww", response</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">end</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;"># target_node</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">b /usr/lib/python3.12/site-packages/redis/cluster.py:1500</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">commands 2</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">p "----initialize---"</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">end</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">continue</span>

b /usr/lib/python3.12/site-packages/redis/client.py:310
commands 1
p <span style="color: #8ac6f2; font-weight: bold;">self</span>.connection_pool
end

</pre>
</div>
</div>
</div>
<div id="outline-container-orgc1afd90" class="outline-3">
<h3 id="orgc1afd90"><span class="section-number-3">30.6.</span> <span class="todo TODO">TODO</span> py-spy, pyinstrument</h3>
</div>
</div>
<div id="outline-container-org34b5297" class="outline-2">
<h2 id="org34b5297"><span class="section-number-2">31.</span> inject</h2>
<div class="outline-text-2" id="text-31">
<p>
<a href="https://github.com/ivankorobkov/python-inject">https://github.com/ivankorobkov/python-inject</a>
Dependency injection
</p>
</div>
<div id="outline-container-orgda0967f" class="outline-3">
<h3 id="orgda0967f"><span class="section-number-3">31.1.</span> Callable</h3>
<div class="outline-text-3" id="text-31-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> inject
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">configuration</span>
inject.configure(<span style="color: #8ac6f2; font-weight: bold;">lambda</span> binder: binder.bind_to_provider(<span style="color: #95e454;">'predict'</span>, <span style="color: #8ac6f2; font-weight: bold;">lambda</span>: predict))
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">or</span>
<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">my_config</span>(binder):
  binder.bind_to_provider(<span style="color: #95e454;">'predict'</span>, <span style="color: #8ac6f2; font-weight: bold;">lambda</span>: predict)
inject.configure(my_config)

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">usage</span>
<span style="color: #92a65e; font-weight: bold;">@inject.params</span>(predict=<span style="color: #95e454;">'predict'</span>)  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">param name to a binder key.</span>
<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">detect_advanced</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>, predict=<span style="color: #e5786d; font-weight: bold;">None</span>) -&gt; (<span style="color: #e5786d;">int</span>, <span style="color: #e5786d;">any</span>):
</pre>
</div>
</div>
</div>

<div id="outline-container-orga6de37c" class="outline-3">
<h3 id="orga6de37c"><span class="section-number-3">31.2.</span> links</h3>
<div class="outline-text-3" id="text-31-2">
<p>
<a href="https://github.com/ivankorobkov/python-inject">https://github.com/ivankorobkov/python-inject</a>
</p>
</div>
</div>
</div>

<div id="outline-container-org8a54254" class="outline-2">
<h2 id="org8a54254"><span class="section-number-2">32.</span> BUILD and PACKAGING</h2>
<div class="outline-text-2" id="text-32">
<p>
<b>setup.py</b> - dustutils and setuptools (based on) was most widely used approach. Since PEP 517, PEP 518 -
 <b>pyproject.toml</b> is recommended format for package.
</p>
</div>



<div id="outline-container-org6ce90e2" class="outline-3">
<h3 id="org6ce90e2"><span class="section-number-3">32.1.</span> build tools:</h3>
<div class="outline-text-3" id="text-32-1">
<p>
<b>frontend</b> - read pyproject.toml
</p>
<ul class="org-ul">
<li>pip</li>
<li>build</li>
<li>gpep517 - gentoo tool <a href="https://github.com/projg2/gpep517">https://github.com/projg2/gpep517</a></li>
<li>hatch</li>
</ul>

<p>
<b>backend</b> - defined in [build-system]-&gt;build-backend, create the build artifacts, dictates what additional
 information is required in the pyproject.toml file
</p>
<ul class="org-ul">
<li>Hatch or Hatchling</li>
<li>setuptools</li>
<li>Flit</li>
<li>PDM</li>
</ul>
</div>
<div id="outline-container-org8dbdc5f" class="outline-4">
<h4 id="org8dbdc5f"><span class="section-number-4">32.1.1.</span> hatchling</h4>
<div class="outline-text-4" id="text-32-1-1">
<p>
backend and frontend
</p>

<pre class="example">
hatch build /path/to/project
</pre>
</div>

<ol class="org-ol">
<li><a id="org1b2d5d9"></a>links<br />
<div class="outline-text-5" id="text-32-1-1-1">
<ul class="org-ul">
<li><a href="https://pypi.org/project/hatchling/">https://pypi.org/project/hatchling/</a></li>
<li><a href="https://github.com/pypa/hatch">https://github.com/pypa/hatch</a></li>
<li>doc <a href="https://hatch.pypa.io/">https://hatch.pypa.io/</a></li>
</ul>
</div>
</li>
</ol>
</div>
<div id="outline-container-org88f7378" class="outline-4">
<h4 id="org88f7378"><span class="section-number-4">32.1.2.</span> setuptools</h4>
<div class="outline-text-4" id="text-32-1-2">
<p>
build backend
</p>

<p>
collection of enhancements to the Python distutils that allow you to more easily build and distribute Python
 distributions, especially ones that have dependencies on other packages.
</p>

<p>
defines the dependencies for a single project, Requirements Files are often used to define the requirements
for a complete Python environment.
</p>

<p>
It is not considered best practice to use install<sub>requires</sub> to pin dependencies to specific versions, or to
 specify sub-dependencies (i.e. dependencies of your dependencies).
</p>
</div>
<ol class="org-ol">
<li><a id="org4b851fb"></a>ex setup.cfg<br />
<div class="outline-text-5" id="text-32-1-2-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #cae682;">install_requires</span>=[
   <span style="color: #95e454;">'A&gt;=1,&lt;2'</span>, <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">not allow v2</span>
   <span style="color: #95e454;">'B&gt;=2'</span>
]
</pre>
</div>
</div>
</li>
<li><a id="org88eadc6"></a>old way<br />
<div class="outline-text-5" id="text-32-1-2-2">
<p>
install
</p>
<ul class="org-ul">
<li>python setup.py build</li>
<li>python setup.py install &#x2013;install-lib ~/.local/lib/python3.10/site-packages/</li>
</ul>
</div>
</li>

<li><a id="orgfcc4c6b"></a>links<br />
<div class="outline-text-5" id="text-32-1-2-3">
<ul class="org-ul">
<li><a href="https://pypi.org/project/setuptools">https://pypi.org/project/setuptools</a></li>
<li><a href="https://github.com/pypa/setuptools">https://github.com/pypa/setuptools</a></li>
<li>toml <a href="https://setuptools.pypa.io/en/latest/userguide/pyproject_config.html">https://setuptools.pypa.io/en/latest/userguide/pyproject_config.html</a></li>
</ul>
</div>
</li>
</ol>
</div>
<div id="outline-container-org2f1a565" class="outline-4">
<h4 id="org2f1a565"><span class="section-number-4">32.1.3.</span> gpep517 <a id="org416086e"></a></h4>
<div class="outline-text-4" id="text-32-1-3">
<p>
a minimal tool to aid building wheels for Python packages
</p>

<pre class="example">
gpep517 build-wheel --backend setuptools.build_meta --output-fd 3 --wheel-dir /var/tmp/portage/dev-python/flask-2.3.2/work/Flask-2.3.2-python3_11/wheel
gpep517 install-wheel --destdir=/var/tmp/portage/dev-python/flask-2.3.2/work/Flask-2.3.2-python3_11/install --interpreter=/usr/bin/python3.11 --prefix=/usr --optimize=all /var/tmp/portage/dev-python/flask-2.3.2/work/Flask-2.3.2-python3_11/wheel/Flask-2.3.2-py3-none-any.whl
</pre>


<p>
commands:
</p>
<dl class="org-dl">
<dt>get-backend</dt><dd>to read build-backend from pyproject.toml (auxiliary command).</dd>
<dt>build-wheel</dt><dd>to call the respeective PEP 517 backend in order to produce a wheel.</dd>
<dt>install-wheel</dt><dd>to install a wheel into the specified directory,</dd>
<dt>install-from-source</dt><dd>that combines building a wheel and installing it (without leaving the artifacts),</dd>
<dt>verify-pyc</dt><dd>to verify that the .pyc files in the specified install tree are correct and up-to-date.</dd>
</dl>
</div>


<ol class="org-ol">
<li><a id="org74abb5d"></a>links<br />
<div class="outline-text-5" id="text-32-1-3-1">
<ul class="org-ul">
<li><a href="https://pypi.org/project/gpep517/">https://pypi.org/project/gpep517/</a></li>
<li><a href="https://github.com/projg2/gpep517">https://github.com/projg2/gpep517</a></li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-org7d50e7e" class="outline-3">
<h3 id="org7d50e7e"><span class="section-number-3">32.2.</span> toml format for pyproject.toml</h3>
<div class="outline-text-3" id="text-32-2">
<p>
Tom's Obvious Minimal Language
</p>
</div>
<div id="outline-container-org7231199" class="outline-4">
<h4 id="org7231199"><span class="section-number-4">32.2.1.</span> basic</h4>
<div class="outline-text-4" id="text-32-2-1">
<ul class="org-ul">
<li>\b         - backspace       (U+0008)</li>
<li>\t         - tab             (U+0009)</li>
<li>\n         - linefeed        (U+000A)</li>
<li>\f         - form feed       (U+000C)</li>
<li>\r         - carriage return (U+000D)</li>
<li>\"         - quote           (U+0022)</li>
<li>\\         - backslash       (U+005C)</li>
<li>\uXXXX     - unicode         (U+XXXX)</li>
<li>\UXXXXXXXX - unicode         (U+XXXXXXXX)</li>
</ul>
<div class="org-src-container">
<pre class="src src-conf"><span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">This is a TOML comment</span>
<span style="color: #cae682;">str1</span> = <span style="color: #95e454;">"I'm a string."</span>
<span style="color: #cae682;">str2</span> = <span style="color: #95e454;">"You can \"quote\" me."</span>
<span style="color: #cae682;">str3</span> = <span style="color: #95e454;">"Name\tJos\u00E9\nLoc\tSF."</span>

<span style="color: #cae682;">str1</span> = <span style="color: #95e454;">"""</span>
<span style="color: #95e454;">Roses are red</span>
<span style="color: #95e454;">Violets are blue"""</span>

<span style="color: #cae682;">str2</span> = <span style="color: #95e454;">"""\</span>
<span style="color: #95e454;">  The quick brown \</span>
<span style="color: #95e454;">  fox jumps over \</span>
<span style="color: #95e454;">  the lazy dog.\</span>
<span style="color: #95e454;">  """</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Literal strings - No escaping is performed so what you see is what you get</span>
<span style="color: #cae682;">path</span> = <span style="color: #95e454;">'C:\Users\nodejs\templates'</span>
<span style="color: #cae682;">path2</span> = <span style="color: #95e454;">'\\User\admin$\system32'</span>
<span style="color: #cae682;">quoted</span> = <span style="color: #95e454;">'Tom "Dubs" Preston-Werner'</span>
<span style="color: #cae682;">regex</span> = <span style="color: #95e454;">'&lt;\i\c*\s*&gt;'</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">multi-line literal strings</span>
<span style="color: #cae682;">re</span> = <span style="color: #95e454;">'''I [dw]on'</span>t need \d{2} apples<span style="color: #95e454;">'''</span>
<span style="color: #95e454;">lines = '''</span>
The first newline is
trimmed in raw strings.
All other whitespace
is preserved.
<span style="color: #95e454;">'''</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org87c3555" class="outline-4">
<h4 id="org87c3555"><span class="section-number-4">32.2.2.</span> integers</h4>
<div class="outline-text-4" id="text-32-2-2">
<div class="org-src-container">
<pre class="src src-conf"><span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">integers</span>
<span style="color: #cae682;">int1</span> = +99
<span style="color: #cae682;">int2</span> = 42
<span style="color: #cae682;">int3</span> = 0
<span style="color: #cae682;">int4</span> = -17

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">hexadecimal with prefix `0x`</span>
<span style="color: #cae682;">hex1</span> = 0xDEADBEEF
<span style="color: #cae682;">hex2</span> = 0xdeadbeef
<span style="color: #cae682;">hex3</span> = 0xdead_beef

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">octal with prefix `0o`</span>
<span style="color: #cae682;">oct1</span> = 0o01234567
<span style="color: #cae682;">oct2</span> = 0o755

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">binary with prefix `0b`</span>
<span style="color: #cae682;">bin1</span> = 0b11010110

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">fractional</span>
<span style="color: #cae682;">float1</span> = +1.0
<span style="color: #cae682;">float2</span> = 3.1415
<span style="color: #cae682;">float3</span> = -0.01

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">exponent</span>
<span style="color: #cae682;">float4</span> = 5e+22
<span style="color: #cae682;">float5</span> = 1e06
<span style="color: #cae682;">float6</span> = -2E-2

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">both</span>
<span style="color: #cae682;">float7</span> = 6.626e-34

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">separators</span>
<span style="color: #cae682;">float8</span> = 224_617.445_991_228

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">infinity</span>
<span style="color: #cae682;">infinite1</span> = inf <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">positive infinity</span>
<span style="color: #cae682;">infinite2</span> = +inf <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">positive infinity</span>
<span style="color: #cae682;">infinite3</span> = -inf <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">negative infinity</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">not a number</span>
<span style="color: #cae682;">not1</span> = nan
<span style="color: #cae682;">not2</span> = +nan
<span style="color: #cae682;">not3</span> = -nan
</pre>
</div>
</div>
</div>
<div id="outline-container-org1bae62f" class="outline-4">
<h4 id="org1bae62f"><span class="section-number-4">32.2.3.</span> Dates and Times</h4>
<div class="outline-text-4" id="text-32-2-3">
<div class="org-src-container">
<pre class="src src-conf"><span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">offset datetime</span>
<span style="color: #cae682;">odt1</span> = 1979-05-27T07:32:00Z
<span style="color: #cae682;">odt2</span> = 1979-05-27T00:32:00-07:00
<span style="color: #cae682;">odt3</span> = 1979-05-27T00:32:00.999999-07:00

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">local datetime</span>
<span style="color: #cae682;">ldt1</span> = 1979-05-27T07:32:00
<span style="color: #cae682;">ldt2</span> = 1979-05-27T00:32:00.999999

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">local date</span>
<span style="color: #cae682;">ld1</span> = 1979-05-27

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">local time</span>
<span style="color: #cae682;">lt1</span> = 07:32:00
<span style="color: #cae682;">lt2</span> = 00:32:00.999999
</pre>
</div>
</div>
</div>
<div id="outline-container-org36a13c4" class="outline-4">
<h4 id="org36a13c4"><span class="section-number-4">32.2.4.</span> array and table</h4>
<div class="outline-text-4" id="text-32-2-4">
<ul class="org-ul">
<li>Key/value pairs within tables are not guaranteed to be in any specific order.</li>
<li>only contain ASCII letters, ASCII digits, underscores, and dashes (A-Za-z0-9_-). Note that bare keys are</li>
</ul>
<p>
allowed to be composed of only ASCII digits, e.g. 1234, but are always interpreted as strings.
</p>
<ul class="org-ul">
<li>Quoted keys</li>
</ul>
<div class="org-src-container">
<pre class="src src-conf"><span style="color: #cae682;">key</span> = <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">INVALID</span>
<span style="color: #cae682;">first</span> = <span style="color: #95e454;">"Tom"</span> last = <span style="color: #95e454;">"Preston-Werner"</span> <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">INVALID</span>
<span style="color: #cae682;">1234</span> = <span style="color: #95e454;">"value"</span>
<span style="color: #95e454;">"127.0.0.1"</span> = <span style="color: #95e454;">"value"</span>

= <span style="color: #95e454;">"no key name"</span>  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">INVALID</span>
<span style="color: #95e454;">""</span> = <span style="color: #95e454;">"blank"</span>     <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">VALID but discouraged</span>
<span style="color: #95e454;">''</span> = <span style="color: #95e454;">'blank'</span>     <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">VALID but discouraged</span>

<span style="color: #cae682;">fruit.name</span> = <span style="color: #95e454;">"banana"</span>     <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">this is best practice</span>
<span style="color: #cae682;">fruit. color</span> = <span style="color: #95e454;">"yellow"</span>    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">same as fruit.color</span>
<span style="color: #cae682;">fruit . flavor</span> = <span style="color: #95e454;">"banana"</span>   <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">same as fruit.flavor</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">DO NOT DO THIS - Defining a key multiple times is invalid.</span>
<span style="color: #cae682;">name</span> = <span style="color: #95e454;">"Tom"</span>
<span style="color: #cae682;">name</span> = <span style="color: #95e454;">"Pradyun"</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">THIS WILL NOT WORK</span>
<span style="color: #cae682;">spelling</span> = <span style="color: #95e454;">"favorite"</span>
<span style="color: #95e454;">"spelling"</span> = <span style="color: #95e454;">"favourite"</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">This makes the key "fruit" into a table.</span>
<span style="color: #cae682;">fruit.apple.smooth</span> = true
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">So then you can add to the table "fruit" like so:</span>
<span style="color: #cae682;">fruit.orange</span> = 2

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">THE FOLLOWING IS INVALID</span>
<span style="color: #cae682;">fruit.apple</span> = 1
<span style="color: #cae682;">fruit.apple.smooth</span> = true

<span style="color: #cae682;">integers</span> = [ 1, 2, 3 ]
<span style="color: #cae682;">colors</span> = [ <span style="color: #95e454;">"red"</span>, <span style="color: #95e454;">"yellow"</span>, <span style="color: #95e454;">"green"</span> ]
<span style="color: #cae682;">nested_arrays_of_ints</span> = [ [ 1, 2 ], [3, 4, 5] ]
<span style="color: #cae682;">nested_mixed_array</span> = [ [ 1, 2 ], [<span style="color: #95e454;">"a"</span>, <span style="color: #95e454;">"b"</span>, <span style="color: #95e454;">"c"</span>] ]
<span style="color: #cae682;">string_array</span> = [ <span style="color: #95e454;">"all"</span>, <span style="color: #95e454;">'strings'</span>, <span style="color: #95e454;">"""are the same"""</span>, <span style="color: #95e454;">'''type'''</span> ]

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Mixed-type arrays are allowed</span>
<span style="color: #cae682;">numbers</span> = [ 0.1, 0.2, 0.5, 1, 2, 5 ]
<span style="color: #cae682;">contributors</span> = [
  <span style="color: #95e454;">"Foo Bar <a href="mailto:foo%40example.com">&lt;foo@example.com&gt;</a>"</span>,
  <span style="color: #cae682;">{ name</span> = <span style="color: #95e454;">"Baz Qux"</span>, email = <span style="color: #95e454;">"bazqux@example.com"</span>, url = <span style="color: #95e454;">"https://example.com/bazqux"</span> }
]
<span style="color: #cae682;">integers2</span> = [
  1, 2, 3
]

<span style="color: #cae682;">integers3</span> = [
  1,
  2, <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">this is ok</span>
]

[<span style="color: #92a65e; font-weight: bold;">table-1</span>]
<span style="color: #cae682;">key1</span> = <span style="color: #95e454;">"some string"</span>
<span style="color: #cae682;">key2</span> = 123

[<span style="color: #92a65e; font-weight: bold;">table-2</span>]
<span style="color: #cae682;">key1</span> = <span style="color: #95e454;">"another string"</span>
<span style="color: #cae682;">key2</span> = 456

[<span style="color: #92a65e; font-weight: bold;">a.b.c</span>]            <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">this is best practice</span>
[ d.e.f ]          <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">same as [d.e.f]</span>
[ g .  h  . i ]    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">same as [g.h.i]</span>
[ j . <span style="color: #95e454;">"&#670;"</span> . <span style="color: #95e454;">'l'</span> ]  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">same as [j."&#670;".'l']</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgb26a30d" class="outline-3">
<h3 id="orgb26a30d"><span class="section-number-3">32.3.</span> pyproject.toml</h3>
<div class="outline-text-3" id="text-32-3">
<p>
consis of
</p>
<ul class="org-ul">
<li>[build-system] - pep-0517</li>
<li>[project] - pep 621 pyproject.toml <a href="https://packaging.python.org/en/latest/specifications/declaring-project-metadata/#declaring-project-metadata">https://packaging.python.org/en/latest/specifications/declaring-project-metadata/#declaring-project-metadata</a>
<ul class="org-ul">
<li>dependencies - pep 0631</li>
</ul></li>
<li>[project.urls]</li>
<li>[project.scripts], [project.gui-scripts], and [project.entry-points] - entryproins</li>
<li>[project.optional-dependencies]</li>
<li>[tool] - pep 518 <a href="https://packaging.python.org/en/latest/specifications/declaring-build-dependencies/#declaring-build-dependencies">https://packaging.python.org/en/latest/specifications/declaring-build-dependencies/#declaring-build-dependencies</a></li>
</ul>

<p>
folder structure <a href="https://packaging.python.org/en/latest/tutorials/packaging-projects/">https://packaging.python.org/en/latest/tutorials/packaging-projects/</a>
</p>
</div>
<div id="outline-container-org94203a6" class="outline-4">
<h4 id="org94203a6"><span class="section-number-4">32.3.1.</span> [build-system]</h4>
<div class="outline-text-4" id="text-32-3-1">
<p>
Hatch
</p>
<pre class="example">
requires = ["hatchling"]
build-backend = "hatchling.build"
</pre>


<p>
setuptools
</p>
<pre class="example">
requires = ["setuptools&gt;=61.0"]
build-backend = "setuptools.build_meta"
</pre>


<p>
Flit
</p>
<pre class="example">
requires = ["flit_core&gt;=3.4"]
build-backend = "flit_core.buildapi"
</pre>


<p>
PDM
</p>
<pre class="example">
requires = ["pdm-backend"]
build-backend = "pdm.backend"
</pre>
</div>
</div>
<div id="outline-container-org813e80f" class="outline-4">
<h4 id="org813e80f"><span class="section-number-4">32.3.2.</span> metadata [project] and [project.urls]</h4>
<div class="outline-text-4" id="text-32-3-2">
<p>
pep 621 - [project] and <a href="https://packaging.python.org/en/latest/specifications/declaring-project-metadata/#declaring-project-metadata">https://packaging.python.org/en/latest/specifications/declaring-project-metadata/#declaring-project-metadata</a>
</p>
<div class="org-src-container">
<pre class="src src-conf">[<span style="color: #92a65e; font-weight: bold;">project</span>]
<span style="color: #cae682;">name</span> = <span style="color: #95e454;">"example_package_YOUR_USERNAME_HERE"</span>
<span style="color: #cae682;">version</span> = <span style="color: #95e454;">"0.0.1"</span>
<span style="color: #cae682;">authors</span> = [
  <span style="color: #cae682;">{ name</span>=<span style="color: #95e454;">"Example Author"</span>, email=<span style="color: #95e454;">"author@example.com"</span> },
] <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">optional?</span>
<span style="color: #cae682;">description</span> = <span style="color: #95e454;">"A small example package"</span>
<span style="color: #cae682;">readme</span> = <span style="color: #95e454;">"README.md"</span>
<span style="color: #cae682;">license</span> = {file = <span style="color: #95e454;">"LICENSE.txt"</span>} <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">optional</span>
<span style="color: #cae682;">keywords</span> = [<span style="color: #95e454;">"egg"</span>, <span style="color: #95e454;">"bacon"</span>, <span style="color: #95e454;">"sausage"</span>, <span style="color: #95e454;">"tomatoes"</span>, <span style="color: #95e454;">"Lobster Thermidor"</span>] <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">optional</span>
<span style="color: #cae682;">requires-python</span> = <span style="color: #95e454;">"&gt;=3.7"</span>
<span style="color: #cae682;">classifiers</span> = [
    <span style="color: #95e454;">"Programming Language :: Python :: 3"</span>,
    <span style="color: #95e454;">"License :: OSI Approved :: MIT License"</span>,
    <span style="color: #95e454;">"Operating System :: OS Independent"</span>,
]
<span style="color: #cae682;">dependencies</span> = [
  <span style="color: #95e454;">"httpx"</span>,
  <span style="color: #95e454;">"gidgethub[httpx]&gt;4.0.0"</span>,
  <span style="color: #95e454;">"django&gt;2.1; os_name != 'nt'"</span>,
  <span style="color: #95e454;">"django&gt;2.0; os_name == 'nt'"</span>,
] <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">optional</span>

[<span style="color: #92a65e; font-weight: bold;">project.optional-dependencies</span>]
<span style="color: #cae682;">gui</span> = [<span style="color: #95e454;">"PyQt5"</span>]
<span style="color: #cae682;">cli</span> = [
  <span style="color: #95e454;">"rich"</span>,
  <span style="color: #95e454;">"click"</span>,
]


[<span style="color: #92a65e; font-weight: bold;">project.urls</span>]
<span style="color: #95e454;">"Homepage"</span> = <span style="color: #95e454;">"https://github.com/pypa/sampleproject"</span>
<span style="color: #95e454;">"Bug Tracker"</span> = <span style="color: #95e454;">"https://github.com/pypa/sampleproject/issues"</span>

[<span style="color: #92a65e; font-weight: bold;">project.scripts</span>]
<span style="color: #cae682;">spam-cli</span> = <span style="color: #95e454;">"spam:main_cli"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1d3f672" class="outline-4">
<h4 id="org1d3f672"><span class="section-number-4">32.3.3.</span> [project.scripts]</h4>
<div class="outline-text-4" id="text-32-3-3">
<pre class="example">
mycmd = mymod:main
</pre>

<p>
would create a command mycmd launching a script like this:
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> sys
<span style="color: #8ac6f2; font-weight: bold;">from</span> mymod <span style="color: #8ac6f2; font-weight: bold;">import</span> main
sys.<span style="color: #e5786d; font-weight: bold;">exit</span>(main())
</pre>
</div>

<p>
main should return 0
</p>
</div>
<ol class="org-ol">
<li><a id="org6c1369d"></a>links<br />
<div class="outline-text-5" id="text-32-3-3-1">
<ul class="org-ul">
<li><a href="https://packaging.python.org/en/latest/specifications/entry-points/#entry-points">https://packaging.python.org/en/latest/specifications/entry-points/#entry-points</a></li>
<li>example of main for cli <a href="https://docs.python.org/3/library/__main__.html">https://docs.python.org/3/library/__main__.html</a></li>
</ul>
</div>
</li>
</ol>
</div>
<div id="outline-container-orgfe74c2c" class="outline-4">
<h4 id="orgfe74c2c"><span class="section-number-4">32.3.4.</span> dependencies</h4>
<div class="outline-text-4" id="text-32-3-4">
<p>
<a href="https://peps.python.org/pep-0508/">https://peps.python.org/pep-0508/</a>
</p>
</div>
</div>
<div id="outline-container-org2f6a06b" class="outline-4">
<h4 id="org2f6a06b"><span class="section-number-4">32.3.5.</span> <span class="todo TODO">TODO</span> minimal</h4>
<div class="outline-text-4" id="text-32-3-5">
<p>
<a href="https://packaging.python.org/en/latest/tutorials/packaging-projects/#configuring-metadata">https://packaging.python.org/en/latest/tutorials/packaging-projects/#configuring-metadata</a>
</p>
</div>
</div>
<div id="outline-container-orgf7d2089" class="outline-4">
<h4 id="orgf7d2089"><span class="section-number-4">32.3.6.</span> example</h4>
<div class="outline-text-4" id="text-32-3-6">
<p>
<a href="https://raw.githubusercontent.com/pypa/sampleproject/refs/heads/main/pyproject.toml">https://raw.githubusercontent.com/pypa/sampleproject/refs/heads/main/pyproject.toml</a>
</p>
<div class="org-src-container">
<pre class="src src-conf">[<span style="color: #92a65e; font-weight: bold;">build-system</span>]
<span style="color: #cae682;">requires</span> = [<span style="color: #95e454;">"setuptools"</span>] <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">REQUIRED if [build-system] table is used</span>
<span style="color: #cae682;">build-backend</span> = <span style="color: #95e454;">"setuptools.build_meta"</span> <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">If not defined, then legacy behavior can happen.</span>

[<span style="color: #92a65e; font-weight: bold;">project</span>]
<span style="color: #cae682;">name</span> = <span style="color: #95e454;">"sampleproject"</span> <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">REQUIRED, is the only field that cannot be marked as dynamic.</span>
<span style="color: #cae682;">version</span> = <span style="color: #95e454;">"4.0.0"</span> <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">REQUIRED, although can be dynamic</span>
<span style="color: #cae682;">description</span> = <span style="color: #95e454;">"A sample Python project"</span>
<span style="color: #cae682;">readme</span> = <span style="color: #95e454;">"README.md"</span>
<span style="color: #cae682;">requires-python</span> = <span style="color: #95e454;">"&gt;=3.9"</span>
<span style="color: #cae682;">license</span> = { file = <span style="color: #95e454;">"LICENSE.txt"</span> }
<span style="color: #cae682;">keywords</span> = [<span style="color: #95e454;">"sample"</span>, <span style="color: #95e454;">"setuptools"</span>, <span style="color: #95e454;">"development"</span>]
<span style="color: #cae682;">authors</span> = [{ name = <span style="color: #95e454;">"A. Random Developer"</span>, email = <span style="color: #95e454;">"author@example.com"</span> }]
<span style="color: #cae682;">maintainers</span> = [
  <span style="color: #cae682;">{ name</span> = <span style="color: #95e454;">"A. Great Maintainer"</span>, email = <span style="color: #95e454;">"maintainer@example.com"</span> },
]

<span style="color: #cae682;">classifiers</span> = [
  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">How mature is this project? Common values are</span>
  <span style="color: #fa8072;">#   </span><span style="color: #99968b; font-style: italic;">3 - Alpha</span>
  <span style="color: #fa8072;">#   </span><span style="color: #99968b; font-style: italic;">4 - Beta</span>
  <span style="color: #fa8072;">#   </span><span style="color: #99968b; font-style: italic;">5 - Production/Stable</span>
  <span style="color: #95e454;">"Development Status :: 3 - Alpha"</span>,
  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Indicate who your project is intended for</span>
  <span style="color: #95e454;">"Intended Audience :: Developers"</span>,
  <span style="color: #95e454;">"Topic :: Software Development :: Build Tools"</span>,
  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Pick your license as you wish</span>
  <span style="color: #95e454;">"License :: OSI Approved :: MIT License"</span>,
  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Specify the Python versions you support here. In particular, ensure</span>
  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">that you indicate you support Python 3. These classifiers are *not*</span>
  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">checked by "pip install". See instead "requires-python" key in this file.</span>
  <span style="color: #95e454;">"Programming Language :: Python :: 3"</span>,
  <span style="color: #95e454;">"Programming Language :: Python :: 3.9"</span>,
  <span style="color: #95e454;">"Programming Language :: Python :: 3.10"</span>,
  <span style="color: #95e454;">"Programming Language :: Python :: 3.11"</span>,
  <span style="color: #95e454;">"Programming Language :: Python :: 3.12"</span>,
  <span style="color: #95e454;">"Programming Language :: Python :: 3.13"</span>,
  <span style="color: #95e454;">"Programming Language :: Python :: 3 :: Only"</span>,
]

<span style="color: #cae682;">dependencies</span> = [<span style="color: #95e454;">"peppercorn"</span>]

[<span style="color: #92a65e; font-weight: bold;">project.optional-dependencies</span>]
<span style="color: #cae682;">dev</span> = [<span style="color: #95e454;">"check-manifest"</span>]
<span style="color: #cae682;">test</span> = [<span style="color: #95e454;">"coverage"</span>]

[<span style="color: #92a65e; font-weight: bold;">project.urls</span>]
<span style="color: #95e454;">"Homepage"</span> = <span style="color: #95e454;">"https://github.com/pypa/sampleproject"</span>
<span style="color: #95e454;">"Bug Reports"</span> = <span style="color: #95e454;">"https://github.com/pypa/sampleproject/issues"</span>
<span style="color: #95e454;">"Funding"</span> = <span style="color: #95e454;">"https://donate.pypi.org"</span>
<span style="color: #95e454;">"Say Thanks!"</span> = <span style="color: #95e454;">"http://saythanks.io/to/example"</span>
<span style="color: #95e454;">"Source"</span> = <span style="color: #95e454;">"https://github.com/pypa/sampleproject/"</span>

[<span style="color: #92a65e; font-weight: bold;">project.scripts</span>]
<span style="color: #cae682;">sample</span> = <span style="color: #95e454;">"sample:main"</span>

[<span style="color: #92a65e; font-weight: bold;">tool.setuptools</span>]
<span style="color: #cae682;">package-data</span> = { <span style="color: #95e454;">"sample"</span> = [<span style="color: #95e454;">"*.dat"</span>] }
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org343b4ce" class="outline-3">
<h3 id="org343b4ce"><span class="section-number-3">32.4.</span> build</h3>
<div class="outline-text-3" id="text-32-4">
<p>
python3 -m build
</p>

<p>
create: dist/
</p>
<ul class="org-ul">
<li>├── example<sub>package</sub><sub>YOUR</sub><sub>USERNAME</sub><sub>HERE</sub>-0.0.1-py3-none-any.whl -  <b>built distribution</b> with binaries</li>
<li>└── example<sub>package</sub><sub>YOUR</sub><sub>USERNAME</sub><sub>HERE</sub>-0.0.1.tar.gz - <b>source distribution</b></li>
</ul>
</div>
</div>

<div id="outline-container-orgc9155e7" class="outline-3">
<h3 id="orgc9155e7"><span class="section-number-3">32.5.</span> distutils (old)</h3>
<div class="outline-text-3" id="text-32-5">
<p>
package has been deprecated in 3.10 and will be removed in Python 3.12. Its functionality for specifying
 package builds has already been completely replaced by third-party packages <b>setuptools</b> and <b>packaging</b>, and
 most other commonly used APIs are available elsewhere in the standard library (such as platform, shutil,
 subprocess or sysconfig).
</p>
<ul class="org-ul">
<li><a href="https://docs.python.org/3/distutils/">https://docs.python.org/3/distutils/</a></li>
</ul>
</div>
</div>

<div id="outline-container-org593024a" class="outline-3">
<h3 id="org593024a"><span class="section-number-3">32.6.</span> terms</h3>
<div class="outline-text-3" id="text-32-6">
<ul class="org-ul">
<li>Source Distribution (or “sdist”) - generated using python setup.py sdist.</li>
<li>Wheel - A Built Distribution format</li>
<li>build - is a PEP 517 compatible Python package builder.
<ul class="org-ul">
<li>pep517 - new style of source tree based around the pep518 pyproject.toml + [build-backend]</li>
</ul></li>
<li>setup.py-style - de facto specification for "source tree"</li>
<li>src-layout - not flat layout. selected for package folder structure. pep 660</li>
</ul>

<p>
types of artifacts:
</p>
<ul class="org-ul">
<li>The source distribution (sdist): python3 -m build &#x2013;sdist source-tree-directory</li>
<li>The built distributions (wheels): python3 -m build &#x2013;wheel source-tree-directory
<ul class="org-ul">
<li>no compilation required during install:</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-orga865ad0" class="outline-3">
<h3 id="orga865ad0"><span class="section-number-3">32.7.</span> recommended</h3>
<div class="outline-text-3" id="text-32-7">
<p>
dapendency management:
</p>
<ul class="org-ul">
<li>pip with &#x2013;require-hashes and &#x2013;only-binary :all:</li>
<li>virtualenv or venv</li>
<li>pip-tools, Pipenv, or poetry</li>
<li>wheel project - offers the bdist<sub>wheel</sub> <b>setuptools</b> extension</li>
<li>buildout: primarily focused on the web development community</li>
<li>Spack, Hashdist, or conda: primarily focused on the scientific community.</li>
</ul>
<p>
package tools
</p>
<ul class="org-ul">
<li><b>setuptools</b></li>
<li><b>build</b> to create Source Distributions and wheels.</li>
<li><b>cibuildwheel</b> - If you have binary extensions and want to distribute wheels for multiple platforms</li>
<li><b>twine</b> - for uploading distributions to PyPI.</li>
</ul>
</div>
</div>
<div id="outline-container-org69af755" class="outline-3">
<h3 id="org69af755"><span class="section-number-3">32.8.</span> Upload to the package distribution service</h3>
<div class="outline-text-3" id="text-32-8">
</div>
<div id="outline-container-org42ebddb" class="outline-4">
<h4 id="org42ebddb"><span class="section-number-4">32.8.1.</span> <span class="todo TODO">TODO</span> twine</h4>
<div class="outline-text-4" id="text-32-8-1">
<pre class="example">
twine upload dist/package-name-version.tar.gz dist/package-name-version-py3-none-any.whl
</pre>
</div>
</div>

<div id="outline-container-orgdcf1905" class="outline-4">
<h4 id="orgdcf1905"><span class="section-number-4">32.8.2.</span> <span class="todo TODO">TODO</span> Github actions</h4>
</div>
</div>
<div id="outline-container-orgf8a8f4d" class="outline-3">
<h3 id="orgf8a8f4d"><span class="section-number-3">32.9.</span> editable installs PEP660</h3>
<div class="outline-text-3" id="text-32-9">
<pre class="example">
pip install --editable
</pre>


<p>
editable installation mode - installation of projects in such a way that the python code being imported
 remains in the source directory
</p>

<p>
Python programmers want to be able to develop packages without having to install (i.e. copy) them into
 site-packages, for example, by working in a checkout of the source repository.
</p>

<p>
Actualy just add directories to PYTHONPATH.
</p>

<p>
there is 2 types of wheel now: normal and "editable".
</p>
</div>
</div>
<div id="outline-container-org81dbf45" class="outline-3">
<h3 id="org81dbf45"><span class="section-number-3">32.10.</span> PyPi project name, name normalization and other specifications</h3>
<div class="outline-text-3" id="text-32-10">
<p>
names should be ASCII alphabet, ASCII numbers. ., -, and _ allowed, but normalized to -.
</p>
<ul class="org-ul">
<li>normalized to</li>
<li>lowercase</li>
</ul>

<p>
Valid non-normalized names: ^([A-Z0-9]|[A-Z0-9][A-Z0-9._-]*[A-Z0-9])$
</p>

<p>
Normalization: re.sub(r"[-_.]+", "-", name).lower()
</p>


<p>
Source distribution format - pep-0517 PEP 518
</p>
<ul class="org-ul">
<li>Source distribution file name: {name}-{version}.tar.gz</li>
<li>contains a single top-level directory called {name}-{version} (e.g. foo-1.0), containing the source files of the package.</li>
<li>directory must also contain
<ul class="org-ul">
<li>a pyproject.toml</li>
<li>PKG-INFO file containing metadata - PEP 566</li>
</ul></li>
</ul>
</div>


<div id="outline-container-org96f48d9" class="outline-4">
<h4 id="org96f48d9"><span class="section-number-4">32.10.1.</span> links</h4>
<div class="outline-text-4" id="text-32-10-1">
<ul class="org-ul">
<li><a href="https://discuss.python.org/t/revisiting-distribution-name-normalization/12348">https://discuss.python.org/t/revisiting-distribution-name-normalization/12348</a></li>
<li><a href="https://peps.python.org/pep-0503/">https://peps.python.org/pep-0503/</a></li>
<li><a href="https://packaging.python.org/en/latest/specifications/">https://packaging.python.org/en/latest/specifications/</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgdabb409" class="outline-3">
<h3 id="orgdabb409"><span class="section-number-3">32.11.</span> <span class="todo TODO">TODO</span> src layout vs flat layout</h3>
<div class="outline-text-3" id="text-32-11">
<p>
src layout helps
</p>
<ul class="org-ul">
<li>prevent accidental usage of the in-development copy of the code</li>

<li><a href="https://packaging.python.org/en/latest/discussions/src-layout-vs-flat-layout/">https://packaging.python.org/en/latest/discussions/src-layout-vs-flat-layout/</a></li>
<li><a href="https://blog.ionelmc.ro/2014/05/25/python-packaging/#the-structure%3E">https://blog.ionelmc.ro/2014/05/25/python-packaging/#the-structure%3E</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgc8d1686" class="outline-3">
<h3 id="orgc8d1686"><span class="section-number-3">32.12.</span> build tool, build system</h3>
<div class="outline-text-3" id="text-32-12">
<p>
The Boost project <a href="https://en.wikipedia.org/wiki/Boost_(C%2B%2B_libraries)">https://en.wikipedia.org/wiki/Boost_(C%2B%2B_libraries)</a> has its own build system:
 BJam. There is some documentation, but it's kind of minimal and cryptic.
</p>

<p>
using Autotools for a modern C/C++ project in 2021 is like using CVS for source code version control in 2021:
 there are better tools available
</p>

<p>
<b>Meson</b> is a build tool with good C/C++ support. written in Python and generates Ninja build
 files. <a href="https://en.wikipedia.org/wiki/Ninja_(build_system)">https://en.wikipedia.org/wiki/Ninja_(build_system)</a>
</p>
<ul class="org-ul">
<li>there is one kind of obvious way to do it.</li>
<li>has better documentation</li>
<li>only supports out of source tree builds, and its domain specific language is arguably much better designed.</li>
</ul>

<p>
<b>CMake</b>
</p>
<ul class="org-ul">
<li>several ways to implement common build tasks</li>
</ul>
</div>
</div>
<div id="outline-container-org15514dd" class="outline-3">
<h3 id="org15514dd"><span class="section-number-3">32.13.</span> build from source</h3>
<div class="outline-text-3" id="text-32-13">
<p>
Old:
</p>
<ul class="org-ul">
<li>python setup.py install &#x2013;user</li>
<li>if setup.py and pyproject.toml exist: pip install &#x2013;index-url <a href="https://your-local-repo-url">https://your-local-repo-url</a> &#x2013;disable-pip-version-check -e .</li>
</ul>
<p>
New - can not disable Internet connection:
</p>
<ul class="org-ul">
<li>python3 -m build -x # uses pip to install dependencies, create dist/package.whl file
<ul class="org-ul">
<li>-x to skip dependencies</li>
</ul></li>
<li>pip install &#x2013;no-index dist/pipdeptree-2.23.5.dev3+gaa0535b-py3-none-any.whl
<ul class="org-ul">
<li>&#x2013;no-index imlies &#x2013;disable-pip-version-check</li>
<li>pip install &#x2013;no-index &#x2013;find-links=C:\path&rarr;\package\mypackage mypackage openpyxl==3.1.5</li>
</ul></li>
</ul>
<p>
Gentoo way:
</p>
<ul class="org-ul">
<li>see: <a href="#org416086e">32.1.3</a></li>
</ul>
<p>
Source:
</p>
<ul class="org-ul">
<li>pip install &#x2013;force-reinstall &#x2013;no-cache-dir &#x2013;no-binary=:all: &#x2013;user # &#x2013;require-hashes may be added</li>
</ul>

<p>
After installation, you may need to adjust:
</p>
<ul class="org-ul">
<li>export PYTHONPATH=$PYTHONPATH:$INSTALL<sub>DIR</sub>/lib/pythonX.Y/site-packages</li>
<li>export PATH=$PATH:$INSTALL<sub>DIR</sub>/bin</li>
</ul>
</div>
<div id="outline-container-orga4fe9bf" class="outline-4">
<h4 id="orga4fe9bf"><span class="section-number-4">32.13.1.</span> pipdeptree</h4>
<div class="outline-text-4" id="text-32-13-1">
<p>
<a href="https://github.com/tox-dev/pipdeptree">https://github.com/tox-dev/pipdeptree</a>
</p>

<p>
requirements:
</p>
<ul class="org-ul">
<li>hatch-vcs,</li>
<li>hatchling</li>
<li>packaging&gt;=24.1</li>
<li>pip&gt;=24.2</li>
</ul>
</div>
</div>
<div id="outline-container-org1718ab8" class="outline-4">
<h4 id="org1718ab8"><span class="section-number-4">32.13.2.</span> troubles</h4>
<div class="outline-text-4" id="text-32-13-2">
<p>
/usr/bin/python3: No module named build
</p>
<ul class="org-ul">
<li>Debian: apt install python3-build</li>
<li>other: python -m pip install build</li>
</ul>

<p>
disable pip Internet requests
pip &#x2013;disable-pip-version-check
</p>
</div>
</div>
</div>
<div id="outline-container-org6b63f93" class="outline-3">
<h3 id="org6b63f93"><span class="section-number-3">32.14.</span> links</h3>
<div class="outline-text-3" id="text-32-14">
<ul class="org-ul">
<li>main <a href="https://packaging.python.org/en/latest/">https://packaging.python.org/en/latest/</a></li>
<li>python key projects <a href="https://packaging.python.org/en/latest/key_projects/">https://packaging.python.org/en/latest/key_projects/</a></li>
<li>build systems recommended (officla) <a href="https://packaging.python.org/en/latest/guides/tool-recommendations/">https://packaging.python.org/en/latest/guides/tool-recommendations/</a></li>
<li>gentoo <a href="https://blogs.gentoo.org/mgorny/2021/11/07/the-future-of-python-build-systems-and-gentoo/">https://blogs.gentoo.org/mgorny/2021/11/07/the-future-of-python-build-systems-and-gentoo/</a></li>
<li>PEP 517 – A build-system independent format for source trees <a href="https://peps.python.org/pep-0517/">https://peps.python.org/pep-0517/</a></li>
<li>PEP 518 Specifying Minimum Build System Requirements for Python Projects <a href="https://peps.python.org/pep-0518/">https://peps.python.org/pep-0518/</a></li>
<li>PEP 621 Storing project metadata in pyproject.toml - <a href="https://peps.python.org/pep-0621/">https://peps.python.org/pep-0621/</a></li>
<li>specifications <a href="https://packaging.python.org/en/latest/specifications/">https://packaging.python.org/en/latest/specifications/</a></li>
<li>pip default installer <a href="https://peps.python.org/pep-0453/">https://peps.python.org/pep-0453/</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org10fe166" class="outline-2">
<h2 id="org10fe166"><span class="section-number-2">33.</span> setuptools - build system</h2>
</div>


<div id="outline-container-org8d8fd4b" class="outline-2">
<h2 id="org8d8fd4b"><span class="section-number-2">34.</span> pip (package manager)</h2>
<div class="outline-text-2" id="text-34">
<p>
Устанавливается вместе с Python
</p>
<ul class="org-ul">
<li>(pip3 for Python 3) by default   - MIT -</li>
<li>pip.pypa.io</li>
</ul>

<p>
Some package managers, including pip, use PyPI as the default source for packages and their dependencies.
</p>

<p>
<b>Python Package Index</b> -  official third-party software repository for Python
</p>
<ul class="org-ul">
<li>PyPI (<i>ˌpaɪpiˈaɪ</i>)</li>
</ul>
</div>

<div id="outline-container-orgaf31882" class="outline-3">
<h3 id="orgaf31882"><span class="section-number-3">34.1.</span> release steps</h3>
<div class="outline-text-3" id="text-34-1">
<ol class="org-ol">
<li>register at pypi.org</li>
<li><a href="https://pypi.org/manage/account/#api-tokens">https://pypi.org/manage/account/#api-tokens</a></li>
<li>github-&gt;project-&gt;Secrets and variables-&gt;actions
<ul class="org-ul">
<li>New repostitory secret</li>
<li>PYPI<sub>API</sub><sub>TOKEN</sub></li>
<li>token from 2)</li>
</ul></li>
<li>github-&gt;project-&gt;Actions-&gt;add-&gt;Publish Python Package</li>
</ol>
</div>
<div id="outline-container-orgc23ea5a" class="outline-4">
<h4 id="orgc23ea5a"><span class="section-number-4">34.1.1.</span> links</h4>
<div class="outline-text-4" id="text-34-1-1">
<p>
<a href="https://packaging.python.org/en/latest/guides/publishing-package-distribution-releases-using-github-actions-ci-cd-workflows/">https://packaging.python.org/en/latest/guides/publishing-package-distribution-releases-using-github-actions-ci-cd-workflows/</a>
</p>
</div>
</div>
</div>

<div id="outline-container-orge08ba1d" class="outline-3">
<h3 id="orge08ba1d"><span class="section-number-3">34.2.</span> wheels</h3>
<div class="outline-text-3" id="text-34-2">
<p>
<b>“Wheel”</b> is a built, archive format that can greatly speed installation compared - .whl
</p>

<p>
to disable wheel:
</p>
<ul class="org-ul">
<li>&#x2013;no-cache-dir</li>
<li>&#x2013;no-binary=:all:</li>
</ul>
</div>
</div>
<div id="outline-container-org445a452" class="outline-3">
<h3 id="org445a452"><span class="section-number-3">34.3.</span> virtualenv</h3>
<div class="outline-text-3" id="text-34-3">
<p>
Unlike venv, virtualenv can create virtual environments for other <b>versions of Python</b>.
</p>

<p>
Может быть так, что проект А запрашивает версию 1.0.0, в то время как проект Б запрашивает более новую версию
2.0.0, к примеру.
</p>
<ul class="org-ul">
<li>не может различать версии в каталоге «site-packages»</li>
</ul>

<p>
pip install virtualenv
</p>
</div>
</div>
<div id="outline-container-org7191c2a" class="outline-3">
<h3 id="org7191c2a"><span class="section-number-3">34.4.</span> venv</h3>
<div class="outline-text-3" id="text-34-4">
<p>
создать:
</p>
<pre class="example">
python -m venv /path/to/new/virtual/environment
</pre>

<ul class="org-ul">
<li>pyvenv.cfg - created</li>
<li>bin (or Scripts on Windows) containing a copy/symlink of the Python binary/binaries</li>
<li>в директории с интерпретатором или уровнем выше ищется файл с именем pyvenv.cfg;</li>
<li>если файл найден, в нём ищется ключ home, значение которого и будет базовой директорией;</li>
<li>в базовой директории идёт поиск системной библиотеки (по спец. маркеру os.py);</li>
</ul>

<p>
Использовать:
</p>
<ul class="org-ul">
<li>source bin/activate</li>
<li>./bin/python main.py</li>
</ul>

<p>
<b>&#x2013;prefix=venv is NOT equal to &#x2013;user</b>
idk what &#x2013;user do, but only &#x2013;prefix works
</p>

<p>
create:
</p>
<ul class="org-ul">
<li>apt install python3.10-venv</li>
<li>python3 -m venv /root/vit/venv</li>
<li>source venv/bin/activate</li>
<li>sed -i "s#/usr/bin#$(readlink -f venv/bin)#"  venv/pyvenv.cfg</li>
<li>source venv/bin/activate</li>
<li>venv/bin/python -m pip install something &#x2013;prefix=/opt/.venv</li>
</ul>
</div>
</div>

<div id="outline-container-orga3f7f4c" class="outline-3">
<h3 id="orga3f7f4c"><span class="section-number-3">34.5.</span> update</h3>
<div class="outline-text-3" id="text-34-5">
<p>
pip3 install &#x2013;upgrade pip &#x2013;user
</p>
<ul class="org-ul">
<li>устаревшие: pip3 list &#x2013;outdated</li>
<li>обновить: pip3 install &#x2013;upgrade SomePackage</li>
</ul>
</div>
</div>
<div id="outline-container-orgd7d9f2d" class="outline-3">
<h3 id="orgd7d9f2d"><span class="section-number-3">34.6.</span> requirements.txt</h3>
<div class="outline-text-3" id="text-34-6">
<p>
Как установить
</p>
<ul class="org-ul">
<li>pip install -r requirements.txt</li>
</ul>

<p>
Как создать
</p>
<ol class="org-ol">
<li>pip freeze &gt; requirements.txt - Создать на основе всех установленных библиотек</li>
<li>pipreqs . - на основе импортов - требует установку pip3 install pipreqs &#x2013;user</li>
</ol>

<p>
Смотреть на кроссплатформенность! Не все библиотеки такие!
</p>

<div class="org-src-container">
<pre class="src src-conf"><span style="color: #cae682;">docopt</span> == 0.6.1             <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Version Matching. Must be version 0.6.1</span>
<span style="color: #cae682;">keyring &gt;</span>= 4.1.1            <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Minimum version 4.1.1</span>
<span style="color: #cae682;">coverage !</span>= 3.5             <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Version Exclusion. Anything except version 3.5</span>
<span style="color: #cae682;">Mopidy-Dirble ~</span>= 1.1        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Compatible release. Same as &gt;= 1.1, == 1.*</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">without version:</span>
nose
nose-cov
beautifulsoup4
</pre>
</div>
</div>
</div>

<div id="outline-container-org311e380" class="outline-3">
<h3 id="org311e380"><span class="section-number-3">34.7.</span> errors</h3>
<div class="outline-text-3" id="text-34-7">
<p>
Traceback (most recent call last):
  File "/usr/bin/pip3", line 9, in &lt;module&gt;
    from pip import main
ImportError: cannot import name 'main'
</p>

<p>
SOLVATION: alias pip3="<i>home/u2</i>.local/bin/pip3"
</p>
</div>
</div>

<div id="outline-container-org5626ac6" class="outline-3">
<h3 id="org5626ac6"><span class="section-number-3">34.8.</span> cache dir</h3>
<div class="outline-text-3" id="text-34-8">
<p>
to reduce the amount of time spent on duplicate downloads and builds.
</p>
<ul class="org-ul">
<li>cached:
<ul class="org-ul">
<li>http responses</li>
<li>Locally built wheels</li>
</ul></li>
<li>pip cache dir</li>
</ul>
</div>


<div id="outline-container-orga2dd17b" class="outline-4">
<h4 id="orga2dd17b"><span class="section-number-4">34.8.1.</span> links</h4>
<div class="outline-text-4" id="text-34-8-1">
<p>
<a href="https://pip.pypa.io/en/latest/topics/caching/">https://pip.pypa.io/en/latest/topics/caching/</a>
</p>
</div>
</div>
</div>
<div id="outline-container-org24c36d1" class="outline-3">
<h3 id="org24c36d1"><span class="section-number-3">34.9.</span> hashes <a id="org0b73dbc"></a></h3>
<div class="outline-text-3" id="text-34-9">
<ul class="org-ul">
<li>pip install package &#x2013;require-hashes</li>
<li>Requirements must be pinned with ==</li>
<li>weak hashes: md5, sha1, and sha224</li>

<li>python -m pip download &#x2013;no-binary=:all: SomePackage</li>
<li>python -m pip hash &#x2013;algorithm sha512 ./pip<sub>downloads</sub>/SomePackage-2.2.tar.gz</li>
<li>pip install &#x2013;force-reinstall &#x2013;no-cache-dir &#x2013;no-binary=:all: &#x2013;require-hashes &#x2013;user -r requirements.txt</li>
</ul>

<p>
FooProject == 1.2 &#x2013;hash=sha256:2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824 \
  &#x2013;hash=sha256:486ea46224d1bb4fb680f34f7c9ad96a8f24ec88be73ea8e5a6c65260e9cb8a7
</p>
</div>
</div>
<div id="outline-container-orgee50edb" class="outline-3">
<h3 id="orgee50edb"><span class="section-number-3">34.10.</span> add SSL certificate</h3>
<div class="outline-text-3" id="text-34-10">
<p>
export PIP<sub>CERT</sub>=/etc/ssl/certs/rnb.pem
</p>

<p>
Dockerfile:
</p>
<ul class="org-ul">
<li>COPY /etc/ssl/certs/rnb.pem /rnb.pem</li>
<li>ENV PIP<sub>CERT</sub>=/rnb.pem</li>
</ul>
</div>
<div id="outline-container-orgff915ba" class="outline-4">
<h4 id="orgff915ba"><span class="section-number-4">34.10.1.</span> crt(not working)</h4>
<div class="outline-text-4" id="text-34-10-1">
<ul class="org-ul">
<li>pip config set global.cert path/to/ca-bundle.crt</li>
<li>pip config list</li>
<li>conda config &#x2013;set ssl<sub>verify</sub> path/to/ca-bundle.crt</li>
<li>conda config &#x2013;show ssl<sub>verify</sub></li>
</ul>

<ul class="org-ul">
<li>git config &#x2013;global http.sslVerify true</li>
<li>git config &#x2013;global http.sslCAInfo path/to/ca-bundle.crt</li>
</ul>


<p>
<a href="https://stackoverflow.com/questions/39356413/how-to-add-a-custom-ca-root-certificate-to-the-ca-store-used-by-pip-in-windows">https://stackoverflow.com/questions/39356413/how-to-add-a-custom-ca-root-certificate-to-the-ca-store-used-by-pip-in-windows</a>
</p>
</div>
</div>
<div id="outline-container-org558be63" class="outline-4">
<h4 id="org558be63"><span class="section-number-4">34.10.2.</span> pem(not working)</h4>
<div class="outline-text-4" id="text-34-10-2">
<p>
pip config set global.cert /home/RootCA3.pem - указываем путь к самоподписномму серту, если возникают ошибки установки модулей питона.
</p>
<ul class="org-ul">
<li>python -c "import ssl; print(ssl.get<sub>default</sub><sub>verify</sub><sub>paths</sub>())"</li>
<li>add pem to path</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org8efd31e" class="outline-3">
<h3 id="org8efd31e"><span class="section-number-3">34.11.</span> ignore SSL certificates</h3>
<div class="outline-text-3" id="text-34-11">
<p>
pip install &#x2013;trusted-host pypi.org &#x2013;trusted-host files.pythonhosted.org &lt;package<sub>name</sub>&gt;
</p>
</div>
</div>

<div id="outline-container-orgd599664" class="outline-3">
<h3 id="orgd599664"><span class="section-number-3">34.12.</span> proxy</h3>
<div class="outline-text-3" id="text-34-12">
<ol class="org-ol">
<li>proxychains</li>
<li>dns proxy and http</li>
</ol>
</div>
</div>
<div id="outline-container-org48d8c91" class="outline-3">
<h3 id="org48d8c91"><span class="section-number-3">34.13.</span> <span class="todo TODO">TODO</span> <a href="https://packaging.python.org/en/latest/key_projects/">https://packaging.python.org/en/latest/key_projects/</a></h3>
</div>

<div id="outline-container-org5ec9881" class="outline-3">
<h3 id="org5ec9881"><span class="section-number-3">34.14.</span> ways to freeze dependencies:</h3>
<div class="outline-text-3" id="text-34-14">
<p>
Problem: according <a href="https://pip.pypa.io/en/stable/topics/secure-installs/">https://pip.pypa.io/en/stable/topics/secure-installs/</a> pip does not perform any checks to
 protect against remote tampering and involves running arbitrary code from distributions
</p>

<p>
Not working: create virtual environment, install, pip freeze
</p>
<ul class="org-ul">
<li>require: python -m pip hash [options] &lt;file&gt; &#x2026;</li>
</ul>
<pre class="example">
./pip_downloads/SomePackage-2.2.tar.gz:
--hash=sha256:93e62e05c7ad3da1a233def6731e8285156701e3419a5fe279017c429ec67ce0
</pre>


<p>
<b>Solution:</b>
</p>
<ol class="org-ol">
<li>pip install pipenv - implementation of <a href="https://github.com/pypa/pipfile">https://github.com/pypa/pipfile</a></li>
<li>just generate hashes <a href="https://www.peterdebelak.com/blog/generating-a-fully-qualified-and-hashed-requirements-file/">https://www.peterdebelak.com/blog/generating-a-fully-qualified-and-hashed-requirements-file/</a>
<ul class="org-ul">
<li>which get <a href="https://pypi.org/pypi/zipp/3.19.2/json">https://pypi.org/pypi/zipp/3.19.2/json</a> and parse</li>
</ul></li>
</ol>
</div>
</div>
<div id="outline-container-orgc322a5c" class="outline-3">
<h3 id="orgc322a5c"><span class="section-number-3">34.15.</span> pipenv</h3>
<div class="outline-text-3" id="text-34-15">
<p>
dependency manager
</p>

<p>
Pepfile - TOML syntax, but it is not <b>pyproject.toml</b>
</p>
</div>

<div id="outline-container-orgac47a20" class="outline-4">
<h4 id="orgac47a20"><span class="section-number-4">34.15.1.</span> Cons: hard to read Pipfile.lock file.</h4>
<div class="outline-text-4" id="text-34-15-1">
<pre class="example">
cat Pipfile.lock | jq '. | keys
</pre>

<p>
"<sub>meta</sub>",  "default",  "develop"
</p>

<p>
packages with version:
cat Pipfile.lock | jq '.default | (keys | .[]) + (.[].version)'
</p>
</div>
</div>


<div id="outline-container-org034824c" class="outline-4">
<h4 id="org034824c"><span class="section-number-4">34.15.2.</span> steps to create project:</h4>
<div class="outline-text-4" id="text-34-15-2">
<ol class="org-ol">
<li>pipenv install requests</li>
<li>cd myproject</li>
<li>pipenv install # Install from Pipfile, if there is one:</li>
<li>pipenv install &lt;package&gt; # add package</li>
<li>pipenv lock # create Pepfile.lock with hashes -  repeatable, and deterministic, builds.</li>
<li>pipenv shell</li>
<li>pipenv update &#x2013;outdated # show what is outdated</li>
<li>pipenv update or pipenv update &lt;pkg&gt;</li>
</ol>

<p>
<a href="https://docs.pipenv.org/basics/">https://docs.pipenv.org/basics/</a>
</p>
</div>
</div>

<div id="outline-container-org17b8653" class="outline-4">
<h4 id="org17b8653"><span class="section-number-4">34.15.3.</span> commands</h4>
<div class="outline-text-4" id="text-34-15-3">
<ul class="org-ul">
<li>check         Checks for PyUp Safety security vulnerabilities and against
PEP 508 markers provided in Pipfile.</li>
<li>clean         Uninstalls all packages not specified in Pipfile.lock.</li>
<li>graph         Displays currently-installed dependency graph information.</li>
<li>install       Installs provided packages and adds them to Pipfile, or (if no
packages are given), installs all packages from Pipfile.</li>
<li>lock          Generates Pipfile.lock.</li>
<li>open          View a given module in your editor.</li>
<li>requirements  Generate a requirements.txt from Pipfile.lock.</li>
<li>run           Spawns a command installed into the virtualenv.</li>
<li>scripts       Lists scripts in current environment config.</li>
<li>shell         Spawns a shell within the virtualenv.</li>
<li>sync          Installs all packages specified in Pipfile.lock.</li>
<li>uninstall     Uninstalls a provided package and removes it from Pipfile.</li>
<li>update        Runs lock, then sync.</li>
<li>upgrade       Resolves provided packages and adds them to Pipfile, or (if no
packages are given), merges results to Pipfile.lock</li>
<li>verify        Verify the hash in Pipfile.lock is up-to-date.</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org0810743" class="outline-3">
<h3 id="org0810743"><span class="section-number-3">34.16.</span> links</h3>
<div class="outline-text-3" id="text-34-16">
<p>
<a href="https://pip.pypa.io/en/latest/topics/secure-installs/">https://pip.pypa.io/en/latest/topics/secure-installs/</a>
</p>
</div>
</div>
</div>


<div id="outline-container-orgef9b67c" class="outline-2">
<h2 id="orgef9b67c"><span class="section-number-2">35.</span> urllib3 and requests library</h2>
<div class="outline-text-2" id="text-35">
<p>
requests-&gt;urllib3-&gt;http.client
</p>

<p>
request parametes:
</p>
<ul class="org-ul">
<li>data - body with header: Content-Type: applicantion/x-www-form-urlencoded</li>
<li>params - ?param=value - urllib.quote(string)</li>
</ul>
</div>



<div id="outline-container-orgbf1f024" class="outline-3">
<h3 id="orgbf1f024"><span class="section-number-3">35.1.</span> difference</h3>
<div class="outline-text-3" id="text-35-1">
<p>
<b>speed</b> - I found that time took to send the data from the client to the server took same time for both
  modules (urllib, requests) but the time it took to return data from the server to the client is more then
  twice faster in urllib compare to request.
</p>
</div>
</div>

<div id="outline-container-org859f571" class="outline-3">
<h3 id="org859f571"><span class="section-number-3">35.2.</span> see raw request</h3>
<div class="outline-text-3" id="text-35-2">
</div>
<div id="outline-container-org69bd119" class="outline-4">
<h4 id="org69bd119"><span class="section-number-4">35.2.1.</span> requests</h4>
<div class="outline-text-4" id="text-35-2-1">
</div>
<ol class="org-ol">
<li><a id="orgde676ff"></a>1) after request:<br />
<div class="outline-text-5" id="text-35-2-1-1">
<p>
hello, as!
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #cae682;">p</span> = requests.post(f<span style="color: #95e454;">'http://127.0.0.1:8081/transcribe/</span>{rid}<span style="color: #95e454;">/find_sentence'</span>, params={<span style="color: #95e454;">'sentences'</span>: sentences})
<span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"----request:"</span>)
[<span style="color: #e5786d;">print</span>(x) <span style="color: #8ac6f2; font-weight: bold;">for</span> x <span style="color: #8ac6f2; font-weight: bold;">in</span> p.request.<span style="color: #e5786d;">__dict__</span>.items()]
</pre>
</div>
<p>
#+
</p>
</div>
</li>
<li><a id="orgee5a015"></a>2) before request<br />
<div class="outline-text-5" id="text-35-2-1-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #cae682;">s</span> = Session()
<span style="color: #cae682;">req</span> = Request(<span style="color: #95e454;">'GET'</span>,  url, data=data, headers=headers)
<span style="color: #cae682;">prepped</span> = s.prepare_request(req)
[<span style="color: #e5786d;">print</span>(x) <span style="color: #8ac6f2; font-weight: bold;">for</span> x <span style="color: #8ac6f2; font-weight: bold;">in</span> prepped.<span style="color: #e5786d;">__dict__</span>.items()]
</pre>
</div>
</div>
</li>
<li><a id="org579faa0"></a>3) after request from logs:<br />
<div class="outline-text-5" id="text-35-2-1-3">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> requests
<span style="color: #8ac6f2; font-weight: bold;">import</span> logging

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">These two lines enable debugging at httplib level (requests-&gt;urllib3-&gt;http.client)</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">You will see the REQUEST, including HEADERS and DATA, and RESPONSE with HEADERS but without DATA.</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">The only thing missing will be the response.body which is not logged.</span>
<span style="color: #8ac6f2; font-weight: bold;">try</span>:
    <span style="color: #8ac6f2; font-weight: bold;">import</span> http.client <span style="color: #8ac6f2; font-weight: bold;">as</span> http_client
<span style="color: #8ac6f2; font-weight: bold;">except</span> <span style="color: #92a65e; font-weight: bold;">ImportError</span>:
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Python 2</span>
    <span style="color: #8ac6f2; font-weight: bold;">import</span> httplib <span style="color: #8ac6f2; font-weight: bold;">as</span> http_client
http_client.HTTPConnection.<span style="color: #cae682;">debuglevel</span> = 1

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">You must initialize logging, otherwise you'll not see debug output.</span>
logging.basicConfig()
logging.getLogger().setLevel(logging.DEBUG)
<span style="color: #cae682;">requests_log</span> = logging.getLogger(<span style="color: #95e454;">"requests.packages.urllib3"</span>)
requests_log.setLevel(logging.DEBUG)
requests_log.<span style="color: #cae682;">propagate</span> = <span style="color: #e5786d; font-weight: bold;">True</span>

requests.get(<span style="color: #95e454;">'https://httpbin.org/headers'</span>)
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-org05b57a3" class="outline-4">
<h4 id="org05b57a3"><span class="section-number-4">35.2.2.</span> links</h4>
<div class="outline-text-4" id="text-35-2-2">
<ul class="org-ul">
<li><a href="https://stackoverflow.com/questions/10588644/how-can-i-see-the-entire-http-request-thats-being-sent-by-my-python-application">https://stackoverflow.com/questions/10588644/how-can-i-see-the-entire-http-request-thats-being-sent-by-my-python-application</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org0ce2474" class="outline-3">
<h3 id="org0ce2474"><span class="section-number-3">35.3.</span> problems:</h3>
<div class="outline-text-3" id="text-35-3">
<ul class="org-ul">
<li></li>
</ul>
</div>
</div>
<div id="outline-container-org697d0f4" class="outline-3">
<h3 id="org697d0f4"><span class="section-number-3">35.4.</span> links</h3>
<div class="outline-text-3" id="text-35-4">
<ul class="org-ul">
<li><a href="https://requests.readthedocs.io/en/latest/">https://requests.readthedocs.io/en/latest/</a></li>
<li><a href="https://urllib3.readthedocs.io/en/stable/">https://urllib3.readthedocs.io/en/stable/</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org612ac8a" class="outline-2">
<h2 id="org612ac8a"><span class="section-number-2">36.</span> pdf 2 png</h2>
<div class="outline-text-2" id="text-36">
</div>
<div id="outline-container-org2ad421f" class="outline-3">
<h3 id="org2ad421f"><span class="section-number-3">36.1.</span> pdf2image</h3>
<div class="outline-text-3" id="text-36-1">
<p>
require poppler-utils
</p>
<ul class="org-ul">
<li>wraps pdftoppm and pdftocairo</li>
<li>to PIL image</li>
</ul>
</div>
</div>
<div id="outline-container-org3da8345" class="outline-3">
<h3 id="org3da8345"><span class="section-number-3">36.2.</span> Wand</h3>
<div class="outline-text-3" id="text-36-2">
<p>
pip3 install Wand
</p>

<p>
ImageMagic binding
</p>
</div>
</div>
<div id="outline-container-org9dd1935" class="outline-3">
<h3 id="org9dd1935"><span class="section-number-3">36.3.</span> PyMuPDF</h3>
<div class="outline-text-3" id="text-36-3">
<p>
pip3 install PyMuPDF
</p>
</div>
</div>
</div>

<div id="outline-container-orgbecfc9f" class="outline-2">
<h2 id="orgbecfc9f"><span class="section-number-2">37.</span> statsmodels</h2>
<div class="outline-text-2" id="text-37">
<ul class="org-ul">
<li><a href="https://github.com/statsmodels/statsmodels">https://github.com/statsmodels/statsmodels</a></li>
<li><a href="https://www.coursera.org/lecture/data-analysis-applications/avtokorrieliatsiia-4PEHZ">https://www.coursera.org/lecture/data-analysis-applications/avtokorrieliatsiia-4PEHZ</a></li>
<li><a href="https://machinelearningmastery.com/gentle-introduction-autocorrelation-partial-autocorrelation/">https://machinelearningmastery.com/gentle-introduction-autocorrelation-partial-autocorrelation/</a></li>
<li><a href="https://en.wikipedia.org/wiki/Partial_autocorrelation_function">https://en.wikipedia.org/wiki/Partial_autocorrelation_function</a></li>
</ul>
</div>
<div id="outline-container-orgd7c9993" class="outline-3">
<h3 id="orgd7c9993"><span class="section-number-3">37.1.</span> ACF, PACF</h3>
<div class="outline-text-3" id="text-37-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">from</span> statsmodels.graphics.tsaplots <span style="color: #8ac6f2; font-weight: bold;">import</span> plot_acf
<span style="color: #8ac6f2; font-weight: bold;">from</span> matplotlib <span style="color: #8ac6f2; font-weight: bold;">import</span> pyplot
<span style="color: #cae682;">series</span> = read_csv(<span style="color: #95e454;">'seasonally_adjusted.csv'</span>, header=<span style="color: #e5786d; font-weight: bold;">None</span>)
plot_acf(series, lags = 150) <span style="color: #fa8072;">#  </span><span style="color: #99968b; font-style: italic;">lag values along the x-axis and correlation on the y-axis between -1 and 1</span>
plot_pacf(series) <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">&#1085;&#1077; &#1087;&#1086;&#1085;&#1103;&#1090;&#1100;. &#1082;&#1086;&#1088;&#1086;&#1095;&#1077;, &#1090;&#1086; &#1078;&#1077; &#1089;&#1072;&#1084;&#1086;&#1077;, &#1090;&#1086;&#1083;&#1100;&#1082;&#1086; &#1073;&#1086;&#1083;&#1077;&#1077; &#1082;&#1086;&#1088;&#1086;&#1090;&#1082;&#1080;&#1077; &#1082;&#1086;&#1088;&#1088;&#1077;&#1083;&#1103;&#1094;&#1080;&#1080; &#1085;&#1077; &#1084;&#1077;&#1096;&#1072;&#1102;&#1090;</span>
pyplot.show()
</pre>
</div>
</div>
</div>
<div id="outline-container-orgfd48553" class="outline-3">
<h3 id="orgfd48553"><span class="section-number-3">37.2.</span> bar plot</h3>
<div class="outline-text-3" id="text-37-2">
<pre class="example">
loan_type_count = data['Loan Type'].value_counts()
sns.set(style="darkgrid")
sns.barplot(loan_type_count.index, loan_type_count.values, alpha=0.9)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd67c5ec" class="outline-2">
<h2 id="orgd67c5ec"><span class="section-number-2">38.</span> XGBoost</h2>
<div class="outline-text-2" id="text-38">
<ul class="org-ul">
<li><a href="https://github.com/dmlc/xgboost">https://github.com/dmlc/xgboost</a></li>
<li>doc <a href="https://xgboost.readthedocs.io/en/latest/">https://xgboost.readthedocs.io/en/latest/</a></li>
<li>parameters tunning <a href="https://xgboost.readthedocs.io/en/latest/tutorials/param_tuning.html">https://xgboost.readthedocs.io/en/latest/tutorials/param_tuning.html</a></li>
</ul>

<p>
One natural regularization parameter is the number of gradient boosting iterations M (i.e. the number of trees
in the model when the base learner is a decision tree).
</p>
</div>
<div id="outline-container-orga4084b6" class="outline-3">
<h3 id="orga4084b6"><span class="section-number-3">38.1.</span> usage</h3>
<div class="outline-text-3" id="text-38-1">
<pre class="example">
import xgboost as xgb
</pre>

<p>
or
</p>
<pre class="example">
from xgboost import XGBClassifier - multi:softprob if classes &gt; 2
</pre>


<p>
for multiclass classification:
</p>
<ul class="org-ul">
<li>from sklearn.preprocessing import LabelBinarizer</li>
<li>y = np.array(['apple', 'pear', 'apple', 'orange'])</li>
<li>y<sub>dense</sub> = LabelBinarizer().fit<sub>transform</sub>(y) - [ [1 0 0],[0 0 1],[1 0 0],[0 0 1] ]</li>
</ul>
</div>
</div>

<div id="outline-container-org3578fc9" class="outline-3">
<h3 id="org3578fc9"><span class="section-number-3">38.2.</span> categorical columns</h3>
<div class="outline-text-3" id="text-38-2">
<p>
The politic of XGBoost is to not have a special support for <b>categorical variables</b>. It s up to you to
manage them before providing the features to the algo.
</p>

<p>
If booster=='gbtree' (the default), then XGBoost can handle categorical variables encoded as numeric
directly, without needing dummifying/one-hotting. Whereas if the label is a string (not an integer)
then yes we need to comvert it.
</p>
</div>

<div id="outline-container-org5fa37d2" class="outline-4">
<h4 id="org5fa37d2"><span class="section-number-4">38.2.1.</span> Feature importance between numerical and categorical features</h4>
<div class="outline-text-4" id="text-38-2-1">
<p>
<a href="https://discuss.xgboost.ai/t/feature-importance-between-numerical-and-categorical-features/245">https://discuss.xgboost.ai/t/feature-importance-between-numerical-and-categorical-features/245</a>
</p>

<p>
one-hot encoding. Consequently, each categorical feature transforms into N sub-categorical features,
where N is the number of possible outcomes for this categorical feature.
</p>

<p>
Then each sub-categorical feature would compete with the rest of sub-categorical features and all
numerical features. It is much easier for a numerical feature to get higher importance ranking.
</p>

<p>
What we can do is to set importance<sub>type</sub> to weight and then add up the frequencies of
sub-categorical features to obtain the frequency of each categorical feature.
</p>
</div>
</div>
</div>
<div id="outline-container-orgdcc5cf3" class="outline-3">
<h3 id="orgdcc5cf3"><span class="section-number-3">38.3.</span> gpu support</h3>
<div class="outline-text-3" id="text-38-3">
<pre class="example">
tree_method = 'gpu_hist'
gpu_id = 0  (optional)
</pre>
</div>
</div>
<div id="outline-container-org8b804d7" class="outline-3">
<h3 id="org8b804d7"><span class="section-number-3">38.4.</span> result value from leaf value</h3>
<div class="outline-text-3" id="text-38-4">
<p>
The final probability prediction is obtained by taking sum of leaf values (raw scores) in all the trees and
then transforming it between 0 and 1 using a <b>sigmoid</b> function. (1 / (1 + math.exp(-x)))
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #cae682;">leaf</span> = 0.1111119 <span style="color: #fa8072;">#  </span><span style="color: #99968b; font-style: italic;">raw score</span>
<span style="color: #cae682;">result</span> = 1/(1+ np.exp(-(leaf))) = 0.5394 <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">probability score -  logistic function</span>

xgb.plot_tree(bst, num_trees=num_round-1) <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">default 0 tree</span>

<span style="color: #e5786d;">print</span>(bst.predict(t, ntree_limit=1)) <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">first 0 tree, default - all</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3d0bcf4" class="outline-3">
<h3 id="org3d0bcf4"><span class="section-number-3">38.5.</span> terms</h3>
<div class="outline-text-3" id="text-38-5">
<ul class="org-ul">
<li>instance or entity - line</li>
<li>feature - column</li>
<li>data - list of instances - 2D</li>
<li>labels - 1D list of labels for instances</li>
</ul>
</div>
</div>
<div id="outline-container-org9eb88d1" class="outline-3">
<h3 id="org9eb88d1"><span class="section-number-3">38.6.</span> xgb.DMatrix</h3>
<div class="outline-text-3" id="text-38-6">
<ul class="org-ul">
<li>LibSVM text format file</li>
<li>Comma-separated values (CSV) file</li>
<li>NumPy 2D array</li>
<li>SciPy 2D sparse array</li>
<li>cuDF DataFrame</li>
<li>Pandas data frame, and</li>
<li>XGBoost binary buffer file.</li>
</ul>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #cae682;">data</span> = np.random.rand(5, 10)  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">5 entities, each contains 10 features</span>
<span style="color: #cae682;">label</span> = np.random.randint(2, size=5)  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">binary target array([1, 0, 1, 0, 0])</span>
<span style="color: #cae682;">dtrain</span> = xgb.DMatrix(data, label=label)

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">weights</span>
<span style="color: #cae682;">w</span> = np.random.rand(5, 1)
<span style="color: #cae682;">dtrain</span> = xgb.DMatrix(data, label=label, missing=-999.0, weight=w)
</pre>
</div>
</div>

<div id="outline-container-org09f3578" class="outline-4">
<h4 id="org09f3578"><span class="section-number-4">38.6.1.</span> LibSVM file format</h4>
<div class="outline-text-4" id="text-38-6-1">
<pre class="example">
1 101:1.2 102:0.03
0 1:2.1 10001:300 10002:400
</pre>


<ul class="org-ul">
<li>Each line represent a single instance</li>
<li>1,0 - labels - probability values in [0,1]</li>
<li>101, 102 - feature indices</li>
<li>1.2, 0.03 - feature values</li>
</ul>


<pre class="example">
xgb.DMatrix('/home/u2/Downloads/agaricus.txt.train')
xgb.DMatrix(train.csv?format=csv&amp;label_column=0)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgeabf73d" class="outline-3">
<h3 id="orgeabf73d"><span class="section-number-3">38.7.</span> parameters</h3>
<div class="outline-text-3" id="text-38-7">
<p>
<a href="https://xgboost.readthedocs.io/en/latest/parameter.html">https://xgboost.readthedocs.io/en/latest/parameter.html</a>
</p>

<pre class="example">
param = {'max_depth': 2, 'eta': 1, 'objective': 'binary:logistic'}
</pre>


<p>
objective:
</p>
<ul class="org-ul">
<li>'binary:logistic' - labels [0,1] - output probability, binary</li>
</ul>
<p>
-'reg:squarederror' - regression with squared loss
</p>
<ul class="org-ul">
<li>multi:softmax		multiclass classification using the softmax objective</li>
<li></li>
</ul>

<p>
'booster': 'gbtree' - <b>gbtree</b> and <b>dart</b> use tree based models while <b>gblinear</b> uses linear functions
</p>

<p>
eval<sub>metric</sub> - <b>rmse</b> for regression, and <b>error</b> for classification, <b>mean average precision</b> for ranking
</p>
<ul class="org-ul">
<li>error - Binary classification #(wrong cases)/#(all cases)</li>
</ul>

<p>
'seed': 0 - random seed
</p>

<p>
<b>gbtree</b>
</p>
<ul class="org-ul">
<li>'eta': 0.3  - learning<sub>rate</sub></li>
<li>'max<sub>depth</sub>': 6 - Maximum depth of a tree - more = more complex and more likely to overfit</li>
<li>'gamma': 0 - Minimum loss reduction required to make a further partition on a leaf node of the tree. - to
make more coservative</li>
</ul>
</div>
</div>

<div id="outline-container-org62ba369" class="outline-3">
<h3 id="org62ba369"><span class="section-number-3">38.8.</span> print important features</h3>
<div class="outline-text-3" id="text-38-8">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> matplotlib.pyplot <span style="color: #8ac6f2; font-weight: bold;">as</span> plt
<span style="color: #8ac6f2; font-weight: bold;">import</span> matplotlib
matplotlib.use(<span style="color: #95e454;">'TkAgg'</span>)

xgb.plot_importance(bst)
plt.show()
</pre>
</div>
</div>
</div>
<div id="outline-container-org3e45143" class="outline-3">
<h3 id="org3e45143"><span class="section-number-3">38.9.</span> <span class="todo TODO">TODO</span> prune обрезание деревьев</h3>
</div>
<div id="outline-container-orgeb267b9" class="outline-3">
<h3 id="orgeb267b9"><span class="section-number-3">38.10.</span> permutation importance</h3>
<div class="outline-text-3" id="text-38-10">
<p>
for XGBClassificator (binary) - sklearn.inspection.permutation<sub>importance</sub>
</p>

<p>
other - shap values
</p>
</div>
</div>
<div id="outline-container-orgf452d7e" class="outline-3">
<h3 id="orgf452d7e"><span class="section-number-3">38.11.</span> model to if-else</h3>
<div class="outline-text-3" id="text-38-11">
<p>
<a href="https://towardsdatascience.com/xgboost-deployment-made-easy-6e11f4b3f817">https://towardsdatascience.com/xgboost-deployment-made-easy-6e11f4b3f817</a>
</p>
</div>
</div>
<div id="outline-container-org4edd940" class="outline-3">
<h3 id="org4edd940"><span class="section-number-3">38.12.</span> Errors</h3>
<div class="outline-text-3" id="text-38-12">
</div>
<div id="outline-container-org41712f8" class="outline-4">
<h4 id="org41712f8"><span class="section-number-4">38.12.1.</span> ValueError: setting an array element with a sequence.</h4>
</div>
<div id="outline-container-org3e81ab3" class="outline-4">
<h4 id="org3e81ab3"><span class="section-number-4">38.12.2.</span> label must be in [0,1] for logistic regression</h4>
</div>
</div>
</div>
<div id="outline-container-org86bfdaa" class="outline-2">
<h2 id="org86bfdaa"><span class="section-number-2">39.</span> Natasha &amp; Yargy</h2>
<div class="outline-text-2" id="text-39">
<ul class="org-ul">
<li>pip install jupyter</li>
<li>pip install yargy ipymarkup    - подсветка разметки</li>
<li>jupyter.exe notebook</li>
<li>graphviz и вручную настроил PATH на его bin</li>
</ul>
</div>
<div id="outline-container-org342ca26" class="outline-3">
<h3 id="org342ca26"><span class="section-number-3">39.1.</span> yargy</h3>
<div class="outline-text-3" id="text-39-1">
<ul class="org-ul">
<li><b>yarky tokenizer</b> <a href="https://yargy.readthedocs.io/ru/latest/reference.html">https://yargy.readthedocs.io/ru/latest/reference.html</a></li>
<li><b>yargy</b> <a href="https://yargy.readthedocs.io/ru/latest/index.html">https://yargy.readthedocs.io/ru/latest/index.html</a></li>
<li>MIT License</li>
</ul>
<p>
Недостатки:
</p>
<ul class="org-ul">
<li>slow</li>
<li>не гибкий</li>
<li>нелья построить правила с условиями</li>
</ul>
</div>
<div id="outline-container-org172a7dd" class="outline-4">
<h4 id="org172a7dd"><span class="section-number-4">39.1.1.</span> yargy.tokenizer</h4>
<div class="outline-text-4" id="text-39-1-1">
<pre class="example">
from yargy.tokenizer import MorphTokenizer # используется по умолчанию
t = MorphTokenizer()
list(t('asds'))[0].value
list(t('asds'))[0].normalized
</pre>

<p>
Его правила:
</p>
<ul class="org-ul">
<li>TokenRule('RU', '[а-яё]+'),</li>
<li>TokenRule('LATIN', '[a-z]+'),</li>
<li>TokenRule('INT', '\d+'),</li>
<li>TokenRule('PUNCT','[-\\/!#$%&amp;()\[\]\*\+,\.:;&lt;=&gt;?@^_`{|}~№…"\'«»„“ʼʻ”]'),</li>
<li>TokenRule('EOL', '[\n\r]+'),</li>
<li>TokenRule('OTHER', '&sect;')]</li>
</ul>
<p>
убрать часть правил:
tokenizer = Tokenizer().remove<sub>types</sub>('EOL')
</p>
</div>
</div>
<div id="outline-container-org261b98a" class="outline-4">
<h4 id="org261b98a"><span class="section-number-4">39.1.2.</span> rules</h4>
<div class="outline-text-4" id="text-39-1-2">
<ul class="org-ul">
<li>yargy.predicates- type('INT'), eq('г'), _or(normalized('ложка'), caseless('вилка')</li>
<li>yargy.rule - rule(predicates, &#x2026;), or_</li>
<li>yargy.pipelines - газетти́р - список - конструктор правила
<ul class="org-ul">
<li>morph<sub>pipeline</sub>(['л','г']) - перед работой приводит слова к нормальной форме</li>
<li>caseless<sub>pipeline</sub>(['Абд Аль','и']) - перед работой приводит слова к нижнему регистру</li>
</ul></li>
<li>yargy.interpretation.fact('название',['аттрибут', &#x2026;]) - его используют предикаты для их интерпритации. -
Интерпретация, это сварачивание дерева разбора снизу вверх.
<ul class="org-ul">
<li>attribute - значение по умолчанию для аттрибута и опреации над результатом</li>
</ul></li>
</ul>
<pre class="example">
f = fact('name',[attribute('year', 2017)])
a=eq('100').interpretation(f.year.custom(произвольная фонкция одного аргумента))
r=rule(a).interpretation(f)
match.fact or match.tree.as_dot
</pre>
</div>
</div>

<div id="outline-container-org2dca019" class="outline-4">
<h4 id="org2dca019"><span class="section-number-4">39.1.3.</span> match</h4>
<div class="outline-text-4" id="text-39-1-3">
<ul class="org-ul">
<li><a href="https://github.com/natasha/yargy/blob/master/yargy/parser.py">https://github.com/natasha/yargy/blob/master/yargy/parser.py</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgd15a812" class="outline-4">
<h4 id="orgd15a812"><span class="section-number-4">39.1.4.</span> предикаты</h4>
<div class="outline-text-4" id="text-39-1-4">
<ul class="org-ul">
<li>eq(value) 		a == b</li>
<li>caseless(value) 	a.lower() == b.lower()</li>
<li>in<sub>(value)</sub>   a in b</li>
<li>in<sub>caseless</sub>(value) 	a.lower() in b</li>
<li>gte(value) 		a &gt;= b</li>
<li>lte(value) 		a &lt;= b</li>
<li>length<sub>eq</sub>(value) 	len(a) == b</li>
<li>normalized(value) 	Нормальная форма слова == value</li>
<li>dictionary(value) 	Нормальная форма слова in value</li>
<li>gram(value) 		value есть среди граммем слова</li>
<li>type(value) 		Тип токена равен value</li>
<li>tag(value) 		Тег токена равен value</li>
<li>custom(function[, types]) 	function в качестве предиката</li>
<li>true 			Всегда возвращает True</li>
<li>is<sub>lower</sub>   str.islower</li>
<li>is<sub>upper</sub>   str.isupper</li>
<li>is<sub>title</sub>   str.istitle</li>
<li>is<sub>capitalized</sub>  Слово написано с большой буквы</li>
<li>is<sub>single</sub>   Слово в единственном числе</li>
</ul>

<p>
Сэты:
</p>
<ul class="org-ul">
<li>optional()</li>
<li>repeatable(min=None, max=None, reverse=False)</li>
<li>interpretation(a.a) - прикрепляет предикат к эллементу интерпретации</li>
</ul>
</div>
</div>
<div id="outline-container-orge397fb9" class="outline-4">
<h4 id="orge397fb9"><span class="section-number-4">39.1.5.</span> нестандартные формы слова - рулетики</h4>
<div class="outline-text-4" id="text-39-1-5">
<ul class="org-ul">
<li>Т библиотека?</li>
<li>уменьшительно ласкательные приводить к стандартной офрме, словарики?</li>
</ul>
</div>
</div>

<div id="outline-container-orgcd085ff" class="outline-4">
<h4 id="orgcd085ff"><span class="section-number-4">39.1.6.</span> ex</h4>
<div class="outline-text-4" id="text-39-1-6">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">------- &#1087;&#1088;&#1072;&#1074;&#1080;&#1083;&#1086; &#1074; &#1074;&#1080;&#1076;&#1077; &#1082;&#1086;&#1085;&#1090;&#1077;&#1082;&#1089;&#1090;&#1085;&#1086;-&#1089;&#1074;&#1086;&#1073;&#1086;&#1076;&#1085;&#1086;&#1081; &#1075;&#1088;&#1072;&#1084;&#1084;&#1072;&#1090;&#1080;&#1082;&#1080; ----</span>
<span style="color: #8ac6f2; font-weight: bold;">from</span> yargy <span style="color: #8ac6f2; font-weight: bold;">import</span> rule
<span style="color: #cae682;">R</span> = rule(<span style="color: #95e454;">'a'</span>,<span style="color: #95e454;">'b'</span>)
R.normalized.as_bnf
&gt;&gt; R -&gt; <span style="color: #95e454;">'a'</span> <span style="color: #95e454;">'b'</span>
<span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">------- FLOAT -------</span>
<span style="color: #8ac6f2; font-weight: bold;">from</span> yargy <span style="color: #8ac6f2; font-weight: bold;">import</span> rule, or_
<span style="color: #8ac6f2; font-weight: bold;">from</span> yargy.predicates <span style="color: #8ac6f2; font-weight: bold;">import</span> eq, <span style="color: #e5786d;">type</span> <span style="color: #8ac6f2; font-weight: bold;">as</span> _type, in_
<span style="color: #cae682;">INT</span> = _type(<span style="color: #95e454;">'INT'</span>)
<span style="color: #cae682;">FLOAT</span> = rule(INT, in_(<span style="color: #95e454;">',.'</span>), INT)
<span style="color: #cae682;">FRACTION</span> = rule(INT, eq(<span style="color: #95e454;">'/'</span>), INT)
<span style="color: #cae682;">RANGE</span> = rule(INT, eq(<span style="color: #95e454;">'-'</span>), INT)
<span style="color: #cae682;">AMOUNT</span> = or_(
  rule(INT),
  FLOAT,
  FRACTION,
  RANGE)
<span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">------- MorphTokenizer -----------</span>
<span style="color: #8ac6f2; font-weight: bold;">from</span> yargy.tokenizer <span style="color: #8ac6f2; font-weight: bold;">import</span> MorphTokenizer
<span style="color: #cae682;">TOKE</span> = MorphTokenizer()
<span style="color: #cae682;">l</span> = <span style="color: #e5786d;">list</span>(TOKE(text))
<span style="color: #8ac6f2; font-weight: bold;">for</span> i <span style="color: #8ac6f2; font-weight: bold;">in</span> l: <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">'</span><span style="color: #e5786d; font-weight: bold;">\n</span><span style="color: #95e454;">'</span>.join(<span style="color: #e5786d;">map</span>(<span style="color: #e5786d;">str</span>, i)))
<span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">--------- findall ----------</span>
<span style="color: #8ac6f2; font-weight: bold;">from</span> yargy <span style="color: #8ac6f2; font-weight: bold;">import</span> rule, Parser
<span style="color: #8ac6f2; font-weight: bold;">from</span> yargy.predicates <span style="color: #8ac6f2; font-weight: bold;">import</span> eq

<span style="color: #cae682;">line</span> = <span style="color: #95e454;">'100 &#1075;'</span>

<span style="color: #cae682;">MEASURE</span> = rule(eq(100))
<span style="color: #cae682;">parser</span> = Parser(MEASURE.optional())
<span style="color: #cae682;">matches</span>=<span style="color: #e5786d;">list</span>(parser.findall(line))
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">--------- Simples ------</span>
<span style="color: #8ac6f2; font-weight: bold;">from</span> yargy <span style="color: #8ac6f2; font-weight: bold;">import</span> rule, Parser
<span style="color: #cae682;">r</span> = rule(<span style="color: #95e454;">'a'</span>,<span style="color: #95e454;">'b'</span>)
<span style="color: #cae682;">parser</span> = Parser(r)
<span style="color: #cae682;">line</span> = <span style="color: #95e454;">'abc'</span>
<span style="color: #8ac6f2; font-weight: bold;">match</span> = parser.<span style="color: #8ac6f2; font-weight: bold;">match</span>(line)
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">----------- spans  show --------</span>
<span style="color: #8ac6f2; font-weight: bold;">from</span> ipymarkup <span style="color: #8ac6f2; font-weight: bold;">import</span> markup, AsciiMarkup

<span style="color: #cae682;">spans</span> =[_.spam <span style="color: #8ac6f2; font-weight: bold;">for</span> _ <span style="color: #8ac6f2; font-weight: bold;">in</span> matches]
<span style="color: #8ac6f2; font-weight: bold;">for</span> line <span style="color: #8ac6f2; font-weight: bold;">in</span> markup(text, spans, AsciiMarkup).as_ascii:
    <span style="color: #e5786d;">print</span>(line)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd9961c7" class="outline-4">
<h4 id="orgd9961c7"><span class="section-number-4">39.1.7.</span> natasha</h4>
<div class="outline-text-4" id="text-39-1-7">
<p>
Extractors:
</p>
<ul class="org-ul">
<li>NamesExtractor - NAME,tagger=tagger</li>
<li>SimpleNamesExtractor - SIMPLE<sub>NAME</sub></li>
<li>PersonExtractor - PERSON, tagger=tagger</li>
<li>DatesExtractor - DATE</li>
<li>MoneyExtractor - MONEY</li>
<li>MoneyRateExtractor - MONEY<sub>RATE</sub></li>
<li>MoneyRangeExtractor - MONEY<sub>RANGE</sub></li>
<li>AddressExtractor - ADDRESS, tagger=tagger</li>
<li>LocationExtractor - LOCATION</li>
<li>OrganisationExtractor - ORGANISATION</li>
</ul>
</div>
</div>
<div id="outline-container-orgb43bd5e" class="outline-4">
<h4 id="orgb43bd5e"><span class="section-number-4">39.1.8.</span> console</h4>
<div class="outline-text-4" id="text-39-1-8">
<ul class="org-ul">
<li><a href="https://jupyter.org/documentation">https://jupyter.org/documentation</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgce1a0ab" class="outline-4">
<h4 id="orgce1a0ab"><span class="section-number-4">39.1.9.</span> QT console</h4>
<div class="outline-text-4" id="text-39-1-9">
<ul class="org-ul">
<li><a href="https://qtconsole.readthedocs.io/en/stable/">https://qtconsole.readthedocs.io/en/stable/</a></li>
<li><a href="https://www.tutorialspoint.com/jupyter/ipython_introduction.htm">https://www.tutorialspoint.com/jupyter/ipython_introduction.htm</a></li>
<li>inline figures</li>
<li>proper multi-line editing with syntax highlighting</li>
<li>graphical calltips</li>
<li>emacs-style bindings for text navigation</li>
<li>HTML or XHTML</li>
<li>PNG(outer or inline) in HTML, or inlined as SVG in XHTML</li>
<li><b>Run</b>: jupyter qtconsole &#x2013;style monokai</li>
<li>! - system command (!dir)</li>
<li>? - a? - information about varible, plt?? - source definition, exit - q</li>
<li>In[2] - input string, Out[2] - out</li>
<li><b>display(object)</b> display anythin supported</li>
<li>"*"*100500; - ; не видеть результат</li>
<li><b>Switch to SVG inline XHTML</b> In [10]: %config InlineBackend.figure<sub>format</sub> = 'svg'</li>
</ul>
</div>
<ol class="org-ol">
<li><a id="org64666dd"></a>keys<br />
<div class="outline-text-5" id="text-39-1-9-1">
<ul class="org-ul">
<li>Tab - autocompletion - Несклько раз нажать</li>
<li>``Enter``: insert new line (may cause execution, see above).</li>
<li>``Ctrl-Enter``: <b>force</b> new line, <b>never</b> causes execution.</li>
<li>``Shift-Enter``: <b>force</b> execution regardless of where cursor is, no newline added.</li>
<li>``Up``: step backwards through the history.</li>
<li>``Down``: step forwards through the history.</li>
<li>``Shift-Up``: search backwards through the history (like ``Control-r`` in bash).</li>
<li>``Shift-Down``: search forwards through the history.</li>
<li>``Control-c``: copy highlighted text to clipboard (prompts are automatically stripped).</li>
<li>``Control-Shift-c``: copy highlighted text to clipboard (prompts are not stripped).</li>
<li>``Control-v``: paste text from clipboard.</li>
<li>``Control-z``: undo (retrieves lost text if you move out of a cell with the arrows).</li>
<li>``Control-Shift-z``: redo.</li>
<li>``Control-o``: move to 'other' area, between pager and terminal.</li>
<li>``Control-l``: clear terminal.</li>
<li>``Control-a``: go to beginning of line.</li>
<li>``Control-e``: go to end of line.</li>
<li>``Control-u``: kill from cursor to the begining of the line.</li>
<li>``Control-k``: kill from cursor to the end of the line.</li>
<li>``Control-y``: yank (paste)</li>
<li>``Control-p``: previous line (like up arrow)</li>
<li>``Control-n``: next line (like down arrow)</li>
<li>``Control-f``: forward (like right arrow)</li>
<li>``Control-b``: back (like left arrow)</li>
<li>``Control-d``: delete next character, or exits if input is empty</li>
<li>``Alt-&lt;``: move to the beginning of the input region.</li>
<li>``alt-&gt;``: move to the end of the input region.</li>
<li>``Alt-d``: delete next word.</li>
<li>``Alt-Backspace``: delete previous word.</li>
<li>``Control-.``: force a kernel restart (a confirmation dialog appears).</li>
<li>``Control-+``: increase font size.</li>
<li>``Control&#x2013;``: decrease font size.</li>
<li>``Control-Alt-Space``: toggle full screen. (Command-Control-Space on Mac OS X)</li>
</ul>
</div>
</li>
<li><a id="orgd9bf3ad"></a>magic<br />
<div class="outline-text-5" id="text-39-1-9-2">
<ul class="org-ul">
<li>%lsmagic - Displays all magic functions currently available</li>
<li>%cd</li>
<li>%pwd</li>
<li>%dhist - directories you have visited in current session</li>
<li>%notebook - history to  into an IPython notebook file with ipynb extension</li>
<li>%precision n - n after ,</li>
<li>%recall n -  execute preview command or n command</li>
<li><b>%run a.py</b> - run file, - замерить время выполнения (-t), запустить с отладчиком (-d) или профайлером (-p)
<ul class="org-ul">
<li>%run -n main.py - import</li>
</ul></li>
<li>%time command - displays time required by IPython environment to execute a Python expression</li>
<li>%who type - у каких переменнх такой-то тип</li>
<li><b>%whos</b> - все импортированные и созданные объекты</li>
<li>%hist - вся история в виде текста</li>
<li><b>%rep n</b> - переход на n ввод</li>
</ul>

<p>
<b>Python</b>
</p>
<ul class="org-ul">
<li>%pdoc -  документацию</li>
<li>%pdef - определение функции</li>
<li>%psource - исходный код функции, класса</li>
<li>%pfile - полный код файла соответственно</li>
</ul>
</div>
</li>
<li><a id="org0d3a2bd"></a>TEMPLATE<br />
<div class="outline-text-5" id="text-39-1-9-3">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">------ TEMPLATE ---------------</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">QTconsole ----</span>
In [1]: run -n main.py

In [2]: main()

In [3]: <span style="color: #8ac6f2; font-weight: bold;">from</span> yargy <span style="color: #8ac6f2; font-weight: bold;">import</span> rule, Parser
<span style="color: #8ac6f2; font-weight: bold;">from</span> yargy.predicates <span style="color: #8ac6f2; font-weight: bold;">import</span> eq, <span style="color: #e5786d;">type</span> <span style="color: #8ac6f2; font-weight: bold;">as</span> _type, normalized
<span style="color: #cae682;">MEASURE</span> = rule(eq(<span style="color: #95e454;">'&#1053;&#1044;&#1057;'</span>))
<span style="color: #cae682;">parser</span> = Parser(MEASURE)
<span style="color: #8ac6f2; font-weight: bold;">for</span> line <span style="color: #8ac6f2; font-weight: bold;">in</span> words:
    <span style="color: #cae682;">matches</span> = <span style="color: #e5786d;">list</span>(parser.findall(line))
    <span style="color: #cae682;">spans</span> = [_.span <span style="color: #8ac6f2; font-weight: bold;">for</span> _ <span style="color: #8ac6f2; font-weight: bold;">in</span> matches]
    mup(line, spans)
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">main.py ------</span>
<span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">my</span>
<span style="color: #8ac6f2; font-weight: bold;">import</span> read_json


<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">-- test</span>
<span style="color: #cae682;">words</span> :<span style="color: #e5786d;">list</span> = [] <span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">words from file</span>
<span style="color: #cae682;">index</span> :<span style="color: #e5786d;">int</span> = 0
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">test --</span>

<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">mup</span>(s :<span style="color: #e5786d;">str</span>, spans:<span style="color: #e5786d;">list</span>):
    <span style="color: #f08080; font-style: italic;">""" &#1074;&#1099;&#1074;&#1086;&#1076;&#1080;&#1090; &#1095;&#1090;&#1086; &#1087;&#1086;&#1084;&#1072;&#1090;&#1095;&#1080;&#1083;&#1086;&#1089;&#1100; &#1085;&#1072; &#1089;&#1090;&#1088;&#1086;&#1082;&#1077; """</span>
    <span style="color: #8ac6f2; font-weight: bold;">from</span> ipymarkup <span style="color: #8ac6f2; font-weight: bold;">import</span> markup, AsciiMarkup
    <span style="color: #8ac6f2; font-weight: bold;">for</span> line <span style="color: #8ac6f2; font-weight: bold;">in</span> markup(s, spans, AsciiMarkup).as_ascii:
        <span style="color: #e5786d;">print</span>(line)

<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">work</span>(prov :<span style="color: #e5786d;">dict</span>):
    <span style="color: #f08080; font-style: italic;">"""&#1074;&#1099;&#1079;&#1099;&#1074;&#1072;&#1077;&#1090;&#1089;&#1103; &#1076;&#1083;&#1103; &#1082;&#1072;&#1078;&#1076;&#1086;&#1081; &#1089;&#1090;&#1088;&#1086;&#1082;&#1080; """</span>
    <span style="color: #cae682;">text</span> = prov[<span style="color: #95e454;">'naznach'</span>]
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">-- test</span>
    <span style="color: #8ac6f2; font-weight: bold;">global</span> words, index
    words.append(text)
    <span style="color: #cae682;">index</span> +=1
    <span style="color: #8ac6f2; font-weight: bold;">if</span> index &gt;5: <span style="color: #e5786d; font-weight: bold;">quit</span>()
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">test --</span>


<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">main</span>():<span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">args):</span>
    read_json.readit(<span style="color: #95e454;">'a.txt'</span>, work) <span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">aml_provodki.txt</span>
<span style="color: #fa8072;">#################### </span><span style="color: #99968b; font-style: italic;">MAIN ##########################</span>
<span style="color: #8ac6f2; font-weight: bold;">if</span> <span style="color: #e5786d;">__name__</span> == <span style="color: #95e454;">'__main__'</span>:  <span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">name of module-namespace.  '__main__' for - $python a.py</span>
     <span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">import sys</span>
     main()<span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">sys.argv)</span>
     <span style="color: #e5786d; font-weight: bold;">quit</span>()
</pre>
</div>
</div>
</li>
<li><a id="org37c442b"></a>Other<br />
<div class="outline-text-5" id="text-39-1-9-4">
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">--------- yargy to graphviz ------------</span>
<span style="color: #8ac6f2; font-weight: bold;">from</span> ipymarkup <span style="color: #8ac6f2; font-weight: bold;">import</span> markup, show_markup
<span style="color: #cae682;">spans</span> = [_.span <span style="color: #8ac6f2; font-weight: bold;">for</span> _ <span style="color: #8ac6f2; font-weight: bold;">in</span> matches]
show_markup(line,spans)

<span style="color: #cae682;">r</span> = rule(...
r.normalized.as_bnf


<span style="color: #8ac6f2; font-weight: bold;">match</span>.tree.as_dot
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">----------- &#1089;&#1083;&#1091;&#1095;&#1072;&#1081;&#1085;&#1072;&#1103; &#1074;&#1099;&#1073;&#1086;&#1088;&#1082;&#1072; &#1089;&#1090;&#1088;&#1086;&#1082; &#1076;&#1083;&#1103; &#1090;&#1077;&#1089;&#1090;&#1072; ----</span>
<span style="color: #8ac6f2; font-weight: bold;">from</span> random <span style="color: #8ac6f2; font-weight: bold;">import</span> seed, sample
seed(1)
sample(lines, 20)


OR
<span style="color: #8ac6f2; font-weight: bold;">from</span> random <span style="color: #8ac6f2; font-weight: bold;">import</span> sample

<span style="color: #8ac6f2; font-weight: bold;">for</span> a <span style="color: #8ac6f2; font-weight: bold;">in</span> sample(<span style="color: #e5786d;">range</span>(0,20), 2):
    <span style="color: #e5786d;">print</span>(a)
<span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">-------- matplotlib --------</span>
<span style="color: #8ac6f2; font-weight: bold;">from</span> matplotlib <span style="color: #8ac6f2; font-weight: bold;">import</span> pyplot <span style="color: #8ac6f2; font-weight: bold;">as</span> plt
plt.plot(<span style="color: #e5786d;">range</span>(10),<span style="color: #e5786d;">range</span>(10))
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-org7901995" class="outline-4">
<h4 id="org7901995"><span class="section-number-4">39.1.10.</span> graphviz</h4>
<div class="outline-text-4" id="text-39-1-10">
<ul class="org-ul">
<li>graphviz - <a href="https://graphviz.gitlab.io/download/">https://graphviz.gitlab.io/download/</a> - визуализация графов
<a href="https://ru.wikipedia.org/wiki/DOT_(%D1%8F%D0%B7%D1%8B%D0%BA)">https://ru.wikipedia.org/wiki/DOT_(%D1%8F%D0%B7%D1%8B%D0%BA)</a></li>
<li>Установить PATH на <i>bin</i> вручную</li>
<li>предназначен для работы внутри jupyter Notebook</li>
<li>pip3 install PyQt5</li>
</ul>

<p>
<a href="https://stackoverflow.com/questions/41942109/plotting-the-digraph-with-graphviz-in-python-from-dot-file">https://stackoverflow.com/questions/41942109/plotting-the-digraph-with-graphviz-in-python-from-dot-file</a>
</p>

<p>
<a href="https://www.youtube.com/watch?time_continue=1027&amp;v=NQxzx0qYgK8">https://www.youtube.com/watch?time_continue=1027&amp;v=NQxzx0qYgK8</a>
</p>

<p>
m.tree.as<sub>dot</sub>.<sub>repr</sub><sub>svg</sub><sub>()</sub>  - выдает что-то для graphiz
</p>
</div>
</div>
<div id="outline-container-orgefce33b" class="outline-4">
<h4 id="orgefce33b"><span class="section-number-4">39.1.11.</span> IPython</h4>
</div>
</div>
</div>

<div id="outline-container-org9ea19a8" class="outline-2">
<h2 id="org9ea19a8"><span class="section-number-2">40.</span> Stanford NER - Java</h2>
<div class="outline-text-2" id="text-40">
<ul class="org-ul">
<li>Conditional Random Field (CRF)</li>
<li>Stanford NER <a href="https://nlp.stanford.edu/software/CRF-NER.shtml#Starting">https://nlp.stanford.edu/software/CRF-NER.shtml#Starting</a></li>
<li>FAQ <a href="https://nlp.stanford.edu/software/crf-faq.html">https://nlp.stanford.edu/software/crf-faq.html</a></li>
<li>article <a href="https://towardsdatascience.com/a-review-of-named-entity-recognition-ner-using-automatic-summarization-of-resumes-5248a75de175">https://towardsdatascience.com/a-review-of-named-entity-recognition-ner-using-automatic-summarization-of-resumes-5248a75de175</a></li>
<li>article <a href="https://medium.com/@mohangupta13/stanford-corenlp-training-your-own-custom-ner-tagger-348195f54d97">https://medium.com/@mohangupta13/stanford-corenlp-training-your-own-custom-ner-tagger-348195f54d97</a></li>
<li>coreNLP <a href="https://stanfordnlp.github.io/CoreNLP/index.html">https://stanfordnlp.github.io/CoreNLP/index.html</a></li>
</ul>
</div>

<div id="outline-container-org4fcd565" class="outline-3">
<h3 id="org4fcd565"><span class="section-number-3">40.1.</span> train</h3>
<div class="outline-text-3" id="text-40-1">
<p>
You give the data file, the meaning of the columns, and what features to generate via a properties file.
</p>
</div>
</div>

<div id="outline-container-orgcc290b2" class="outline-3">
<h3 id="orgcc290b2"><span class="section-number-3">40.2.</span> Ttraining data</h3>
<div class="outline-text-3" id="text-40-2">
<ul class="org-ul">
<li>Dataturks NER tagger</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orga35709d" class="outline-2">
<h2 id="orga35709d"><span class="section-number-2">41.</span> DeepPavlov</h2>
<div class="outline-text-2" id="text-41">
<ul class="org-ul">
<li><a href="https://deeppavlov.ai/">https://deeppavlov.ai/</a></li>
<li><a href="http://docs.deeppavlov.ai/en/latest/components/ner.html">http://docs.deeppavlov.ai/en/latest/components/ner.html</a></li>
<li>SpaCy и DeepPavlov <a href="https://www.youtube.com/watch?v=WVhA3YpIek4">https://www.youtube.com/watch?v=WVhA3YpIek4</a></li>
<li>simple-intent-recognition <a href="https://medium.com/deeppavlov/simple-intent-recognition-and-question-answering-with-deeppavlov-c54ccf5339a9">https://medium.com/deeppavlov/simple-intent-recognition-and-question-answering-with-deeppavlov-c54ccf5339a9</a></li>
<li>Курс по NLP от DeepPavlov <a href="https://github.com/hse-aml/natural-language-processing">https://github.com/hse-aml/natural-language-processing</a></li>
<li>built on <b>TensorFlow</b> and <b>Keras</b></li>
</ul>
<p>
Валентин Малых, Алексей Лымарь, МФТИ
</p>
<ul class="org-ul">
<li><b>агенты</b> ведут диалог с пользователем,</li>
<li>у них есть <b>скилы</b>, которые выбираются. - это набор <b>компонентов</b> - spellchecker, morphanalizer,
классификатор интентов</li>
<li>скил - their input and output should both be strings</li>
<li>компоненты могут объединяться в цепочку, похожую на pipeline spacy</li>
</ul>
<p>
Компоненты - могут быть вложенными:
</p>
<ul class="org-ul">
<li>нет синтаксич парсера</li>
<li>Question Answering вопросно-ответная система</li>
<li>NER и Slot filling</li>
<li>Classification</li>
<li>Goal-oriented bot</li>
<li>Spellchecker</li>
<li>Morphotagger</li>
</ul>
</div>
<div id="outline-container-orgc8c7d23" class="outline-3">
<h3 id="orgc8c7d23"><span class="section-number-3">41.1.</span> Коммандная-строка</h3>
<div class="outline-text-3" id="text-41-1">
<p>
python .\deeppavlov\deep.py interact ner<sub>rus</sub> [-d]
</p>
<ul class="org-ul">
<li>взаимодействие, тестирование</li>
<li>ner<sub>rus</sub> - C:\Users\Chepilev<sub>VS\AppData\Local\Programs\Python\Python36\lib\site</sub>-packages\deeppavlov\configs\ner\ner<sub>rus.json</sub></li>
</ul>
</div>
</div>

<div id="outline-container-orgb38ffcd" class="outline-3">
<h3 id="orgb38ffcd"><span class="section-number-3">41.2.</span> вспомогательные классы</h3>
<div class="outline-text-3" id="text-41-2">
<ul class="org-ul">
<li>simple<sub>vocab</sub>
<ul class="org-ul">
<li>self.<sub>t2i</sub>[token] = self.count - индексы токенов</li>
<li>self.<sub>i2t.append</sub>(token) - токены индексов</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-orgefbbb17" class="outline-3">
<h3 id="orgefbbb17"><span class="section-number-3">41.3.</span> in code</h3>
<div class="outline-text-3" id="text-41-3">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">------------ build model and interact ---------</span>
<span style="color: #8ac6f2; font-weight: bold;">from</span> deeppavlov <span style="color: #8ac6f2; font-weight: bold;">import</span> configs
<span style="color: #8ac6f2; font-weight: bold;">from</span> deeppavlov.core.commands.infer <span style="color: #8ac6f2; font-weight: bold;">import</span> build_model

<span style="color: #cae682;">faq</span> = build_model(configs.faq.tfidf_logreg_en_faq, download = <span style="color: #e5786d; font-weight: bold;">True</span>)
<span style="color: #cae682;">a</span> = faq([<span style="color: #95e454;">"I need help"</span>])
</pre>
</div>
</div>
</div>

<div id="outline-container-org4efed65" class="outline-3">
<h3 id="org4efed65"><span class="section-number-3">41.4.</span> installation</h3>
<div class="outline-text-3" id="text-41-4">
<ul class="org-ul">
<li>apt install libssl-dev libncurses5-dev libsqlite3-dev libreadline-dev libtk8.5 libgdm-dev libdb4o-cil-dev libpcap-dev</li>
</ul>
<p>
wget <a href="https://www.python.org/ftp/python/3.6.8/Python-3.6.8rc1.tgz">https://www.python.org/ftp/python/3.6.8/Python-3.6.8rc1.tgz</a>
</p>
<ul class="org-ul">
<li>tar -xvzf</li>
<li>cd Python-3.6.8</li>
<li>./configure &#x2013;enable-optimizations &#x2013;with-ensurepip=install</li>
<li>make -j8</li>
<li>sudo make altinstall</li>
<li>python3.6</li>
<li>update-alternatives &#x2013;install /usr/bin/python python /usr/bin/python3.6 1</li>
<li>update-alternatives &#x2013;config python</li>
<li>python -m pip install &#x2013;upgrade pip</li>
<li>git config &#x2013;global http.proxy <a href="http://srv-proxy:8080">http://srv-proxy:8080</a></li>
<li>git clone <a href="https://github.com/deepmipt/DeepPavlov.git">https://github.com/deepmipt/DeepPavlov.git</a></li>
</ul>
<p>
ver 1
</p>
<ul class="org-ul">
<li>pip3.6 install virtualenv &#x2013;user</li>
<li>~/.local/bin/virtualenv ENV</li>
<li>source ENV/bin/activate</li>
</ul>
<p>
var 2
</p>
<ul class="org-ul">
<li>python -m venv .</li>
<li>source bin/activate</li>

<li>pip install deeppavlov</li>
<li>ENV/bin/python</li>
</ul>

<p>
<b>fastText</b>
</p>
<pre class="example">
pip install git+https://github.com/facebookresearch/fastText.git#egg=fastText==0.8.22
</pre>


<p>
install everything required by a specific DeepPavlov config by running:
</p>
<pre class="example">
python -m deeppavlov install &lt;config_name&gt;
</pre>


<p>
<b>МОИ ФИКСЫ</b> <a href="https://github.com/vitalij23/DeepPavlov/commits/master">https://github.com/vitalij23/DeepPavlov/commits/master</a>
</p>
<ul class="org-ul">
<li>JSON с комментами:
<ul class="org-ul">
<li>pip3.6 install jstyleson</li>
<li>deeppavlov\core\common\file.py   json -&gt;jstyleson</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org2396d42" class="outline-3">
<h3 id="org2396d42"><span class="section-number-3">41.5.</span> training</h3>
<div class="outline-text-3" id="text-41-5">
<ul class="org-ul">
<li>IOB format <a href="https://en.wikipedia.org/wiki/Inside%E2%80%93outside%E2%80%93beginning_(tagging)">https://en.wikipedia.org/wiki/Inside%E2%80%93outside%E2%80%93beginning_(tagging)</a></li>
<li><a href="https://lingpipe-blog.com/2009/10/14/coding-chunkers-as-taggers-io-bio-bmewo-and-bmewo/">https://lingpipe-blog.com/2009/10/14/coding-chunkers-as-taggers-io-bio-bmewo-and-bmewo/</a></li>
</ul>
<p>
we use BIO or IOB (Inside–outside–beginning) - It subdivides the in tags as either being begin-of-entity (B<sub>X</sub>)
or continuation-of-entity (I<sub>X</sub>).
</p>

<p>
dataset
</p>
<dl class="org-dl">
<dt>train</dt><dd>data for training the model;</dd>
<dt>validation</dt><dd>data for evaluation and hyperparameters tuning;</dd>
<dt>test</dt><dd>data for final evaluation of the model.</dd>
</dl>

<p>
Обучение состоит из 3 элементов dataset<sub>reader</sub>, dataset<sub>iterator</sub> and train. Или хотя бы двух dataset and train.
</p>

<p>
dataset<sub>reader</sub> - источник x и у
</p>

<p>
Прото-Классы dataset<sub>iterator</sub>:
</p>
<ul class="org-ul">
<li>Estimator - no early stopping, safely done  at the time of pipeline initialization. in both supervised and unsupervised settings
<ul class="org-ul">
<li>fit()</li>
</ul></li>
<li>NNModel  - Обучение с учителем (supervised learning);
<ul class="org-ul">
<li>in</li>
<li>in<sub>y</sub></li>
</ul></li>
</ul>

<p>
<b>Обучение:</b>
</p>
<ul class="org-ul">
<li>rm -r ~/.deeppavlov/models/ner<sub>rus</sub></li>
<li>cd deep</li>
<li>source ENV/bin/activate</li>
<li>python3.6 -m deeppavlov train ~/ner<sub>rus.json</sub></li>
</ul>
</div>

<div id="outline-container-org81821fc" class="outline-4">
<h4 id="org81821fc"><span class="section-number-4">41.5.1.</span> dataset<sub>iterators</sub></h4>
<div class="outline-text-4" id="text-41-5-1">
<p>
<a href="https://deeppavlov.readthedocs.io/en/0.1.6/apiref/dataset_iterators.html">https://deeppavlov.readthedocs.io/en/0.1.6/apiref/dataset_iterators.html</a>
</p>
</div>
</div>
</div>

<div id="outline-container-orgdccb721" class="outline-3">
<h3 id="orgdccb721"><span class="section-number-3">41.6.</span> NLP pipeline json config</h3>
<div class="outline-text-3" id="text-41-6">
<p>
<a href="https://deeppavlov.readthedocs.io/en/0.1.6/intro/config_description.html">https://deeppavlov.readthedocs.io/en/0.1.6/intro/config_description.html</a>
Используется core/common/registry.json
</p>

<ul class="org-ul">
<li>Если у компонента указать id с именем, то по этому имени можно не создавать, а сослаться на него: "ref":
"id<sub>name</sub>"</li>
</ul>
<p>
Four main sections:
</p>
<ul class="org-ul">
<li>dataset<sub>reader</sub></li>
<li>dataset<sub>iterator</sub></li>
<li>chainer - one required element
<ul class="org-ul">
<li>in</li>
<li>pipe
<ul class="org-ul">
<li>in</li>
<li>out</li>
</ul></li>
<li>out</li>
</ul></li>
<li>train</li>
</ul>

<p>
"metadata": {"variables" - определеяет пути "DOWNLOADS<sub>PATH</sub>" "MODELS<sub>PATH</sub>" и т.д.
</p>
</div>
<div id="outline-container-orgb010d0a" class="outline-4">
<h4 id="orgb010d0a"><span class="section-number-4">41.6.1.</span> configs</h4>
<div class="outline-text-4" id="text-41-6-1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">ner<sub>conll2003.json</sub></td>
<td class="org-left">glove</td>
</tr>

<tr>
<td class="org-left">ner<sub>conll2003</sub><sub>pos.json</sub></td>
<td class="org-left">glove</td>
</tr>

<tr>
<td class="org-left">ner<sub>dstc2.json</sub></td>
<td class="org-left">random<sub>emb</sub><sub>mat</sub></td>
</tr>

<tr>
<td class="org-left">ner<sub>few</sub><sub>shot</sub><sub>ru.json</sub></td>
<td class="org-left">elmo<sub>embedder</sub></td>
</tr>

<tr>
<td class="org-left">ner<sub>few</sub><sub>shot</sub><sub>ru</sub><sub>simulate.json</sub></td>
<td class="org-left">elmo<sub>embedder</sub></td>
</tr>

<tr>
<td class="org-left">ner<sub>ontonotes.json</sub></td>
<td class="org-left">glove</td>
</tr>

<tr>
<td class="org-left">ner<sub>rus.json</sub></td>
<td class="org-left">fasttext</td>
</tr>

<tr>
<td class="org-left">slotfill<sub>dstc2.json</sub></td>
<td class="org-left">nothing</td>
</tr>

<tr>
<td class="org-left">slotfill<sub>dstc2</sub><sub>raw.json</sub></td>
<td class="org-left">nothing</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-org6a59f12" class="outline-4">
<h4 id="org6a59f12"><span class="section-number-4">41.6.2.</span> parsing anal</h4>
<div class="outline-text-4" id="text-41-6-2">
<pre class="example">
from deeppavlov import configs
from deeppavlov.core.commands.utils import parse_config
config_dict = parse_config(configs.ner.ner_ontonotes)
print(config_dict['dataset_reader']['data_path'])
</pre>
</div>
</div>
<div id="outline-container-org05a90ab" class="outline-4">
<h4 id="org05a90ab"><span class="section-number-4">41.6.3.</span> json</h4>
<div class="outline-text-4" id="text-41-6-3">
<div class="org-src-container">
<pre class="src src-javascript">{
  <span style="color: #95e454;">"deeppavlov_root"</span>: <span style="color: #95e454;">"."</span>,
  <span style="color: #95e454;">"dataset_reader"</span>: { <span style="color: #fa8072;">//</span><span style="color: #99968b; font-style: italic;">deeppavlov\dataset_readers</span>
    <span style="color: #95e454;">"class_name"</span>: <span style="color: #95e454;">"conll2003_reader"</span>,  <span style="color: #fa8072;">//</span><span style="color: #99968b; font-style: italic;">conll2003_reader.py</span>
    <span style="color: #95e454;">"data_path"</span>: <span style="color: #95e454;">"{DOWNLOADS_PATH}/total_rus/"</span>, <span style="color: #fa8072;">//</span><span style="color: #99968b; font-style: italic;">&#1087;&#1072;&#1087;&#1082;&#1072; &#1086;&#1090;&#1082;&#1091;&#1076;&#1072; &#1073;&#1088;&#1072;&#1090;&#1100; train.txt, valid.txt, test.txt</span>
    <span style="color: #95e454;">"dataset_name"</span>: <span style="color: #95e454;">"collection_rus"</span>, <span style="color: #fa8072;">//</span><span style="color: #99968b; font-style: italic;">&#1077;&#1089;&#1083;&#1080; &#1087;&#1072;&#1087;&#1082;&#1072; &#1087;&#1091;&#1089;&#1090;&#1072;&#1103; &#1090;&#1086; &#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1077;&#1090;&#1089;&#1103; &#1089;&#1089;&#1099;&#1083;&#1082;&#1072; &#1074;&#1085;&#1091;&#1090;&#1088;&#1080; conll2003_reader.py</span>
    <span style="color: #95e454;">"provide_pos"</span>: <span style="color: #e5786d; font-weight: bold;">false</span> <span style="color: #fa8072;">//</span><span style="color: #99968b; font-style: italic;">pos tag?</span>
  },
  <span style="color: #95e454;">"dataset_iterator"</span>: { <span style="color: #fa8072;">//</span><span style="color: #99968b; font-style: italic;">deeppavlov\dataset_iterators</span>
    <span style="color: #fa8072;">//</span><span style="color: #99968b; font-style: italic;">For simple batching and shuffling</span>
    <span style="color: #95e454;">"class_name"</span>: <span style="color: #95e454;">"data_learning_iterator"</span>, <span style="color: #fa8072;">//</span><span style="color: #99968b; font-style: italic;">deeppavlov\core\data\data_learning_iterator.py</span>
    <span style="color: #95e454;">"shuffle"</span>: <span style="color: #e5786d; font-weight: bold;">true</span>, <span style="color: #fa8072;">//</span><span style="color: #99968b; font-style: italic;">&#1087;&#1086; &#1091;&#1084;&#1086;&#1083;&#1095;&#1072;&#1085;&#1080;&#1102; &#1087;&#1077;&#1088;&#1077;&#1084;&#1077;&#1096;&#1080;&#1074;&#1072;&#1077;&#1090; List[Tuple[Any, Any]]</span>
    <span style="color: #95e454;">"seed"</span>: 42 <span style="color: #fa8072;">//</span><span style="color: #99968b; font-style: italic;">seed for random shuffle</span>
  },
  <span style="color: #95e454;">"chainer"</span>: {  <span style="color: #fa8072;">//</span><span style="color: #99968b; font-style: italic;">list of components - core\common\chainer.py</span>
    <span style="color: #95e454;">"in"</span>: [<span style="color: #95e454;">"x"</span>], <span style="color: #fa8072;">//</span><span style="color: #99968b; font-style: italic;">names of inputs for pipeline inference mode</span>
    <span style="color: #95e454;">"in_y"</span>: [<span style="color: #95e454;">"y"</span>], <span style="color: #fa8072;">//</span><span style="color: #99968b; font-style: italic;">names of additional inputs for pipeline training and evaluation modes</span>
    <span style="color: #95e454;">"out"</span>: [<span style="color: #95e454;">"x_tokens"</span>, <span style="color: #95e454;">"tags"</span>], <span style="color: #fa8072;">//</span><span style="color: #99968b; font-style: italic;">names of pipeline inference outputs</span>
    <span style="color: #95e454;">"pipe"</span>: [  <span style="color: #fa8072;">//</span>
    {
      <span style="color: #95e454;">"class_name"</span>: <span style="color: #95e454;">"tokenizer"</span>,
      <span style="color: #95e454;">"in"</span>: <span style="color: #95e454;">"x"</span>, <span style="color: #fa8072;">//</span><span style="color: #99968b; font-style: italic;">in of chainer</span>
      <span style="color: #95e454;">"lemmas"</span>: <span style="color: #e5786d; font-weight: bold;">true</span>, <span style="color: #fa8072;">// </span><span style="color: #99968b; font-style: italic;">lemmatizer enabled</span>
      <span style="color: #95e454;">"out"</span>: <span style="color: #95e454;">"q_token_lemmas"</span>
    },
</pre>
</div>
</div>
</div>

<div id="outline-container-orga9bd58d" class="outline-4">
<h4 id="orga9bd58d"><span class="section-number-4">41.6.4.</span> examples</h4>
<div class="outline-text-4" id="text-41-6-4">
</div>
<ol class="org-ol">
<li><a id="org8724fe1"></a>tokenizer<br />
<div class="outline-text-5" id="text-41-6-4-1">
<p>
x::As a'd.234 4567
&gt;&gt; ['as', "a'd.234", '4567']
</p>
<div class="org-src-container">
<pre class="src src-javascript">{
  <span style="color: #95e454;">"chainer"</span>: {
    <span style="color: #95e454;">"in"</span>: [ <span style="color: #95e454;">"x"</span> ],
    <span style="color: #95e454;">"in_y"</span>: [ <span style="color: #95e454;">"y"</span> ],
    <span style="color: #95e454;">"pipe"</span>: [
      {
        <span style="color: #95e454;">"class_name"</span>: <span style="color: #95e454;">"str_lower"</span>,
        <span style="color: #95e454;">"id"</span>: <span style="color: #95e454;">"lower"</span>,
        <span style="color: #95e454;">"in"</span>: [ <span style="color: #95e454;">"x"</span> ],
        <span style="color: #95e454;">"out"</span>: [ <span style="color: #95e454;">"x_lower"</span> ]
      },
      {
        <span style="color: #95e454;">"in"</span>: [ <span style="color: #95e454;">"x_lower"</span> ],
        <span style="color: #95e454;">"class_name"</span>: <span style="color: #95e454;">"lazy_tokenizer"</span>,
        <span style="color: #95e454;">"out"</span>: [ <span style="color: #95e454;">"x_tokens"</span> ]
      },
      {
        <span style="color: #95e454;">"in"</span>: [ <span style="color: #95e454;">"x_tokens"</span> ],
        <span style="color: #95e454;">"class_name"</span>: <span style="color: #95e454;">"sanitizer"</span>,
        <span style="color: #95e454;">"nums"</span>: <span style="color: #e5786d; font-weight: bold;">false</span>,
        <span style="color: #95e454;">"out"</span>: [ <span style="color: #95e454;">"x_san"</span> ]
      }
    ],
    <span style="color: #95e454;">"out"</span>: [ <span style="color: #95e454;">"x_san"</span> ]
  }
}
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-org12fe569" class="outline-3">
<h3 id="org12fe569"><span class="section-number-3">41.7.</span> prerocessors</h3>
<div class="outline-text-3" id="text-41-7">
<ul class="org-ul">
<li>sanitizer - \models\preprocessors Remove all combining characters like diacritical marks from tokens deeppavlov\models\preprocessors\sanitizer.py
<ul class="org-ul">
<li>nums - Replace [0-9] - 1 и ниибет</li>
</ul></li>
<li>str<sub>lower</sub> - batch.lower()</li>
</ul>
</div>
<div id="outline-container-orgfd8e098" class="outline-4">
<h4 id="orgfd8e098"><span class="section-number-4">41.7.1.</span> tokenizers</h4>
<div class="outline-text-4" id="text-41-7-1">
<p>
deeppavlov\models\tokenizers
</p>
<ul class="org-ul">
<li>lazy<sub>tokenizer</sub> - english nltk word<sub>tokenize</sub> (нет параметров)</li>
<li>ru<sub>tokenizer</sub> - lowercase - съедает точку вместе со словом
<ul class="org-ul">
<li>stopwords - List[str]</li>
<li>ngram<sub>range</sub> - List[int] - size of ngrams to create; only unigrams are returned by default</li>
<li>lemmas - default=False - whether to perform lemmatizing or not</li>
</ul></li>
<li>nltk<sub>moses</sub><sub>tokenizer</sub> - MosesTokenizer().tokenize - как lazy<sub>tokenizer</sub>, если вход токены - то склеивает.
<ul class="org-ul">
<li>escape = False - если True заменяет | [] &lt; &gt; [ ] &amp; на '&amp;#124;', '&amp;#91;', '&amp;#93;', '&amp;lt;', '&amp;gt;', '&amp;#91;',</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org129a364" class="outline-4">
<h4 id="org129a364"><span class="section-number-4">41.7.2.</span> Embedder [ɪmˈbede] - Deep contextualized word reprezentation</h4>
<div class="outline-text-4" id="text-41-7-2">
<ul class="org-ul">
<li>"Words that occur in similar contexts tend to have similar meaning"</li>

<li>Consist of embedding matrices.</li>
<li>Converts every token to a vector of particular dimensionality</li>
<li>Vocabularies allow conversion from tokens to indices is needed to perform lookup in <b>embeddings matrices</b>
and compute cross-entropy between predicted probabilities and target values.</li>
<li>Для: (eg Cosine) similarity - as a measure of semantic simularity</li>
<li>unsupervised learning algorithm</li>
</ul>


<p>
Classes
</p>
<ul class="org-ul">
<li>glove<sub>emb</sub> - GloVe (Stanford) - by factorizing the logarithm of the corpus word co-occurrence matrix
<a href="https://github.com/maciejkula/glove-python">https://github.com/maciejkula/glove-python</a></li>
<li>ELMo - Embeddings from Language Models
<ul class="org-ul">
<li>whole sentences as context</li>
</ul></li>
<li>fastText - By default, we use 100 dimensions
<ul class="org-ul">
<li>skip-gram - learns to predict using a random close-by word - skipgram models works better with
subword information than cbow.
<ul class="org-ul">
<li>designed to predict the context</li>
<li>works well with small amount of the training data, represents well even rare words or phrases.</li>
<li>slow</li>
</ul></li>
<li>cbow - according to its context - uses the sum of their vectors to predict the target
<ul class="org-ul">
<li>learning to predict the word by the context. Or maximize the probability of the target word by looking
at the context</li>
<li>there is problem for rare words.</li>
<li>several times faster to train than the skip-gram, slightly better accuracy for the frequent words</li>
</ul></li>
</ul></li>
</ul>
</div>
<ol class="org-ol">
<li><a id="orgf7116c9"></a>GloVe (Stanford)<br />
<div class="outline-text-5" id="text-41-7-2-1">
<p>
Global Vectors for Word Representation
</p>
<ul class="org-ul">
<li><a href="https://en.wikipedia.org/wiki/GloVe_(machine_learning)">https://en.wikipedia.org/wiki/GloVe_(machine_learning)</a></li>
<li><a href="https://nlp.stanford.edu/projects/glove/">https://nlp.stanford.edu/projects/glove/</a></li>
<li>python <a href="https://pypi.org/project/glove/">https://pypi.org/project/glove/</a></li>
<li>python <a href="https://pypi.org/project/glovepy/">https://pypi.org/project/glovepy/</a></li>
<li>tutorial <a href="https://medium.com/@japneet121/word-vectorization-using-glove-76919685ee0b">https://medium.com/@japneet121/word-vectorization-using-glove-76919685ee0b</a></li>
</ul>
<p>
Goal: create a glove model
X  pip3 install <a href="https://github.com/JonathanRaiman/glove/archive/master.zip">https://github.com/JonathanRaiman/glove/archive/master.zip</a>
</p>
<ul class="org-ul">
<li>git clone <a href="https://github.com/umlkhuang/glovepy.git">https://github.com/umlkhuang/glovepy.git</a></li>
<li>cd glovepy</li>
<li>pip3.6 install numpy &#x2013;user</li>
<li>python3.6 setup.py install &#x2013;user</li>
</ul>

<p>
glovepy
</p>
<ul class="org-ul">
<li>corpus.py  - Cooccurrence matrix construction tools for fitting the GloVe model.</li>
<li>glovepy.py - Glove(object) - Glove model for obtaining dense embeddings from a co-occurence (sparse) matrix.</li>
</ul>
</div>
</li>
<li><a id="org48f3b53"></a>fastText skip-gram model<br />
<div class="outline-text-5" id="text-41-7-2-2">
<ul class="org-ul">
<li><a href="https://fasttext.cc/docs/en/unsupervised-tutorial.html">https://fasttext.cc/docs/en/unsupervised-tutorial.html</a></li>

<li>wget <a href="https://github.com/facebookresearch/fastText/archive/v0.2.0.zip">https://github.com/facebookresearch/fastText/archive/v0.2.0.zip</a></li>
<li>wget <a href="https://github.com/facebookresearch/fastText/archive/v0.1.0.zip">https://github.com/facebookresearch/fastText/archive/v0.1.0.zip</a></li>
<li>unzip v0.2.0.zip</li>
<li>make -j3</li>
<li>./fasttext skipgram -input README.md -output result/re</li>
</ul>

<p>
Without subwords: ./fasttext skipgram -input data/fil9 -output result/fil9-none -maxn 0 -ws 30 -dim 300
</p>


<p>
"class<sub>name</sub>": "fasttext", deeppavlov\models\embedders\fasttext<sub>embedder.py</sub>
</p>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-orgbf21d52" class="outline-3">
<h3 id="orgbf21d52"><span class="section-number-3">41.8.</span> components</h3>
<div class="outline-text-3" id="text-41-8">
<ul class="org-ul">
<li>simple<sub>vocab</sub> - For holding sets of tokens, tags, or characters - \core\data\simple<sub>vocab.py</sub>
<ul class="org-ul">
<li>id - the name of the vocabulary which will be used in other models</li>
<li>fit<sub>on</sub> - out у предыдущего</li>
<li>save<sub>path</sub> - path to a new file to save the vocabulary</li>
<li>load<sub>path</sub> - path to an existing vocabulary (ignored if there is no files)</li>
<li>pad<sub>with</sub><sub>zeros</sub>: whether to pad the resulting index array with zeros or not</li>
<li>out - indices</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-orgae8d7f4" class="outline-3">
<h3 id="orgae8d7f4"><span class="section-number-3">41.9.</span> Models</h3>
<div class="outline-text-3" id="text-41-9">
<ul class="org-ul">
<li>Rule-based Models cannot be trained.</li>
<li>Machine Learning Models can be trained only stand alone.</li>
<li>Deep Learning Models can be trained independently and in an end-to-end mode being joined in a chain.</li>
</ul>

<p>
У каждой модели своя архитектура - CNN у или LSTM+CRF
</p>
</div>
</div>
<div id="outline-container-orgb3aa955" class="outline-3">
<h3 id="orgb3aa955"><span class="section-number-3">41.10.</span> speelcheking</h3>
<div class="outline-text-3" id="text-41-10">
<ul class="org-ul">
<li><a href="http://docs.deeppavlov.ai/en/latest/components/spelling_correction.html">http://docs.deeppavlov.ai/en/latest/components/spelling_correction.html</a></li>
<li><a href="https://kheafield.com/code/kenlm/">https://kheafield.com/code/kenlm/</a></li>
</ul>


<p>
based on context with the help of a kenlm language model
</p>


<p>
две pipeline
</p>

<p>
<a href="https://github.com/deepmipt/DeepPavlov/blob/0.1.6/deeppavlov/configs/spelling_correction/levenshtein_corrector_ru.json">https://github.com/deepmipt/DeepPavlov/blob/0.1.6/deeppavlov/configs/spelling_correction/levenshtein_corrector_ru.json</a>
</p>
<ul class="org-ul">
<li>Damerau-Levenshtein distance to find correction candidates</li>
<li>Нет тренера
<ul class="org-ul">
<li>вход x разбитый на токены и в нижнем регистре</li>
<li>Файла:
<ol class="org-ol">
<li>russian<sub>words</sub><sub>vocab.dict</sub> - "слово 1" - без ё</li>
<li>ru<sub>wiyalen</sub><sub>no</sub><sub>punkt.arpa.binary</sub> -  kenlm language model?</li>
</ol></li>
<li>simple<sub>vocab</sub> &#x2014; слово\tчастота - файл 1)</li>
<li>главный deeppavlov.models.spelling<sub>correction.levenshtein.searcher</sub><sub>component</sub>:LevenshteinSearcherComponent
<ul class="org-ul">
<li>x<sub>tokens</sub> -&gt; tokens<sub>candidates</sub></li>
<li>words - vacabulary - файл 1)</li>
<li>max<sub>distance</sub> = 1</li>
<li>инициализирует LevenshteinSearcher по словарю - возвращает близкие слова и дистанцию до них</li>
<li>(0, word) - для пунктуаций</li>
<li>error<sub>probability</sub> = 1e-4 = 0.0001</li>
<li>выдает мама: [(-4,'мара'),(-8,'мама')]</li>
</ul></li>
<li>deeppavlov.models.spelling<sub>correction.electors.kenlm</sub><sub>elector</sub>:KenlmElector  spelling<sub>correction\electors\kenlm</sub><sub>elector.py</sub>
<ul class="org-ul">
<li>2)</li>
<li>выбирает лучший вариант с учетом 2) файла, даже с маньшим фактором от Levenshtein</li>
</ul></li>
</ul></li>
</ul>
<p>
<a href="https://github.com/deepmipt/DeepPavlov/blob/0.1.6/deeppavlov/configs/spelling_correction/brillmoore_kartaslov_ru.json">https://github.com/deepmipt/DeepPavlov/blob/0.1.6/deeppavlov/configs/spelling_correction/brillmoore_kartaslov_ru.json</a>
</p>
<ul class="org-ul">
<li>statistic error model</li>
<li>"dataset<sub>iterator</sub>": deeppavlov\dataset<sub>iterators\typos</sub><sub>iterator.py</sub> наследник DataLearningIterator</li>
<li>"dataset<sub>reader</sub>" :
<ul class="org-ul">
<li>typos<sub>kartaslov</sub><sub>reader</sub> - typos<sub>reader.py</sub> - бумажка;бумаша;0.5</li>
<li><a href="https://raw.githubusercontent.com/dkulagin/kartaslov/master/dataset/orfo_and_typos/orfo_and_typos.L1_5.csv">https://raw.githubusercontent.com/dkulagin/kartaslov/master/dataset/orfo_and_typos/orfo_and_typos.L1_5.csv</a></li>
</ul></li>
<li>Есть тренер
<ul class="org-ul">
<li>вход x, у  - разбиваются на токены и в нижнем регистре</li>
<li>Файла:
<ol class="org-ol">
<li>error<sub>model.tar.gz</sub>/error<sub>model</sub><sub>ru.tsv</sub></li>
<li>{DOWNLOADS<sub>PATH</sub>}/vocabs</li>
<li>ru<sub>wiyalen</sub><sub>no</sub><sub>punkt.arpa.binary</sub> -  kenlm language model?</li>
</ol></li>
<li>главный <b>spelling<sub>error</sub><sub>model</sub></b> наследник Estimator  1) - deeppavlov.models.spelling<sub>correction.brillmoore.error</sub><sub>model</sub>:ErrorModel
<ul class="org-ul">
<li>"fit<sub>on</sub>" - x, y</li>
<li>in - x</li>
<li>out - tokens<sub>candidates</sub></li>
<li>error<sub>model</sub><sub>ru.tsv</sub> "лицо ло	0.060606060606060615"</li>
<li>dictionary: class <b>russian<sub>words</sub><sub>vocab</sub></b> DeepPavlov\deeppavlov\vocabs\typos.py - Tie tree
<ul class="org-ul">
<li>2)</li>
<li></li>
</ul></li>
</ul></li>
<li>deeppavlov.models.spelling<sub>correction.electors.kenlm</sub><sub>elector</sub>:KenlmElector
<ul class="org-ul">
<li>3)</li>
</ul></li>
</ul></li>
</ul>


<p>
Первый spelling<sub>error</sub><sub>model</sub>
</p>
</div>

<div id="outline-container-org97cb03a" class="outline-4">
<h4 id="org97cb03a"><span class="section-number-4">41.10.1.</span> Tie vocabulary</h4>
<div class="outline-text-4" id="text-41-10-1">
<p>
Префиксное дерево - по буквам разные слова в дереве.
<a href="https://ru.wikipedia.org/wiki/%D0%9F%D1%80%D0%B5%D1%84%D0%B8%D0%BA%D1%81%D0%BD%D0%BE%D0%B5_%D0%B4%D0%B5%D1%80%D0%B5%D0%B2%D0%BE">https://ru.wikipedia.org/wiki/%D0%9F%D1%80%D0%B5%D1%84%D0%B8%D0%BA%D1%81%D0%BD%D0%BE%D0%B5_%D0%B4%D0%B5%D1%80%D0%B5%D0%B2%D0%BE</a>
</p>
</div>
</div>
</div>

<div id="outline-container-org00209dd" class="outline-3">
<h3 id="org00209dd"><span class="section-number-3">41.11.</span> Classification</h3>
<div class="outline-text-3" id="text-41-11">
<ol class="org-ol">
<li>keras<sub>classification</sub><sub>model</sub> - neural network on Keras with tensorflow - deeppavlov.models.classifiers.KerasClassificationModel
<ul class="org-ul">
<li>cnn<sub>model</sub> – Shallow-and-wide CNN with max pooling after convolution,</li>
<li>dcnn<sub>model</sub> – Deep CNN with number of layers determined by the given number of kernel sizes and filters,</li>
<li>cnn<sub>model</sub><sub>max</sub><sub>and</sub><sub>aver</sub><sub>pool</sub> – Shallow-and-wide CNN with max and average pooling concatenation after convolution,</li>
<li>bilstm<sub>model</sub> – Bidirectional LSTM,</li>
<li>bilstm<sub>bilstm</sub><sub>model</sub> – 2-layers bidirectional LSTM,</li>
<li>bilstm<sub>cnn</sub><sub>model</sub> – Bidirectional LSTM followed by shallow-and-wide CNN,</li>
<li>cnn<sub>bilstm</sub><sub>model</sub> – Shallow-and-wide CNN followed by bidirectional LSTM,</li>
<li>bilstm<sub>self</sub><sub>add</sub><sub>attention</sub><sub>model</sub> – Bidirectional LSTM followed by self additive attention layer,</li>
<li>bilstm<sub>self</sub><sub>mult</sub><sub>attention</sub><sub>model</sub> – Bidirectional LSTM followed by self multiplicative attention layer,</li>
<li>bigru<sub>model</sub> – Bidirectional GRU model.</li>
</ul></li>
</ol>

<p>
Please, pay attention that each model has its own parameters that should be specified in config.
</p>
<ol class="org-ol">
<li>sklearn<sub>component</sub> - sklearn classifiers - deeppavlov.models.sklearn.SklearnComponent</li>
</ol>

<p>
configs/classifiers:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">JSON</th>
<th scope="col" class="org-left">Frame</th>
<th scope="col" class="org-left">Embedder</th>
<th scope="col" class="org-left">Dataset</th>
<th scope="col" class="org-left">Lang</th>
<th scope="col" class="org-left">model</th>
<th scope="col" class="org-left">comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">insults<sub>kaggle.json</sub></td>
<td class="org-left">keras</td>
<td class="org-left">fasttext</td>
<td class="org-left">basic</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">insults<sub>kaggle</sub><sub>bert.json</sub></td>
<td class="org-left">bert<sub>classifier</sub></td>
<td class="org-left">?</td>
<td class="org-left">basic</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">new 0.2.0</td>
</tr>

<tr>
<td class="org-left">intents<sub>dstc2.json</sub></td>
<td class="org-left">keras</td>
<td class="org-left">fasttext</td>
<td class="org-left">dstc2</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">intents<sub>dstc2</sub><sub>bert.json</sub></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">intents<sub>dstc2</sub><sub>big.json</sub></td>
<td class="org-left">keras</td>
<td class="org-left">fasttext</td>
<td class="org-left">dstc2</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">intents<sub>sample</sub><sub>csv.json</sub></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">intents<sub>sample</sub><sub>json.json</sub></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">intents<sub>snips.json</sub></td>
<td class="org-left">keras</td>
<td class="org-left">fasttext</td>
<td class="org-left">SNIPS</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">cnn<sub>model</sub></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">intents<sub>snips</sub><sub>big.json</sub></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">intents<sub>snips</sub><sub>sklearn.json</sub></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">intents<sub>snips</sub><sub>tfidf</sub><sub>weighted.json</sub></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">paraphraser<sub>bert.json</sub></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">rusentiment<sub>bert.json</sub></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">basic</td>
<td class="org-left">ru</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">rusentiment<sub>cnn.json</sub></td>
<td class="org-left">keras</td>
<td class="org-left">fasttext</td>
<td class="org-left">basic</td>
<td class="org-left">ru</td>
<td class="org-left">cnn<sub>model</sub></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">rusentiment<sub>elmo.json</sub></td>
<td class="org-left">keras</td>
<td class="org-left">elmo</td>
<td class="org-left">basic</td>
<td class="org-left">ru</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">sentiment<sub>twitter.json</sub></td>
<td class="org-left">keras</td>
<td class="org-left">fasttext</td>
<td class="org-left">basic</td>
<td class="org-left">ru</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">sentiment<sub>twitter</sub><sub>preproc.json</sub></td>
<td class="org-left">keras</td>
<td class="org-left">fasttext</td>
<td class="org-left">basic</td>
<td class="org-left">ru</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">topic<sub>ag</sub><sub>news.json</sub></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">yahoo<sub>convers</sub><sub>vs</sub><sub>info.json</sub></td>
<td class="org-left">keras</td>
<td class="org-left">elmo</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">en</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">no reader and iterator</td>
</tr>
</tbody>
</table>

<p>
one<sub>hotter</sub> - in(y)out(y) - given batch of list of labels to one-hot representation
</p>
</div>
<div id="outline-container-org7b4e589" class="outline-4">
<h4 id="org7b4e589"><span class="section-number-4">41.11.1.</span> bert</h4>
<div class="outline-text-4" id="text-41-11-1">
<ul class="org-ul">
<li><a href="https://github.com/google-research/bert">https://github.com/google-research/bert</a></li>
</ul>
<p>
Bidirectional Encoder Representations from Transformers, is a new method of pre-training language
representations which obtains state-of-the-art results on a wide array of Natural Language Processing (NLP)
tasks.
</p>

<p>
Pre-trained representations:
</p>
<ul class="org-ul">
<li>context-free - word2vec or GloVe</li>
<li>contextual -  based on the other words in the sentence
<ul class="org-ul">
<li>unidirectional</li>
<li>bidirectional</li>
</ul></li>
</ul>

<p>
json:
</p>
<ul class="org-ul">
<li>bert<sub>preprocessor</sub> in(x)</li>
<li>one<sub>hotter</sub> in(y)</li>
<li>bert<sub>classifier</sub> x y</li>
<li>proba2labels - probas to id</li>
<li>classes<sub>vocab</sub> - id to labels</li>
</ul>
</div>
</div>
<div id="outline-container-org3aabb9e" class="outline-4">
<h4 id="org3aabb9e"><span class="section-number-4">41.11.2.</span> iterators</h4>
<div class="outline-text-4" id="text-41-11-2">
<ul class="org-ul">
<li>basic<sub>classification</sub><sub>iterator</sub> - for basic<sub>classification</sub><sub>reader</sub>
<ul class="org-ul">
<li>Формат csv text,label\n word1,</li>
</ul></li>
<li>dstc2<sub>intents</sub><sub>iterator</sub> - dstc2<sub>reader</sub> - <a href="http://camdial.org/~mh521/dstc/downloads/handbook.pdf">http://camdial.org/~mh521/dstc/downloads/handbook.pdf</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgc46b6ab" class="outline-3">
<h3 id="orgc46b6ab"><span class="section-number-3">41.12.</span> NER - componen</h3>
<div class="outline-text-3" id="text-41-12">
<ul class="org-ul">
<li><a href="https://docs.deeppavlov.ai/en/master/features/models/NER.html">https://docs.deeppavlov.ai/en/master/features/models/NER.html</a></li>
<li><a href="https://docs.deeppavlov.ai/en/0.2.0/components/ner.html">https://docs.deeppavlov.ai/en/0.2.0/components/ner.html</a></li>
<li><a href="https://github.com/deeppavlov/DeepPavlov/blob/master/docs/intro/python.ipynb">https://github.com/deeppavlov/DeepPavlov/blob/master/docs/intro/python.ipynb</a></li>
</ul>


<p>
<b>conll2003<sub>reader</sub></b> dataset<sub>reader</sub> - BIO
</p>
<ul class="org-ul">
<li>"data<sub>path</sub>": - three files, namely: “train.txt”, “valid.txt”, and “test.txt”</li>
</ul>

<p>
Models:
</p>
<ul class="org-ul">
<li>"ner": "deeppavlov.models.ner.network:NerNetwork",</li>
<li>"ner<sub>bio</sub><sub>converter</sub>": "deeppavlov.models.ner.bio:BIOMarkupRestorer",</li>
<li>"ner<sub>few</sub><sub>shot</sub><sub>iterator</sub>": "deeppavlov.dataset<sub>iterators.ner</sub><sub>few</sub><sub>shot</sub><sub>iterator</sub>:NERFewShotIterator",</li>
<li>"ner<sub>svm</sub>": "deeppavlov.models.ner.svm:SVMTagger",</li>
</ul>

<p>
preprocess
</p>
<ul class="org-ul">
<li>ХЗ random<sub>emb</sub><sub>mat</sub> deeppavlov.models.preprocessors.random<sub>embeddings</sub><sub>matrix</sub>:RandomEmbeddingsMatrix</li>
<li>"mask": "deeppavlov.models.preprocessors.mask:Mask"</li>
</ul>

<p>
<b>deeppavlov.models.ner.network</b> - когда ответ после всех или для каждого
</p>
<ul class="org-ul">
<li>use<sub>cudnn</sub><sub>rnn</sub> - true TF layouts build on - NVIDIA CUDA® Deep Neural Network library (cuDNN) is a GPU-accelerated library of
primitives for deep neural networks.</li>
<li>net<sub>type</sub> - rnn</li>
<li>cell<sub>type</sub> - lstm</li>
</ul>

<p>
"in": ["x<sub>emb</sub>", "mask", "x<sub>char</sub><sub>ind</sub>", "cap"],
</p>
<ul class="org-ul">
<li>x<sub>emb</sub> - token of fastText</li>
</ul>
</div>
<div id="outline-container-orgb06423c" class="outline-4">
<h4 id="orgb06423c"><span class="section-number-4">41.12.1.</span> ner<sub>rus</sub><sub>bert</sub></h4>
<div class="outline-text-4" id="text-41-12-1">
<p>
config <a href="https://github.com/deeppavlov/DeepPavlov/blob/master/deeppavlov/configs/ner/ner_rus_bert.json">https://github.com/deeppavlov/DeepPavlov/blob/master/deeppavlov/configs/ner/ner_rus_bert.json</a>
</p>

<p>
'torch<sub>transformers</sub><sub>ner</sub><sub>preprocessor</sub>'
</p>

<p>
install:
</p>
<div class="org-src-container">
<pre class="src src-python">python -m deeppavlov install ner_rus_bert
python
<span style="color: #8ac6f2; font-weight: bold;">from</span> deeppavlov <span style="color: #8ac6f2; font-weight: bold;">import</span> build_model
<span style="color: #cae682;">ner_model</span> = build_model(<span style="color: #95e454;">'ner_rus_bert'</span>, download=<span style="color: #e5786d; font-weight: bold;">True</span>)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org96d3d86" class="outline-3">
<h3 id="org96d3d86"><span class="section-number-3">41.13.</span> Custom component</h3>
<div class="outline-text-3" id="text-41-13">
<ul class="org-ul">
<li>\deeppavlov\core\common\registry.json</li>
</ul>
</div>
</div>

<div id="outline-container-org2336e59" class="outline-3">
<h3 id="org2336e59"><span class="section-number-3">41.14.</span> docker</h3>
<div class="outline-text-3" id="text-41-14">
<p>
<a href="https://hub.docker.com/r/deeppavlov/base-cpu/tags">https://hub.docker.com/r/deeppavlov/base-cpu/tags</a>
</p>

<p>
Dockerfile: <a href="https://hub.docker.com/r/deeppavlov/base-cpu/tags">https://hub.docker.com/r/deeppavlov/base-cpu/tags</a>
</p>
<pre class="example">
docker build -t p .
python -m deeppavlov install ner_rus_bert
python
from deeppavlov import build_model
ner_model = build_model('ner_rus_bert', download=True)
</pre>


<p>
FROM deeppavlov/base-cpu
</p>

<p>
docker build -t pavl .
</p>
</div>
</div>
<div id="outline-container-orgf437714" class="outline-3">
<h3 id="orgf437714"><span class="section-number-3">41.15.</span> issues</h3>
<div class="outline-text-3" id="text-41-15">
<p>
No module named 'bert<sub>dp</sub>'
</p>
<pre class="example">
python -m deeppavlov install ner_rus_bert # model name
</pre>
</div>
</div>
</div>

<div id="outline-container-orgee62bee" class="outline-2">
<h2 id="orgee62bee"><span class="section-number-2">42.</span> AllenNLP</h2>
<div class="outline-text-2" id="text-42">
<ul class="org-ul">
<li><a href="https://allennlp.org">https://allennlp.org</a></li>
<li><a href="https://pytorch.org/get-started/previous-versions/">https://pytorch.org/get-started/previous-versions/</a></li>
<li>conda install pytorch=0.4.1 -c pytorch</li>
<li>pip install allennlp</li>
</ul>
</div>
</div>

<div id="outline-container-org49350a0" class="outline-2">
<h2 id="org49350a0"><span class="section-number-2">43.</span> spaCy</h2>
<div class="outline-text-2" id="text-43">
<p>
spaCy - convolutional neural network (CNN(  <a href="https://en.wikipedia.org/wiki/SpaCy">https://en.wikipedia.org/wiki/SpaCy</a>
</p>
<ul class="org-ul">
<li><a href="https://en.wikipedia.org/wiki/Convolutional_neural_network">https://en.wikipedia.org/wiki/Convolutional_neural_network</a></li>
<li><a href="https://github.com/explosion/spaCy">https://github.com/explosion/spaCy</a></li>
<li>архитектура pipeline</li>
</ul>
</div>
</div>

<div id="outline-container-org0d843cb" class="outline-2">
<h2 id="org0d843cb"><span class="section-number-2">44.</span> fastText</h2>
<div class="outline-text-2" id="text-44">
<ul class="org-ul">
<li><a href="https://fasttext.cc/docs/en/options.html">https://fasttext.cc/docs/en/options.html</a></li>
</ul>
<p>
By default, we use 100 dimensions
</p>
<ul class="org-ul">
<li>skip-gram - learns to predict using a random close-by word - skipgram models works better with
subword information than cbow.
<ul class="org-ul">
<li>designed to predict the context</li>
<li>works well with small amount of the training data, represents well even rare words or phrases.</li>
<li>slow</li>
<li>better for rare slow</li>
</ul></li>
<li>cbow - according to its context - uses the sum of their vectors to predict the target
<ul class="org-ul">
<li>learning to predict the word by the context. Or maximize the probability of the target word by looking
at the context</li>
<li>there is problem for rare words.</li>
<li>several times faster to train than the skip-gram, slightly better accuracy for the frequent words</li>
</ul></li>
</ul>

<p>
./fasttext skipgram -input data/fil9 -output result/fil9 -minn 2 -maxn 5 -dim 300
</p>
<ul class="org-ul">
<li>dim dimensions - default 100</li>
<li>-minn 2 -maxn 5 - substrings contained in a <b>word</b> between the minimum size (minn) and the maximal size</li>
<li>-ws                 size of the context window [5]</li>
</ul>
<p>
-epoch              number of epochs [5]
</p>

<p>
result
</p>
<ul class="org-ul">
<li><b>bin</b> stores the whole fastText model and can be subsequently loaded</li>
<li><b>vec</b> contains the word vectors, one per line for each word in the vocabulary. The first line is a header
containing the number of words and the dimensionality of the vectors.</li>
</ul>

<p>
Проверка:
</p>
<ul class="org-ul">
<li>./fasttext nn result/fil9.bin</li>
<li>./fasttext analogies result/fil9.bin</li>
</ul>
</div>
<div id="outline-container-org61fa01d" class="outline-3">
<h3 id="org61fa01d"><span class="section-number-3">44.1.</span> install</h3>
<div class="outline-text-3" id="text-44-1">
<ul class="org-ul">
<li>wget <a href="https://github.com/facebookresearch/fastText/archive/v0.1.0.zip">https://github.com/facebookresearch/fastText/archive/v0.1.0.zip</a></li>
<li>unzip v0.2.0.zip</li>
<li>make -j3</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org308a406" class="outline-2">
<h2 id="org308a406"><span class="section-number-2">45.</span> <span class="todo TODO">TODO</span> rusvectores</h2>
<div class="outline-text-2" id="text-45">
<ul class="org-ul">
<li><a href="https://rusvectores.org/en/about/">https://rusvectores.org/en/about/</a></li>
<li><a href="https://github.com/akutuzov/webvectors">https://github.com/akutuzov/webvectors</a></li>
<li><a href="https://github.com/akutuzov/webvectors/blob/master/preprocessing/rusvectores_tutorial.ipynb">https://github.com/akutuzov/webvectors/blob/master/preprocessing/rusvectores_tutorial.ipynb</a></li>
</ul>
</div>
</div>

<div id="outline-container-org12dbb04" class="outline-2">
<h2 id="org12dbb04"><span class="section-number-2">46.</span> Natural Language Toolkit (NLTK)</h2>
<div class="outline-text-2" id="text-46">
<ul class="org-ul">
<li><a href="http://www.nltk.org/">http://www.nltk.org/</a></li>
<li>API <a href="http://www.nltk.org/genindex.html">http://www.nltk.org/genindex.html</a></li>
<li>nltk.download('averaged<sub>perceptron</sub><sub>tagger</sub><sub>ru</sub>') - russian. The NLTK corpus and module downloader.
<ul class="org-ul">
<li>Корпус corpus - набор слов  <a href="http://www.nltk.org/howto/corpus.html">http://www.nltk.org/howto/corpus.html</a>
<ul class="org-ul">
<li>nltk.corpus.abc.words() - примерн окакие слова там C:\Users\Chepilev<sub>VS\AppData\Roaming\nltk</sub><sub>data</sub></li>
<li>for w in nltk.corpus.genesis.words('english-web.txt'): print(w) - все слова</li>
<li>Plaintext Corpora</li>
<li>Tagged Corpora - ex.  part-of-speech tags -  (word,tag) tuples</li>
</ul></li>
<li>Tagger</li>
<li>&gt;&gt;&gt; nltk.download('book') -   &gt;&gt;&gt; from nltk.book import *   - &gt;&gt;&gt; text1</li>
</ul></li>
</ul>



<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">corpus</td>
<td class="org-left">standardized interfaces to corpora and lexicons</td>
</tr>

<tr>
<td class="org-left">String processing</td>
<td class="org-left">tokenize, stem</td>
<td class="org-left">tokenizers, sentence tokenizers, stemmers</td>
</tr>

<tr>
<td class="org-left">Collocation discovery</td>
<td class="org-left">collocations</td>
<td class="org-left">t-test, chi-squared, point-wise mutual information</td>
</tr>

<tr>
<td class="org-left">Part-of-speech tagging</td>
<td class="org-left">tag</td>
<td class="org-left">n-gram, backoff, Brill, HMM, TnT</td>
</tr>

<tr>
<td class="org-left">Machine learning</td>
<td class="org-left">classify, cluster, tbl</td>
<td class="org-left">decision tree, maximum entropy, naive Bayes, EM, k-means</td>
</tr>

<tr>
<td class="org-left">Chunking</td>
<td class="org-left">chunk</td>
<td class="org-left">regular expression, n-gram, named-entity</td>
</tr>

<tr>
<td class="org-left">Parsing</td>
<td class="org-left">parse, ccg</td>
<td class="org-left">chart, feature-based, unification, probabilistic, dependency</td>
</tr>
</tbody>
</table>
</div>

<div id="outline-container-orgc3001fa" class="outline-3">
<h3 id="orgc3001fa"><span class="section-number-3">46.1.</span> collocations</h3>
<div class="outline-text-3" id="text-46-1">
<ul class="org-ul">
<li><a href="http://www.nltk.org/howto/collocations.html">http://www.nltk.org/howto/collocations.html</a></li>
<li><a href="http://www.nltk.org/api/nltk.html">http://www.nltk.org/api/nltk.html</a></li>
<li>Finders -</li>
<li>Filtering candidates</li>
<li>Association measures</li>
</ul>

<p>
nltk.collocations.BigramCollocationFinder
</p>
<ul class="org-ul">
<li>from<sub>words</sub>([sequence of words], bigram<sub>fdm</sub>, window<sub>size</sub>=2)=&gt;finder - '.', ',',':' - разделяет</li>
<li></li>
</ul>

<p>
AbstractCollocationFinder
</p>
<ul class="org-ul">
<li>nbest(funct, n)=&gt;[] top n ngrams when scored by the given function</li>
<li>finder.apply<sub>freq</sub><sub>filter</sub>(min<sub>freq</sub>) - the minimum number of occurrencies of bigrams to take into
consideration</li>
<li>finder.apply<sub>word</sub><sub>filter</sub>(lambda w: w <code>= '.' or w =</code> ',') - Removes candidate ngrams (w1, w2, &#x2026;) where any
of (fn(w1), fn(w2), &#x2026;) evaluates to True.</li>
</ul>
</div>
</div>

<div id="outline-container-org447c637" class="outline-3">
<h3 id="org447c637"><span class="section-number-3">46.2.</span> Association measures for collocations (measure functions)</h3>
<div class="outline-text-3" id="text-46-2">
<dl class="org-dl">
<dt>bigram<sub>measures.student</sub><sub>t</sub></dt><dd>Student's t</dd>
<dt>bigram<sub>measures.chi</sub><sub>sq</sub></dt><dd>Chi-square</dd>
<dt>bigram<sub>measures.likelihood</sub><sub>ratio</sub></dt><dd>Likelihood ratios</dd>
<dt>bigram<sub>measures.pmi</sub> Pointwise Mutual Information</dt><dd>bigram<sub>measures.pmi</sub></dd>
<dt>raw<sub>freq</sub></dt><dd>Scores ngrams by their frequency</dd>
<dt>(no term)</dt><dd>::</dd>

<dt>(no term)</dt><dd>w2 (w2w1)  (o w1) = n<sub>xi</sub></dd>
<dt>(no term)</dt><dd>~w2 (w2 o)</dd>
<dt>(no term)</dt><dd>= n<sub>ix</sub>   TOTAL = n<sub>xx</sub></dd>
</dl>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">(n_ii, (n_ix, n_xi), n_xx):</span>
&gt;&gt;&gt; <span style="color: #8ac6f2; font-weight: bold;">import</span> nltk
&gt;&gt;&gt; <span style="color: #8ac6f2; font-weight: bold;">from</span> nltk.collocations <span style="color: #8ac6f2; font-weight: bold;">import</span> *
&gt;&gt;&gt; <span style="color: #cae682;">bigram_measures</span> = nltk.collocations.BigramAssocMeasures()
&gt;&gt;&gt;<span style="color: #e5786d;">print</span>(<span style="color: #95e454;">'%0.4f'</span> % bigram_measures.student_t(1, (2, 2), 4))
0
&gt;&gt;&gt; <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">'%0.4f'</span> % bigram_measures.student_t(1, (2, 2), 8))
0.5000

</pre>
</div>
</div>
</div>



<div id="outline-container-org5b65f9f" class="outline-3">
<h3 id="org5b65f9f"><span class="section-number-3">46.3.</span> Taggers</h3>
<div class="outline-text-3" id="text-46-3">
<ul class="org-ul">
<li>averaged<sub>perceptron</sub><sub>tagger</sub><sub>ru</sub> <a href="http://www.nltk.org/nltk_data/">http://www.nltk.org/nltk_data/</a></li>
<li>example <a href="http://www.nltk.org/_modules/nltk/tag">http://www.nltk.org/_modules/nltk/tag</a></li>
<li>API <a href="http://www.nltk.org/api/nltk.tag.html">http://www.nltk.org/api/nltk.tag.html</a></li>
</ul>
</div>
</div>

<div id="outline-container-org0d3c2df" class="outline-3">
<h3 id="org0d3c2df"><span class="section-number-3">46.4.</span> Корпус русского языка</h3>
<div class="outline-text-3" id="text-46-4">
<ul class="org-ul">
<li><a href="http://www.nltk.org/nltk_data/">http://www.nltk.org/nltk_data/</a></li>
<li><a href="https://github.com/nltk/nltk/wiki/Adding-a-Corpus">https://github.com/nltk/nltk/wiki/Adding-a-Corpus</a></li>
<li><a href="http://www.ruscorpora.ru/index.html">http://www.ruscorpora.ru/index.html</a></li>
<li>Значение тэгов <a href="http://www.ruscorpora.ru/en/corpora-morph.html">http://www.ruscorpora.ru/en/corpora-morph.html</a></li>
</ul>

<p>
Почему-то не показывает падежи
</p>
</div>
</div>
</div>

<div id="outline-container-org21dab13" class="outline-2">
<h2 id="org21dab13"><span class="section-number-2">47.</span> pymorphy2</h2>
<div class="outline-text-2" id="text-47">
<p>
<a href="https://pymorphy2.readthedocs.io/en/latest/user/grammemes.html">https://pymorphy2.readthedocs.io/en/latest/user/grammemes.html</a>
</p>
<ul class="org-ul">
<li>grammeme - Грамме́ма - один из элементов грамматической категории - граммемы:
tag=OpencorporaTag('NOUN,inan,masc plur,nomn')</li>
<li>используется словарь <a href="http://opencorpora.org/">http://opencorpora.org/</a></li>
<li>для незнакомых слов строятся гипотезы</li>
<li>полностью поддерживается буква ё</li>
<li>Лицензия - MIT</li>
</ul>
</div>
</div>

<div id="outline-container-org46ba16e" class="outline-2">
<h2 id="org46ba16e"><span class="section-number-2">48.</span> linux NLP</h2>
<div class="outline-text-2" id="text-48">
</div>
<div id="outline-container-org72e835d" class="outline-3">
<h3 id="org72e835d"><span class="section-number-3">48.1.</span> count max words in line of file</h3>
<div class="outline-text-3" id="text-48-1">
<pre class="example">
MAX=0; file="/path";
while read -r line; do if [[ $(echo $line | wc -w ) -gt $MAX ]]; then MAX=$(echo $line | wc -w ); fi; done &lt; "$file"
</pre>
</div>
</div>
</div>
<div id="outline-container-org8ca070b" class="outline-2">
<h2 id="org8ca070b"><span class="section-number-2">49.</span> fuzzysearch</h2>
<div class="outline-text-2" id="text-49">
<p>
pip install &#x2013;force-reinstall &#x2013;no-cache-dir &#x2013;no-binary=:all: &#x2013;require-hashes &#x2013;user -r file.txt
</p>
<div class="org-src-container">
<pre class="src src-text">fuzzysearch==0.7.3 --hash=sha256:d5a1b114ceee50a5e181b2fe1ac1b4371ac8db92142770a48fed49ecbc37ca4c
attrs==22.2.0 --hash=sha256:c9227bfc2f01993c03f68db37d1d15c9690188323c067c641f1a35ca58185f99
</pre>
</div>
</div>
<div id="outline-container-org97dc66a" class="outline-3">
<h3 id="org97dc66a"><span class="section-number-3">49.1.</span> typesense</h3>
<div class="outline-text-3" id="text-49-1">
</div>
<div id="outline-container-orgcbb93a8" class="outline-4">
<h4 id="orgcbb93a8"><span class="section-number-4">49.1.1.</span> pip3 install typesense &#x2013;user</h4>
<div class="outline-text-4" id="text-49-1-1">
<p>
<i>usr/lib/python3/dist-packages/secretstorage/dhcrypto.py:15: CryptographyDeprecationWarning: int<sub>from</sub><sub>bytes</sub> is deprecated, use int.from<sub>bytes</sub> instead
  from cryptography.utils import int<sub>from</sub><sub>bytes</sub>
/usr/lib/python3/dist-packages/secretstorage/util.py:19: CryptographyDeprecationWarning: int<sub>from</sub><sub>bytes</sub> is deprecated, use int.from<sub>bytes</sub> instead
  from cryptography.utils import int<sub>from</sub><sub>bytes</sub>
Collecting typesense
  Downloading typesense-0.15.0-py2.py3-none-any.whl (30 kB)
Requirement already satisfied: requests in .</i>.local/lib/python3.8/site-packages (from typesense) (2.28.1)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in ./.local/lib/python3.8/site-packages (from requests-&gt;typesense) (3.4)
Requirement already satisfied: certifi&gt;=2017.4.17 in ./.local/lib/python3.8/site-packages (from requests-&gt;typesense) (2022.12.7)
Requirement already satisfied: urllib3&lt;1.27,&gt;=1.21.1 in ./.local/lib/python3.8/site-packages (from requests-&gt;typesense) (1.26.13)
Requirement already satisfied: charset-normalizer&lt;3,&gt;=2 in ./.local/lib/python3.8/site-packages (from requests-&gt;typesense) (2.1.1)
Installing collected packages: typesense
Successfully installed typesense-0.15.0
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org9846b0d" class="outline-2">
<h2 id="org9846b0d"><span class="section-number-2">50.</span> Audio - librosa</h2>
<div class="outline-text-2" id="text-50">
<p>
librosa uses <b>soundfile</b> and <b>audioread</b> for reading audio.
</p>
</div>
<div id="outline-container-org2462db7" class="outline-3">
<h3 id="org2462db7"><span class="section-number-3">50.1.</span> generic audio characteristics</h3>
<div class="outline-text-3" id="text-50-1">
<ul class="org-ul">
<li>Channels: number of channels; 1 for mono, 2 for stereo audio</li>
<li>Sample width: number of bytes per sample; 1 means 8-bit, 2 means 16-bit</li>
<li>Frame rate/Sample rate: frequency of samples used (in Hertz)</li>
<li>Frame width or Bit depth: Number of bytes for each “frame”. One frame contains a sample for each channel.</li>
<li>Length: audio file length (in milliseconds)</li>
<li>Frame count: the number of frames from the sample</li>
<li>Intensity: loudness in dBFS (dB relative to the maximum possible loudness)</li>
</ul>
</div>
</div>
<div id="outline-container-orga241b9e" class="outline-3">
<h3 id="orga241b9e"><span class="section-number-3">50.2.</span> load</h3>
<div class="outline-text-3" id="text-50-2">
<p>
default: librosa.core.load(path, sr=22050, mono=True, offset=0.0, duration=None, dtype=&lt;class 'numpy.float32'&gt;, res<sub>type</sub>='kaiser<sub>best</sub>')
</p>
<ul class="org-ul">
<li>sr is the sampling rate (To preserve the native sampling rate of the file, use sr=None.)</li>
<li>mono is the option (true/ false) to convert it into mono file.</li>
<li>offset is a floating point number which is the starting time to read the file</li>
<li>duration is a floating point number which signifies how much of the file to load.</li>
<li>dtype is the numeric representation of data can be float32, float16, int8 and others.</li>
<li>res<sub>type</sub> is the type of resampling (one option is kaiser<sub>best</sub>)</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> librosa
y: np.array
<span style="color: #cae682;">y</span>, <span style="color: #cae682;">sample_rate</span> = librosa.load(filename, sr=<span style="color: #e5786d; font-weight: bold;">None</span>) <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">sampling rate as `sr` , y - time series</span>
<span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"sample rate of original file:"</span>, sample_rate)
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">-- Duration</span>
<span style="color: #e5786d;">print</span>(librosa.get_duration(y))
<span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"duration in seconds"</span>, <span style="color: #e5786d;">len</span>(y)/sample_rate)


<span style="color: #8ac6f2; font-weight: bold;">from</span> IPython.display <span style="color: #8ac6f2; font-weight: bold;">import</span> Audio
Audio(data=data1,rate=sample_rate) <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">play audio</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">--- for WAV files:</span>
<span style="color: #8ac6f2; font-weight: bold;">import</span> soundfile <span style="color: #8ac6f2; font-weight: bold;">as</span> sf
<span style="color: #cae682;">ob</span> = sf.SoundFile(<span style="color: #95e454;">'example.wav'</span>)
<span style="color: #e5786d;">print</span>(<span style="color: #95e454;">'Sample rate: {}'</span>.<span style="color: #e5786d;">format</span>(ob.samplerate))
<span style="color: #e5786d;">print</span>(<span style="color: #95e454;">'Channels: {}'</span>.<span style="color: #e5786d;">format</span>(ob.channels))
<span style="color: #e5786d;">print</span>(<span style="color: #95e454;">'Subtype: {}'</span>.<span style="color: #e5786d;">format</span>(ob.subtype))

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">--- mp3</span>
<span style="color: #8ac6f2; font-weight: bold;">import</span> audioread
<span style="color: #8ac6f2; font-weight: bold;">with</span> audioread.audio_open(filename) <span style="color: #8ac6f2; font-weight: bold;">as</span> f:
    <span style="color: #e5786d;">print</span>(f.channels, f.samplerate, f.duration)

</pre>
</div>
</div>
</div>

<div id="outline-container-orgffdd803" class="outline-3">
<h3 id="orgffdd803"><span class="section-number-3">50.3.</span> the Fourier transform - spectrum</h3>
<div class="outline-text-3" id="text-50-3">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> numpy <span style="color: #8ac6f2; font-weight: bold;">as</span> np
<span style="color: #8ac6f2; font-weight: bold;">import</span> librosa
<span style="color: #8ac6f2; font-weight: bold;">import</span> matplotlib.pyplot <span style="color: #8ac6f2; font-weight: bold;">as</span> plt

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">filepath = '/home/u2/h4/PycharmProjects/whisper/1670162239-2022-12-04-16_57.mp3'</span>
<span style="color: #cae682;">filepath</span> = <span style="color: #95e454;">'/mnt/hit4/hit4user/gitlabprojects/captcha_fssp/app/929014e341a0457f5a90a909b0a51c40.wav'</span>

<span style="color: #cae682;">y</span>, <span style="color: #cae682;">sr</span> = librosa.load(filepath)
librosa.fft_frequencies()
<span style="color: #cae682;">n_fft</span> = 2048
<span style="color: #cae682;">ft</span> = np.<span style="color: #e5786d;">abs</span>(librosa.stft(y[:n_fft], hop_length=n_fft + 1))

plt.plot(ft)
plt.title(<span style="color: #95e454;">'Spectrum'</span>)
plt.xlabel(<span style="color: #95e454;">'Frequency Bin'</span>)
plt.ylabel(<span style="color: #95e454;">'Amplitude'</span>)
plt.show()

</pre>
</div>
</div>
</div>
<div id="outline-container-org9c5d462" class="outline-3">
<h3 id="org9c5d462"><span class="section-number-3">50.4.</span> spectrogram</h3>
<div class="outline-text-3" id="text-50-4">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> numpy <span style="color: #8ac6f2; font-weight: bold;">as</span> np
<span style="color: #8ac6f2; font-weight: bold;">import</span> librosa
<span style="color: #8ac6f2; font-weight: bold;">import</span> matplotlib.pyplot <span style="color: #8ac6f2; font-weight: bold;">as</span> plt

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">filepath = '/home/u2/h4/PycharmProjects/whisper/1670162239-2022-12-04-16_57.mp3'</span>
<span style="color: #cae682;">filepath</span> = <span style="color: #95e454;">'/mnt/hit4/hit4user/gitlabprojects/captcha_fssp/app/929014e341a0457f5a90a909b0a51c40.wav'</span>

<span style="color: #cae682;">y</span>, <span style="color: #cae682;">sr</span> = librosa.load(filepath)

<span style="color: #cae682;">spec</span> = np.<span style="color: #e5786d;">abs</span>(librosa.stft(y, hop_length=512))
<span style="color: #cae682;">spec</span> = librosa.amplitude_to_db(spec, ref=np.<span style="color: #e5786d;">max</span>)
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">fig, ax = plt.figure()</span>
plt.imshow(spec, origin=<span style="color: #95e454;">"lower"</span>, cmap=plt.get_cmap(<span style="color: #95e454;">"magma"</span>))

plt.colorbar(<span style="color: #e5786d;">format</span>=<span style="color: #95e454;">'%+2.0f dB'</span>)
plt.title(<span style="color: #95e454;">'Spectrogram'</span>)
plt.show()
</pre>
</div>
</div>
</div>
<div id="outline-container-orgff4957b" class="outline-3">
<h3 id="orgff4957b"><span class="section-number-3">50.5.</span> log-Mel spectrogram</h3>
<div class="outline-text-3" id="text-50-5">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> numpy <span style="color: #8ac6f2; font-weight: bold;">as</span> np
<span style="color: #8ac6f2; font-weight: bold;">import</span> librosa
<span style="color: #8ac6f2; font-weight: bold;">import</span> matplotlib.pyplot <span style="color: #8ac6f2; font-weight: bold;">as</span> plt

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">filepath = '/home/u2/h4/PycharmProjects/whisper/1670162239-2022-12-04-16_57.mp3'</span>
<span style="color: #cae682;">filepath</span> = <span style="color: #95e454;">'/mnt/hit4/hit4user/gitlabprojects/captcha_fssp/app/929014e341a0457f5a90a909b0a51c40.wav'</span>

<span style="color: #cae682;">y</span>, <span style="color: #cae682;">sr</span> = librosa.load(filepath)

<span style="color: #cae682;">hop_length</span> = 512
<span style="color: #cae682;">n_mels</span> = 128 <span style="color: #fa8072;">#  </span><span style="color: #99968b; font-style: italic;">linear transformation matrix to project FFT bins</span>
<span style="color: #cae682;">n_fft</span> = 2048 <span style="color: #fa8072;">#  </span><span style="color: #99968b; font-style: italic;">samples, corresponds to a physical duration of 93 milliseconds at a sample rate of 22050 Hz</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">one line mel spectrogram</span>
<span style="color: #cae682;">S</span> = librosa.feature.melspectrogram(y, sr=sr, n_fft=n_fft, hop_length=hop_length, n_mels=n_mels)
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">3 lines mel spectrogram</span>
<span style="color: #cae682;">fft_windows</span> = librosa.stft(y, n_fft=n_fft, hop_length=hop_length)
<span style="color: #cae682;">magnitude</span> = np.<span style="color: #e5786d;">abs</span>(fft_windows)**2
<span style="color: #cae682;">mel</span> = librosa.filters.mel(sr=sr, n_fft=n_fft, n_mels=n_mels)
<span style="color: #cae682;">S2</span> = mel.dot(magnitude)
<span style="color: #8ac6f2; font-weight: bold;">assert</span> (S2 == S).<span style="color: #e5786d;">all</span>()

<span style="color: #cae682;">S</span> = np.log10(S) <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Log</span>

<span style="color: #cae682;">mel_spect</span> = librosa.power_to_db(S, ref=np.<span style="color: #e5786d;">max</span>)
plt.imshow(mel_spect, origin=<span style="color: #95e454;">"lower"</span>, cmap=plt.get_cmap(<span style="color: #95e454;">"magma"</span>))

plt.colorbar(<span style="color: #e5786d;">format</span>=<span style="color: #95e454;">'%+2.0f dB'</span>)
plt.title(<span style="color: #95e454;">'Mel Spectrogram'</span>)
plt.show()
</pre>
</div>
</div>
</div>

<div id="outline-container-org2e84433" class="outline-3">
<h3 id="org2e84433"><span class="section-number-3">50.6.</span> distinguish emotions</h3>
<div class="outline-text-3" id="text-50-6">
<pre class="example">
male = librosa.feature.mfcc(y=X, sr=sample_rate, n_mfcc=13)
male = np.mean(librosa.feature.mfcc(y=X, sr=sample_rate, n_mfcc=13), axis=0)
</pre>
</div>
</div>
<div id="outline-container-orga5dfc09" class="outline-3">
<h3 id="orga5dfc09"><span class="section-number-3">50.7.</span> links</h3>
<div class="outline-text-3" id="text-50-7">
<ul class="org-ul">
<li><a href="https://community-app.topcoder.com/thrive/articles/audio-data-analysis-using-python">https://community-app.topcoder.com/thrive/articles/audio-data-analysis-using-python</a></li>
<li><a href="https://iq.opengenus.org/introduction-to-librosa/">https://iq.opengenus.org/introduction-to-librosa/</a></li>
<li><a href="https://librosa.org/doc/latest/index.html">https://librosa.org/doc/latest/index.html</a></li>
<li>split on silence <a href="https://medium.com/@vvk.victory/audio-processing-librosa-split-on-silence-8e1edab07bbb">https://medium.com/@vvk.victory/audio-processing-librosa-split-on-silence-8e1edab07bbb</a></li>
<li>distinguish emotions <a href="https://www.kaggle.com/code/krishnachary/speech-emotion-recognition-with-librosa">https://www.kaggle.com/code/krishnachary/speech-emotion-recognition-with-librosa</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org6c661cf" class="outline-2">
<h2 id="org6c661cf"><span class="section-number-2">51.</span> Audio</h2>
<div class="outline-text-2" id="text-51">
</div>
<div id="outline-container-org2ecfe02" class="outline-3">
<h3 id="org2ecfe02"><span class="section-number-3">51.1.</span> terms</h3>
<div class="outline-text-3" id="text-51-1">
<ul class="org-ul">
<li>down-mixing -  The process of combining multiple audio output channels into a single stereo or mono output</li>
<li>resampling - change sample rate, - samplese per seconds</li>
</ul>
</div>
</div>
<div id="outline-container-orge79a464" class="outline-3">
<h3 id="orge79a464"><span class="section-number-3">51.2.</span> theory</h3>
<div class="outline-text-3" id="text-51-2">
<ul class="org-ul">
<li>waveform - wave or oscilates curve with amplitude</li>
<li>frequency - occurrences of vibrations per unit of time</li>
<li>sampling frequency or sampling rate - average number of samples obtained in one second. or hertz e.g. 48 kHz
is 48,000 samples per second. 44.1kHz, or 44,100 samples per second</li>
<li>Bit depth - typically recorded at 8-, 16-, and 24-bit depth,
<ul class="org-ul">
<li>mp3 does not have bit depth - compressed format</li>
<li>wav - uncompressed</li>
</ul></li>
<li>quality 44.1kHz / 16-bit  - CD, 192kHz/24-bit - hires audio</li>
<li>bit rate - bits per second required for encoding without compression</li>
</ul>

<p>
Calc bit rate and size:
</p>
<ul class="org-ul">
<li>44.1kHz/16-bit: 44,100 x 16 x 2 = 1,411,200 bits per second (1.4Mbps)</li>
<li>44.1kHz/16-bit: 1.4Mbps * 300s = 420Mb (52.5MB)</li>
</ul>

<p>
All wave forms
</p>
<ul class="org-ul">
<li>periodic
<ul class="org-ul">
<li>simple</li>
<li>comples</li>
</ul></li>
<li>aperiodic
<ul class="org-ul">
<li>noise</li>
<li>pulse</li>
</ul></li>
</ul>



<ul class="org-ul">
<li>amplitude - distance from max and min</li>
<li>wavelength -  total distance covered by a particle in one time period</li>
<li>Phase - location of the wave from an equilibrium point as time t=0</li>
<li></li>
</ul>


<p>
features
</p>
<ul class="org-ul">
<li>loudness - brain intensity</li>
<li>pitch - brain frequency</li>
<li>quality or Timbre - brain ?</li>
<li>intensity</li>
<li>amplitude phase</li>
<li>angular velocity</li>
</ul>
</div>
</div>

<div id="outline-container-org0273cb1" class="outline-3">
<h3 id="org0273cb1"><span class="section-number-3">51.3.</span> The Fourier Transform (spectrum)</h3>
<div class="outline-text-3" id="text-51-3">
<p>
mathematical formula - converts the signal from the time domain into the frequency domain.
</p>
<ul class="org-ul">
<li>result - *spectrum</li>
<li>Fourier’s theorem - signal can be decomposed into a set of sine and cosine waves</li>
<li>fast Fourier transform (FFT) is an algorithm that can efficiently compute the Fourier transform</li>
<li>Short-time Fourier transform - signal in the time-frequency domain by computing discrete Fourier transforms
(DFT) over short overlapping windows. for non periodic signals - such as music and speech</li>
</ul>
</div>
</div>


<div id="outline-container-org893e4d5" class="outline-3">
<h3 id="org893e4d5"><span class="section-number-3">51.4.</span> log-Mel spectrogram</h3>
<div class="outline-text-3" id="text-51-4">
<p>
spectrogram - the horizontal axis represents time, the vertical axis represents frequency, and the color intensity
represents the amplitude of a frequency at a certain point.
</p>
<ul class="org-ul">
<li>y - Decibels</li>
<li>used to train convolutional neural networks for the classification</li>
</ul>

<p>
Mel-spectrogram converts the frequencies to the mel-scale is “a perceptual scale of pitches judged by
listeners to be equal in distance from one another”
</p>
<ul class="org-ul">
<li>y - just Hz 0,64,128,256,512,1024</li>
<li>It uses the Mel Scale instead of Frequency on the y-axis.</li>
<li>It uses the Decibel Scale instead of Amplitude to indicate colors.</li>
<li>x - time sequence</li>
<li>value - mel shaped dB</li>
</ul>

<p>
Mel scale (after the word melody) - frequency(Hz) to mels(mel) conversion by formula
</p>
<ul class="org-ul">
<li>the pair at 100Hz and 200Hz will sound further apart than the pair at 1000Hz and 1100Hz.</li>
<li>you will hardly be able to distinguish between the pair at 10000Hz and 10100Hz.</li>
</ul>

<p>
Decibel Scale - *2
</p>
<ul class="org-ul">
<li>10 dB is 10 times louder than 0 dB</li>
<li>20 dB is 100 times louder than 10 dB</li>
</ul>

<p>
steps:
</p>
<ol class="org-ol">
<li>Separate to windows: Sample the input with windows of size n<sub>fft</sub>=2048, making hops of size hop<sub>length</sub>=512
each time to sample the next window.</li>
<li>Compute FFT (Fast Fourier Transform) for each window to transform from time domain to frequency domain.</li>
<li>Generate a Mel scale: Take the entire frequency spectrum, and separate it into n<sub>mels</sub>=128 evenly spaced
frequencies.</li>
<li>Generate Spectrogram: For each window, decompose the magnitude of the signal into its components,
corresponding to the frequencies in the mel scale.</li>
</ol>
</div>
<div id="outline-container-orgd32c658" class="outline-4">
<h4 id="orgd32c658"><span class="section-number-4">51.4.1.</span> Log - because</h4>
<div class="outline-text-4" id="text-51-4-1">
<ul class="org-ul">
<li>np.log10(S) after mel spectrogram</li>
<li>or because Mel Scale has log in formule</li>
</ul>
<div class="org-src-container">
<pre class="src src-c"> <span style="color: #92a65e; font-weight: bold;">func</span> <span style="color: #cae682; font-weight: bold;">frequencyToMel</span>(_ <span style="color: #92a65e; font-weight: bold;">frequency</span>: Float) -&gt; Float {
        <span style="color: #8ac6f2; font-weight: bold;">return</span> 2595 * log10(1 + (frequency / 700))
    }


    <span style="color: #92a65e; font-weight: bold;">func</span> <span style="color: #cae682; font-weight: bold;">melToFrequency</span>(_ <span style="color: #92a65e; font-weight: bold;">mel</span>: Float) -&gt; Float {
        <span style="color: #8ac6f2; font-weight: bold;">return</span> 700 * (pow(10, mel / 2595) - 1)
    }
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org7969870" class="outline-3">
<h3 id="org7969870"><span class="section-number-3">51.5.</span> pyo</h3>
<div class="outline-text-3" id="text-51-5">
<ul class="org-ul">
<li><a href="http://ajaxsoundstudio.com/software/pyo/">http://ajaxsoundstudio.com/software/pyo/</a></li>
</ul>
<p>
libsndfile-dev
</p>
</div>
</div>
<div id="outline-container-org8f10e92" class="outline-3">
<h3 id="org8f10e92"><span class="section-number-3">51.6.</span> torchaudio</h3>
</div>

<div id="outline-container-orgbd74279" class="outline-3">
<h3 id="orgbd74279"><span class="section-number-3">51.7.</span> ffmpeg-python</h3>
<div class="outline-text-3" id="text-51-7">
<ul class="org-ul">
<li>doc <a href="https://kkroening.github.io/ffmpeg-python/">https://kkroening.github.io/ffmpeg-python/</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org5e2c465" class="outline-2">
<h2 id="org5e2c465"><span class="section-number-2">52.</span> Whisper</h2>
<div class="outline-text-2" id="text-52">
<ul class="org-ul">
<li>a Transformer based encoder-decoder model, also referred to as a sequence-to-sequence model</li>
<li>Input audio is split into 30-second chunks, converted into a log-Mel spectrogram, and then passed into an encoder</li>
<li>automatic speech recognition (ASR)</li>
<li>Whisper is pre-trained on a vast quantity of labelled audio-transcription data, 680,000 hours to be precise</li>
<li>117,000 hours of this pre-training data is multilingual ASR data</li>
<li>supervised task of speech recognition</li>
<li>uses
<ul class="org-ul">
<li>GPT2TokenizerFast <a href="https://github.com/huggingface/transformers/blob/main/src/transformers/models/gpt2/tokenization_gpt2_fast.py">https://github.com/huggingface/transformers/blob/main/src/transformers/models/gpt2/tokenization_gpt2_fast.py</a>
<ul class="org-ul">
<li>byte-level    Byte-Pair-Encoding</li>
<li>"gpt2" and "multilingual"</li>
</ul></li>
</ul></li>
</ul>

<p>
logits - all 51865 tokes probability
</p>

<p>
Steps:
</p>
<ol class="org-ol">
<li>model.transcribe</li>
<li>model.decode</li>
<li>DecodingTask.run()</li>
<li>self.<sub>main</sub><sub>loop</sub></li>
</ol>
</div>


<div id="outline-container-orgfb6f6dc" class="outline-3">
<h3 id="orgfb6f6dc"><span class="section-number-3">52.1.</span> Byte-Pair Encoding (BPE)</h3>
<div class="outline-text-3" id="text-52-1">
<p>
Tokenization algorithms can be
</p>
<ul class="org-ul">
<li>word</li>
<li>subword - used by most state-of-the-art NLP models - frequently used words should not be split into smaller subwords</li>
<li>character-based</li>
</ul>

<p>
Subword-based tokenization:
</p>
<ul class="org-ul">
<li>splits the rare words into smaller meaningful subwords</li>
<li>WordPiece, Byte-Pair Encoding (BPE)(used in GPT-2), Unigram, and SentencePiece</li>
<li><a href="https://huggingface.co/docs/transformers/tokenizer_summary">https://huggingface.co/docs/transformers/tokenizer_summary</a></li>
<li><a href="https://arxiv.org/abs/1508.07909">https://arxiv.org/abs/1508.07909</a></li>
</ul>
</div>
<div id="outline-container-org1c6425c" class="outline-4">
<h4 id="org1c6425c"><span class="section-number-4">52.1.1.</span> usage</h4>
<div class="outline-text-4" id="text-52-1-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">from</span> transformers <span style="color: #8ac6f2; font-weight: bold;">import</span> GPT2TokenizerFast
<span style="color: #cae682;">path</span> = <span style="color: #95e454;">'/home/u2/.local/lib/python3.8/site-packages/whisper/assets/multilingual'</span>

<span style="color: #cae682;">tokenizer</span> = GPT2TokenizerFast.from_pretrained(path)

<span style="color: #cae682;">tokens</span> = [[50364, 3450, 5505, 13, 50464, 51014, 9149, 11, 6035, 5345, 7520, 1595, 6885, 1725, 30162, 13, 51114, 51414, 21249, 7520, 9916, 13, 51464]]
<span style="color: #e5786d;">print</span>([tokenizer.decode(t).strip() <span style="color: #8ac6f2; font-weight: bold;">for</span> t <span style="color: #8ac6f2; font-weight: bold;">in</span> tokens])
<span style="color: #e5786d;">print</span>(tokenizer.encode(<span style="color: #95e454;">'&#1040; &#1074;&#1086;&#1090;. &#1044;&#1072;, &#1085;&#1086; &#1086;&#1085; &#1091;&#1078;&#1077; &#1091; &#1084;&#1077;&#1085;&#1103; &#1085;&#1077; &#1088;&#1072;&#1073;&#1086;&#1090;&#1072;&#1077;&#1090;. &#1053;&#1077;&#1090; &#1091;&#1078;&#1077; &#1085;&#1077;&#1090;.'</span>))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgd55715f" class="outline-3">
<h3 id="orgd55715f"><span class="section-number-3">52.2.</span> model.transcribe(filepath or numpy)</h3>
<div class="outline-text-3" id="text-52-2">
<ul class="org-ul">
<li>mel = log<sub>mel</sub><sub>spectrogram</sub>(audio) # split audio by chunks (84)
<ul class="org-ul">
<li>whisper.audio.load<sub>audio</sub>(filepath)</li>
</ul></li>
<li>if no language set - it will use 30 seconds to detect language first</li>
<li>loop seek&lt;length
<ul class="org-ul">
<li>get 3000 frames - 30 seconds</li>
<li>decode segment - DecodingResult=DecodingTask(model, options).run(mel) decoding.py (701) see <a href="#org458b2be">52.3</a></li>
<li>if no speech then skip</li>
<li>split segment to consequtives</li>
</ul></li>
<li>tokenize and segment</li>
<li>summarize</li>
</ul>

<pre class="example">

</pre>

<ul class="org-ul">
<li>segments - think a chunk of speech based you obtain from the timestamps. Something like 10:00s -&gt; 13.52s would be a segment</li>
</ul>
</div>

<div id="outline-container-org5705d3c" class="outline-4">
<h4 id="org5705d3c"><span class="section-number-4">52.2.1.</span> return</h4>
<div class="outline-text-4" id="text-52-2-1">
<ul class="org-ul">
<li>text - full text</li>
<li>segments
<ul class="org-ul">
<li>seek</li>
<li>start&amp;end</li>
<li>text - segment text</li>
<li>'tokens': []</li>
<li>'temperature': 0.0,</li>
<li>'avg<sub>logprob</sub>': -0.7076873779296875, # if &lt; -1 - too low probability, retranscribe with another temperature</li>
<li>'compression<sub>ratio</sub>': 1.1604938271604939,</li>
<li>'no<sub>speech</sub><sub>prob</sub>': 0.5063244700431824 - если больше 0.6, то не возвращаем сегмент</li>
</ul></li>
<li>'language': 'ru'</li>
</ul>


<p>
{'text': 'long text', 'segments': [{'id': 0, 'seek': 0, 'start': 0.0, 'end': 2.64, 'text': ' А вот, не добрый
день.', 'tokens': [], 'temperature': 0.0,
'avg<sub>logprob</sub>': -0.7076873779296875, 'compression<sub>ratio</sub>': 1.1604938271604939, 'no<sub>speech</sub><sub>prob</sub>':
0.5063244700431824},
 {'id': 1, 'seek': 0, 'start': 2.64, 'end': 4.64, 'text': ' Меня зовут Дмитрий, это
Русснорбанг.', 'tokens': [], 'temperature': 0.0,
'avg<sub>logprob</sub>': -0.7076873779296875, 'compression<sub>ratio</sub>': 1.1604938271604939, 'no<sub>speech</sub><sub>prob</sub>':
0.5063244700431824},
 {'id': 2, 'seek': 0, 'start': 4.64, 'end': 8.040000000000001, 'text': ' Дайте, он
разжонили по поводу Мехеэлы Романовича Гапуэк,', 'tokens': [], 'temperature': 0.0, 'avg<sub>logprob</sub>': -0.7076873779296875, 'compression<sub>ratio</sub>':
1.1604938271604939, 'no<sub>speech</sub><sub>prob</sub>': 0.5063244700431824},
</p>

<p>
{'id': 62, 'seek': 13828, 'start': 150.28, 'end': 151.28, 'text': ' Если&#x2026;', 'tokens': [], 'temperature': 0.0, 'avg<sub>logprob</sub>': -0.3628227009492762,
'compression<sub>ratio</sub>': 1.0274509803921568, 'no<sub>speech</sub><sub>prob</sub>': 1.6432641132269055e-05}, {'id': 63, 'seek': 13828,
'start': 151.28, 'end': 154.28, 'text': ' Если как-то пежись, хорошо, накрыли.', 'tokens': [], 'temperature': 0.0, 'avg<sub>logprob</sub>': -0.3628227009492762,
'compression<sub>ratio</sub>': 1.0274509803921568, 'no<sub>speech</sub><sub>prob</sub>': 1.6432641132269055e-05}, {'id': 64, 'seek': 15428,
'start': 154.28, 'end': 183.28, 'text': ' Ну, да, всего доброго, до сих пор.', 'tokens': [50364, 7571, 11,
8995, 11, 15520, 35620, 2350, 11, 5865, 776, 4165, 11948, 13, 51814], 'temperature': 0.0, 'avg<sub>logprob</sub>':
-0.9855107069015503, 'compression<sub>ratio</sub>': 0.576271186440678, 'no<sub>speech</sub><sub>prob</sub>': 6.223811215022579e-05}],
'language': 'ru'}
</p>
</div>
</div>
</div>

<div id="outline-container-orge5be1a4" class="outline-3">
<h3 id="orge5be1a4"><span class="section-number-3">52.3.</span> model.decode(mel, options) <a id="org458b2be"></a></h3>
<div class="outline-text-3" id="text-52-3">
<p>
options: language
</p>

<p>
DecodingTask(model, options).run(mel)
</p>
<ul class="org-ul">
<li>create GPT2TokenizerFast wrapped</li>
<li>audio<sub>features</sub> &lt;- mel</li>
<li>tokens, sum<sub>logprobs</sub>, no<sub>speech</sub><sub>probs</sub> &lt;- audio<sub>features</sub></li>
<li>texts: List[str] = [tokenizer.decode(t).strip() for t in tokens]
<ul class="org-ul">
<li>tokens = [ [50364, 3450, 5505, 13, 50464, 51014, 9149, 11, 6035, 5345, 7520, 1595, 6885, 1725, 30162, 13, 51114, 51414, 21249, 7520, 9916, 13, 51464] ]</li>
</ul></li>
<li>&lt;- fine tune</li>
</ul>

<p>
<a href="https://huggingface.co/blog/fine-tune-whisper">https://huggingface.co/blog/fine-tune-whisper</a>
<a href="https://colab.research.google.com/drive/1P4ClLkPmfsaKn2tBbRp0nVjGMRKR-EWz">https://colab.research.google.com/drive/1P4ClLkPmfsaKn2tBbRp0nVjGMRKR-EWz</a>
</p>
</div>
</div>
<div id="outline-container-org23b68b1" class="outline-3">
<h3 id="org23b68b1"><span class="section-number-3">52.4.</span> no<sub>speech</sub><sub>prob</sub> and avg<sub>logprob</sub></h3>
<div class="outline-text-3" id="text-52-4">
<ul class="org-ul">
<li>no<sub>speech</sub><sub>prob</sub> - calc at the first toke only and at SOT logit</li>
<li>avg<sub>logprob</sub>
<ul class="org-ul">
<li>sum<sub>logprobs</sub> - sum of:
<ul class="org-ul">
<li>current<sub>logprobs</sub> - logprobs = F.log<sub>softmax</sub>(logits.float(), dim=-1)</li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-orgdc0e7c0" class="outline-3">
<h3 id="orgdc0e7c0"><span class="section-number-3">52.5.</span> decode from whisper<sub>word</sub><sub>level</sub> 844</h3>
<div class="outline-text-3" id="text-52-5">
<p>
decode<sub>word</sub><sub>level</sub> 781
</p>
<ul class="org-ul">
<li>result, ts = decode.run() 711   - decoding.py 612</li>
<li>finalize 524    - decoding.py 271</li>
</ul>


<p>
self.ts
</p>
<ul class="org-ul">
<li>self.decoder.update<sub>with</sub><sub>ts</sub> 700 (main<sub>loop</sub>) - decoding.py 602</li>
<li></li>
</ul>
</div>
</div>
<div id="outline-container-orgd601a16" class="outline-3">
<h3 id="orgd601a16"><span class="section-number-3">52.6.</span> main<sub>loop</sub></h3>
<div class="outline-text-3" id="text-52-6">
<p>
receive
</p>
<ul class="org-ul">
<li>audio<sub>features</sub></li>
<li>tokens with 3 values</li>
</ul>


<p>
tokes: int +=1
complete: bool = False
sum<sub>logprobs</sub>: int
</p>
</div>
</div>
<div id="outline-container-orgd8fd969" class="outline-3">
<h3 id="orgd8fd969"><span class="section-number-3">52.7.</span> words timestemps <a href="https://github.com/jianfch/stable-ts">https://github.com/jianfch/stable-ts</a></h3>
<div class="outline-text-3" id="text-52-7">
<p>
timestamp<sub>logits</sub> - ts<sub>logits</sub> - self.ts -
</p>
</div>
<div id="outline-container-org3271445" class="outline-4">
<h4 id="org3271445"><span class="section-number-4">52.7.1.</span> transcribe format</h4>
<div class="outline-text-4" id="text-52-7-1">
<ul class="org-ul">
<li></li>

<li>segments:</li>
</ul>
<p>
[{'id': 0, 'seek': 0, 'offset': 0.0, 'start': 1.0, 'end': 3.0, 'text': ' А вот, не добрый день.',
  'tokens': [50414, 3450, 5505, 11, 1725, 35620, 4851, 13509, 13, 50514, 50514, 47311, 46376, 3401, 919, 1635, 50161, 11, 2691, 6325, 7071, 461, 1234, 481, 1552, 1416, 1906, 13, 50564, 50564, 3401, 10330, 11, 5345, 4203, 1820, 1784, 5435, 2801, 10499, 35749, 50150, 386, 2338, 6325, 1253, 11114, 3903, 386, 7247, 4219, 23412, 3605, 13, 50714, 50714, 3200, 585, 37408, 585, 11, 2143, 10655, 30162, 1006, 17724, 15028, 4558, 13, 50814, 50814, 2348, 1069, 755, 12886, 387, 29868, 11, 776, 31158, 50233, 19411, 23201, 860, 1283, 25190, 13, 51014, 51014, 9149, 11, 6035, 5345, 7520, 1595, 6885, 1725, 30162, 13, 51064, 51064, 3450, 5505, 5865, 10751, 29117, 21235, 13640, 11, 2143, 5345, 1595, 10655, 2801, 7247, 9223, 24665, 30162, 13, 51314, 51314, 6684, 1725, 13790, 13549, 10986, 11, 6035, 8995, 11, 6035, 4777, 1725, 485, 51414, 51414, 21249, 7520, 9916, 13, 51464, 51464, 4857, 37975, 11, 25969, 5878, 11, 3014, 50150, 386, 2338, 6325, 1253, 11114, 3903, 1595, 6519, 3348, 35968, 23412, 34005, 47573, 51664, 51664, 10969, 45309, 13388, 19465, 5332, 4396, 20392, 44356, 740, 1069, 755, 1234, 1814, 13254, 11, 51814, 51814],
  'temperature': 0.0, 'avg<sub>logprob</sub>': -0.5410955043438354, 'compression<sub>ratio</sub>': 1.1496259351620948, 'no<sub>speech</sub><sub>prob</sub>': 0.5069490671157837,
  'alt<sub>start</sub><sub>timestamps</sub>': [1.0, 0.9199999570846558, 1.0399999618530273, 0.9599999785423279, 1.100000023841858, 0.9399999976158142, 0.9799999594688416, 1.0799999237060547, 1.1200000047683716, 1.1999999284744263],
  'start<sub>ts</sub><sub>logits</sub>': [13.0390625, 12.4140625, 12.296875, 12.2109375, 12.171875, 12.140625, 12.0390625, 11.9921875, 11.9453125, 11.8046875],
  'alt<sub>end</sub><sub>timestamps</sub>': [3.0, 2.0, 2.859999895095825, 2.879999876022339, 2.8999998569488525, 4.0, 2.9800000190734863, 3.0399999618530273, 2.299999952316284, 2.359999895095825],
  'end<sub>ts</sub><sub>logits</sub>': [9.6015625, 8.9375, 7.65234375, 7.53125, 7.4609375, 7.4609375, 7.30859375, 7.28515625, 7.22265625, 7.11328125],
  'unstable<sub>word</sub><sub>timestamps</sub>': [{'word': ' А', 'token': 3450,
				'timestamps':[7.0, 29.5, 1.0, 29.35999870300293, 13.0, 29.279998779296875, 29.34000015258789, 29.479999542236328, 28.939998626708984, 29.01999855041504],
				'timestamp<sub>logits</sub>': [15.1328125, 15.0703125, 14.9921875, 14.96875, 14.96875, 14.96875, 14.890625, 14.8359375, 14.7890625, 14.7890625]},
				{'word': ' вот', 'token': 5505,
				'timestamps': [27.34000015258789, 29.31999969482422, 26.979999542236328, 28.420000076293945, 28.739999771118164, 27.31999969482422, 28.439998626708984, 29.34000015258789, 13.519999504089355, 28.239999771118164],
				'timestamp<sub>logits</sub>': [19.546875, 19.46875, 19.296875, 19.125, 19.109375, 19.109375, 19.09375, 19.09375, 19.078125, 19.046875]},
				{'word': ',', 'token': 11,
				'timestamps': [2.0, 3.0, 4.0, 1.0, 1.7999999523162842, 10.0, 3.0199999809265137, 1.7599999904632568, 19.0, 3.5],
				'timestamp<sub>logits</sub>': [14.8828125, 13.640625, 13.21875, 12.734375, 11.3828125, 11.3671875, 11.3515625, 11.3359375, 11.2890625, 11.2578125]},
				{'word': ' не', 'token': 1725,
				'timestamps': [2.0, 1.0, 1.7599999904632568, 1.71999990940094, 1.6399999856948853, 1.7799999713897705, 28.19999885559082, 1.7999999523162842, 7.0, 28.239999771118164],
				'timestamp<sub>logits</sub>': [15.328125, 15.03125, 14.921875, 14.4453125, 14.3671875, 14.234375, 14.2265625, 14.203125, 14.0234375, 13.875]},
				{'word': ' добр', 'token': 35620,
				'timestamps': [28.099998474121094, 28.139999389648438, 14.75999927520752, 14.920000076293945, 27.099998474121094, 18.119998931884766, 14.59999942779541, 28.260000228881836, 13.0, 26.599998474121094],
				'timestamp<sub>logits</sub>': [14.015625, 13.9765625, 13.96875, 13.8515625, 13.84375, 13.8046875, 13.7109375, 13.7109375, 13.6953125, 13.6953125]},
				{'word': 'ый', 'token': 4851,
				'timestamps': [13.59999942779541, 15.399999618530273, 13.279999732971191, 14.719999313354492, 13.399999618530273, 14.880000114440918, 13.0, 14.59999942779541, 13.679999351501465, 13.639999389648438],
				'timestamp<sub>logits</sub>': [15.4140625, 15.28125, 15.21875, 14.765625, 14.7265625, 14.71875, 14.6328125, 14.578125, 14.5546875, 14.53125]}, {'word': ' день', 'token': 13509, 'timestamps': [2.0, 20.959999084472656, 3.0, 25.68000030517578, 3.4800000190734863, 24.0, 3.5, 19.920000076293945, 28.559999465942383, 4.0], 'timestamp<sub>logits</sub>': [9.3984375, 9.21875, 9.046875, 9.015625, 8.9296875, 8.90625, 8.875, 8.8203125, 8.7890625, 8.7421875]},
				{'word': '.', 'token': 13, 'timestamps': [3.0, 2.0, 4.0, 3.5, 3.0199999809265137, 2.879999876022339, 3.319999933242798, 3.0399999618530273, 2.299999952316284, 2.859999895095825], 'timestamp<sub>logits</sub>': [12.6328125, 12.4296875, 10.875, 10.2578125, 9.828125, 9.5078125, 9.4921875, 9.421875, 9.3828125, 9.3046875]}
				],
  'anchor<sub>point</sub>': False,
  'word<sub>timestamps</sub>': [{'word': ' А', 'token': 3450, 'timestamp': 1.0}, {'word': ' вот', 'token': 5505, 'timestamp': 1.0}, {'word': ',', 'token': 11, 'timestamp': 2.0}, {'word': ' не', 'token': 1725, 'timestamp': 2.0}, {'word': ' добр', 'token': 35620, 'timestamp': 2.0}, {'word': 'ый', 'token': 4851, 'timestamp': 2.0}, {'word': ' день', 'token': 13509, 'timestamp': 2.0}, {'word': '.', 'token': 13, 'timestamp': 3.0}],
  'whole<sub>word</sub><sub>timestamps</sub>': [{'word': ' А', 'timestamp': 1.3799999952316284}, {'word': ' вот,', 'timestamp': 1.7599999904632568}, {'word': ' не', 'timestamp': 1.7899999618530273}, {'word': ' добр', 'timestamp': 1.8899999856948853}, {'word': 'ый', 'timestamp': 1.8899999856948853}, {'word': ' день.', 'timestamp': 2.5899999141693115}
			     ]
  }, {'id': 1,
</p>
</div>
</div>
</div>
<div id="outline-container-orgb0609fd" class="outline-3">
<h3 id="orgb0609fd"><span class="section-number-3">52.8.</span> confidence score</h3>
<div class="outline-text-3" id="text-52-8">
<p>
sum<sub>logprobs</sub>: List[float] = [lp[i] for i, lp in zip(selected, sum<sub>logprobs</sub>)]
</p>

<p>
avg<sub>logprob</sub> - [lp / (len(t) + 1) for t, lp in zip(tokens, sum<sub>logprobs</sub>)]
</p>

<p>
path
</p>
<ul class="org-ul">
<li>model.transcribe</li>
<li>model.decode</li>
<li>transcribe<sub>word</sub><sub>level</sub> (whisper<sub>word</sub><sub>level.py</sub>:39)</li>
<li>results, ts<sub>tokens</sub>, ts<sub>logits</sub>_ = model.decode</li>
</ul>
</div>
</div>

<div id="outline-container-org7e073f5" class="outline-3">
<h3 id="org7e073f5"><span class="section-number-3">52.9.</span> <span class="todo TODO">TODO</span> main/notebooks</h3>
</div>

<div id="outline-container-org1c3a61f" class="outline-3">
<h3 id="org1c3a61f"><span class="section-number-3">52.10.</span> links</h3>
<div class="outline-text-3" id="text-52-10">
<p>
<a href="https://github.com/openai/whisper">https://github.com/openai/whisper</a>
</p>
<ul class="org-ul">
<li><a href="https://cdn.openai.com/papers/whisper.pdf">https://cdn.openai.com/papers/whisper.pdf</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgc2a2b7a" class="outline-2">
<h2 id="orgc2a2b7a"><span class="section-number-2">53.</span> NER USΕ CASES</h2>
<div class="outline-text-2" id="text-53">
</div>
<div id="outline-container-orgca67f15" class="outline-3">
<h3 id="orgca67f15"><span class="section-number-3">53.1.</span> Spelling correction algorithms or  (spell checker) or (comparing a word to a list of words)</h3>
<div class="outline-text-3" id="text-53-1">
<ul class="org-ul">
<li><a href="https://www.quora.com/Algorithms-What-is-a-fast-way-of-comparing-a-word-to-a-list-of-words-to-find-the-closest-match">https://www.quora.com/Algorithms-What-is-a-fast-way-of-comparing-a-word-to-a-list-of-words-to-find-the-closest-match</a></li>
</ul>

<p>
Damerau-Levenshtein - edit distance with constant time O(1) - independent of the word list size (but depending
on the average term length and maximum edit distance)
</p>
</div>
</div>

<div id="outline-container-org0602e7e" class="outline-3">
<h3 id="org0602e7e"><span class="section-number-3">53.2.</span> fuzzy string comparision или Приближённый поиск</h3>
<div class="outline-text-3" id="text-53-2">
<ul class="org-ul">
<li><a href="https://stackoverflow.com/questions/6690739/high-performance-fuzzy-string-comparison-in-python-use-levenshtein-or-difflib">https://stackoverflow.com/questions/6690739/high-performance-fuzzy-string-comparison-in-python-use-levenshtein-or-difflib</a></li>
</ul>

<p>
approaches:
</p>
<ul class="org-ul">
<li>Levenshtein is O(m*n) - mn - length of the two input strings</li>
<li>difflib.SequenceMatcher
<ul class="org-ul">
<li>uses the Ratcliff/Obershelp algorithm - O(n*2)</li>
</ul></li>
<li>расстояние Хэмминга - не учитывает удаление символов, а считает только для двух строк одинаковой длины
количество символов</li>
</ul>

<p>
databases
</p>
<ul class="org-ul">
<li>Clickhouse <a href="https://habr.com/en/company/yandex/blog/466183/">https://habr.com/en/company/yandex/blog/466183/</a></li>
<li></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org2b54cac" class="outline-2">
<h2 id="org2b54cac"><span class="section-number-2">54.</span> Flax and Jax</h2>
<div class="outline-text-2" id="text-54">
<p>
Google
</p>
<ul class="org-ul">
<li><a href="https://github.com/google/flax">https://github.com/google/flax</a></li>
<li><a href="https://github.com/google/jax">https://github.com/google/jax</a></li>
</ul>

<p>
Flax - neural network library and ecosystem for JAX designed for flexibility
</p>
</div>
</div>
<div id="outline-container-org61b627b" class="outline-2">
<h2 id="org61b627b"><span class="section-number-2">55.</span> hyperparemeter optimization library <b>test-tube</b></h2>
<div class="outline-text-2" id="text-55">
<p>
<a href="https://github.com/williamFalcon/test-tube">https://github.com/williamFalcon/test-tube</a>
</p>
</div>
</div>
<div id="outline-container-org5c625b9" class="outline-2">
<h2 id="org5c625b9"><span class="section-number-2">56.</span> Keras</h2>
<div class="outline-text-2" id="text-56">
<ul class="org-ul">
<li><a href="https://keras.io/">https://keras.io/</a></li>
<li><a href="https://keras.io/optimizers/">https://keras.io/optimizers/</a></li>
<li>CNN <a href="https://www.learnopencv.com/image-classification-using-convolutional-neural-networks-in-keras/">https://www.learnopencv.com/image-classification-using-convolutional-neural-networks-in-keras/</a></li>
</ul>
<p>
MIT нейросетевая библиотека
</p>
<ul class="org-ul">
<li>надстройку над фреймворками Deeplearning4j, TensorFlow и Theano</li>
<li>Нацелена на оперативную работу с сетями глубинного обучения</li>
<li>компактной, модульной и расширяемой</li>
<li>высокоуровневый, более интуитивный набор абстракций, который делает простым формирование нейронных сетей,</li>
<li>channels<sub>last</sub> - default for keras <a href="python-ds#MissingReference">python-ds#MissingReference</a></li>
</ul>

<p>
import logging
logging.getLogger('tensorflow').disabled = True
</p>


<ul class="org-ul">
<li>loss - loss function <a href="https://github.com/keras-team/keras/blob/c2e36f369b411ad1d0a40ac096fe35f73b9dffd3/keras/metrics.py">https://github.com/keras-team/keras/blob/c2e36f369b411ad1d0a40ac096fe35f73b9dffd3/keras/metrics.py</a>
<ul class="org-ul">
<li>mean<sub>squared</sub><sub>error</sub></li>
<li>categorical<sub>crossentropy</sub></li>
<li>binary<sub>crossentropy</sub></li>
<li>sparse<sub>categorical</sub><sub>accuracy</sub> - Calculates the top-k categorical accuracy rate, i.e. success when the
target class is within the top-k predictions provided.</li>
<li>top<sub>k</sub><sub>categorical</sub><sub>accuracy</sub> - Calculates the top-k categorical accuracy rate, i.e. success when the target
class is within the top-k predictions provided.</li>
<li>sparse<sub>top</sub><sub>k</sub><sub>categorical</sub><sub>accuracy</sub></li>
</ul></li>
</ul>

<p>
Steps:
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">1.declare keras.layers.Input and keras.layers.Dense in chain</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">2.</span>
<span style="color: #cae682;">model</span> = Model(inputs=inputs, outputs=predictions) <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">where inputs - inputs, predictions - last Dense layout</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">3. Configures the model for training</span>
model.<span style="color: #e5786d;">compile</span>(optimizer=<span style="color: #95e454;">'rmsprop'</span>, loss=<span style="color: #95e454;">'categorical_crossentropy'</span>, metrics=[<span style="color: #95e454;">'accuracy'</span>]) <span style="color: #fa8072;">#</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">4.</span>
model.fit(data, labels, epochs=10, batch_size=32)
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">5.</span>
model.predict(np.array([[3,3,3]])) - shape (3,)

<span style="color: #cae682;">model</span> = Model(inputs=inputs, outputs=predictions)
model.<span style="color: #e5786d;">compile</span>(optimizer=<span style="color: #95e454;">'rmsprop'</span>,
              loss=<span style="color: #95e454;">'categorical_crossentropy'</span>,
              metrics=[<span style="color: #95e454;">'accuracy'</span>])

</pre>
</div>
</div>


<div id="outline-container-org0cb6650" class="outline-3">
<h3 id="org0cb6650"><span class="section-number-3">56.1.</span> install</h3>
<div class="outline-text-3" id="text-56-1">
<p>
pip install keras &#x2013;user
</p>
</div>
</div>
<div id="outline-container-orga9d68ce" class="outline-3">
<h3 id="orga9d68ce"><span class="section-number-3">56.2.</span> API types</h3>
<div class="outline-text-3" id="text-56-2">
<ul class="org-ul">
<li>Model subclassing: from keras.models import Model</li>
<li>Model constructor - deprecated</li>
<li>Functional API</li>
<li>Sequential model</li>
</ul>
</div>
</div>
<div id="outline-container-org26304dc" class="outline-3">
<h3 id="org26304dc"><span class="section-number-3">56.3.</span> Sequential model</h3>
<div class="outline-text-3" id="text-56-3">
<ul class="org-ul">
<li>first layer needs to receive information about its input shape - following layers can do automatic shape</li>
</ul>
<p>
inference
</p>
</div>
</div>
<div id="outline-container-org18b6654" class="outline-3">
<h3 id="org18b6654"><span class="section-number-3">56.4.</span> functional API</h3>
</div>
<div id="outline-container-orgbcf5508" class="outline-3">
<h3 id="orgbcf5508"><span class="section-number-3">56.5.</span> Layers</h3>
<div class="outline-text-3" id="text-56-5">
<ul class="org-ul">
<li>layer.get<sub>weights</sub>()</li>
<li>layer.get<sub>config</sub>(): returns a dictionary containing the configuration of the layer.</li>
</ul>
</div>


<div id="outline-container-orgd5ccf4d" class="outline-4">
<h4 id="orgd5ccf4d"><span class="section-number-4">56.5.1.</span> types</h4>
<div class="outline-text-4" id="text-56-5-1">
<ul class="org-ul">
<li>Input - instantiate a Keras tensor Input(shape=(784,)) - indicates that the expected input will be batches
of 784-dimensional vectors</li>
<li>Dense - Each neuron recieves input from all the neurons in the previous layer</li>
<li>Embedding -  can only be used as the first layer</li>
<li>Merge Layers  - concatenate  - Add  - Substract  - Multiply  - Average etc.
<ul class="org-ul">
<li></li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org0ab5ac2" class="outline-4">
<h4 id="org0ab5ac2"><span class="section-number-4">56.5.2.</span> Dense</h4>
<div class="outline-text-4" id="text-56-5-2">
<ul class="org-ul">
<li>output = activation(dot(input, kernel) + bias)</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orga619bcf" class="outline-3">
<h3 id="orga619bcf"><span class="section-number-3">56.6.</span> Models</h3>
<div class="outline-text-3" id="text-56-6">
<p>
attributes:
</p>
<ul class="org-ul">
<li>model.layers is a flattened list of the layers comprising the model.</li>
<li>model.inputs is the list of input tensors of the model.</li>
<li>model.outputs is the list of output tensors of the model.</li>
<li>model.summary() prints a summary representation of your model. Shortcut for</li>
<li>model.get<sub>config</sub>() returns a dictionary containing the configuration of the model.</li>
</ul>
</div>
</div>

<div id="outline-container-org6905683" class="outline-3">
<h3 id="org6905683"><span class="section-number-3">56.7.</span> Accuracy:</h3>
<div class="outline-text-3" id="text-56-7">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Keras reported accuracy:</span>
<span style="color: #cae682;">score</span> = model.evaluate(x_test, y_test, verbose=0)
score[1]
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">0.99794011611938471</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Actual accuracy calculated manually:</span>
<span style="color: #8ac6f2; font-weight: bold;">import</span> numpy <span style="color: #8ac6f2; font-weight: bold;">as</span> np
<span style="color: #cae682;">y_pred</span> = model.predict(x_test)
<span style="color: #cae682;">acc</span> = <span style="color: #e5786d;">sum</span>([np.argmax(y_test[i])==np.argmax(y_pred[i]) <span style="color: #8ac6f2; font-weight: bold;">for</span> i <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">range</span>(10000)])/10000
acc
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">0.98999999999999999</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org88ff2ab" class="outline-3">
<h3 id="org88ff2ab"><span class="section-number-3">56.8.</span> input shape &amp; text prepare</h3>
<div class="outline-text-3" id="text-56-8">
<pre class="example">
import numpy as np
data = np.random.random((2, 3)) # ndarray [[1,1,1],[1,1,1]]
print(data.shape) # = (2,3)
</pre>

<p>
(2,)
</p>
<pre class="example">
data = np.random.random((2,)) # [0.3907832  0.00941261]
</pre>

<p>
list to ndarray
</p>
<pre class="example">
np.array(texts)
np.asarray(texts)
</pre>


<p>
fit of batches
</p>
<pre class="example">
model.fit([np.asarray([x_embed , x_embed]) , np.asarray([x2_onehot, x2_onehot])], np.asarray([y_onehot[0], y_onehot[0]]), epochs=2, batch_size=2)
</pre>
</div>
</div>
<div id="outline-container-org7c7808b" class="outline-3">
<h3 id="org7c7808b"><span class="section-number-3">56.9.</span> ValueError: Error when checking input: expected input<sub>1</sub> to have 3 dimensions, but got array with shape</h3>
<div class="outline-text-3" id="text-56-9">
<p>
if
</p>
<pre class="example">
Input(shape=(5,100))
</pre>

<p>
then
</p>
<pre class="example">
model.fit(x_embed, y_onehot, epochs=3, batch_size=1)
</pre>

<p>
where x<sub>embed.shape</sub> = (1, 5, 100)
</p>
</div>
</div>

<div id="outline-container-orgb885d8c" class="outline-3">
<h3 id="orgb885d8c"><span class="section-number-3">56.10.</span> merge inputs</h3>
<div class="outline-text-3" id="text-56-10">
<p>
<a href="https://www.pyimagesearch.com/2019/02/04/keras-multiple-inputs-and-mixed-data/">https://www.pyimagesearch.com/2019/02/04/keras-multiple-inputs-and-mixed-data/</a>
</p>

<p>
Добавил ещё один Input(shape=(x2<sub>size</sub>,) в виде вектора и сделал concatenate на плоском слое нейронов, важно
чтобы shape были одной размерности в данном случае это вектор
</p>

<div class="org-src-container">
<pre class="src src-python">    <span style="color: #cae682;">inp</span> = Input(shape=(words, embedding_size))  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">5 tokens</span>
    <span style="color: #cae682;">output</span> = inp
    <span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">my</span>
    <span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">word_input = Input(shape=(x2_size,), name='word_input')</span>

    <span style="color: #cae682;">outputs</span> = []
    <span style="color: #8ac6f2; font-weight: bold;">for</span> i <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">range</span>(<span style="color: #e5786d;">len</span>(kernel_sizes_cnn)):
        <span style="color: #cae682;">output_i</span> = Conv1D(filters_cnn, kernel_size=kernel_sizes_cnn[i],
                          activation=<span style="color: #e5786d; font-weight: bold;">None</span>,
                          kernel_regularizer=l2(coef_reg_cnn),
                          padding=<span style="color: #95e454;">'same'</span>)(output)
        <span style="color: #cae682;">output_i</span> = BatchNormalization()(output_i)
        <span style="color: #cae682;">output_i</span> = Activation(<span style="color: #95e454;">'relu'</span>)(output_i)
        <span style="color: #cae682;">output_i</span> = GlobalMaxPooling1D()(output_i)
        outputs.append(output_i)

    <span style="color: #cae682;">output</span> = concatenate(outputs, axis=1)
    <span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">my</span>
    <span style="color: #cae682;">output</span> = concatenate([output, word_input]) <span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">second input</span>

    <span style="color: #cae682;">output</span> = Dropout(rate=dropout_rate)(output)
    <span style="color: #cae682;">output</span> = Dense(dense_size, activation=<span style="color: #e5786d; font-weight: bold;">None</span>,
                   kernel_regularizer=l2(coef_reg_den))(output)

    <span style="color: #cae682;">output</span> = BatchNormalization()(output)
    <span style="color: #cae682;">output</span> = Activation(<span style="color: #95e454;">'relu'</span>)(output)
    <span style="color: #cae682;">output</span> = Dropout(rate=dropout_rate)(output)
    <span style="color: #cae682;">output</span> = Dense(n_classes, activation=<span style="color: #e5786d; font-weight: bold;">None</span>,
                   kernel_regularizer=l2(coef_reg_den))(output)
    <span style="color: #cae682;">output</span> = BatchNormalization()(output)
    <span style="color: #cae682;">act_output</span> = Activation(<span style="color: #95e454;">"softmax"</span>)(output)
    <span style="color: #cae682;">model</span> = Model(inputs=[inp, word_input], outputs=act_output)

<span style="color: #cae682;">model</span>: Model = build_model(vocab_y.<span style="color: #e5786d;">len</span>, embedder.dim, words, embedder.dim)
model.fit([np.asarray(x), np.asarray(x2)], np.asarray(y), epochs=100, batch_size=2)
</pre>
</div>
</div>
</div>

<div id="outline-container-org6c43fd1" class="outline-3">
<h3 id="org6c43fd1"><span class="section-number-3">56.11.</span> convolution</h3>
<div class="outline-text-3" id="text-56-11">
<ul class="org-ul">
<li><b>filters</b> - dimensionality of the output space - In practice, they are in number of 64,128,256, 512 etc.</li>
<li><b>kernel<sub>size</sub></b> is size of these convolution filters -  sliding window. In practice they are 3x3, 1x1 or 5x5</li>
<li>Note that number of filters from previous layer become the number of channels for current layer's input image.</li>
</ul>
</div>
</div>
<div id="outline-container-org8e3e273" class="outline-3">
<h3 id="org8e3e273"><span class="section-number-3">56.12.</span> character CNN</h3>
<div class="outline-text-3" id="text-56-12">
<p>
<a href="https://towardsdatascience.com/besides-word-embedding-why-you-need-to-know-character-embedding-6096a34a3b10">https://towardsdatascience.com/besides-word-embedding-why-you-need-to-know-character-embedding-6096a34a3b10</a>
</p>
</div>
</div>
<div id="outline-container-orgfb5a6c6" class="outline-3">
<h3 id="orgfb5a6c6"><span class="section-number-3">56.13.</span> Early stopping</h3>
<div class="outline-text-3" id="text-56-13">
<p>
<a href="https://keras.io/callbacks/">https://keras.io/callbacks/</a>
</p>

<pre class="example">
from tensorflow.keras.callbacks import EarlyStopping
early_stopping_callback = EarlyStopping(monitor='val_acc', patience=2)
model.fit(X_train, Y_train, callbacks=[early_stopping_callback])
</pre>



<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">from</span> keras.callbacks <span style="color: #8ac6f2; font-weight: bold;">import</span> EarlyStopping
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">...</span>
<span style="color: #cae682;">num_epochs</span> = 50 <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">we iterate at most fifty times over the entire training set</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">...</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">fit the model on the batches generated by datagen.flow()---most parameters similar to model.fit</span>
model.fit_generator(datagen.flow(X_train, Y_train,
                        batch_size=batch_size),
                        samples_per_epoch=X_train.shape[0],
                        nb_epoch=num_epochs,
                        validation_data=(X_val, Y_val),
                        verbose=1,
                        callbacks=[EarlyStopping(monitor=<span style="color: #95e454;">'val_loss'</span>, patience=5)]) <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">adding early stopping</span>

</pre>
</div>
</div>
</div>
<div id="outline-container-org206c4d0" class="outline-3">
<h3 id="org206c4d0"><span class="section-number-3">56.14.</span> plot history</h3>
<div class="outline-text-3" id="text-56-14">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #cae682;">history</span> = model.fit(X_train, Y_train, validation_split=0.2)
plt.plot(history.history[<span style="color: #95e454;">'acc'</span>],
         label=<span style="color: #95e454;">'&#1044;&#1086;&#1083;&#1103; &#1074;&#1077;&#1088;&#1085;&#1099;&#1093; &#1086;&#1090;&#1074;&#1077;&#1090;&#1086;&#1074; &#1085;&#1072; &#1086;&#1073;&#1091;&#1095;&#1072;&#1102;&#1097;&#1077;&#1084; &#1085;&#1072;&#1073;&#1086;&#1088;&#1077;'</span>)
plt.plot(history.history[<span style="color: #95e454;">'val_acc'</span>],
         label=<span style="color: #95e454;">'&#1044;&#1086;&#1083;&#1103; &#1074;&#1077;&#1088;&#1085;&#1099;&#1093; &#1086;&#1090;&#1074;&#1077;&#1090;&#1086;&#1074; &#1085;&#1072; &#1087;&#1088;&#1086;&#1074;&#1077;&#1088;&#1086;&#1095;&#1085;&#1086;&#1084; &#1085;&#1072;&#1073;&#1086;&#1088;&#1077;'</span>)
plt.xlabel(<span style="color: #95e454;">'&#1069;&#1087;&#1086;&#1093;&#1072; &#1086;&#1073;&#1091;&#1095;&#1077;&#1085;&#1080;&#1103;'</span>)
plt.ylabel(<span style="color: #95e454;">'&#1044;&#1086;&#1083;&#1103; &#1074;&#1077;&#1088;&#1085;&#1099;&#1093; &#1086;&#1090;&#1074;&#1077;&#1090;&#1086;&#1074;'</span>)
plt.legend()
plt.show()

</pre>
</div>
</div>
</div>
<div id="outline-container-orgdf67262" class="outline-3">
<h3 id="orgdf67262"><span class="section-number-3">56.15.</span> ImageDataGenerator class</h3>
<div class="outline-text-3" id="text-56-15">
<ul class="org-ul">
<li><a href="https://medium.com/@vijayabhaskar96/tutorial-image-classification-with-keras-flow-from-directory-and-generators-95f75ebe5720">https://medium.com/@vijayabhaskar96/tutorial-image-classification-with-keras-flow-from-directory-and-generators-95f75ebe5720</a></li>
<li>flow() - Takes (x,y), return generator for model.fit<sub>generator</sub>()</li>
<li>flow<sub>from</sub><sub>directory</sub>() - берез директорию с субдиректориями и выдает (x,y) без остановки или в одну директорию</li>
<li>flow<sub>from</sub><sub>dataframe</sub>()</li>
<li>fit() - Only required if `featurewise<sub>center</sub>` or `featurewise<sub>std</sub><sub>normalization</sub>` or `zca<sub>whitening</sub>` are set
to True.</li>
</ul>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #cae682;">datagen</span> = ImageDataGenerator(
<span style="color: #fa8072;">#         </span><span style="color: #99968b; font-style: italic;">zoom_range=0.2, # randomly zoom into images</span>
<span style="color: #fa8072;">#         </span><span style="color: #99968b; font-style: italic;">rotation_range=10,  # randomly rotate images in the range (degrees, 0 to 180)</span>
        width_shift_range=0.1,  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">randomly shift images horizontally (fraction of total width)</span>
        height_shift_range=0.1,  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">randomly shift images vertically (fraction of total height)</span>
        horizontal_flip=<span style="color: #e5786d; font-weight: bold;">True</span>,  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">randomly flip images</span>
        vertical_flip=<span style="color: #e5786d; font-weight: bold;">False</span>)  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">randomly flip images</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgba04cb9" class="outline-3">
<h3 id="orgba04cb9"><span class="section-number-3">56.16.</span> CNN Rotate</h3>
</div>
<div id="outline-container-orgb1da0c8" class="outline-3">
<h3 id="orgb1da0c8"><span class="section-number-3">56.17.</span> LSTM</h3>
<div class="outline-text-3" id="text-56-17">
<p>
<a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/">https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/</a>
By default the Keras implementation resets the network state after each training batch.
</p>

<pre class="example">
model.add(LSTM(50, batch_input_shape=(batch_size, X.shape[1], X.shape[2]), stateful=True))
model.reset_states() # at the end of epoch
</pre>
</div>
</div>
</div>

<div id="outline-container-org1c72732" class="outline-2">
<h2 id="org1c72732"><span class="section-number-2">57.</span> Tesseract - Optical Character Recognition</h2>
<div class="outline-text-2" id="text-57">
<ul class="org-ul">
<li><a href="https://github.com/tesseract-ocr/tesseract">https://github.com/tesseract-ocr/tesseract</a></li>
<li>man <a href="https://github.com/tesseract-ocr/tesseract/blob/master/doc/tesseract.1.asc">https://github.com/tesseract-ocr/tesseract/blob/master/doc/tesseract.1.asc</a></li>
</ul>
</div>
<div id="outline-container-org959803b" class="outline-3">
<h3 id="org959803b"><span class="section-number-3">57.1.</span> compilation</h3>
<div class="outline-text-3" id="text-57-1">
<ul class="org-ul">
<li><a href="https://github.com/tesseract-ocr/tesseract/wiki/Compiling">https://github.com/tesseract-ocr/tesseract/wiki/Compiling</a></li>
</ul>
<p>
dockerfile:
</p>
<div class="org-src-container">
<pre class="src src-conf">RUN apt-get update &amp;&amp; apt-get install -y --no-install-recommends \
  g++ \
  automake \
  make \
  libtool \
  pkg-config \
  libleptonica-dev \
  curl \
  libpng-dev \
  zlib1g-dev \
  libjpeg-dev \
  &amp;&amp; apt-get autoclean \
  &amp;&amp; apt-get clean \
  &amp;&amp; rm -rf /var/lib/apt/lists/*

<span style="color: #cae682;">ARG PREFIX</span>=/usr/local
<span style="color: #cae682;">ARG VERSION</span>=4.1.0

RUN curl --silent --location --location-trusted \
        --remote-name https://github.com/tesseract-ocr/tesseract/archive/$VERSION.tar.gz \
  &amp;&amp; tar -xzf $VERSION.tar.gz \
  &amp;&amp; cd tesseract-$VERSION \
  &amp;&amp; ./autogen.sh \
  <span style="color: #cae682;">&amp;&amp; ./configure --prefix</span>=$PREFIX \
  &amp;&amp; make \
  &amp;&amp; make install \
  &amp;&amp; ldconfig
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc6b0227" class="outline-3">
<h3 id="orgc6b0227"><span class="section-number-3">57.2.</span> black and white list</h3>
<div class="outline-text-3" id="text-57-2">
<p>
<a href="https://github.com/tesseract-ocr/langdata/blob/master/rus/rus.training_text">https://github.com/tesseract-ocr/langdata/blob/master/rus/rus.training_text</a>
</p>
<ul class="org-ul">
<li>./tesseract -l eng /home/u2/Documents/2.jpg stdout -c tessedit<sub>char</sub><sub>blacklist</sub>='0123456789'</li>
<li>./tesseract -l eng /home/u2/Documents/2.jpg stdout -c tessedit<sub>char</sub><sub>whitelist</sub>='0123456789'</li>
</ul>


<pre class="example">
print(pytesseract.image_to_string(im, lang='rus', config='-c tessedit_char_whitelist=0123456789'))
</pre>
</div>
</div>


<div id="outline-container-org1bc5546" class="outline-3">
<h3 id="org1bc5546"><span class="section-number-3">57.3.</span> notes</h3>
<div class="outline-text-3" id="text-57-3">
<p>
when we repeat symbol it start to recognize it
</p>
</div>
</div>
<div id="outline-container-org3bd285d" class="outline-3">
<h3 id="org3bd285d"><span class="section-number-3">57.4.</span> prepare</h3>
<div class="outline-text-3" id="text-57-4">
<ul class="org-ul">
<li><a href="https://github.com/tesseract-ocr/tesseract/wiki/ImproveQuality">https://github.com/tesseract-ocr/tesseract/wiki/ImproveQuality</a></li>

<li>20-30 pix - height character</li>
</ul>
</div>
</div>
<div id="outline-container-orgde99a94" class="outline-3">
<h3 id="orgde99a94"><span class="section-number-3">57.5.</span> usage</h3>
<div class="outline-text-3" id="text-57-5">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #cae682;">text</span> = pytesseract.image_to_string(img, lang=<span style="color: #95e454;">'rus'</span>)

<span style="color: #cae682;">letters</span> = pytesseract.image_to_boxes(img, lang=<span style="color: #95e454;">'rus'</span>)
<span style="color: #cae682;">letters</span> = letters.split(<span style="color: #95e454;">'</span><span style="color: #e5786d; font-weight: bold;">\n</span><span style="color: #95e454;">'</span>)
<span style="color: #cae682;">letters</span> = [letter.split() <span style="color: #8ac6f2; font-weight: bold;">for</span> letter <span style="color: #8ac6f2; font-weight: bold;">in</span> letters]
<span style="color: #cae682;">h</span>, <span style="color: #cae682;">w</span> = img.shape
<span style="color: #8ac6f2; font-weight: bold;">for</span> letter <span style="color: #8ac6f2; font-weight: bold;">in</span> letters:
     cv.rectangle(img, (<span style="color: #e5786d;">int</span>(letter[1]), h - <span style="color: #e5786d;">int</span>(letter[2])), (<span style="color: #e5786d;">int</span>(letter[3]), h - <span style="color: #e5786d;">int</span>(letter[4])), (0, 0, 255), 2)
            <span style="color: #cae682;">p_x</span> = <span style="color: #e5786d;">int</span>(letter[1])
            <span style="color: #cae682;">p_y</span> = hh - <span style="color: #e5786d;">int</span>(letter[2])  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">0 at top - LOWER</span>
            <span style="color: #cae682;">p_x2</span> = <span style="color: #e5786d;">int</span>(letter[3])
            <span style="color: #cae682;">p_y2</span> = hh - <span style="color: #e5786d;">int</span>(letter[4])  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">0 at top - close to 0 - higher y2 &lt; y</span>

            <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">cv.rectangle(img, (int(letter[1]), h - int(letter[2])), (int(letter[3]), h - int(letter[4])), (0, 0, 255),</span>
            <span style="color: #fa8072;">#              </span><span style="color: #99968b; font-style: italic;">2)</span>

            <span style="color: #cae682;">cc</span> = [
                [p_x, p_y],
                [p_x2, p_y],  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">_</span>
                [p_x2, p_y2],  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">_|</span>
                [p_x, p_y2]]

            <span style="color: #cae682;">c</span> = np.array(cc, dtype=np.int32)

            <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">print(cv.contourArea(c), ',')</span>

            <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">print(cc)</span>
            <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">cv.drawMarker(img, (int(letter[1]), hh - int(letter[2])), -1, (0, 255, 0), 3)</span>

            <span style="color: #cae682;">x</span> = p_x
            <span style="color: #cae682;">y</span> = p_y2
            <span style="color: #cae682;">w</span> = p_x2 - p_x
            <span style="color: #cae682;">h</span> = p_y - p_y2
            <span style="color: #cae682;">box</span> = [x, y, w, h]
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org854ddfa" class="outline-2">
<h2 id="org854ddfa"><span class="section-number-2">58.</span> FEATURE ENGEERING</h2>
<div class="outline-text-2" id="text-58">
</div>
<div id="outline-container-org7f6ed18" class="outline-3">
<h3 id="org7f6ed18"><span class="section-number-3">58.1.</span> Featuretools - Aturomatic Feature Engeering</h3>
<div class="outline-text-3" id="text-58-1">
<ul class="org-ul">
<li>doc dfs <a href="https://docs.featuretools.com/en/stable/generated/featuretools.dfs.html#featuretools.dfs">https://docs.featuretools.com/en/stable/generated/featuretools.dfs.html#featuretools.dfs</a></li>
<li>doc <a href="https://docs.featuretools.com/en/stable/">https://docs.featuretools.com/en/stable/</a></li>

<li>article <a href="https://medium.com/@rrfd/simple-automatic-feature-engineering-using-featuretools-in-python-for-classification-b1308040e183">https://medium.com/@rrfd/simple-automatic-feature-engineering-using-featuretools-in-python-for-classification-b1308040e183</a></li>
<li>article kaggle <a href="https://www.kaggle.com/willkoehrsen/automated-feature-engineering-basics/notebook">https://www.kaggle.com/willkoehrsen/automated-feature-engineering-basics/notebook</a></li>
</ul>


<p>
Limitation: intended to be run on datasets that can fit in memory on one machine
</p>
<ul class="org-ul">
<li>делить закачку по строкам и делать массив</li>
<li>закачивать часть по дате</li>
</ul>
<p>
Steps:
</p>
<ol class="org-ol">
<li>create dict {column:[rows], column2:[rows]}</li>
<li>EntitySet
<ul class="org-ul">
<li>Entities pd.DataFrame</li>
<li>Relations
<ul class="org-ul">
<li><b>one to one only</b> - for many to many you must create middle set(ids)</li>
<li>for each child id parent id MUST EXIST</li>
<li>child id and parent id type must be queal</li>
</ul></li>
</ul></li>
<li>ft.dfs - Input - entities with relationships</li>
</ol>


<p>
Cons
</p>
<ul class="org-ul">
<li>мусорные столбцы построенные на id столбцах и в порядке от child к parent при many-to-many</li>
</ul>

<p>
for prediction you must have в 10 раз больше строк чем feature <a href="https://www.youtube.com/watch?v=Dc0sr0kdBVI&amp;hd=1#t=57m20s">https://www.youtube.com/watch?v=Dc0sr0kdBVI&amp;hd=1#t=57m20s</a>
</p>
</div>
<div id="outline-container-orgb87afc8" class="outline-4">
<h4 id="orgb87afc8"><span class="section-number-4">58.1.1.</span> variable types</h4>
<div class="outline-text-4" id="text-58-1-1">
<ul class="org-ul">
<li><a href="https://docs.featuretools.com/en/stable/api_reference.html#variable-types">https://docs.featuretools.com/en/stable/api_reference.html#variable-types</a></li>

<li id="Index">указывается при созданни Entity</li>
<li id="Id">foreign key</li>
</ul>
</div>
</div>
<div id="outline-container-orgf2ccb16" class="outline-4">
<h4 id="orgf2ccb16"><span class="section-number-4">58.1.2.</span> example one-to-many</h4>
<div class="outline-text-4" id="text-58-1-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">sys.partner_id - foreign key</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">partner - one</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">sys - many</span>
<span style="color: #cae682;">entities</span> = {
  <span style="color: #95e454;">"sys"</span>: (sys, <span style="color: #95e454;">"id"</span>),
  <span style="color: #95e454;">"partner"</span>: (partner, <span style="color: #95e454;">"id)</span>
<span style="color: #95e454;">}</span>
<span style="color: #95e454;">relationships = {</span>
<span style="color: #95e454;">  ("</span>partner<span style="color: #95e454;">", "</span><span style="color: #e5786d;">id</span><span style="color: #95e454;">", "</span>sys<span style="color: #95e454;">", "</span>partner_id<span style="color: #95e454;">")</span>
<span style="color: #95e454;">}</span>
<span style="color: #95e454;"># fields:</span>
<span style="color: #95e454;"># partner.SUM(sys.field1)</span>


</pre>
</div>
</div>
</div>
<div id="outline-container-org82178b6" class="outline-4">
<h4 id="org82178b6"><span class="section-number-4">58.1.3.</span> example many-to-many</h4>
<div class="outline-text-4" id="text-58-1-3">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #cae682;">entities</span> = {
  <span style="color: #95e454;">"sys"</span>: (sys, <span style="color: #95e454;">"id"</span>),
  <span style="color: #95e454;">"cl_ids"</span>: (cl_ids, <span style="color: #95e454;">"id"</span>),
  <span style="color: #95e454;">"cl_budget"</span>: (cl_budget, <span style="color: #95e454;">"idp"</span>)
}
<span style="color: #cae682;">relationships</span> = {
  (<span style="color: #95e454;">"cl_ids"</span>, <span style="color: #95e454;">"id"</span>, <span style="color: #95e454;">"sys"</span>, <span style="color: #95e454;">"client_id"</span>),
  (<span style="color: #95e454;">"cl_ids"</span>, <span style="color: #95e454;">"id"</span>, <span style="color: #95e454;">"cl_budget"</span>, <span style="color: #95e454;">"id"</span>)
}

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">cl_ids.SUM(cl_budget.field1)</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">cl_ids.SUM(sys.field1) - &#1084;&#1091;&#1089;&#1086;&#1088;&#1085;&#1086;&#1077; &#1087;&#1086;&#1083;&#1077;, &#1076;&#1091;&#1073;&#1083;&#1080;&#1088;&#1091;&#1102;&#1097;&#1080;&#1077;&#1077; sys.field1</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org20f621a" class="outline-4">
<h4 id="org20f621a"><span class="section-number-4">58.1.4.</span> oparations</h4>
<div class="outline-text-4" id="text-58-1-4">
<ul class="org-ul">
<li><a href="https://primitives.featurelabs.com/">https://primitives.featurelabs.com/</a></li>
</ul>

<pre class="example">
ft.list_primitives().head(5)
</pre>
</div>
</div>

<div id="outline-container-orgc42e388" class="outline-4">
<h4 id="orgc42e388"><span class="section-number-4">58.1.5.</span> aggregation primitive - across a parent-child relationship:</h4>
<div class="outline-text-4" id="text-58-1-5">
<p>
Default: [“sum”, “std”, “max”, “skew”, “min”, “mean”, “count”, “percent<sub>true</sub>”, “num<sub>unique</sub>”, “mode”]
</p>
<dl class="org-dl">
<dt>skew</dt><dd>Computes the extent to which a distribution differs from a normal distribution.</dd>
<dt>std</dt><dd>Computes the dispersion relative to the mean value, ignoring `NaN`.</dd>
<dt>percent<sub>true</sub></dt><dd>Determines the percent of `True` values.</dd>
<dt>mode</dt><dd>Determines the most commonly repeated value.</dd>
</dl>
</div>

<ol class="org-ol">
<li><a id="org1aa3be3"></a>all<br />
<div class="outline-text-5" id="text-58-1-5-1">
<p>
0                               std  aggregation              Computes the dispersion relative to the mean value, ignoring `NaN`.
1                            median  aggregation                            Determines the middlemost number in a list of values.
2                     n<sub>most</sub><sub>common</sub>  aggregation                                         Determines the `n` most common elements.
3                          num<sub>true</sub>  aggregation                                              Counts the number of `True` values.
4                   time<sub>since</sub><sub>last</sub>  aggregation        Calculates the time elapsed since the last datetime (default in seconds).
5                               max  aggregation                             Calculates the highest value, ignoring `NaN` values.
6                           entropy  aggregation                                Calculates the entropy for a categorical variable
7                               any  aggregation                                     Determines if any value is 'True' in a list.
8                              mode  aggregation                                     Determines the most commonly repeated value.
9                  time<sub>since</sub><sub>first</sub>  aggregation               Calculates the time elapsed since the first datetime (in seconds).
10                            trend  aggregation                                    Calculates the trend of a variable over time.
11                            first  aggregation                                            Determines the first value in a list.
12                              sum  aggregation                                   Calculates the total addition, ignoring `NaN`.
13                            count  aggregation                          Determines the total number of values, excluding `NaN`.
14                             skew  aggregation  Computes the extent to which a distribution differs from a normal distribution.
15                 avg<sub>time</sub><sub>between</sub>  aggregation               Computes the average number of seconds between consecutive events.
16                     percent<sub>true</sub>  aggregation                                         Determines the percent of `True` values.
17                       num<sub>unique</sub>  aggregation                 Determines the number of distinct values, ignoring `NaN` values.
18                              all  aggregation                                   Calculates if all values are 'True' in a list.
19                              min  aggregation                            Calculates the smallest value, ignoring `NaN` values.
20                             last  aggregation                                             Determines the last value in a list.
21                             mean  aggregation                                       Computes the average for a list of values.
</p>
</div>
</li>
</ol>
</div>
<div id="outline-container-orgaed361c" class="outline-4">
<h4 id="orgaed361c"><span class="section-number-4">58.1.6.</span> TransformPrimitive - one or more variables from an entity to one new:</h4>
<div class="outline-text-4" id="text-58-1-6">
<p>
Default: [“day”, “year”, “month”, “weekday”, “haversine”, “num<sub>words</sub>”, “num<sub>characters</sub>”]
</p>

<p>
Useful:
</p>
<ul class="org-ul">
<li>divide<sub>numeric</sub> - ratio</li>
</ul>

<p>
Transform Don't have:
</p>
<ul class="org-ul">
<li>root</li>
<li>square<sub>root</sub></li>
<li>log</li>
</ul>
</div>

<ol class="org-ol">
<li><a id="org1f1950b"></a>all<br />
<div class="outline-text-5" id="text-58-1-6-1">
<ul class="org-ul">
<li><a href="https://docs.featuretools.com/en/stable/_modules/featuretools/primitives/standard/binary_transform.html">https://docs.featuretools.com/en/stable/_modules/featuretools/primitives/standard/binary_transform.html</a></li>
<li>22                             year    transform                                         Determines the year value of a datetime.</li>
<li>23                            equal    transform                      Determines if values in one list are equal to another list.</li>
<li>24                             isin    transform                        Determines whether a value is present in a provided list.</li>
<li>25                   num<sub>characters</sub>    transform                                 Calculates the number of characters in a string.</li>
<li>26                 less<sub>than</sub><sub>scalar</sub>    transform                               Determines if values are less than a given scalar.</li>
<li>27               less<sub>than</sub><sub>equal</sub><sub>to</sub>    transform         Determines if values in one list are less than or equal to another list.</li>
<li>28                 multiply<sub>boolean</sub>    transform                      Element-wise multiplication of two lists of boolean values.</li>
<li>29                             week    transform                                 Determines the week of the year from a datetime.</li>
<li>30     greater<sub>than</sub><sub>equal</sub><sub>to</sub><sub>scalar</sub>    transform                Determines if values are greater than or equal to a given scalar.</li>
<li>31                              and    transform                                           Element-wise logical AND of two lists.</li>
<li>32                 multiply<sub>numeric</sub>    transform                                        Element-wise multiplication of two lists.</li>
<li>33                           second    transform                                      Determines the seconds value of a datetime.</li>
<li>34                        not<sub>equal</sub>    transform                  Determines if values in one list are not equal to another list.</li>
<li>35                              day    transform                                 Determines the day of the month from a datetime.</li>
<li>36                          cum<sub>min</sub>    transform                                               Calculates the cumulative minimum.</li>
<li>37              greater<sub>than</sub><sub>scalar</sub>    transform                            Determines if values are greater than a given scalar.</li>
<li>38            modulo<sub>numeric</sub><sub>scalar</sub>    transform                       Return the modulo of each element in the list by a scalar.</li>
<li>39          subtract<sub>numeric</sub><sub>scalar</sub>    transform                                 Subtract a scalar from each element in the list.</li>
<li>40                         absolute    transform                                         Computes the absolute value of a number.</li>
<li>41               add<sub>numeric</sub><sub>scalar</sub>    transform                                          Add a scalar to each value in the list.</li>
<li>42                        cum<sub>count</sub>    transform                                                 Calculates the cumulative count.</li>
<li>43                divide<sub>by</sub><sub>feature</sub>    transform                                       Divide a scalar by each value in the list.</li>
<li>44            divide<sub>numeric</sub><sub>scalar</sub>    transform                                     Divide each element in the list by a scalar.</li>
<li>45              time<sub>since</sub><sub>previous</sub>    transform                             Compute the time since the previous entry in a list.</li>
<li>46                        longitude    transform                      Returns the second tuple value in a list of LatLong tuples.</li>
<li>47                          cum<sub>max</sub>    transform                                               Calculates the cumulative maximum.</li>
<li>48                              not    transform                                                         Negates a boolean value.</li>
<li>49                 not<sub>equal</sub><sub>scalar</sub>    transform                  Determines if values in a list are not equal to a given scalar.</li>
<li>50                             diff    transform                       Compute the difference between the value in a list and the</li>
<li>51                     equal<sub>scalar</sub>    transform                      Determines if values in a list are equal to a given scalar.</li>
<li>52                        num<sub>words</sub>    transform               Determines the number of words in a string by counting the spaces.</li>
<li>53                   divide<sub>numeric</sub>    transform                                              Element-wise division of two lists.</li>
<li>54        less<sub>than</sub><sub>equal</sub><sub>to</sub><sub>scalar</sub>    transform                   Determines if values are less than or equal to a given scalar.</li>
<li>55                            month    transform                                        Determines the month value of a datetime.</li>
<li>56                               or    transform                                            Element-wise logical OR of two lists.</li>
<li>57                          weekday    transform                                  Determines the day of the week from a datetime.</li>
<li>58                        less<sub>than</sub>    transform                     Determines if values in one list are less than another list.</li>
<li>59                           minute    transform                                      Determines the minutes value of a datetime.</li>
<li>60          multiply<sub>numeric</sub><sub>scalar</sub>    transform                                   Multiply each element in the list by a scalar.</li>
<li>61            greater<sub>than</sub><sub>equal</sub><sub>to</sub>    transform      Determines if values in one list are greater than or equal to another list.</li>
<li>62                             hour    transform                                         Determines the hour value of a datetime.</li>
<li>63                modulo<sub>by</sub><sub>feature</sub>    transform                       Return the modulo of a scalar by each element in the list.</li>
<li>64  scalar<sub>subtract</sub><sub>numeric</sub><sub>feature</sub>    transform                             Subtract each value in the list from a given scalar.</li>
<li>65                       is<sub>weekend</sub>    transform                                         Determines if a date falls on a weekend.</li>
<li>66                     greater<sub>than</sub>    transform                  Determines if values in one list are greater than another list.</li>
<li>67                         cum<sub>mean</sub>    transform                                                  Calculates the cumulative mean.</li>
<li>68                   modulo<sub>numeric</sub>    transform                                                Element-wise modulo of two lists.</li>
<li>69                 subtract<sub>numeric</sub>    transform                                           Element-wise subtraction of two lists.</li>
<li>70                        haversine    transform                Calculates the approximate haversine distance between two LatLong</li>
<li>71                          is<sub>null</sub>    transform                                                   Determines if a value is null.</li>
<li>72                      add<sub>numeric</sub>    transform                                              Element-wise addition of two lists.</li>
<li>73                          cum<sub>sum</sub>    transform                                                   Calculates the cumulative sum.</li>
<li>74                       percentile    transform                         Determines the percentile rank for each value in a list.</li>
<li>75                       time<sub>since</sub>    transform                     Calculates time from a value to a specified cutoff datetime.</li>
<li>76                         latitude    transform                       Returns the first tuple value in a list of LatLong tuples.</li>
<li>77                           negate    transform                                                         Negates a numeric value.</li>
</ul>
</div>
</li>
</ol>
</div>

<div id="outline-container-org636664c" class="outline-4">
<h4 id="org636664c"><span class="section-number-4">58.1.7.</span> create primitive</h4>
<div class="outline-text-4" id="text-58-1-7">
<ul class="org-ul">
<li><a href="https://medium.com/@rrfd/simple-automatic-feature-engineering-using-featuretools-in-python-for-classification-b1308040e183">https://medium.com/@rrfd/simple-automatic-feature-engineering-using-featuretools-in-python-for-classification-b1308040e183</a></li>
</ul>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">from</span> featuretools.primitives <span style="color: #8ac6f2; font-weight: bold;">import</span> make_trans_primitive
<span style="color: #8ac6f2; font-weight: bold;">from</span> featuretools.variable_types <span style="color: #8ac6f2; font-weight: bold;">import</span> Numeric
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Create two new functions for our two new primitives</span>
<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">Log</span>(column):
    <span style="color: #8ac6f2; font-weight: bold;">return</span> np.log(column)
<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">Square_Root</span>(column):
    <span style="color: #8ac6f2; font-weight: bold;">return</span> np.sqrt(column)
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Create the primitives</span>
<span style="color: #cae682;">log_prim</span> = make_trans_primitive(
    function=Log, input_types=[Numeric], return_type=Numeric)
<span style="color: #cae682;">square_root_prim</span> = make_trans_primitive(
    function=Square_Root, input_types=[Numeric], return_type=Numeric)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgccf33db" class="outline-4">
<h4 id="orgccf33db"><span class="section-number-4">58.1.8.</span> EXAMPLE from pandas</h4>
<div class="outline-text-4" id="text-58-1-8">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #cae682;">es</span> = ft.EntitySet()
<span style="color: #cae682;">matches_df</span> = pd.read_csv(<span style="color: #95e454;">"./matches.csv"</span>)
es.entity_from_dataframe(entity_id=<span style="color: #95e454;">"matches"</span>,
                         index=<span style="color: #95e454;">"match_id"</span>,
                         time_index=<span style="color: #95e454;">"match_date"</span>,
                         dataframe=matches_df)

</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgba6e3cd" class="outline-3">
<h3 id="orgba6e3cd"><span class="section-number-3">58.2.</span> <span class="todo TODO">TODO</span> informationsfabirc</h3>
<div class="outline-text-3" id="text-58-2">
<ul class="org-ul">
<li><a href="https://www.informationsfabrik.com/">https://www.informationsfabrik.com/</a></li>
<li><a href="https://github.com/Informationsfabrik/feature-engineering-slides/blob/master/pydata2019_feature-engineering.pdf">https://github.com/Informationsfabrik/feature-engineering-slides/blob/master/pydata2019_feature-engineering.pdf</a></li>
</ul>
</div>
</div>
<div id="outline-container-org77d4cdb" class="outline-3">
<h3 id="org77d4cdb"><span class="section-number-3">58.3.</span> <span class="todo TODO">TODO</span> TPOT</h3>
<div class="outline-text-3" id="text-58-3">
<ul class="org-ul">
<li><a href="https://epistasislab.github.io/tpot/">https://epistasislab.github.io/tpot/</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgb20cc1a" class="outline-3">
<h3 id="orgb20cc1a"><span class="section-number-3">58.4.</span> TSFRESH (time sequence)</h3>
<div class="outline-text-3" id="text-58-4">
<ul class="org-ul">
<li><a href="https://tsfresh.readthedocs.io/en/latest/">https://tsfresh.readthedocs.io/en/latest/</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgaaa38f9" class="outline-3">
<h3 id="orgaaa38f9"><span class="section-number-3">58.5.</span> ATgfe - new feature</h3>
<div class="outline-text-3" id="text-58-5">
<p>
<a href="https://github.com/ahmed-mohamed-sn/ATgfe">https://github.com/ahmed-mohamed-sn/ATgfe</a>
</p>
</div>
</div>
</div>
<div id="outline-container-org68787d8" class="outline-2">
<h2 id="org68787d8"><span class="section-number-2">59.</span> support libraries</h2>
<div class="outline-text-2" id="text-59">
<dl class="org-dl">
<dt>dask</dt><dd>scale numpy, pandas, scikit-learn, XGBoost</dd>
<dt>(no term)</dt><dd>tqdm - progress meter for loops: for i in tqdm(range(1000)):</dd>
<dt>(no term)</dt><dd>msgpack - binary serialization of JSON for example</dd>
<dt>(no term)</dt><dd>cloudpickle - serialize to "pickle" lambda and classes</dd>
<dt>(no term)</dt><dd>tornado - non-blocking network I/O</dd>
<dt>(no term)</dt><dd>BeautifulSoup - extract data for web html pages</dd>
</dl>
</div>
</div>
<div id="outline-container-orgb3b84a0" class="outline-2">
<h2 id="orgb3b84a0"><span class="section-number-2">60.</span> Microsoft nni AutoML framework (stupid shut)</h2>
<div class="outline-text-2" id="text-60">
<ul class="org-ul">
<li><a href="https://github.com/microsoft/nni">https://github.com/microsoft/nni</a></li>
<li><a href="https://github.com/microsoft/nni/blob/master/docs/en_US/FeatureEngineering/Overview.md">https://github.com/microsoft/nni/blob/master/docs/en_US/FeatureEngineering/Overview.md</a></li>
</ul>
</div>
</div>

<div id="outline-container-org2b753f6" class="outline-2">
<h2 id="org2b753f6"><span class="section-number-2">61.</span> help</h2>
<div class="outline-text-2" id="text-61">
</div>
<div id="outline-container-org5ec0923" class="outline-3">
<h3 id="org5ec0923"><span class="section-number-3">61.1.</span> build-in help</h3>
<div class="outline-text-3" id="text-61-1">
<ol class="org-ol">
<li>help(L.append) - docstr and many things</li>
<li>dir() or dir(object) - list of all the globals and locals.</li>
<li>locals() variables, and their values (called inside method)</li>
<li>globals() method returns all the global variables, and their values, in a dictionary</li>
</ol>
</div>
</div>
</div>
<div id="outline-container-org45e013b" class="outline-2">
<h2 id="org45e013b"><span class="section-number-2">62.</span> IDE</h2>
<div class="outline-text-2" id="text-62">
<p>
By default, Python source files are treated as encoded in UTF-8 to change it:
</p>
<pre class="example">
#!/usr/bin/env python3
# - '*' - coding: cp1252 -*-
</pre>

<p>
<a href="https://en.wikipedia.org/wiki/Comparison_of_integrated_development_environments#Python">https://en.wikipedia.org/wiki/Comparison_of_integrated_development_environments#Python</a>
</p>
</div>
<div id="outline-container-org9079cfb" class="outline-3">
<h3 id="org9079cfb"><span class="section-number-3">62.1.</span> EPL</h3>
<div class="outline-text-3" id="text-62-1">
<p>
py.exe or python.exe file [arg]
</p>
<ul class="org-ul">
<li>Exit - Control-D on Unix, Control-Z on Windows.  - quit();</li>
<li>blank line; this is used to end a multi-line command.</li>
</ul>
</div>
</div>

<div id="outline-container-org585fcfe" class="outline-3">
<h3 id="org585fcfe"><span class="section-number-3">62.2.</span> PyDev is a Python IDE for Eclipse</h3>
<div class="outline-text-3" id="text-62-2">
<ul class="org-ul">
<li>Cltr+Space</li>
<li>F3 go to definition   Alt+Arrow &lt; &gt;</li>
<li>Shift+Enter - next line</li>
<li>Ctrl+1 assign paramenters to field, create class constructor</li>
<li>Ctrl+2/R  - rename varible</li>
<li>Alt+Shift+R rename verible</li>
<li>Alt+Shift+A Start/Stop Rectangular editing</li>
<li>Ctrl+F9 run test</li>
<li>Ctrl+F11 rerun last launch</li>
<li>Ctrl+Alt+Down/Up duplicate line</li>
<li>Alt+Shift+L Extract local varible</li>
<li>Alt+Shift+R Extract method</li>
</ul>

<p>
Firest
</p>
<ol class="org-ol">
<li>Create Project</li>
<li>Create new Source Folder - "src" <a href="http://www.pydev.org/manual_101_project_conf2.html">http://www.pydev.org/manual_101_project_conf2.html</a></li>
</ol>
</div>
<div id="outline-container-orgb4a5c04" class="outline-4">
<h4 id="orgb4a5c04"><span class="section-number-4">62.2.1.</span> features</h4>
<div class="outline-text-4" id="text-62-2-1">
<ul class="org-ul">
<li>Django integration</li>
<li>Code completion</li>
<li>Code completion with auto import</li>
<li>Type hinting</li>
<li>Code analysis</li>
<li>Go to definition</li>
<li>Refactoring</li>
<li>Debugger</li>
<li>Remote debugger</li>
<li>Find Referrers in Debugger</li>
<li>Tokens browser</li>
<li>Interactive console</li>
<li>Unittest integration</li>
<li>Code coverage</li>
<li>PyLint integration</li>
<li>Find References (Ctrl+Shift+G)</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org6d67735" class="outline-3">
<h3 id="org6d67735"><span class="section-number-3">62.3.</span> Emacs</h3>
<div class="outline-text-3" id="text-62-3">
<p>
M-~	menu
</p>
</div>

<div id="outline-container-org1d04a80" class="outline-4">
<h4 id="org1d04a80"><span class="section-number-4">62.3.1.</span> python in org mode</h4>
<div class="outline-text-4" id="text-62-3-1">
<p>
<a href="https://stackoverflow.com/questions/18598870/emacs-org-mode-executing-simple-python-code">https://stackoverflow.com/questions/18598870/emacs-org-mode-executing-simple-python-code</a>
</p>

<p>
C-c C-c - to activate
</p>

<div class="org-src-container">
<pre class="src src-python">1+1
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #e5786d;">print</span>(1+1)
</pre>
</div>
<p>
.emacs configuration:
</p>
<div class="org-src-container">
<pre class="src src-lisp"><span style="color: #fa8072;">;; </span><span style="color: #99968b; font-style: italic;">enable python for in-buffer evaluation</span>
(org-babel-do-load-languages
 'org-babel-load-languages
 '((python . t)))

<span style="color: #fa8072;">;; </span><span style="color: #99968b; font-style: italic;">all python code be safe</span>
(<span style="color: #8ac6f2; font-weight: bold;">defun</span> <span style="color: #cae682; font-weight: bold;">my-org-confirm-babel-evaluate</span> (lang body)
(not (string= lang <span style="color: #95e454;">"python"</span>)))
(setq org-confirm-babel-evaluate 'my-org-confirm-babel-evaluate)

<span style="color: #fa8072;">;; </span><span style="color: #99968b; font-style: italic;">required</span>
(setq shell-command-switch <span style="color: #95e454;">"-ic"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org58b80aa" class="outline-4">
<h4 id="org58b80aa"><span class="section-number-4">62.3.2.</span> Emacs</h4>
<div class="outline-text-4" id="text-62-3-2">
<p>
<a href="https://habr.com/ru/post/303600/">https://habr.com/ru/post/303600/</a>
</p>
<ul class="org-ul">
<li><a href="https://crafting.be/2015/06/emacs-python-django-dev/">https://crafting.be/2015/06/emacs-python-django-dev/</a></li>
</ul>

<p>
.emacs.d/lisp
</p>

<ul class="org-ul">
<li><b>Company</b> is a text completion framework for Emacs <a href="http://company-mode.github.io/">http://company-mode.github.io/</a></li>
<li><b>Jedi</b> Python auto-completion package <a href="http://tkf.github.io/emacs-jedi/latest/">http://tkf.github.io/emacs-jedi/latest/</a></li>
<li><b>Elpy</b> Emacs Python Development Environment <a href="https://github.com/jorgenschaefer/elpy">https://github.com/jorgenschaefer/elpy</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-lisp">
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2893e3a" class="outline-3">
<h3 id="org2893e3a"><span class="section-number-3">62.4.</span> PyCharm</h3>
<div class="outline-text-3" id="text-62-4">
</div>
<div id="outline-container-org0fc7371" class="outline-4">
<h4 id="org0fc7371"><span class="section-number-4">62.4.1.</span> installation:</h4>
<div class="outline-text-4" id="text-62-4-1">
<ul class="org-ul">
<li>Other settings -&gt; settings for new project -&gt; Tools -&gt; Python integrated tools -&gt; docstrings - reStructuredText</li>
<li>Ctrl+Alt+S -&gt; keymap - Emacs</li>
</ul>
<p>
navigate
</p>
<ul class="org-ul">
<li>Ctrl+Alt+S -&gt; keymap - up -&gt; Ctrl+k</li>
<li>Ctrl+Alt+S -&gt; keymap - left -&gt; Ctrl+l</li>
<li>Ctrl+Alt+S -&gt; keymap - move catet to previous word -&gt; Alt+l</li>
</ul>
<p>
other:
</p>
<ul class="org-ul">
<li>Ctrl+Alt+S -&gt; keymap - Error Description -&gt; add key Alt+Z</li>
<li>Ctrl+Alt+S -&gt; keymap - Navigate; Back -&gt; add key Ctrl+\</li>
<li>Ctrl+Alt+S -&gt; keymap - Select next tab -&gt; Alt+E</li>
<li>Ctrl+Alt+S -&gt; keymap - Select previous tab -&gt; Alt+A</li>
<li>Ctrl+Alt+S -&gt; keymap - Close tab -&gt; Ctrl+Alt+w</li>
<li>Ctrl+Alt+S -&gt; keymap - Backspace -&gt; Ctrl+h</li>
<li>Ctrl+Alt+S -&gt; keymap - Delete to word start -&gt; Alt+h</li>
<li>Ctrl+Alt+S -&gt; keymap - run/ -&gt; Ctrl+C Ctrl+C</li>
<li>Ctrl+Alt+S -&gt; keymap - back (Navigate) -&gt; Alt+,</li>
</ul>

<p>
Disable cursor blinking: Ctrl+Alt+s -&gt; Editor, General, Appearance
</p>
</div>
</div>
<div id="outline-container-org1d439c5" class="outline-4">
<h4 id="org1d439c5"><span class="section-number-4">62.4.2.</span> keys</h4>
<div class="outline-text-4" id="text-62-4-2">
<ul class="org-ul">
<li>Alt+\ - main menu</li>
<li>Alt+Shift+F10 - run</li>
<li>Alt+Shift+F8 - debug</li>

<li>Ctrl+Shift+U		to upper case</li>
<li>Ctrl+.		fold/unfold</li>
<li>Ctrl+q		get documentation</li>
<li>Ctrl+Alt+q		auto-indent lines</li>
<li>Ctrl+z/v		scroll</li>
<li>Alt+left/right	switch tabs</li>
<li>Ctrl+x k		close tab</li>
<li>Ctrl+x `		go to next error</li>
<li>Alt+.		go to declaration</li>
<li>Ctr+Shift+'		maximize bottom console</li>
</ul>

<p>
<b>emacs keymap</b>
</p>
<ul class="org-ul">
<li>Alt+Shift+F10 run</li>
<li>Alt+; - comment text</li>
<li>leftAlt+ arrows - tabs switch</li>
<li>leftAlt+Enter - at yello - variants to solve</li>
<li>Ctrl+Alt+L - Reformat code</li>
<li>Alt+Enter - at error - fix error menu</li>
<li>F10 - menu</li>
<li>Esc+Esc - focus Editor</li>
<li>F12 - focus last tool window(run)</li>
<li>Shift+Esc - hide low "Run"</li>
<li>Ctrl+ +/- - unfold/fold</li>
<li>Ctrl+m - Enter</li>
</ul>

<p>
<b>navigate</b> (Goto by reference actions)
</p>
<ul class="org-ul">
<li>Ctrl+Alt+g, Alt+. - navigate to definition</li>
<li>Alt+, - Navigate; Back (my)</li>
</ul>


<p>
<b>Windows</b>
</p>
<ul class="org-ul">
<li>Alt+1 - project navigation</li>
<li>Alt+2 - bookmars and debug points</li>
<li>Alt+4 - console</li>
<li>Alt+5 - debug</li>
<li>F11 - create</li>
<li>Ctrl-Shift+F8 - debug points</li>
<li>Shift-F11 bookmars</li>
<li>shift+Esc - hide current window</li>
<li>switch to main window - shift+Esc or F4 or Alt+current window or double Alt+any</li>
<li>C-x k - close current tab</li>
</ul>

<p>
<b>not emacs</b>
</p>
<ul class="org-ul">
<li>Ctrl+/ - comment text</li>
<li>Ctrl+b - navigate to definition</li>
</ul>
</div>
</div>
<div id="outline-container-orgf12b3bd" class="outline-4">
<h4 id="orgf12b3bd"><span class="section-number-4">62.4.3.</span> mirrored environment in remote Docker</h4>
<div class="outline-text-4" id="text-62-4-3">
<p>
see <a href="#orga4b940e">69.3</a> and <a href="git#MissingReference">git#MissingReference</a>
</p>

<p>
remote:
</p>
<ul class="org-ul">
<li>mkdir proj-ds.git</li>
<li>cd proj-ds.git</li>
<li>git init &#x2013;bare</li>
<li>cd ..</li>
<li>git clone &#x2013;local proj-ds.git</li>
<li>cd proj-ds</li>
<li>touch .gitignore</li>
<li>git commit -m "init"</li>
<li>git push</li>
</ul>
<p>
host:
</p>
<ul class="org-ul">
<li>sudo -u pych bash</li>
<li>git clone remotehost:/root/proj-ds.git /home/pych/PycharmProjects/proj-ds</li>
<li>Start PyCharm and configure venv in /home/pych/PycharmProjects/proj-ds
<ul class="org-ul">
<li>new project</li>
<li>virtualenv</li>
<li>venv/.gitignore: # *</li>
<li>venv -&gt; Git -&gt; Add</li>
<li>add Dockerfile:
<ul class="org-ul">
<li>FROM python:3.11 (as in venv)</li>
<li>WORKDIR /usr/src/app</li>
<li>COPY requirements.txt ./</li>
</ul></li>
<li>add requirements.txt: fastapi==0.111.0 parquet-tools==0.2.16 parquet==1.3.1 scikit-learn==1.4.2 pandas==2.2.2</li>
<li>commit</li>
<li>git push</li>
</ul></li>
</ul>
<p>
remote:
</p>
<ul class="org-ul">
<li>cd proj-ds</li>
<li>git pull</li>
<li>docker build -t ds .</li>
<li>docker run -v /root/proj-ds:/opt -it ds bash</li>
<li>cd /opt</li>
<li>see from 2) <a href="#orga4b940e">69.3</a></li>
<li>&#x2026;</li>
<li>source <i>opt</i>.venv/bin/activate</li>
<li><i>opt</i>.venv/bin/python -m pip install &#x2013;prefix=/opt/.venv &#x2013;no-cache-dir -r /opt/requirements.txt</li>
<li>exit</li>
<li>git add .</li>
<li>git commit -m "install req" ; git push</li>
</ul>

<p>
host:
</p>
<ul class="org-ul">
<li>add lines to Dockerfile:</li>
<li>COPY main.py ./</li>
<li># COPY venv /opt/venv</li>
<li># COPY .venv <i>opt</i>.venv</li>
<li>CMD . <i>opt</i>.venv/bin/activate &amp;&amp; exec python main.py</li>
<li>CMD <i>opt</i>.venv/bin/python <i>opt</i>.venv/bin/jupyter notebook &#x2013;ip 0.0.0.0 &#x2013;no-browser &#x2013;allow-root</li>
<li>docker run -v /root/proj-ds:/opt -p 127.0.0.1:8888:8888 -t ds</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orge1e6f91" class="outline-3">
<h3 id="orge1e6f91"><span class="section-number-3">62.5.</span> ipython</h3>
<div class="outline-text-3" id="text-62-5">
<ul class="org-ul">
<li>Ctrl+e Ctrl+o - multiline code or if 1:</li>
<li>Ctrl+r - search in history</li>
</ul>
</div>
</div>
<div id="outline-container-org3b6a0b9" class="outline-3">
<h3 id="org3b6a0b9"><span class="section-number-3">62.6.</span> geany</h3>
<div class="outline-text-3" id="text-62-6">
<p>
no autocompletion
</p>
</div>
</div>

<div id="outline-container-orgbeb4947" class="outline-3">
<h3 id="orgbeb4947"><span class="section-number-3">62.7.</span> BlueFish</h3>
<div class="outline-text-3" id="text-62-7">
<p>
Style - preferences-&gt;Editor settings-&gt;Fonts&amp;Colours-&gt;Use system wide color settings
</p>

<ul class="org-ul">
<li>S-C-c	comment</li>
<li>C-space	completion</li>
</ul>

<p>
to execute file:
</p>
<ul class="org-ul">
<li>preferences-&gt;external commands-&gt;
<ul class="org-ul">
<li>any name:  xfce4-terminal  -e 'bash -c "python %f; exec bash"'</li>
</ul></li>
</ul>

<p>
cons
</p>
<ul class="org-ul">
<li>cannot execute</li>
</ul>
</div>
</div>

<div id="outline-container-orgb9471fe" class="outline-3">
<h3 id="orgb9471fe"><span class="section-number-3">62.8.</span> Eric</h3>
<div class="outline-text-3" id="text-62-8">
<ul class="org-ul">
<li>echo "dev-python/PyQt5 network" &gt;&gt; /etc/portage/package.use/eric</li>
<li>emerge mercurial PyQt5 qscintilla-python dev-qt/qtcharts dev-qt/qtwebengine</li>
<li>cd /usr/local</li>
<li>hg clone <a href="https://hg.die-offenbachs.homelinux.org/eric">https://hg.die-offenbachs.homelinux.org/eric</a></li>
<li>or <a href="https://sourceforge.net/projects/eric-ide/files/latest/download">https://sourceforge.net/projects/eric-ide/files/latest/download</a></li>
<li>select branch
<ul class="org-ul">
<li>hg up eric7-maintenance (PyQt6)</li>
<li>hg up eric6 (PyQt5)</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org98e7f8e" class="outline-3">
<h3 id="org98e7f8e"><span class="section-number-3">62.9.</span> Google Colab</h3>
<div class="outline-text-3" id="text-62-9">
</div>
<div id="outline-container-orgc085f71" class="outline-4">
<h4 id="orgc085f71"><span class="section-number-4">62.9.1.</span> <span class="todo TODO">TODO</span> todo</h4>
<div class="outline-text-4" id="text-62-9-1">
<p>
Overfitting
Look-ahead Bias
P-hacking
</p>

<p>
<a href="https://course.algotrading101.com/courses/pt101-practical-python-for-finance-trading-masterclass/lectures/27360454">https://course.algotrading101.com/courses/pt101-practical-python-for-finance-trading-masterclass/lectures/27360454</a>
</p>

<p>
<a href="https://colab.research.google.com/signup/pricing">https://colab.research.google.com/signup/pricing</a>
</p>
</div>
</div>
<div id="outline-container-org480bac8" class="outline-4">
<h4 id="org480bac8"><span class="section-number-4">62.9.2.</span> initial config</h4>
<div class="outline-text-4" id="text-62-9-2">
<ul class="org-ul">
<li>Runtime -&gt; View resources -&gt; Change runtime tupe - GPU</li>
<li>Editor -&gt; Code diagnostics -&gt; Syntax and type checking</li>
<li>Miscellaneous -&gt; Power level - ?</li>
</ul>
</div>
</div>

<div id="outline-container-org24fcbd1" class="outline-4">
<h4 id="org24fcbd1"><span class="section-number-4">62.9.3.</span> keys (checked):</h4>
<div class="outline-text-4" id="text-62-9-3">
<ul class="org-ul">
<li>Ctrl-a/e 	Move cursor to the beginning/end of the line</li>
<li>Ctrl-Alt-n/p Move cursor to the beginning of the line</li>
<li>Ctrl-d/h 	Delete next/previous character in line</li>
<li>Ctrl-k 	Delete text from cursor to end of line</li>
<li>Ctrl-space	auto completion</li>
<li>Ctrl+o	new line and stay at current</li>
<li>Ctrl+j	delete and of the line character and set cursor at the end</li>
<li>Ctrl+m m/y	convert (code to text)/(text to code)</li>
<li>Ctrl+z/y	undo/redo action</li>
</ul>

<p>
Docstring:
</p>
<ul class="org-ul">
<li>Ctrl + mouse over variable</li>
<li>Ctrl + space + mouse click</li>
</ul>


<p>
keys advanced (checked)
</p>
<ul class="org-ul">
<li>Ctrl+s		save notebook</li>
<li>Ctrl+m		activate the shortcuts</li>
<li>Ctrl+m h		get Keyboard preferences</li>
<li>Tab			Toggle code docstring help</li>
<li>Shift+Tab		Unindent current line</li>
<li>Ctrl+m n/p		next/preview cell (like arrows)</li>
<li>Ctrl+]		Collapse</li>
<li>Ctrl+'		toggle collapse</li>
<li>Ctrl+Shift+Enter	Run</li>
<li>Ctrl+Shift+S		select focused cell</li>
<li>Ctrl+m o		show hide output</li>
<li>Ctrl+m a/b		add cell above/below</li>
<li>ctrl+m+d	Delete cell</li>
<li>Ctrl+shift+alt+p	command palette</li>
</ul>
</div>
</div>
<div id="outline-container-org303a988" class="outline-4">
<h4 id="org303a988"><span class="section-number-4">62.9.4.</span> keys in Internet (emacs IPython console)</h4>
<div class="outline-text-4" id="text-62-9-4">
<p>
Ctrl-C and Ctrl-V) for copying and pasting in a wide variety of programs and systems
</p>

<ul class="org-ul">
<li>Ctrl-a 	Move cursor to the beginning of the line</li>
<li>Ctrl-e 	Move cursor to the end of the line</li>
<li>Ctrl-b or the left arrow key 	Move cursor back one character</li>
<li>Ctrl-f or the right arrow key 	Move cursor forward one character</li>

<li>Backspace key 	Delete previous character in line</li>
<li>Ctrl-d 	Delete next character in line</li>
<li>Ctrl-k 	Cut text from cursor to end of line</li>
<li>Ctrl-u 	Cut text from beginning of line to cursor</li>
<li>Ctrl-y 	Yank (i.e. paste) text that was previously cut</li>
<li>Ctrl-t 	Transpose (i.e., switch) previous two characters</li>

<li>Ctrl-p (or the up arrow key) 	Access previous command in history</li>
<li>Ctrl-n (or the down arrow key) 	Access next command in history</li>
<li>Ctrl-r 	Reverse-search through command history</li>
</ul>

<p>
?
</p>
<ul class="org-ul">
<li>Ctrl-l 	Clear terminal screen</li>
<li>Ctrl-c 	Interrupt current Python command</li>
<li>Ctrl-d 	Exit IPython session</li>
</ul>
</div>
</div>
<div id="outline-container-org40afdc7" class="outline-4">
<h4 id="org40afdc7"><span class="section-number-4">62.9.5.</span> Google Colab Magics</h4>
<div class="outline-text-4" id="text-62-9-5">
<p>
set of system commands that can be seen as a mini extensive command language
</p>
<ul class="org-ul">
<li>line magics start with %, while the cell magics start with %%</li>
<li>%lsmagic - full list of available magics</li>
<li>%ldir</li>
<li>%%html</li>
</ul>

<p>
more <a href="https://colab.research.google.com/notebooks/intro.ipynb">https://colab.research.google.com/notebooks/intro.ipynb</a>
</p>
</div>
</div>
<div id="outline-container-orgfcccd3e" class="outline-4">
<h4 id="orgfcccd3e"><span class="section-number-4">62.9.6.</span> install libraries and system commands</h4>
<div class="outline-text-4" id="text-62-9-6">
<ul class="org-ul">
<li>!pip install or !apt-get install
<ul class="org-ul">
<li>!apt-get -qq install -y libfluidsynth1</li>
</ul></li>

<li>!wget</li>
<li>!git clone <a href="https://github.com/wxs/keras-mnist-tutorial.gi">https://github.com/wxs/keras-mnist-tutorial.gi</a></li>
<li>!ls /bin</li>
</ul>
</div>
</div>
<div id="outline-container-org4c53afb" class="outline-4">
<h4 id="org4c53afb"><span class="section-number-4">62.9.7.</span> execute code from google drive</h4>
<div class="outline-text-4" id="text-62-9-7">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Run this cell to mount your Google Drive.</span>
<span style="color: #8ac6f2; font-weight: bold;">from</span> google.colab <span style="color: #8ac6f2; font-weight: bold;">import</span> drive
drive.mount(<span style="color: #95e454;">'/content/drive'</span>)

!python3 <span style="color: #95e454;">"/content/drive/My Drive/Colab Notebooks/hello.py"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb41596d" class="outline-4">
<h4 id="orgb41596d"><span class="section-number-4">62.9.8.</span> shell</h4>
<div class="outline-text-4" id="text-62-9-8">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">from</span> IPython.display <span style="color: #8ac6f2; font-weight: bold;">import</span> JSON
<span style="color: #8ac6f2; font-weight: bold;">from</span> google.colab <span style="color: #8ac6f2; font-weight: bold;">import</span> output
<span style="color: #8ac6f2; font-weight: bold;">from</span> subprocess <span style="color: #8ac6f2; font-weight: bold;">import</span> getoutput
<span style="color: #8ac6f2; font-weight: bold;">import</span> os

<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">shell</span>(command):
  <span style="color: #8ac6f2; font-weight: bold;">if</span> command.startswith(<span style="color: #95e454;">'cd'</span>):
      <span style="color: #cae682;">path</span> = command.strip().split(maxsplit=1)[1]
      os.chdir(path)
      <span style="color: #8ac6f2; font-weight: bold;">return</span> JSON([<span style="color: #95e454;">''</span>])
  <span style="color: #8ac6f2; font-weight: bold;">return</span> JSON([getoutput(command)])
output.register_callback(<span style="color: #95e454;">'shell'</span>, shell)
</pre>
</div>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">@title Colab Shell</span>
%%html
&lt;div <span style="color: #e5786d;">id</span>=term_demo&gt;&lt;/div&gt;
&lt;script <span style="color: #cae682;">src</span>=<span style="color: #95e454;">"https://code.jquery.com/jquery-latest.js"</span>&gt;&lt;/script&gt;
&lt;script <span style="color: #cae682;">src</span>=<span style="color: #95e454;">"https://cdn.jsdelivr.net/npm/jquery.terminal/js/jquery.terminal.min.js"</span>&gt;&lt;/script&gt;
&lt;link <span style="color: #cae682;">href</span>=<span style="color: #95e454;">"https://cdn.jsdelivr.net/npm/jquery.terminal/css/jquery.terminal.min.css"</span> <span style="color: #cae682;">rel</span>=<span style="color: #95e454;">"stylesheet"</span>/&gt;
&lt;script&gt;
  $(<span style="color: #95e454;">'#term_demo'</span>).terminal(async function(command) {
      <span style="color: #8ac6f2; font-weight: bold;">if</span> (command !== <span style="color: #95e454;">''</span>) {
          <span style="color: #8ac6f2; font-weight: bold;">try</span> {
              let res = <span style="color: #8ac6f2; font-weight: bold;">await</span> google.colab.kernel.invokeFunction(<span style="color: #95e454;">'shell'</span>, [command])
              let out = res.data[<span style="color: #95e454;">'application/json'</span>][0]
              this.echo(new String(out))
          } catch(e) {
              this.error(new String(e));
          }
      } <span style="color: #8ac6f2; font-weight: bold;">else</span> {
          this.echo(<span style="color: #95e454;">''</span>);
      }
  }, {
      greetings: <span style="color: #95e454;">'Welcome to Colab Shell'</span>,
      name: <span style="color: #95e454;">'colab_demo'</span>,
      height: 250,
      prompt: <span style="color: #95e454;">'colab &gt; '</span>
  });
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc365f05" class="outline-4">
<h4 id="orgc365f05"><span class="section-number-4">62.9.9.</span> gcloud</h4>
<div class="outline-text-4" id="text-62-9-9">
<ul class="org-ul">
<li>gcloud info - current environment</li>
</ul>

<p>
import torch
print(torch.cuda.get<sub>device</sub><sub>name</sub>())
</p>

<p>
LD<sub>LIBRARY</sub><sub>PATH</sub>=/usr/lib64-nvidia watch -n 1 nvidia-smi
</p>

<p>
!gcloud auth login # Authorize gcloud to access the Cloud Platform with Google user credentials.
</p>

<p>
connect Google Colab to Google Cloud.
</p>
<pre class="example">
!gcloud compute ssh --zone us-central1-a 'instance-name' -- -L 8888:localhost:8888
</pre>
</div>
</div>

<div id="outline-container-org6ad4390" class="outline-4">
<h4 id="org6ad4390"><span class="section-number-4">62.9.10.</span> gcloud ssh (require billing)</h4>
<div class="outline-text-4" id="text-62-9-10">
<pre class="example">
bad: !gcloud config set account account@gmail
</pre>


<pre class="example">
!gcloud auth login
!gcloud projects create vfdsgq2345 --enable-cloud-apis --name vfdsgq2345 --set-as-default
</pre>


<p>
Create in progress for [<a href="https://cloudresourcemanager.googleapis.com/v1/projects/vfdsgq2346">https://cloudresourcemanager.googleapis.com/v1/projects/vfdsgq2346</a>].
Enabling service [cloudapis.googleapis.com] on project [vfdsgq2346]&#x2026;
Operation "operations/acat.p2-872588642643-8ef11211-5181-47e3-bcd2-383690de7d91" finished successfully.
Updated property [core/project] to [vfdsgq2346].
</p>

<pre class="example">
!gcloud config set project 1
!gcloud compute ssh
</pre>

<p>
gcloud compute ssh example-instance &#x2013;zone=us-central1-a &#x2013; -vvv -L 80:%INSTANCE%:80
</p>

<p>
!gcloud compute ssh 10.2.3.4:22 &#x2013;zone=us-central1-a &#x2013; -vvv -L 80:localhost:80
</p>
</div>
</div>
<div id="outline-container-orgda52f29" class="outline-4">
<h4 id="orgda52f29"><span class="section-number-4">62.9.11.</span> api</h4>
<div class="outline-text-4" id="text-62-9-11">
<ul class="org-ul">
<li><a href="https://github.com/googlecolab">https://github.com/googlecolab</a></li>
<li><a href="https://cloud.google.com/sdk/docs/install">https://cloud.google.com/sdk/docs/install</a></li>
<li>binary gcloud</li>
</ul>
</div>
</div>
<div id="outline-container-org5fa66e7" class="outline-4">
<h4 id="org5fa66e7"><span class="section-number-4">62.9.12.</span> upload and download files</h4>
<div class="outline-text-4" id="text-62-9-12">
<pre class="example">
from google.colab import files
files.upload/download()
</pre>
</div>
</div>
<div id="outline-container-org0263dc5" class="outline-4">
<h4 id="org0263dc5"><span class="section-number-4">62.9.13.</span> connect ssh (restricted)</h4>
<div class="outline-text-4" id="text-62-9-13">
<p>
<a href="https://medium.com/@ayaka_45434/connect-to-google-colab-using-ssh-bb342e0d0fd2">https://medium.com/@ayaka_45434/connect-to-google-colab-using-ssh-bb342e0d0fd2</a>
</p>

<p>
at relay server:
</p>
<ul class="org-ul">
<li>$ ssh-keygen -t ed25519 -a 256</li>
<li>$ cat .ssh/id<sub>ed25519.pub</sub></li>
</ul>

<p>
at colab:
</p>
<div class="org-src-container">
<pre class="src src-python">%%sh
mkdir -p ~/.ssh
echo <span style="color: #95e454;">'&lt;SSH public key of PC&gt;'</span> &gt;&gt; ~/.ssh/authorized_keys
apt update &gt; /dev/null
yes | unminimize &gt; /dev/null
apt install -qq -<span style="color: #cae682;">o</span>=Dpkg::Use-<span style="color: #cae682;">Pty</span>=0 openssh-server pwgen net-tools psmisc pciutils htop neofetch zsh nano byobu &gt; /dev/null
ssh-keygen -t rsa -N <span style="color: #95e454;">""</span> -f ~/.ssh/id_rsa &gt; /dev/null
echo ListenAddress 127.0.0.1 &gt;&gt; /etc/ssh/sshd_config
mkdir -p /var/run/sshd
/usr/sbin/sshd
</pre>
</div>
</div>
</div>
<div id="outline-container-orga09014e" class="outline-4">
<h4 id="orga09014e"><span class="section-number-4">62.9.14.</span> connect ssh (unrestricted)</h4>
<div class="outline-text-4" id="text-62-9-14">
<p>
at colab:
</p>
<ol class="org-ol">
<li>!git clone <a href="https://github.com/WassimBenzarti/colab-ssh">https://github.com/WassimBenzarti/colab-ssh</a> ; mv colab-ssh cs ; cd cs ; rm -r .git</li>
</ol>
<p>
!git clone &#x2013;depth=1 <a href="https://github.com/openssh/openssh-portable">https://github.com/openssh/openssh-portable</a> ; mv openssh-portable cs ; cd cs ; rm -r .git ; autoreconf &amp;&amp; ./configure &amp;&amp; make &amp;&amp; make install ; mv /usr/local/sbin/sshd /usr/local/sbin/aav
</p>



<p>
%%shell
a=$(cat &lt;&lt;EOF
AcceptEnv LANG LC<sub>ALL</sub> LC<sub>COLLATE</sub> LC<sub>CTYPE</sub> LC<sub>MESSAGES</sub> LC<sub>MONETARY</sub> LC<sub>NUMERIC</sub> LC<sub>TIME</sub> LANGUAGE LC<sub>ADDRESS</sub> LC<sub>IDENTIFICATION</sub> LC<sub>MEASUREMENT</sub> LC<sub>NAME</sub> LC<sub>PAPER</sub> LC<sub>TELEPHONE</sub>
AcceptEnv COLORTERM
</p>

<p>
Port 9090
ListenAddress 127.0.0.1
AllowUsers u
</p>

<p>
PermitRootLogin no
PubkeyAuthentication yes
PasswordAuthentication no
PermitEmptyPasswords no
KbdInteractiveAuthentication no
EOF
)
echo "$a" &gt; aav.conf ; useradd -m sshd ; ls
</p>

<p>
!mkdir <i>root</i>.ssh ; chmod  0700 <i>root</i>.ssh ; mv cs/ssh aavc ; ./cs/ssh-keygen -b 4096 -t rsa -f <i>root</i>.ssh/mykey<sub>rsa</sub> -q -N "" ; cat <i>root</i>.ssh/mykey<sub>rsa.pub</sub> &gt; <i>root</i>.ssh/authorized<sub>keys</sub>
</p>

<p>
!exec /usr/local/sbin/aav -f aav.conf
</p>

<p>
!cat <i>root</i>.ssh/mykey<sub>rsa.pub</sub> &gt; <i>root</i>.ssh/authorized<sub>keys</sub>
</p>

<p>
!./aavc -vvv -p 9090 localhost
</p>
</div>
</div>

<div id="outline-container-orgcff84d9" class="outline-4">
<h4 id="orgcff84d9"><span class="section-number-4">62.9.15.</span> Restrictions</h4>
<div class="outline-text-4" id="text-62-9-15">
<p>
disallowed from Colab runtimes:
</p>
<ul class="org-ul">
<li>file hosting, media serving, or other web service offerings not related to interactive compute with Colab</li>
<li>downloading torrents or engaging in peer-to-peer file-sharing</li>
<li>using a remote desktop or SSH</li>
<li>connecting to remote proxies</li>
<li>mining cryptocurrency</li>
<li>running denial-of-service attacks</li>
<li>password cracking</li>
<li>using multiple accounts to work around access or resource usage restrictions</li>
<li>creating deepfakes</li>
</ul>
</div>
</div>
<div id="outline-container-orgb2cdd6d" class="outline-4">
<h4 id="orgb2cdd6d"><span class="section-number-4">62.9.16.</span> cons</h4>
<div class="outline-text-4" id="text-62-9-16">
<ul class="org-ul">
<li>GPU/TPU usage is limited</li>
<li>Not the most powerful GPU/TPU setups available</li>
<li>Not the best de-bugging environment</li>
<li>It is hard to work with big data</li>
<li>Have to re-install extra dependencies every new runtime</li>
<li>Google drive: limited to 15 GB of free space with a Gmail id.</li>
<li>you’ll have to (re)install any additional libraries you want to use every time you (re)connect to a Google
Colab notebook.</li>
</ul>

<p>
Alternatives:
</p>
<ul class="org-ul">
<li>Kaggle</li>
<li>Azure Notebooks</li>
<li>Amazon SageMaker</li>
<li>Paperspace Gradient</li>
<li>FloydHub</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org259c6d3" class="outline-3">
<h3 id="org259c6d3"><span class="section-number-3">62.10.</span> Eclipse Theia (IDE)</h3>
<div class="outline-text-3" id="text-62-10">
<p>
<a href="https://theia-ide.org/docs/">https://theia-ide.org/docs/</a>
</p>

<p>
based on  (TypeScript, HTML and CSS) - can run as desktop applications or in the browser.
</p>
<ul class="org-ul">
<li>consist of client (the UI) and a server</li>
</ul>

<p>
features:
</p>
<ul class="org-ul">
<li>Eclipse Theia and its extensions are node.js packages.
<ul class="org-ul">
<li>Installation from Yarn package manager: <a href="https://theia-ide.org/docs/composing_applications">https://theia-ide.org/docs/composing_applications</a></li>
</ul></li>
<li><a href="https://smartface.io/">https://smartface.io/</a> - IDE to develop native iOS/Android mobile applications with a single JavaScript/TypeScript codebase.</li>
<li>Monaco code editor of VS Code and makes strong use of the language server protocol (LSP)</li>
<li>can customize almost everything within Theia and even replace core features
<ul class="org-ul">
<li><a href="https://eclipsesource.com/blogs/2019/11/21/how-to-create-develop-an-eclipse-theia-ide-extension/">https://eclipsesource.com/blogs/2019/11/21/how-to-create-develop-an-eclipse-theia-ide-extension/</a></li>
<li>injections <a href="https://eclipsesource.com/blogs/2018/11/28/how-to-inversify-in-eclipse-theia/">https://eclipsesource.com/blogs/2018/11/28/how-to-inversify-in-eclipse-theia/</a></li>
</ul></li>
<li>Active community and vendor-neutrality</li>
<li>Compatible with Visual Studio Code extensions</li>
<li>License GPLv2 with the classpath exception.</li>
</ul>
</div>
</div>
<div id="outline-container-orgfb34258" class="outline-3">
<h3 id="orgfb34258"><span class="section-number-3">62.11.</span> Atom</h3>
<div class="outline-text-3" id="text-62-11">
<ul class="org-ul">
<li>Written: CoffeeScript, JavaScript, Less, HTML</li>
<li>MIT License</li>
<li>last release: 2022</li>
<li>fork: Pulsar</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orge61535e" class="outline-2">
<h2 id="orge61535e"><span class="section-number-2">63.</span> Jupyter Notebook</h2>
<div class="outline-text-2" id="text-63">
<p>
<a href="https://jupyter-notebook.readthedocs.io/en/stable/examples/Notebook/Importing">https://jupyter-notebook.readthedocs.io/en/stable/examples/Notebook/Importing</a> Notebooks.html
<b>.ipynb</b>
</p>

<p>
у каждой cell желательно обеспечить идемпотентность
</p>
</div>

<div id="outline-container-org9ef089b" class="outline-3">
<h3 id="org9ef089b"><span class="section-number-3">63.1.</span> jupyter [ˈʤuːpɪtə] - акцентом на интерактивности производимых вычислений</h3>
<div class="outline-text-3" id="text-63-1">
<ul class="org-ul">
<li><a href="https://jupyter.org/">https://jupyter.org/</a></li>
<li>Идея - не рисовать, а отбирать работающие правила</li>
<li>many languages <a href="https://github.com/jupyter/jupyter/wiki/Jupyter-kernels">https://github.com/jupyter/jupyter/wiki/Jupyter-kernels</a></li>
<li>Project Jupyter - nonprofit organization, interactive computing across dozens of programming languages.
Free for all to use and released under the liberal terms of the modified BSD license
<ul class="org-ul">
<li>Jupyter Notebook -web-based - .ipynb - Jupyter Notebook is MathJax-aware (subset of Tex and LaTeX.)</li>
<li>Jupyter Hub</li>
<li>Jupyter Lab - interfaces for all products under the Jupyter ecosystem, редактирование изображений, CSV,
JSON, Markdown, PDF, Vega, Vega-Lite</li>
<li>next-generation version of Jupyter Notebook</li>
<li>Jupyter Console</li>
<li>Qt Console</li>
</ul></li>
</ul>

<p>
<b>kernels:</b> jupyter kernelspec list
</p>

<pre class="example">
%run -n main.py  - import module
</pre>
</div>
</div>
<div id="outline-container-org8d471ba" class="outline-3">
<h3 id="org8d471ba"><span class="section-number-3">63.2.</span> install</h3>
<div class="outline-text-3" id="text-63-2">
<pre class="example">
useradd --create-home --shell=/bin/bash jup
sudo -u jup bash
cd
python3 -m pip install --upgrade pip --user
python3 -m pip install notebook --user
</pre>


<pre class="example">
pip3 install nbconvert --user
</pre>


<p>
Launch with:
</p>
<pre class="example">
sudo -u jup bash ; cd
cd; .local/bin/jupyter notebook --no-browser --IdentityProvider.token=''
</pre>
</div>
</div>
<div id="outline-container-org94ba71f" class="outline-3">
<h3 id="org94ba71f"><span class="section-number-3">63.3.</span> convert <b>to htmp</b></h3>
<div class="outline-text-3" id="text-63-3">
<pre class="example">
ipython nbconvert /home/u2/tmp/Lecture_10_decision_trees.ipynb
</pre>
</div>
</div>

<div id="outline-container-orgc9780a4" class="outline-3">
<h3 id="orgc9780a4"><span class="section-number-3">63.4.</span> Widgets</h3>
<div class="outline-text-3" id="text-63-4">
</div>
<div id="outline-container-orgd6fcee0" class="outline-4">
<h4 id="orgd6fcee0"><span class="section-number-4">63.4.1.</span> install</h4>
<div class="outline-text-4" id="text-63-4-1">
<ul class="org-ul">
<li>list <a href="https://ipywidgets.readthedocs.io/en/stable/examples/Widget%20List.html">https://ipywidgets.readthedocs.io/en/stable/examples/Widget%20List.html</a></li>
</ul>

<p>
run
</p>
<ul class="org-ul">
<li>pip install ipywidgets &#x2013;user</li>
<li>jupyter nbextension enable &#x2013;py widgetsnbextension</li>
</ul>
</div>
</div>

<div id="outline-container-orgb1410d9" class="outline-4">
<h4 id="orgb1410d9"><span class="section-number-4">63.4.2.</span> usage</h4>
<div class="outline-text-4" id="text-63-4-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">from</span> ipywidgets <span style="color: #8ac6f2; font-weight: bold;">import</span> interact, interactive, fixed, interact_manual
<span style="color: #8ac6f2; font-weight: bold;">import</span> ipywidgets <span style="color: #8ac6f2; font-weight: bold;">as</span> widgets

<span style="color: #cae682;">date_w</span> = widgets.DatePicker(
    description=<span style="color: #95e454;">'Pick a Date'</span>,
    disabled=<span style="color: #e5786d; font-weight: bold;">False</span>
)

<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">f</span>(x):
    <span style="color: #8ac6f2; font-weight: bold;">return</span> x

interact(f, x=date_w) <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">x - name of f(x) parameter and *type of widget*</span>
interact(f, x=10); <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">int slider (abbrev)</span>
interact(f, x=<span style="color: #e5786d; font-weight: bold;">True</span>); <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">bool flag (abbrev)</span>

interact(h, p=5, q=fixed(20)); <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">q parameter is fixed</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org046239d" class="outline-4">
<h4 id="org046239d"><span class="section-number-4">63.4.3.</span> widget abbreviation</h4>
<div class="outline-text-4" id="text-63-4-3">
<dl class="org-dl">
<dt>Checkbox</dt><dd>True or False</dd>
<dt>Text</dt><dd>'Hi there'</dd>
<dt>IntSlider</dt><dd>value or (min,max) or (min,max,step) if integers are passed</dd>
<dt>FloatSlider</dt><dd>value or (min,max) or (min,max,step) if floats are passed</dd>
<dt>Dropdown</dt><dd>['orange','apple'] or `[(‘one’, 1), (‘two’, 2)]</dd>
</dl>
</div>
</div>
<div id="outline-container-org997da3b" class="outline-4">
<h4 id="org997da3b"><span class="section-number-4">63.4.4.</span> widget return type</h4>
<div class="outline-text-4" id="text-63-4-4">
<dl class="org-dl">
<dt>widgets.DatePicker</dt><dd>datetime.date</dd>
</dl>
</div>
</div>
<div id="outline-container-org789870c" class="outline-4">
<h4 id="org789870c"><span class="section-number-4">63.4.5.</span> Styling</h4>
<div class="outline-text-4" id="text-63-4-5">
<p>
<a href="https://ipywidgets.readthedocs.io/en/latest/examples/Widget%20Styling.html">https://ipywidgets.readthedocs.io/en/latest/examples/Widget%20Styling.html</a>
</p>

<p>
<b>Description</b>
</p>
<ul class="org-ul">
<li>style = {'description<sub>width</sub>': 'initial'}</li>
<li>IntSlider(description='A too long description', style=style)</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orge7ca9e4" class="outline-3">
<h3 id="orge7ca9e4"><span class="section-number-3">63.5.</span> Hotkeys:</h3>
<div class="outline-text-3" id="text-63-5">
<ul class="org-ul">
<li>Enter - in cell</li>
<li>Escepe - exit cell</li>
<li>h - hotkeys</li>
<li>Ctrl+Enter/Shift+Enter - run</li>
<li>Tab - code completion</li>
<li>arrow up/down - above/below cell</li>
</ul>
</div>
</div>
<div id="outline-container-org4750dc6" class="outline-3">
<h3 id="org4750dc6"><span class="section-number-3">63.6.</span> emacs (sucks)</h3>
<div class="outline-text-3" id="text-63-6">
<p>
org-mode may evaluate code blocks using a Jupyter kernel
<a href="https://github.com/gregsexton/ob-ipython">https://github.com/gregsexton/ob-ipython</a>
</p>

<p>
jupyter<sub>console</sub>, jupyter<sub>client</sub>
</p>
</div>
</div>
<div id="outline-container-org55c9dec" class="outline-3">
<h3 id="org55c9dec"><span class="section-number-3">63.7.</span> in Docker</h3>
<div class="outline-text-3" id="text-63-7">
<p>
types <a href="https://docs.jupyter.org/en/latest/install.html">https://docs.jupyter.org/en/latest/install.html</a>
</p>

<pre class="example">
pip install  notebook==7.2.0
</pre>

<p>
jupyter<sub>core</sub>==5.7.2
inside:
</p>
<pre class="example">
python .venv/bin/jupyter notebook --ip 0.0.0.0 --allow-root
</pre>

<p>
outside:
</p>
<pre class="example">
docker run -p 127.0.0.1:8888:8888 -it image
</pre>

<p>
remote:
</p>
<pre class="example">
ssh -L localhost:8888:localhost:8888
</pre>
</div>
</div>
<div id="outline-container-orgc986c35" class="outline-3">
<h3 id="orgc986c35"><span class="section-number-3">63.8.</span> other</h3>
<div class="outline-text-3" id="text-63-8">
<ul class="org-ul">
<li><a href="https://proglib.io/p/analysis-hacks/">https://proglib.io/p/analysis-hacks/</a></li>
</ul>
</div>
</div>

<div id="outline-container-org953b6eb" class="outline-3">
<h3 id="org953b6eb"><span class="section-number-3">63.9.</span> lab</h3>
<div class="outline-text-3" id="text-63-9">
</div>
<div id="outline-container-orgaa00a77" class="outline-4">
<h4 id="orgaa00a77"><span class="section-number-4">63.9.1.</span> in venv</h4>
<div class="outline-text-4" id="text-63-9-1">
<p>
python -m pip install &#x2013;prefix=/opt/venv &#x2013;isolated -v 'jupyterlab==4.2.1'
</p>
<div class="org-src-container">
<pre class="src src-sh">FROM python:3.10
CMD [<span style="color: #95e454;">"jupyter"</span>, <span style="color: #95e454;">"lab"</span>, <span style="color: #95e454;">"--allow-root"</span>, <span style="color: #95e454;">"--ip=0.0.0.0"</span>]
</pre>
</div>

<p>
to check installation:
</p>
<pre class="example">
ipython3 -c 'import tokrch'
</pre>


<p>
docker run -v /dev/shm/vit:/opt -p 8888:8888 -t pavl &gt; /var/log/d1.log &amp;
</p>
</div>
</div>

<div id="outline-container-orgb703e14" class="outline-4">
<h4 id="orgb703e14"><span class="section-number-4">63.9.2.</span> Will not respect mounted venv:</h4>
<div class="outline-text-4" id="text-63-9-2">
<div class="org-src-container">
<pre class="src src-sh">FROM python:3.10
RUN pip install --no-cache-dir --upgrade pip &amp;&amp; <span style="color: #95e454;">\</span>
    pip install --no-cache-dir jupyterlab
CMD [<span style="color: #95e454;">"jupyter"</span>, <span style="color: #95e454;">"lab"</span>, <span style="color: #95e454;">"--allow-root"</span>, <span style="color: #95e454;">"--ip=0.0.0.0"</span>]
</pre>
</div>

<p>
to check installation:
</p>
<pre class="example">
ipython3 -c 'import torch'
</pre>


<p>
docker run -p 8888:8888 -t pavl &gt; /var/log/d1.log &amp;
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org22acfb9" class="outline-2">
<h2 id="org22acfb9"><span class="section-number-2">64.</span> USΕ CASES</h2>
<div class="outline-text-2" id="text-64">
<p>
measure time <a href="#org6f854bc">30.3</a>
</p>
</div>
<div id="outline-container-org0620053" class="outline-3">
<h3 id="org0620053"><span class="section-number-3">64.1.</span> NET</h3>
<div class="outline-text-3" id="text-64-1">
</div>
<div id="outline-container-org4c9e3f1" class="outline-4">
<h4 id="org4c9e3f1"><span class="section-number-4">64.1.1.</span> REST request</h4>
<div class="outline-text-4" id="text-64-1-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> urllib.request
<span style="color: #8ac6f2; font-weight: bold;">import</span> json


<span style="color: #cae682;">API_KEY</span> = <span style="color: #95e454;">'f670813c14f672c1e197101fd767cbe675933d86'</span>
<span style="color: #cae682;">headers</span> = {<span style="color: #95e454;">'User-agent'</span>: <span style="color: #95e454;">'Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.9.1.5) Gecko/20091102 Firefox/3.5.5'</span>,
           <span style="color: #95e454;">'Content-Type'</span>: <span style="color: #95e454;">'application/json'</span>,
           <span style="color: #95e454;">'Accept'</span>: <span style="color: #95e454;">'application/json'</span>,
           <span style="color: #95e454;">'Authorization'</span>: <span style="color: #95e454;">'Token '</span> + API_KEY
}

<span style="color: #cae682;">data</span> = <span style="color: #95e454;">'{ "query": "&#1042;&#1080;&#1082;&#1090;&#1086;&#1088; &#1048;&#1074;&#1072;&#1085;", "count": 3 }'</span>
<span style="color: #cae682;">req</span> = urllib.request.Request(url=<span style="color: #95e454;">'https://suggestions.dadata.ru/suggestions/api/4_1/rs/suggest/fio'</span>,
                             headers=headers, data=data.encode())
<span style="color: #8ac6f2; font-weight: bold;">with</span> urllib.request.urlopen(req) <span style="color: #8ac6f2; font-weight: bold;">as</span> f:
    <span style="color: #cae682;">r</span> = f.read().decode(<span style="color: #95e454;">'utf-8'</span>)
    <span style="color: #cae682;">j</span> = json.loads(r)
    <span style="color: #e5786d;">print</span>(j[<span style="color: #95e454;">'suggestions'</span>][0][<span style="color: #95e454;">"unrestricted_value"</span>])
    <span style="color: #e5786d;">print</span>(j[<span style="color: #95e454;">'suggestions'</span>][0][<span style="color: #95e454;">"gender"</span>])
    <span style="color: #cae682;">j2</span> = json.dumps(j, ensure_ascii=<span style="color: #e5786d; font-weight: bold;">False</span>, indent=4)
    <span style="color: #e5786d;">print</span>(j2)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgdda96c9" class="outline-4">
<h4 id="orgdda96c9"><span class="section-number-4">64.1.2.</span> email IMAP</h4>
<div class="outline-text-4" id="text-64-1-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> configparser <span style="color: #8ac6f2; font-weight: bold;">as</span> cp
<span style="color: #8ac6f2; font-weight: bold;">import</span> cx_Oracle
<span style="color: #8ac6f2; font-weight: bold;">import</span> datetime
<span style="color: #8ac6f2; font-weight: bold;">import</span> email
<span style="color: #8ac6f2; font-weight: bold;">import</span> imaplib
<span style="color: #8ac6f2; font-weight: bold;">import</span> logging
<span style="color: #8ac6f2; font-weight: bold;">import</span> os
<span style="color: #8ac6f2; font-weight: bold;">import</span> re
<span style="color: #8ac6f2; font-weight: bold;">import</span> requests
<span style="color: #8ac6f2; font-weight: bold;">import</span> shutil
<span style="color: #8ac6f2; font-weight: bold;">import</span> smtplib
<span style="color: #8ac6f2; font-weight: bold;">import</span> zipfile
<span style="color: #8ac6f2; font-weight: bold;">import</span> sys

<span style="color: #8ac6f2; font-weight: bold;">from</span> email.header <span style="color: #8ac6f2; font-weight: bold;">import</span> decode_header
<span style="color: #8ac6f2; font-weight: bold;">from</span> email.mime.application <span style="color: #8ac6f2; font-weight: bold;">import</span> MIMEApplication
<span style="color: #8ac6f2; font-weight: bold;">from</span> email.mime.multipart <span style="color: #8ac6f2; font-weight: bold;">import</span> MIMEMultipart
<span style="color: #8ac6f2; font-weight: bold;">from</span> email.mime.text <span style="color: #8ac6f2; font-weight: bold;">import</span> MIMEText
<span style="color: #8ac6f2; font-weight: bold;">from</span> email.utils <span style="color: #8ac6f2; font-weight: bold;">import</span> formatdate
<span style="color: #8ac6f2; font-weight: bold;">from</span> os.path <span style="color: #8ac6f2; font-weight: bold;">import</span> basename
<span style="color: #8ac6f2; font-weight: bold;">from</span> requests.auth <span style="color: #8ac6f2; font-weight: bold;">import</span> HTTPBasicAuth
<span style="color: #8ac6f2; font-weight: bold;">from</span> sys <span style="color: #8ac6f2; font-weight: bold;">import</span> <span style="color: #e5786d; font-weight: bold;">exit</span>

<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">decode_header_fix</span>(subject_list: <span style="color: #e5786d;">list</span>) -&gt; <span style="color: #e5786d;">str</span>:
    <span style="color: #f08080; font-style: italic;">""" decode to string any header after decode_header"""</span>
    <span style="color: #cae682;">sub_list</span> = []
    <span style="color: #8ac6f2; font-weight: bold;">for</span> subject <span style="color: #8ac6f2; font-weight: bold;">in</span> subject_list:
        <span style="color: #8ac6f2; font-weight: bold;">if</span> subject <span style="color: #8ac6f2; font-weight: bold;">and</span> subject[1]:
            <span style="color: #cae682;">subject</span> = (subject[0].decode(subject[1]))
        <span style="color: #8ac6f2; font-weight: bold;">elif</span> <span style="color: #e5786d;">type</span>(subject[0]) == <span style="color: #e5786d;">bytes</span>:
            <span style="color: #cae682;">subject</span> = subject[0].decode(<span style="color: #95e454;">'utf-8'</span>)
        <span style="color: #8ac6f2; font-weight: bold;">else</span>:
            <span style="color: #cae682;">subject</span> = subject[0]
        sub_list.append(subject)
    <span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #95e454;">''</span>.join(sub_list)


<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">send_mail</span>(username, password, send_from, send_to, subject,
              text, files=<span style="color: #e5786d; font-weight: bold;">None</span>, server=<span style="color: #95e454;">"mx1.rnb.com"</span>):
    <span style="color: #8ac6f2; font-weight: bold;">assert</span> <span style="color: #e5786d;">isinstance</span>(send_to, <span style="color: #e5786d;">list</span>)

    <span style="color: #cae682;">msg</span> = MIMEMultipart()
    <span style="color: #cae682;">msg</span>[<span style="color: #95e454;">'From'</span>] = send_from
    <span style="color: #cae682;">msg</span>[<span style="color: #95e454;">'To'</span>] = COMMASPACE.join(send_to)
    <span style="color: #cae682;">msg</span>[<span style="color: #95e454;">'Date'</span>] = formatdate(localtime=<span style="color: #e5786d; font-weight: bold;">True</span>)
    <span style="color: #cae682;">msg</span>[<span style="color: #95e454;">'Subject'</span>] = subject

    msg.attach(MIMEText(text))

    <span style="color: #8ac6f2; font-weight: bold;">for</span> f <span style="color: #8ac6f2; font-weight: bold;">in</span> files <span style="color: #8ac6f2; font-weight: bold;">or</span> []:
        <span style="color: #8ac6f2; font-weight: bold;">with</span> <span style="color: #e5786d;">open</span>(f, <span style="color: #95e454;">"rb"</span>) <span style="color: #8ac6f2; font-weight: bold;">as</span> fil:
            <span style="color: #cae682;">part</span> = MIMEApplication(
                fil.read(),
                Name=basename(f)
            )
        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">After the file is closed</span>
        <span style="color: #cae682;">part</span>[<span style="color: #95e454;">'Content-Disposition'</span>] = <span style="color: #95e454;">'attachment; filename="%s"'</span> % basename(f)
        msg.attach(part)

    <span style="color: #cae682;">smtp</span> = smtplib.SMTP(server)
    smtp.login(username, password)
    log.debug(u<span style="color: #95e454;">'&#1054;&#1090;&#1087;&#1088;&#1072;&#1074;&#1083;&#1103;&#1102; &#1087;&#1080;&#1089;&#1100;&#1084;&#1086; &#1085;&#1072; %s'</span> % send_to)
    smtp.sendmail(send_from, send_to, msg.as_string())
    smtp.close()


<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">save_attachment</span>(conn: imaplib.IMAP4, emailid: <span style="color: #e5786d;">str</span>, outputdir: <span style="color: #e5786d;">str</span>, file_pattern: <span style="color: #e5786d;">str</span>):
    <span style="color: #f08080; font-style: italic;">""" https://docs.python.org/3/library/imaplib.html</span>

<span style="color: #f08080; font-style: italic;">    :param conn: connection</span>
<span style="color: #f08080; font-style: italic;">    :param emailid:</span>
<span style="color: #f08080; font-style: italic;">    :param outputdir:</span>
<span style="color: #f08080; font-style: italic;">    :param file_pattern: regex pattern for file name of attachment</span>
<span style="color: #f08080; font-style: italic;">    :return:</span>
<span style="color: #f08080; font-style: italic;">    """</span>
    <span style="color: #8ac6f2; font-weight: bold;">try</span>:
        <span style="color: #cae682;">ret</span>, <span style="color: #cae682;">data</span> = conn.fetch(emailid, <span style="color: #95e454;">"(BODY[])"</span>)
    <span style="color: #8ac6f2; font-weight: bold;">except</span>:
        <span style="color: #95e454;">"No new emails to read."</span>
        conn.close_connection()
        <span style="color: #e5786d; font-weight: bold;">exit</span>()
    <span style="color: #cae682;">mail</span> = email.message_from_bytes(data[0][1])
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">print('From:' + mail['From'])</span>
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">print('To:' + mail['To'])</span>
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">print('Date:' + mail['Date'])</span>
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">subject_list = decode_header(mail['Subject'])</span>
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">subject = decode_header_fix(subject_list) # must be: Updating client ICODE RNB_378026</span>
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">print('Subject:' + subject)</span>
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">print('Content:' + str(mail.get_payload()[0]))</span>

    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">process_out_reestr(mail)</span>

    <span style="color: #8ac6f2; font-weight: bold;">if</span> mail.get_content_maintype() != <span style="color: #95e454;">'multipart'</span>:
        <span style="color: #8ac6f2; font-weight: bold;">return</span>
    <span style="color: #8ac6f2; font-weight: bold;">for</span> part <span style="color: #8ac6f2; font-weight: bold;">in</span> mail.walk():
        <span style="color: #8ac6f2; font-weight: bold;">if</span> part.get_content_maintype() != <span style="color: #95e454;">'multipart'</span> <span style="color: #8ac6f2; font-weight: bold;">and</span> part.get(<span style="color: #95e454;">'Content-Disposition'</span>) <span style="color: #8ac6f2; font-weight: bold;">is</span> <span style="color: #8ac6f2; font-weight: bold;">not</span> <span style="color: #e5786d; font-weight: bold;">None</span>:
            <span style="color: #cae682;">filename_list</span> = decode_header(part.get_filename())  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">(encoded_string, charset)</span>
            <span style="color: #cae682;">filename</span> = decode_header_fix(filename_list)
            <span style="color: #8ac6f2; font-weight: bold;">if</span> <span style="color: #8ac6f2; font-weight: bold;">not</span> re.search(file_pattern, filename):
                <span style="color: #8ac6f2; font-weight: bold;">continue</span>
            <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">write attachment</span>
            <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"OKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK"</span>)
            <span style="color: #8ac6f2; font-weight: bold;">with</span> <span style="color: #e5786d;">open</span>(<span style="color: #95e454;">'{}/{}'</span>.<span style="color: #e5786d;">format</span>(outputdir, filename), <span style="color: #95e454;">'wb'</span>) <span style="color: #8ac6f2; font-weight: bold;">as</span> f:
                f.write(part.get_payload(decode=<span style="color: #e5786d; font-weight: bold;">True</span>))


<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">download_email_attachments</span>(server: <span style="color: #e5786d;">str</span>, user: <span style="color: #e5786d;">str</span>, password: <span style="color: #e5786d;">str</span>, outputdir: <span style="color: #e5786d;">str</span>,
                               subject_contains: <span style="color: #e5786d;">str</span>, file_pattern: <span style="color: #e5786d;">str</span>, days_since=0) \
        -&gt; <span style="color: #e5786d;">bool</span> <span style="color: #8ac6f2; font-weight: bold;">or</span> <span style="color: #e5786d; font-weight: bold;">None</span>:
    <span style="color: #f08080; font-style: italic;">"""</span>

<span style="color: #f08080; font-style: italic;">    :param server:</span>
<span style="color: #f08080; font-style: italic;">    :param user:</span>
<span style="color: #f08080; font-style: italic;">    :param password:</span>
<span style="color: #f08080; font-style: italic;">    :param outputdir:</span>
<span style="color: #f08080; font-style: italic;">    :param subject_contains:</span>
<span style="color: #f08080; font-style: italic;">    :param file_pattern:</span>
<span style="color: #f08080; font-style: italic;">    :param days_since:</span>
<span style="color: #f08080; font-style: italic;">    :return:</span>
<span style="color: #f08080; font-style: italic;">    """</span>
    <span style="color: #cae682;">date</span> = datetime.datetime.now() - datetime.timedelta(days=days_since)
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">https://docs.python.org/3/library/imaplib.html</span>
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">https://tools.ietf.org/html/rfc3501#page-49</span>
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">SUBJECT &lt;string&gt;</span>
    <span style="color: #fa8072;">#          </span><span style="color: #99968b; font-style: italic;">Messages that contain the specified string in the envelope</span>
    <span style="color: #fa8072;">#          </span><span style="color: #99968b; font-style: italic;">structure's SUBJECT field</span>
    <span style="color: #cae682;">criteria</span> = <span style="color: #95e454;">'(SENTSINCE "{}" SUBJECT "{}")'</span>.<span style="color: #e5786d;">format</span>(date.strftime(<span style="color: #95e454;">'%d-%b-%Y'</span>),
                                                      subject_contains)

    <span style="color: #8ac6f2; font-weight: bold;">try</span>:
        <span style="color: #cae682;">m</span> = imaplib.IMAP4_SSL(server)
        m.login(user, password)
        m.select()
        <span style="color: #cae682;">resp</span>, <span style="color: #cae682;">items</span> = m.search(<span style="color: #e5786d; font-weight: bold;">None</span>, criteria)
        <span style="color: #8ac6f2; font-weight: bold;">if</span> <span style="color: #8ac6f2; font-weight: bold;">not</span> items[0]:
            log.debug(u<span style="color: #95e454;">'&#1053;&#1077;&#1090; &#1087;&#1080;&#1089;&#1077;&#1084; &#1089; &#1088;&#1077;&#1077;&#1089;&#1090;&#1088;&#1072;&#1084;&#1080; &#1074; &#1087;&#1072;&#1087;&#1082;&#1077; &#1042;&#1061;&#1054;&#1044;&#1071;&#1065;&#1048;&#1045;'</span>)
            <span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #e5786d; font-weight: bold;">False</span>
        <span style="color: #cae682;">items</span> = items[0].split()
        <span style="color: #8ac6f2; font-weight: bold;">for</span> emailid <span style="color: #8ac6f2; font-weight: bold;">in</span> items:
            save_attachment(m, emailid, outputdir, file_pattern)
            <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">TODO: change</span>
            <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">m.store(emailid, '+FLAGS', '\\Seen')</span>
            <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">m.copy(emailid, 'processed')</span>
            <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">m.store(emailid, '+FLAGS', '\\Deleted')</span>
        m.close()
        m.logout()
    <span style="color: #8ac6f2; font-weight: bold;">except</span> imaplib.IMAP4_SSL.error <span style="color: #8ac6f2; font-weight: bold;">as</span> e:
        <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"LOGIN FAILED!!! "</span>, e)
        sys.<span style="color: #e5786d; font-weight: bold;">exit</span>(1)
    <span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #e5786d; font-weight: bold;">True</span>


<span style="color: #8ac6f2; font-weight: bold;">if</span> <span style="color: #e5786d;">__name__</span> == <span style="color: #95e454;">'__main__'</span>:
    <span style="color: #8ac6f2; font-weight: bold;">import</span> tempfile
    <span style="color: #cae682;">c</span> = config_load(<span style="color: #95e454;">'autocred.conf'</span>)
    <span style="color: #cae682;">log</span> = init_logger(logging.INFO, c[<span style="color: #95e454;">'storage'</span>][<span style="color: #95e454;">'log_path'</span>])  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">required by all methods</span>
    <span style="color: #fa8072;">#</span>
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">with tempfile.TemporaryDirectory() as tmp:</span>
    <span style="color: #fa8072;">#     </span><span style="color: #99968b; font-style: italic;">print(tmp)</span>
    <span style="color: #fa8072;">#     </span><span style="color: #99968b; font-style: italic;">res = download_email_attachments(server=c['imap']['host'],</span>
    <span style="color: #fa8072;">#                                      </span><span style="color: #99968b; font-style: italic;">user=c['imap']['login'],</span>
    <span style="color: #fa8072;">#                                      </span><span style="color: #99968b; font-style: italic;">password=c['imap']['password'],</span>
    <span style="color: #fa8072;">#                                      </span><span style="color: #99968b; font-style: italic;">outputdir=tmp, subject_contains='Updating client ICODE RNB_',</span>
    <span style="color: #fa8072;">#                                      </span><span style="color: #99968b; font-style: italic;">file_pattern=r'^client_identity_RNB_\d+\.zip\.enc$', days_since=1)</span>
    <span style="color: #fa8072;">#     </span><span style="color: #99968b; font-style: italic;">extract_zip_files(tmp)</span>
    <span style="color: #fa8072;">#     </span><span style="color: #99968b; font-style: italic;">for x in os.listdir(tmp):</span>
    <span style="color: #fa8072;">#         </span><span style="color: #99968b; font-style: italic;">print(x)</span>

    <span style="color: #cae682;">tmp</span> = <span style="color: #95e454;">'/home/u2/Desktop/tmp/tmp2/'</span>
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">res = download_email_attachments(server=c['imap_bistr']['host'],</span>
    <span style="color: #fa8072;">#                                  </span><span style="color: #99968b; font-style: italic;">user=c['imap_bistr']['login'],</span>
    <span style="color: #fa8072;">#                                  </span><span style="color: #99968b; font-style: italic;">password=c['imap_bistr']['password'],</span>
    <span style="color: #fa8072;">#                                  </span><span style="color: #99968b; font-style: italic;">outputdir=tmp,</span>
    <span style="color: #fa8072;">#                                  </span><span style="color: #99968b; font-style: italic;">subject_contains='Updating client ICODE',  # 'Updating client ICODE RNB_378026'</span>
    <span style="color: #fa8072;">#                                  </span><span style="color: #99968b; font-style: italic;">file_pattern=r'^client_identity_RNB_\d+\.zip\.enc$', days_since=3)</span>

    <span style="color: #8ac6f2; font-weight: bold;">for</span> filename <span style="color: #8ac6f2; font-weight: bold;">in</span> os.listdir(tmp):
        <span style="color: #e5786d;">print</span>(filename)
        decrypt_file(uri=c[<span style="color: #95e454;">'api'</span>][<span style="color: #95e454;">'dec_uri'</span>],
                     cert_thumbprint=c[<span style="color: #95e454;">'api'</span>][<span style="color: #95e454;">'dec_cert_thumbprint'</span>],
                     user=c[<span style="color: #95e454;">'api'</span>][<span style="color: #95e454;">'user'</span>],
                     passw=c[<span style="color: #95e454;">'api'</span>][<span style="color: #95e454;">'pass'</span>],
                     filename=os.path.join(tmp, filename))
    <span style="color: #8ac6f2; font-weight: bold;">for</span> x <span style="color: #8ac6f2; font-weight: bold;">in</span> os.listdir(tmp):
        <span style="color: #e5786d;">print</span>(x)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgdaf47d9" class="outline-4">
<h4 id="orgdaf47d9"><span class="section-number-4">64.1.3.</span> email DKIM</h4>
<div class="outline-text-4" id="text-64-1-3">
<pre class="example">
('DKIM-Signature', 'v=1; a=rsa-sha256; q=dns/txt; c=simple/simple; d=bystrobank.ru\n\t; s=dkim;
h=Message-Id:Content-Type:MIME-Version:From:Date:Subject:To:Sender:\n\tReply-To:Cc:Content-Transfer-Encoding:Content-ID:Content-Description:\n\tResent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:\n\tIn-Reply-To:References:List-Id:List-Help:List-Unsubscribe:List-Subscribe:\n\tList-Post:List-Owner:List-Archive;\n\tbh=dDimDD8KIdEx1QkqygEiFeQfyTIgIztxgQu6BtkzQ5o=;
b=hZGPWUFnQ2gGNV4UJ7MyaPJYFL\n\tbB9Csmpg/ukcwQuWBI1NtvILUoviMff4ACkNnhPgD7OV4aGtR5UBOy81tdvY5cQnBFv9Yku9yAf8R\n\t1BV83crKYnhU4GRtw7wD4W64zpZRhX3KZxG8SWissmh+vNEMBlmYXN9FsuLyVKaBbks0DYnR3HA9Q\n\tFV4d8CMC8wLrdmBi/MV0x75Q9GhDhGMc8MPNAleuWabHOT8Bmf7FLHQERHBRYm78i4wDWEFFNv5Ox\n\tuqMEm5iJQeYRnoHkrm5KEEP4DYohb8GgJkfIIZs4dO2oMjJif/2A1JLnmq64KPmoAE3s8lO2Bo2Zq\n\t68tnSdFA==;')
</pre>



<pre class="example">
pip3 install dkimpy --user
</pre>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> dkim
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">verify email</span>
    <span style="color: #8ac6f2; font-weight: bold;">try</span>:
        <span style="color: #cae682;">res</span> = dkim.verify(data[0][1])
    <span style="color: #8ac6f2; font-weight: bold;">except</span>:
        log.error(u<span style="color: #95e454;">'Invalid signature'</span>)
        <span style="color: #8ac6f2; font-weight: bold;">return</span>
    <span style="color: #8ac6f2; font-weight: bold;">if</span> <span style="color: #8ac6f2; font-weight: bold;">not</span> res:
        log.error(u<span style="color: #95e454;">'Invalid signature'</span>)
        <span style="color: #8ac6f2; font-weight: bold;">return</span>
    <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">'['</span> + os.path.basename(__file__) + <span style="color: #95e454;">'] isDkimValid = '</span> + <span style="color: #e5786d;">str</span>(res))

    <span style="color: #cae682;">mail</span> = email.message_from_bytes(data[0][1])
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">verify sender domain</span>
    <span style="color: #cae682;">dkim_sig</span> = decode_header(mail[<span style="color: #95e454;">'DKIM-Signature'</span>])
    <span style="color: #cae682;">dkim_sig</span> = decode_header_fix(dkim_sig)
    <span style="color: #8ac6f2; font-weight: bold;">if</span> <span style="color: #8ac6f2; font-weight: bold;">not</span> re.search(r<span style="color: #95e454;">" d=bystrobank\.ru"</span>, dkim_sig):
        <span style="color: #8ac6f2; font-weight: bold;">return</span>

</pre>
</div>
</div>
</div>
<div id="outline-container-orge818d85" class="outline-4">
<h4 id="orge818d85"><span class="section-number-4">64.1.4.</span> urllib SOCKS</h4>
<div class="outline-text-4" id="text-64-1-4">
<p>
pip install requests[socks]
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> urllib
<span style="color: #8ac6f2; font-weight: bold;">import</span> socket
<span style="color: #8ac6f2; font-weight: bold;">import</span> socks
socks.set_default_proxy(socks.SOCKS5, <span style="color: #95e454;">"127.0.0.1"</span>,port=8888)
<span style="color: #cae682;">save</span> = socket.socket
socket.<span style="color: #cae682;">socket</span> = socks.socksocket <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">replace socket with socks</span>
<span style="color: #cae682;">req</span> = urllib.request.Request(url=<span style="color: #95e454;">'http://httpbin.org/ip'</span>)
urllib.request.urlopen(req).read() <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">default request</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org9c858f5" class="outline-3">
<h3 id="org9c858f5"><span class="section-number-3">64.2.</span> LISTS</h3>
<div class="outline-text-3" id="text-64-2">
</div>
<div id="outline-container-org0f78cb8" class="outline-4">
<h4 id="org0f78cb8"><span class="section-number-4">64.2.1.</span> all has one value</h4>
<div class="outline-text-4" id="text-64-2-1">
<pre class="example">
list.count('value') == len(list)
</pre>
</div>
</div>
<div id="outline-container-orgcad41cf" class="outline-4">
<h4 id="orgcad41cf"><span class="section-number-4">64.2.2.</span> 2D list to 1D dict or list</h4>
<div class="outline-text-4" id="text-64-2-2">
<pre class="example">
[j for sub in [[1,2,3],[1,2],[1,4,5,6,7]] for j in sub]
</pre>


<pre class="example">
{j for sub in [[1,2,3],[1,2],[1,4,5,6,7]] for j in sub}
</pre>
</div>
</div>
<div id="outline-container-org27f1cd1" class="outline-4">
<h4 id="org27f1cd1"><span class="section-number-4">64.2.3.</span> list to string</h4>
<div class="outline-text-4" id="text-64-2-3">
<pre class="example">
' '.join(w for w in a)
</pre>
</div>
</div>
<div id="outline-container-orgdd85838" class="outline-4">
<h4 id="orgdd85838"><span class="section-number-4">64.2.4.</span> replace one with two</h4>
<div class="outline-text-4" id="text-64-2-4">
<pre class="example">
l[pos:pos+1] = ('a', 'b')
</pre>
</div>
</div>
<div id="outline-container-org841e18b" class="outline-4">
<h4 id="org841e18b"><span class="section-number-4">64.2.5.</span> remove elements</h4>
<div class="outline-text-4" id="text-64-2-5">
<p>
<b>filter</b>
</p>
<pre class="example">
self.contours = list(filter(lambda a: a is not None, self.contours))
</pre>


<p>
<b>new list</b>
</p>
<pre class="example">
a = [item for item in a if ...]
</pre>


<p>
<b>iterate over copy</b>
</p>
<pre class="example">
for i, x in enumerate(lis[:]):
  del lis[i]
</pre>
</div>
</div>
<div id="outline-container-org459f49b" class="outline-4">
<h4 id="org459f49b"><span class="section-number-4">64.2.6.</span> average</h4>
<div class="outline-text-4" id="text-64-2-6">
<pre class="example">
[np.average((x[0], x[1])) for x in zip([1,2,3],[1,2,3])]
</pre>
</div>
</div>
<div id="outline-container-org7f5d12d" class="outline-4">
<h4 id="org7f5d12d"><span class="section-number-4">64.2.7.</span> [1, -2, 3, -4, 5]</h4>
<div class="outline-text-4" id="text-64-2-7">
<pre class="example">
&gt;&gt;&gt; [(x % 2 -0.5)*2*x for x in range(1,10)]
[1.0, -2.0, 3.0, -4.0, 5.0, -6.0, 7.0, -8.0, 9.0]
</pre>
</div>
</div>
<div id="outline-container-org759eefb" class="outline-4">
<h4 id="org759eefb"><span class="section-number-4">64.2.8.</span> ZIP массивов с разной длинной</h4>
<div class="outline-text-4" id="text-64-2-8">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> itertools
<span style="color: #cae682;">z</span>= itertools.zip_longest(arr1,arr2,arr3)
<span style="color: #cae682;">flat_list</span>=[]
<span style="color: #8ac6f2; font-weight: bold;">for</span> x <span style="color: #8ac6f2; font-weight: bold;">in</span> z:
    <span style="color: #cae682;">subflat</span>=[]
    <span style="color: #8ac6f2; font-weight: bold;">for</span> subl <span style="color: #8ac6f2; font-weight: bold;">in</span> x:
        <span style="color: #8ac6f2; font-weight: bold;">if</span> subl != <span style="color: #e5786d; font-weight: bold;">None</span>:
            subflat.append(subl[0])
            subflat.append(subl[1])
            subflat.append(subl[1])
        <span style="color: #8ac6f2; font-weight: bold;">else</span>:
            subflat.append(<span style="color: #95e454;">''</span>)
            subflat.append(<span style="color: #95e454;">''</span>)
    flat_list.append(subflat)


</pre>
</div>
</div>
</div>
<div id="outline-container-orgcd6ed12" class="outline-4">
<h4 id="orgcd6ed12"><span class="section-number-4">64.2.9.</span> Shuffle two lists</h4>
<div class="outline-text-4" id="text-64-2-9">
<pre class="example">
z = list(zip(self.x, self.y))
z = random.shuffle(z)
self.x, self.y = zip(*z)
</pre>
</div>
</div>
<div id="outline-container-org1819354" class="outline-4">
<h4 id="org1819354"><span class="section-number-4">64.2.10.</span> list of dictionaries</h4>
<div class="outline-text-4" id="text-64-2-10">
</div>
<ol class="org-ol">
<li><a id="org894d676"></a>search and encode<br />
<div class="outline-text-5" id="text-64-2-10-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">one_h_str_col</span>(dicts: <span style="color: #e5786d;">list</span>, column: <span style="color: #e5786d;">str</span>):
    <span style="color: #cae682;">c</span> = <span style="color: #e5786d;">set</span>([x[column] <span style="color: #8ac6f2; font-weight: bold;">for</span> x <span style="color: #8ac6f2; font-weight: bold;">in</span> dicts])  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">unique</span>
    <span style="color: #cae682;">c</span> = <span style="color: #e5786d;">list</span>(c)  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">.index</span>
    <span style="color: #cae682;">nb_classes</span> = <span style="color: #e5786d;">len</span>(c)
    <span style="color: #cae682;">targets</span> = np.arange(nb_classes)
    <span style="color: #cae682;">one_hot_targets</span> = np.eye(nb_classes)[targets]
    <span style="color: #8ac6f2; font-weight: bold;">for</span> i, x <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">enumerate</span>(dicts):
        <span style="color: #cae682;">x</span>[column] = <span style="color: #e5786d;">list</span>(one_hot_targets[c.index(x[column])])
    <span style="color: #8ac6f2; font-weight: bold;">return</span> dicts


<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">one_h_date_col</span>(dicts: <span style="color: #e5786d;">list</span>, column: <span style="color: #e5786d;">str</span>):
    <span style="color: #8ac6f2; font-weight: bold;">for</span> i, x <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">enumerate</span>(dicts):
        <span style="color: #cae682;">d</span>: date = x[column]
        <span style="color: #cae682;">x</span>[column] = d.year
    <span style="color: #8ac6f2; font-weight: bold;">return</span> dicts


<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">one_h</span>(dicts: <span style="color: #e5786d;">list</span>):
    <span style="color: #8ac6f2; font-weight: bold;">for</span> col <span style="color: #8ac6f2; font-weight: bold;">in</span> dicts[0].keys():
        <span style="color: #cae682;">lst</span> = <span style="color: #e5786d;">set</span>([x[col] <span style="color: #8ac6f2; font-weight: bold;">for</span> x <span style="color: #8ac6f2; font-weight: bold;">in</span> dicts])
        <span style="color: #8ac6f2; font-weight: bold;">if</span> <span style="color: #e5786d;">all</span>(<span style="color: #e5786d;">isinstance</span>(x, (<span style="color: #e5786d;">str</span>, <span style="color: #e5786d;">bytes</span>)) <span style="color: #8ac6f2; font-weight: bold;">for</span> x <span style="color: #8ac6f2; font-weight: bold;">in</span> lst):
            <span style="color: #cae682;">dicts</span> = one_h_str_col(dicts, col)
        <span style="color: #8ac6f2; font-weight: bold;">if</span> <span style="color: #e5786d;">all</span>(<span style="color: #e5786d;">isinstance</span>(x, date) <span style="color: #8ac6f2; font-weight: bold;">for</span> x <span style="color: #8ac6f2; font-weight: bold;">in</span> lst):
            <span style="color: #cae682;">dicts</span> = one_h_date_col(dicts, col)
    <span style="color: #8ac6f2; font-weight: bold;">return</span> dicts
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #cae682;">dicts</span> = [
{ <span style="color: #95e454;">"name"</span>: <span style="color: #95e454;">"Mark"</span>, <span style="color: #95e454;">"age"</span>: 5 },
{ <span style="color: #95e454;">"name"</span>: <span style="color: #95e454;">"Tom"</span>, <span style="color: #95e454;">"age"</span>: 10 },
{ <span style="color: #95e454;">"name"</span>: <span style="color: #95e454;">"Pam"</span>, <span style="color: #95e454;">"age"</span>: 7 },
]

<span style="color: #cae682;">c</span> = <span style="color: #e5786d;">set</span>([x[<span style="color: #95e454;">'name'</span>] <span style="color: #8ac6f2; font-weight: bold;">for</span> x <span style="color: #8ac6f2; font-weight: bold;">in</span> dicts]) <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">unique</span>
<span style="color: #cae682;">c</span> = <span style="color: #e5786d;">list</span>(c)  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">.index</span>

<span style="color: #8ac6f2; font-weight: bold;">for</span> i, x <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">enumerate</span>(dicts):
  <span style="color: #cae682;">x</span>[<span style="color: #95e454;">'name'</span>] = c.index(x)

</pre>
</div>
</div>
</li>

<li><a id="orge152ece"></a>separate labels from matrix<br />
<div class="outline-text-5" id="text-64-2-10-2">
<pre class="example">
matrix = [list(x.values()) for x in dicts]
labels = dicts[0].keys()
</pre>
</div>
</li>
</ol>
</div>

<div id="outline-container-orgb48cfd4" class="outline-4">
<h4 id="orgb48cfd4"><span class="section-number-4">64.2.11.</span> closest in list</h4>
<div class="outline-text-4" id="text-64-2-11">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #cae682;">alph</span> = [1,2,5,7]
<span style="color: #cae682;">source</span> = [1,2,3,6] <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">3, 6 replace</span>
<span style="color: #cae682;">target</span> = source[:]
<span style="color: #8ac6f2; font-weight: bold;">for</span> i, s <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">enumerate</span>(source
  <span style="color: #8ac6f2; font-weight: bold;">if</span> s <span style="color: #8ac6f2; font-weight: bold;">not</span> <span style="color: #8ac6f2; font-weight: bold;">in</span> alph:
    distance = [(<span style="color: #e5786d;">abs</span>(x-s), x) <span style="color: #8ac6f2; font-weight: bold;">for</span> x <span style="color: #8ac6f2; font-weight: bold;">in</span> alph
    res = <span style="color: #e5786d;">min</span>(distance, key=<span style="color: #8ac6f2; font-weight: bold;">lambda</span> x: x[0])
    target[i] = res[1]

</pre>
</div>
</div>
</div>

<div id="outline-container-org09ad8a8" class="outline-4">
<h4 id="org09ad8a8"><span class="section-number-4">64.2.12.</span> TIMΕ SEQUENCE</h4>
<div class="outline-text-4" id="text-64-2-12">
<p>
<b>smooth</b>
</p>
<pre class="example">
mean_ver1 = pandas.Series(mean_ver1).rolling(window=5).mean()
</pre>
</div>
</div>
<div id="outline-container-orgbf8774f" class="outline-4">
<h4 id="orgbf8774f"><span class="section-number-4">64.2.13.</span> split list in chunks</h4>
<div class="outline-text-4" id="text-64-2-13">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #cae682;">our_list</span> = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11]
<span style="color: #cae682;">chunk_size</span> = 3
<span style="color: #cae682;">chunked_list</span> = [our_list[i:i+chunk_size] <span style="color: #8ac6f2; font-weight: bold;">for</span> i <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">range</span>(0, <span style="color: #e5786d;">len</span>(our_list), chunk_size)]
<span style="color: #e5786d;">print</span>(chunked_list)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgc1005f8" class="outline-3">
<h3 id="orgc1005f8"><span class="section-number-3">64.3.</span> FILES</h3>
<div class="outline-text-3" id="text-64-3">
<ul class="org-ul">
<li>os.path.join('/home','user') - /home/user</li>
<li>os.listdir('/home/user') -&gt; list of file<sub>names</sub> - files and directories</li>
<li>os.path.isdir/isfile() -&gt; True False</li>
<li>os.walk() - subderictories = [(folder<sub>path</sub>, list<sub>folders</sub>, list<sub>files</sub>), &#x2026; ]</li>
<li>extension = os.path.splitext(filename)[1][1:]</li>
</ul>

<p>
Extract from subolders:
find . -mindepth 2 -type f -print -exec mv {} . \;
</p>

<ul class="org-ul">
<li>list files and directories deepth=1: os.listdir()-&gt;list</li>
<li>list only files deepth=1 os.listdir() AND os.path.isfile()</li>
</ul>
</div>

<div id="outline-container-orgd0a65e0" class="outline-4">
<h4 id="orgd0a65e0"><span class="section-number-4">64.3.1.</span> locking</h4>
<div class="outline-text-4" id="text-64-3-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">try</span>:
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Posix based file locking (Linux, Ubuntu, MacOS, etc.)</span>
    <span style="color: #fa8072;">#   </span><span style="color: #99968b; font-style: italic;">Only allows locking on writable files, might cause</span>
    <span style="color: #fa8072;">#   </span><span style="color: #99968b; font-style: italic;">strange results for reading.</span>
    <span style="color: #8ac6f2; font-weight: bold;">import</span> fcntl, os
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">lock_file</span>(f):
        <span style="color: #8ac6f2; font-weight: bold;">if</span> f.writable(): fcntl.lockf(f, fcntl.LOCK_EX)
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">unlock_file</span>(f):
        <span style="color: #8ac6f2; font-weight: bold;">if</span> f.writable(): fcntl.lockf(f, fcntl.LOCK_UN)
<span style="color: #8ac6f2; font-weight: bold;">except</span> ModuleNotFoundError:
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Windows file locking</span>
    <span style="color: #8ac6f2; font-weight: bold;">import</span> msvcrt, os
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">file_size</span>(f):
        <span style="color: #8ac6f2; font-weight: bold;">return</span> os.path.getsize( os.path.realpath(f.name) )
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">lock_file</span>(f):
        msvcrt.locking(f.fileno(), msvcrt.LK_RLCK, file_size(f))
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">unlock_file</span>(f):
        msvcrt.locking(f.fileno(), msvcrt.LK_UNLCK, file_size(f))

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;"># Class for ensuring that all file operations are atomic, treat</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;"># initialization like a standard call to 'open' that happens to be atomic.</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;"># This file opener *must* be used in a "with" block.</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">class AtomicOpen:</span>
<span style="color: #fa8072;">#     </span><span style="color: #99968b; font-style: italic;"># Open the file with arguments provided by user. Then acquire</span>
<span style="color: #fa8072;">#     </span><span style="color: #99968b; font-style: italic;"># a lock on that file object (WARNING: Advisory locking).</span>
<span style="color: #fa8072;">#     </span><span style="color: #99968b; font-style: italic;">def __init__(self, path, *args, **kwargs):</span>
<span style="color: #fa8072;">#         </span><span style="color: #99968b; font-style: italic;"># Open the file and acquire a lock on the file before operating</span>
<span style="color: #fa8072;">#         </span><span style="color: #99968b; font-style: italic;">self.file = open(path,*args, **kwargs)</span>
<span style="color: #fa8072;">#         </span><span style="color: #99968b; font-style: italic;"># Lock the opened file</span>
<span style="color: #fa8072;">#         </span><span style="color: #99968b; font-style: italic;">lock_file(self.file)</span>

<span style="color: #fa8072;">#     </span><span style="color: #99968b; font-style: italic;"># Return the opened file object (knowing a lock has been obtained).</span>
<span style="color: #fa8072;">#     </span><span style="color: #99968b; font-style: italic;">def __enter__(self, *args, **kwargs): return self.file</span>

<span style="color: #fa8072;">#     </span><span style="color: #99968b; font-style: italic;"># Unlock the file and close the file object.</span>
<span style="color: #fa8072;">#     </span><span style="color: #99968b; font-style: italic;">def __exit__(self, exc_type=None, exc_value=None, traceback=None):</span>
<span style="color: #fa8072;">#         </span><span style="color: #99968b; font-style: italic;"># Flush to make sure all buffered contents are written to file.</span>
<span style="color: #fa8072;">#         </span><span style="color: #99968b; font-style: italic;">self.file.flush()</span>
<span style="color: #fa8072;">#         </span><span style="color: #99968b; font-style: italic;">os.fsync(self.file.fileno())</span>
<span style="color: #fa8072;">#         </span><span style="color: #99968b; font-style: italic;"># Release the lock on the file.</span>
<span style="color: #fa8072;">#         </span><span style="color: #99968b; font-style: italic;">unlock_file(self.file)</span>
<span style="color: #fa8072;">#         </span><span style="color: #99968b; font-style: italic;">self.file.close()</span>
<span style="color: #fa8072;">#         </span><span style="color: #99968b; font-style: italic;"># Handle exceptions that may have come up during execution, by</span>
<span style="color: #fa8072;">#         </span><span style="color: #99968b; font-style: italic;"># default any exceptions are raised to the user.</span>
<span style="color: #fa8072;">#         </span><span style="color: #99968b; font-style: italic;">if (exc_type != None): return False</span>
<span style="color: #fa8072;">#         </span><span style="color: #99968b; font-style: italic;">else:                  return True</span>

<span style="color: #cae682;">f</span> = <span style="color: #e5786d;">open</span>(<span style="color: #95e454;">"/tmp/a.pl"</span>, <span style="color: #95e454;">"r"</span>)
lock_file(f)
<span style="color: #cae682;">strings</span> = f.read()
<span style="color: #cae682;">f2</span> = <span style="color: #e5786d;">open</span>(<span style="color: #95e454;">"/tmp/a.pl"</span>, <span style="color: #95e454;">'r+'</span>) <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">open to erase</span>
f2.truncate(0) <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">need '0' when using r+</span>
unlock_file(f)
f.close()
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf0dc247" class="outline-4">
<h4 id="orgf0dc247"><span class="section-number-4">64.3.2.</span> Read JSON</h4>
<div class="outline-text-4" id="text-64-3-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> codecs
<span style="color: #cae682;">fileObj</span> =codecs.<span style="color: #e5786d;">open</span>(<span style="color: #95e454;">"provodki_1000.json"</span>, encoding=<span style="color: #95e454;">'utf-8'</span>, mode=<span style="color: #95e454;">'r'</span>)
<span style="color: #cae682;">text</span> = fileObj.read()
fileObj.close()
<span style="color: #cae682;">data</span> = json.loads(text)

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">or</span>
<span style="color: #8ac6f2; font-weight: bold;">import</span> json
<span style="color: #8ac6f2; font-weight: bold;">with</span> <span style="color: #e5786d;">open</span>(<span style="color: #95e454;">'test_data.txt'</span>, <span style="color: #95e454;">'r'</span>) <span style="color: #8ac6f2; font-weight: bold;">as</span> myfile:
    <span style="color: #cae682;">data</span>=myfile.read()
<span style="color: #cae682;">obj</span> = json.loads(data)

<span style="color: #cae682;">data</span> = json.loads(text)

</pre>
</div>
</div>
</div>
<div id="outline-container-orgc2d0c68" class="outline-4">
<h4 id="orgc2d0c68"><span class="section-number-4">64.3.3.</span> CSV</h4>
<div class="outline-text-4" id="text-64-3-3">
<ul class="org-ul">
<li><a href="https://docs.python.org/3.6/library/csv.html">https://docs.python.org/3.6/library/csv.html</a></li>
</ul>
</div>
<ol class="org-ol">
<li><a id="org1dc8d55"></a>array to CSV file for Excell<br />
<div class="outline-text-5" id="text-64-3-3-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #cae682;">wtr</span> = csv.writer(<span style="color: #e5786d;">open</span> (<span style="color: #95e454;">'out.csv'</span>, <span style="color: #95e454;">'w'</span>), delimiter=<span style="color: #95e454;">';'</span>, lineterminator=<span style="color: #95e454;">'</span><span style="color: #e5786d; font-weight: bold;">\n</span><span style="color: #95e454;">'</span>)
<span style="color: #8ac6f2; font-weight: bold;">for</span> x <span style="color: #8ac6f2; font-weight: bold;">in</span> arr :
    wtr.writerow(x)
</pre>
</div>
</div>
</li>
<li><a id="orgcbf7f61"></a>read CSV and write<br />
<div class="outline-text-5" id="text-64-3-3-2">
<ul class="org-ul">
<li><a href="https://docs.python.org/3.6/library/collections.html#collections.OrderedDict">https://docs.python.org/3.6/library/collections.html#collections.OrderedDict</a></li>
</ul>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> csv

<span style="color: #cae682;">p</span> = <span style="color: #95e454;">'/home/u2/Downloads/BANE_191211_191223.csv'</span>

<span style="color: #8ac6f2; font-weight: bold;">with</span> <span style="color: #e5786d;">open</span>(p, <span style="color: #95e454;">'r'</span>) <span style="color: #8ac6f2; font-weight: bold;">as</span> f:
    <span style="color: #cae682;">reader</span> = csv.reader(f, delimiter=<span style="color: #95e454;">';'</span>, quoting=csv.QUOTE_NONE)
    <span style="color: #8ac6f2; font-weight: bold;">for</span> row <span style="color: #8ac6f2; font-weight: bold;">in</span> reader:
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-org23ab52e" class="outline-4">
<h4 id="org23ab52e"><span class="section-number-4">64.3.4.</span> read file</h4>
<div class="outline-text-4" id="text-64-3-4">
<p>
Whole:
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> codecs
<span style="color: #cae682;">fileObj</span> =codecs.<span style="color: #e5786d;">open</span>(<span style="color: #95e454;">"provodki_1000.json"</span>, encoding=<span style="color: #95e454;">'utf-8'</span>, mode=<span style="color: #95e454;">'r'</span>)
<span style="color: #cae682;">text</span> = fileObj.read()
fileObj.close()
</pre>
</div>

<p>
Line by line:
</p>
<pre class="example">
with open(fname) as f:    content = f.readline()
</pre>


<p>
go to the begining of the file
</p>
<pre class="example">
file.seek(0)
</pre>


<p>
read whole text file:
</p>
<pre class="example">
with open(fname) as f:    content = f.readlines()
with open(fname) as f: temp = f.read().splitlines()
</pre>
</div>
</div>
<div id="outline-container-orgab1ba23" class="outline-4">
<h4 id="orgab1ba23"><span class="section-number-4">64.3.5.</span> Export to Excell</h4>
<div class="outline-text-4" id="text-64-3-5">
<p>
<a href="https://docs.python.org/3.6/library/csv.html">https://docs.python.org/3.6/library/csv.html</a>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> csv
<span style="color: #cae682;">wtr</span> = csv.writer(<span style="color: #e5786d;">open</span>(<span style="color: #95e454;">'out.csv'</span>, <span style="color: #95e454;">'w'</span>), delimiter=<span style="color: #95e454;">';'</span>, lineterminator=<span style="color: #95e454;">'</span><span style="color: #e5786d; font-weight: bold;">\n</span><span style="color: #95e454;">'</span>)
wtr.writerows(flat_list)
</pre>
</div>
</div>
</div>

<div id="outline-container-org3576827" class="outline-4">
<h4 id="org3576827"><span class="section-number-4">64.3.6.</span> NameError: name 'A' is not defined</h4>
<div class="outline-text-4" id="text-64-3-6">
<pre class="example">
try:
    file.close()
except NameError:
</pre>
</div>
</div>
<div id="outline-container-orgcc5ca8e" class="outline-4">
<h4 id="orgcc5ca8e"><span class="section-number-4">64.3.7.</span> rename files (list directory)</h4>
<div class="outline-text-4" id="text-64-3-7">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> os
<span style="color: #8ac6f2; font-weight: bold;">from</span> shutil <span style="color: #8ac6f2; font-weight: bold;">import</span> copyfile

<span style="color: #cae682;">sd</span> = <span style="color: #95e454;">'/mnt/hit4/hit4user/kaggle/abstraction-and-reasoning-challenge/training/'</span>

<span style="color: #cae682;">td</span> = <span style="color: #95e454;">'/mnt/hit4/hit4user/kaggle/abc/training/'</span>
<span style="color: #cae682;">dirFiles</span> = os.listdir(sd)
dirFiles.sort(key=<span style="color: #8ac6f2; font-weight: bold;">lambda</span> f: <span style="color: #e5786d;">int</span>(f[:-5], base=16))
<span style="color: #8ac6f2; font-weight: bold;">for</span> i, x <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">enumerate</span>(dirFiles):
    <span style="color: #cae682;">src</span> = os.path.join(sd,x)
    <span style="color: #cae682;">dst</span> = os.path.join(td,<span style="color: #e5786d;">str</span>(i))
    copyfile(src, dst)
</pre>
</div>
</div>
</div>
<div id="outline-container-org43d39c9" class="outline-4">
<h4 id="org43d39c9"><span class="section-number-4">64.3.8.</span> current directory</h4>
<div class="outline-text-4" id="text-64-3-8">
<pre class="example">
import sys, os
os.path.abspath(sys.argv[0])
</pre>
</div>
</div>
</div>
<div id="outline-container-org1fbca1e" class="outline-3">
<h3 id="org1fbca1e"><span class="section-number-3">64.4.</span> STRINGS</h3>
<div class="outline-text-3" id="text-64-4">
</div>
<div id="outline-container-orgdcbf22e" class="outline-4">
<h4 id="orgdcbf22e"><span class="section-number-4">64.4.1.</span> String comparision</h4>
<div class="outline-text-4" id="text-64-4-1">
<p>
<a href="https://stackabuse.com/comparing-strings-using-python/">https://stackabuse.com/comparing-strings-using-python/</a>
</p>
<ul class="org-ul">
<li>== compares two variables based on their actual value</li>
<li><b>is</b> operator compares two variables based on the object id (When the variables on either side of an
operator point at the exact same object)</li>
</ul>

<p>
Rule: <b>use == when comparing immutable types (like ints) and is when comparing objects.</b>
</p>

<ul class="org-ul">
<li>a.lower() == b.lower()</li>
</ul>
</div>

<ol class="org-ol">
<li><a id="orgbad61b1"></a>difflib.SequenceMatcher - gestalt pattern matching<br />
<div class="outline-text-5" id="text-64-4-1-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">from</span> difflib <span style="color: #8ac6f2; font-weight: bold;">import</span> SequenceMatcher
<span style="color: #cae682;">m</span> = SequenceMatcher(<span style="color: #e5786d; font-weight: bold;">None</span>, <span style="color: #95e454;">"NEW YORK METS"</span>, <span style="color: #95e454;">"NEW YORK MEATS"</span>)
m.ratio() &#8658; 0.962962962963
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">disadvantage:</span>
fuzz.ratio(<span style="color: #95e454;">"YANKEES"</span>, <span style="color: #95e454;">"NEW YORK YANKEES"</span>) &#8658; 60 <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">same team</span>
fuzz.ratio(<span style="color: #95e454;">"NEW YORK METS"</span>, <span style="color: #95e454;">"NEW YORK YANKEES"</span>) &#8658; 75 <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">different teams</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">fix: best partial:</span>
<span style="color: #8ac6f2; font-weight: bold;">from</span> difflib <span style="color: #8ac6f2; font-weight: bold;">import</span> SequenceMatcher

<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">a</span>(s1,s2):
    <span style="color: #8ac6f2; font-weight: bold;">if</span> <span style="color: #e5786d;">len</span>(s1) &lt;= <span style="color: #e5786d;">len</span>(s2):
        <span style="color: #cae682;">shorter</span> = s1
        <span style="color: #cae682;">longer</span> = s2
    <span style="color: #8ac6f2; font-weight: bold;">else</span>:
        <span style="color: #cae682;">shorter</span> = s2
        <span style="color: #cae682;">longer</span> = s1

    <span style="color: #cae682;">m</span> = SequenceMatcher(<span style="color: #e5786d; font-weight: bold;">None</span>, shorter, longer)
    <span style="color: #cae682;">blocks</span> = m.get_matching_blocks()
    <span style="color: #cae682;">scores</span> = []
    <span style="color: #8ac6f2; font-weight: bold;">for</span> block <span style="color: #8ac6f2; font-weight: bold;">in</span> blocks:
        <span style="color: #cae682;">long_start</span> = block[1] - block[0] <span style="color: #8ac6f2; font-weight: bold;">if</span> (block[1] - block[0]) &gt; 0 <span style="color: #8ac6f2; font-weight: bold;">else</span> 0
        <span style="color: #cae682;">long_end</span> = long_start + <span style="color: #e5786d;">len</span>(shorter)
        <span style="color: #cae682;">long_substr</span> = longer[long_start:long_end]

        <span style="color: #cae682;">m2</span> = SequenceMatcher(<span style="color: #e5786d; font-weight: bold;">None</span>, shorter, long_substr)
        <span style="color: #cae682;">r</span> = m2.ratio()
        <span style="color: #8ac6f2; font-weight: bold;">if</span> r &gt; .995:
            <span style="color: #8ac6f2; font-weight: bold;">return</span> 100
        <span style="color: #8ac6f2; font-weight: bold;">else</span>:
            scores.append(r)

    <span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #e5786d;">int</span>(<span style="color: #e5786d;">round</span>(100 * <span style="color: #e5786d;">max</span>(scores)))

<span style="color: #cae682;">s1</span>=<span style="color: #95e454;">"MEATS"</span>
<span style="color: #cae682;">s2</span>=<span style="color: #95e454;">"NEW YORK MEATS"</span>


<span style="color: #e5786d;">print</span>(a(<span style="color: #95e454;">"asd"</span>, <span style="color: #95e454;">"123asd"</span>)) <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">100</span>
<span style="color: #e5786d;">print</span>(a(<span style="color: #95e454;">"asd"</span>, <span style="color: #95e454;">"asd123"</span>)) <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">100</span>



</pre>
</div>
</div>
</li>

<li><a id="orgab87c5b"></a><a href="https://en.wikipedia.org/wiki/Levenshtein_distance">https://en.wikipedia.org/wiki/Levenshtein_distance</a><br />
<div class="outline-text-5" id="text-64-4-1-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">levenshtein</span>(s: <span style="color: #e5786d;">str</span>, t: <span style="color: #e5786d;">str</span>) -&gt; <span style="color: #e5786d;">int</span>:
    <span style="color: #f08080; font-style: italic;">"""</span>

<span style="color: #f08080; font-style: italic;">    :param s:</span>
<span style="color: #f08080; font-style: italic;">    :param t:</span>
<span style="color: #f08080; font-style: italic;">    :return: 0 - len(s)</span>
<span style="color: #f08080; font-style: italic;">    """</span>
    <span style="color: #8ac6f2; font-weight: bold;">if</span> s == <span style="color: #95e454;">""</span>:
        <span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #e5786d;">len</span>(t)
    <span style="color: #8ac6f2; font-weight: bold;">if</span> t == <span style="color: #95e454;">""</span>:
        <span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #e5786d;">len</span>(s)
    <span style="color: #cae682;">cost</span> = 0 <span style="color: #8ac6f2; font-weight: bold;">if</span> s[-1] == t[-1] <span style="color: #8ac6f2; font-weight: bold;">else</span> 1

    <span style="color: #cae682;">i1</span> = (s[:-1], t)
    <span style="color: #8ac6f2; font-weight: bold;">if</span> <span style="color: #8ac6f2; font-weight: bold;">not</span> i1 <span style="color: #8ac6f2; font-weight: bold;">in</span> memo:
        <span style="color: #cae682;">memo</span>[i1] = levenshtein(*i1)
    <span style="color: #cae682;">i2</span> = (s, t[:-1])
    <span style="color: #8ac6f2; font-weight: bold;">if</span> <span style="color: #8ac6f2; font-weight: bold;">not</span> i2 <span style="color: #8ac6f2; font-weight: bold;">in</span> memo:
        <span style="color: #cae682;">memo</span>[i2] = levenshtein(*i2)
    <span style="color: #cae682;">i3</span> = (s[:-1], t[:-1])
    <span style="color: #8ac6f2; font-weight: bold;">if</span> <span style="color: #8ac6f2; font-weight: bold;">not</span> i3 <span style="color: #8ac6f2; font-weight: bold;">in</span> memo:
        <span style="color: #cae682;">memo</span>[i3] = levenshtein(*i3)
    <span style="color: #cae682;">res</span> = <span style="color: #e5786d;">min</span>([memo[i1] + 1, memo[i2] + 1, memo[i3] + cost])

    <span style="color: #8ac6f2; font-weight: bold;">return</span> res
</pre>
</div>
</div>
</li>
<li><a id="orgfd61830"></a>hamming distance<br />
<div class="outline-text-5" id="text-64-4-1-3">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> hashlib

<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">hamming_distance</span>(chaine1, chaine2):
    <span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #e5786d;">sum</span>(c1 != c2 <span style="color: #8ac6f2; font-weight: bold;">for</span> c1, c2 <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">zip</span>(chaine1, chaine2))

<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">hamming_distance2</span>(chaine1, chaine2):
    <span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #e5786d;">len</span>(<span style="color: #e5786d;">list</span>(<span style="color: #e5786d;">filter</span>(<span style="color: #8ac6f2; font-weight: bold;">lambda</span> x : <span style="color: #e5786d;">ord</span>(x[0])^<span style="color: #e5786d;">ord</span>(x[1]), <span style="color: #e5786d;">zip</span>(chaine1, chaine2))))
<span style="color: #e5786d;">print</span>(hamming_distance(<span style="color: #95e454;">"chaine1"</span>, <span style="color: #95e454;">"chaine2"</span>))

<span style="color: #e5786d;">print</span>(hamming_distance2(<span style="color: #95e454;">"chaine1"</span>, <span style="color: #95e454;">"chaine2"</span>))
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-orgb89f85e" class="outline-4">
<h4 id="orgb89f85e"><span class="section-number-4">64.4.2.</span> Remove whitespaces</h4>
<div class="outline-text-4" id="text-64-4-2">
<pre class="example">
line = " ".join(line.split()) # resplit
</pre>
</div>
</div>
<div id="outline-container-orga15921d" class="outline-4">
<h4 id="orga15921d"><span class="section-number-4">64.4.3.</span> Unicode</h4>
<div class="outline-text-4" id="text-64-4-3">
<ul class="org-ul">
<li>'\u2116'.encode("unicode<sub>escape</sub>")
<ul class="org-ul">
<li>b'\\u2116'</li>
</ul></li>
<li>print('№'.encode("unicode<sub>escape</sub>"))
<ul class="org-ul">
<li>b'\\u2116'</li>
</ul></li>
<li>print('\u2116'.encode("utf-8")) # sometimes do wrong
<ul class="org-ul">
<li>b'\xe2\x84\x96'</li>
</ul></li>
<li>print(b'\xe2\x84\x96'.decode('utf-8'))
<ul class="org-ul">
<li>№</li>
</ul></li>
<li>print('\u2116'.encode("utf-8").decode('utf-8'))
<ul class="org-ul">
<li>№</li>
</ul></li>
</ul>
</div>


<ol class="org-ol">
<li><a id="org5c5a60f"></a>terms<br />
<div class="outline-text-5" id="text-64-4-3-1">
<ul class="org-ul">
<li><b>code points</b>, first two characters are always "U+", hexadecimal.  At least 4 hexadecimal digits are shown,
prepended with leading zeros as needed. ex: U+00F7</li>
<li>BOM -  magic number at the start of a text
<ul class="org-ul">
<li>UTF-8 byte sequence EF BB BF, permits the BOM in UTF-8, but does not require or recommend its use.</li>
<li>Not using a BOM allows text to be backwards-compatible with software designed for extended ASCII.</li>
<li>In UTF-16, a BOM (U+FEFF), byte sequence FE FF</li>
</ul></li>
<li><b>UTF-8 Encoding</b> or <b>Hex UTF-8</b> - hex representation of encoded 1-4 bytes.</li>
</ul>
</div>
</li>
<li><a id="org183d818"></a>Encoding formats: UTF-8, UTF-16, GB18030, UTF-32<br />
<div class="outline-text-5" id="text-64-4-3-2">
<p>
utf-8
</p>
<ul class="org-ul">
<li>ASCII-compatible</li>
<li>1-4 bytes for each code point</li>
</ul>

<p>
UTF-16
</p>
<ul class="org-ul">
<li>ASCII-compatible</li>
</ul>

<p>
GB18030
</p>
</div>
</li>

<li><a id="org4c8fb83"></a>utf-8<br />
<div class="outline-text-5" id="text-64-4-3-3">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">First code point</th>
<th scope="col" class="org-left">Last code point</th>
<th scope="col" class="org-right">Byte 1</th>
<th scope="col" class="org-right">Byte 2</th>
<th scope="col" class="org-left">Byte 3</th>
<th scope="col" class="org-left">Byte 4</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">U+0000</td>
<td class="org-left">U+007F</td>
<td class="org-right">0xxxxxxx</td>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">U+0080</td>
<td class="org-left">U+07FF</td>
<td class="org-right">110xxxxx</td>
<td class="org-right">10xxxxxx</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">U+0800</td>
<td class="org-left">U+FFFF</td>
<td class="org-right">1110xxxx</td>
<td class="org-right">10xxxxxx</td>
<td class="org-left">10xxxxxx</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">U+10000</td>
<td class="org-left">U+10FFFF</td>
<td class="org-right">11110xxx</td>
<td class="org-right">10xxxxxx</td>
<td class="org-left">10xxxxxx</td>
<td class="org-left">10xxxxxx</td>
</tr>
</tbody>
</table>
</div>
</li>
</ol>
</div>

<div id="outline-container-org7e7e1dd" class="outline-4">
<h4 id="org7e7e1dd"><span class="section-number-4">64.4.4.</span> To find all the repeating substring in a given string</h4>
<div class="outline-text-4" id="text-64-4-4">
<p>
<a href="https://stackoverflow.com/questions/41077268/python-find-repeated-substring-in-string">https://stackoverflow.com/questions/41077268/python-find-repeated-substring-in-string</a>
</p>

<p>
You can do it by repeating the substring a certain number of times and testing if it is equal to the original string.
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">levenshtein</span>(s: <span style="color: #e5786d;">str</span>, t: <span style="color: #e5786d;">str</span>) -&gt; <span style="color: #e5786d;">int</span>:
    <span style="color: #f08080; font-style: italic;">"""</span>

<span style="color: #f08080; font-style: italic;">    :param s:</span>
<span style="color: #f08080; font-style: italic;">    :param t:</span>
<span style="color: #f08080; font-style: italic;">    :return: 0 - len(s)</span>
<span style="color: #f08080; font-style: italic;">    """</span>
    <span style="color: #8ac6f2; font-weight: bold;">if</span> s == <span style="color: #95e454;">""</span>:
        <span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #e5786d;">len</span>(t)
    <span style="color: #8ac6f2; font-weight: bold;">if</span> t == <span style="color: #95e454;">""</span>:
        <span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #e5786d;">len</span>(s)
    <span style="color: #cae682;">cost</span> = 0 <span style="color: #8ac6f2; font-weight: bold;">if</span> s[-1] == t[-1] <span style="color: #8ac6f2; font-weight: bold;">else</span> 1

    <span style="color: #cae682;">i1</span> = (s[:-1], t)
    <span style="color: #8ac6f2; font-weight: bold;">if</span> <span style="color: #8ac6f2; font-weight: bold;">not</span> i1 <span style="color: #8ac6f2; font-weight: bold;">in</span> memo:
        <span style="color: #cae682;">memo</span>[i1] = levenshtein(*i1)
    <span style="color: #cae682;">i2</span> = (s, t[:-1])
    <span style="color: #8ac6f2; font-weight: bold;">if</span> <span style="color: #8ac6f2; font-weight: bold;">not</span> i2 <span style="color: #8ac6f2; font-weight: bold;">in</span> memo:
        <span style="color: #cae682;">memo</span>[i2] = levenshtein(*i2)
    <span style="color: #cae682;">i3</span> = (s[:-1], t[:-1])
    <span style="color: #8ac6f2; font-weight: bold;">if</span> <span style="color: #8ac6f2; font-weight: bold;">not</span> i3 <span style="color: #8ac6f2; font-weight: bold;">in</span> memo:
        <span style="color: #cae682;">memo</span>[i3] = levenshtein(*i3)
    <span style="color: #cae682;">res</span> = <span style="color: #e5786d;">min</span>([memo[i1] + 1, memo[i2] + 1, memo[i3] + cost])

    <span style="color: #8ac6f2; font-weight: bold;">return</span> res


<span style="color: #cae682;">c</span> = <span style="color: #95e454;">'03105591400310559140031055914003105591400310559140031055914003105591400310559140'</span>
<span style="color: #cae682;">c</span> = <span style="color: #95e454;">'0310559140031055914031055914003105591400310591400310559140031055910030559140'</span>
<span style="color: #cae682;">a</span>=[]
<span style="color: #8ac6f2; font-weight: bold;">for</span> j <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">range</span>(10):
    <span style="color: #8ac6f2; font-weight: bold;">for</span> i <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">range</span>(7):
        <span style="color: #8ac6f2; font-weight: bold;">if</span> (i*10+10+j) &lt;= <span style="color: #e5786d;">len</span>(c):
            a.append(c[i*10+j:i*10+10+j])
<span style="color: #cae682;">v</span> = {x: a.count(x) <span style="color: #8ac6f2; font-weight: bold;">for</span> x <span style="color: #8ac6f2; font-weight: bold;">in</span> a <span style="color: #8ac6f2; font-weight: bold;">if</span> a.count(x) &gt;2}
<span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">for k in v.keys():</span>
<span style="color: #fa8072;">#    </span><span style="color: #99968b; font-style: italic;">print(k, levenshtein(k*8,c)</span>
<span style="color: #cae682;">re</span> = {k: levenshtein(k*8,c) <span style="color: #8ac6f2; font-weight: bold;">for</span> k <span style="color: #8ac6f2; font-weight: bold;">in</span> v.keys()}
<span style="color: #e5786d;">print</span>(<span style="color: #e5786d;">sorted</span>(re, key=re.__getitem__)[0]) <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">asc</span>
0310559140 4
3105591400 6
1055914003 8
0559140031 10
5591400310 12
5914003105 14
9140031055 12
1400310559 10
4003105591 8
0031055914 6
<span style="color: #95e454;">'3105591400310559140031055914003105591400310559140031055914003105591400310559140'</span>
3105591400 1
1055914003 3
0559140031 5
5591400310 7
5914003105 9
9140031055 9
1400310559 7
4003105591 5
0031055914 3
0310559140 1 - THIS
</pre>
</div>
</div>
</div>

<div id="outline-container-org3533739" class="outline-4">
<h4 id="org3533739"><span class="section-number-4">64.4.5.</span> first substring</h4>
<div class="outline-text-4" id="text-64-4-5">
<ul class="org-ul">
<li>str.find</li>
<li>by regex:</li>
</ul>
<pre class="example">
m = re.search("[0-9]*")
  if m:
    num = d[m.start():m.end()]
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb1d246d" class="outline-3">
<h3 id="orgb1d246d"><span class="section-number-3">64.5.</span> DICT</h3>
<div class="outline-text-3" id="text-64-5">
<p>
<b>add</b>
</p>
<pre class="example">
d1.update(d2) # d1 = d1+d2
</pre>


<p>
<b>find max value</b>
</p>
<pre class="example">
import operator
max(d1.items(), key=operator.itemgetter(1))[0]
</pre>


<p>
<b>for</b>
</p>
<ul class="org-ul">
<li>for key in dict:</li>
<li>for key, value in dict.items():</li>
</ul>

<p>
<b>sorted dict</b>
</p>
<pre class="example">
abb_sel_diff_middle[wind] = sum/len(abb_sel_diff[wind])
c = sorted(abb_sel_diff_middle.items(), key=lambda kv: kv[1], reverse=True) #dsc
numbers = {'first': 2, 'second': 1, 'third': 3, 'Fourth': 4}
sorted(numbers, key=numbers.__getitem__)
&gt;&gt;['second', 'first', 'third', 'Fourth']
</pre>


<p>
<b>merge two dicts</b>
</p>
<pre class="example">
z={**x, **y}
</pre>
</div>
<div id="outline-container-org6aa04c5" class="outline-4">
<h4 id="org6aa04c5"><span class="section-number-4">64.5.1.</span> del</h4>
<div class="outline-text-4" id="text-64-5-1">
<p>
<b>loop with clone</b>
</p>
<pre class="example">
for k,v in list(d.items()):
  if v is bad:
     del d[k]
# or
{k,v for k,v in list(d.items()) if v is not bad}
</pre>


<p>
<b>filter</b>
</p>
<pre class="example">
self.contours = list(filter(lambda a: a is not None, self.contours))
</pre>
</div>
</div>
</div>

<div id="outline-container-org78b756e" class="outline-3">
<h3 id="org78b756e"><span class="section-number-3">64.6.</span> argparse: command line arguments</h3>
<div class="outline-text-3" id="text-64-6">
</div>
<div id="outline-container-org8ea47ca" class="outline-4">
<h4 id="org8ea47ca"><span class="section-number-4">64.6.1.</span> terms</h4>
<div class="outline-text-4" id="text-64-6-1">
<ul class="org-ul">
<li>positional arguments - arguments without options (main.py input<sub>file.txt</sub>)</li>
<li>options that accept values (&#x2013;file a.txt)</li>
<li>on/off flags - options without any vaues (&#x2013;overwrite)</li>
</ul>
</div>
</div>
<div id="outline-container-org209bade" class="outline-4">
<h4 id="org209bade"><span class="section-number-4">64.6.2.</span> usage</h4>
<div class="outline-text-4" id="text-64-6-2">
<pre class="example">
import sys
&gt;&gt;&gt; print(sys.argv)
</pre>


<p>
or
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> argparse



<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">main</span>(args):
    args.batch_size

<span style="color: #8ac6f2; font-weight: bold;">if</span> <span style="color: #e5786d;">__name__</span> == <span style="color: #95e454;">'__main__'</span>:
<span style="color: #cae682;">parser</span> = argparse.ArgumentParser()
    parser.add_argument(<span style="color: #95e454;">"--data_dir"</span>, <span style="color: #e5786d;">help</span>=<span style="color: #95e454;">"data directory"</span>, default=<span style="color: #95e454;">'./data'</span>)
    parser.add_argument(<span style="color: #95e454;">"--default_settings"</span>, <span style="color: #e5786d;">help</span>=<span style="color: #95e454;">"use default settings"</span>, <span style="color: #e5786d;">type</span>=<span style="color: #e5786d;">bool</span>, default=<span style="color: #e5786d; font-weight: bold;">True</span>)
    parser.add_argument(<span style="color: #95e454;">"--combine_train_val"</span>, <span style="color: #e5786d;">help</span>=<span style="color: #95e454;">"combine the training and validation sets for testing"</span>, <span style="color: #e5786d;">type</span>=<span style="color: #e5786d;">bool</span>,
                        default=<span style="color: #e5786d; font-weight: bold;">False</span>)
    main(parser.parse_args())

</pre>
</div>
</div>
</div>
<div id="outline-container-org6d5357f" class="outline-4">
<h4 id="org6d5357f"><span class="section-number-4">64.6.3.</span> optional positional argument</h4>
<div class="outline-text-4" id="text-64-6-3">
<p>
parser.add<sub>argument</sub>('bar', nargs='?', default='d')
</p>
</div>
</div>
</div>
<div id="outline-container-org332642c" class="outline-3">
<h3 id="org332642c"><span class="section-number-3">64.7.</span> way to terminate</h3>
<div class="outline-text-3" id="text-64-7">
<p>
sys.exit()
</p>
</div>
</div>

<div id="outline-container-org76abe0f" class="outline-3">
<h3 id="org76abe0f"><span class="section-number-3">64.8.</span> JSON</h3>
<div class="outline-text-3" id="text-64-8">
<p>
may be array or object
</p>
<ul class="org-ul">
<li>замана " на  \"</li>
<li>замена \ на <br /></li>
</ul>
</div>
</div>

<div id="outline-container-org4d6665c" class="outline-3">
<h3 id="org4d6665c"><span class="section-number-3">64.9.</span> NN EQUAL QUANTITY FROM SAMPLES</h3>
<div class="outline-text-3" id="text-64-9">
<div class="org-src-container">
<pre class="src src-python">    <span style="color: #cae682;">lim</span> = <span style="color: #e5786d;">max</span>(count.values())*2 <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">limit for all groups</span>
    <span style="color: #e5786d;">print</span>(count.values())
    <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">'max'</span>, <span style="color: #e5786d;">max</span>)

    <span style="color: #8ac6f2; font-weight: bold;">for</span> _, v <span style="color: #8ac6f2; font-weight: bold;">in</span> count.items(): <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">v - quantity</span>
        <span style="color: #cae682;">c</span> = 0 <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">current quantity</span>
        <span style="color: #8ac6f2; font-weight: bold;">for</span> _ <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">range</span>(v):  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">i - v-1</span>
            <span style="color: #cae682;">r</span> = <span style="color: #e5786d;">round</span>(lim / v) <span style="color: #fa8072;">#</span>
            <span style="color: #8ac6f2; font-weight: bold;">if</span> c &lt; lim + r:
                <span style="color: #cae682;">diff</span> = 0
                <span style="color: #8ac6f2; font-weight: bold;">if</span> (c + r) &gt; lim:
                    <span style="color: #cae682;">diff</span> = c + r - lim
                <span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">create: r - diff</span>
                <span style="color: #cae682;">c</span> += r - diff <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">may be removed</span>
        <span style="color: #e5786d;">print</span>(c)

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Or in class -------------</span>
<span style="color: #8ac6f2; font-weight: bold;">import</span> math

<span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">Counter</span>:
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">__init__</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>, limit):  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">, multiplyer):</span>
        <span style="color: #8ac6f2; font-weight: bold;">self</span>.<span style="color: #cae682;">lim</span>: <span style="color: #e5786d;">int</span> = limit  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">int(max(amounts) * multiplyer)</span>
        <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"Counter limit:"</span>, <span style="color: #8ac6f2; font-weight: bold;">self</span>.lim)

    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">new_count</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>, one_amount):
        <span style="color: #8ac6f2; font-weight: bold;">self</span>.<span style="color: #cae682;">c</span>: <span style="color: #e5786d;">int</span> = 0  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">done counter</span>
        <span style="color: #8ac6f2; font-weight: bold;">self</span>.<span style="color: #cae682;">r</span>: <span style="color: #e5786d;">int</span> = math.ceil(<span style="color: #8ac6f2; font-weight: bold;">self</span>.lim / one_amount)  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">multiplyer</span>
        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">x + y = one_amount</span>
        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">x* r + y = lim</span>
        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">y = one_amount - x  # without duplicates</span>
        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">x*r + one_amount - x = lim  # with duplicates</span>
        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">x*(r - 1) = lim - one_amount</span>
        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">x = (lim - one_amount) / (r - 1)</span>
        <span style="color: #8ac6f2; font-weight: bold;">if</span> <span style="color: #8ac6f2; font-weight: bold;">self</span>.r == 1:
            <span style="color: #8ac6f2; font-weight: bold;">self</span>.<span style="color: #cae682;">wd</span> = <span style="color: #8ac6f2; font-weight: bold;">self</span>.lim
        <span style="color: #8ac6f2; font-weight: bold;">else</span>:
            <span style="color: #8ac6f2; font-weight: bold;">self</span>.<span style="color: #cae682;">wd</span> = (<span style="color: #8ac6f2; font-weight: bold;">self</span>.lim - one_amount) / (<span style="color: #8ac6f2; font-weight: bold;">self</span>.r - 1)    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">take duplicates</span>
            <span style="color: #8ac6f2; font-weight: bold;">self</span>.<span style="color: #cae682;">wd</span> = <span style="color: #8ac6f2; font-weight: bold;">self</span>.wd * <span style="color: #8ac6f2; font-weight: bold;">self</span>.r

    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">how_many_now</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>) -&gt; <span style="color: #e5786d;">int</span>:
        <span style="color: #f08080; font-style: italic;">""" called one_amount times</span>
<span style="color: #f08080; font-style: italic;">        :return how many times repeat this sample to equal this one_amount to others</span>
<span style="color: #f08080; font-style: italic;">        """</span>
        <span style="color: #cae682;">diff</span>: <span style="color: #e5786d;">int</span> = 0
        <span style="color: #8ac6f2; font-weight: bold;">if</span> <span style="color: #8ac6f2; font-weight: bold;">self</span>.c &gt; <span style="color: #8ac6f2; font-weight: bold;">self</span>.wd:
            <span style="color: #cae682;">r</span>: <span style="color: #e5786d;">int</span> = 1
        <span style="color: #8ac6f2; font-weight: bold;">else</span>:
            <span style="color: #cae682;">r</span>: <span style="color: #e5786d;">int</span> = <span style="color: #8ac6f2; font-weight: bold;">self</span>.r
        <span style="color: #8ac6f2; font-weight: bold;">if</span> (<span style="color: #8ac6f2; font-weight: bold;">self</span>.c + r) &gt; <span style="color: #8ac6f2; font-weight: bold;">self</span>.lim:
            <span style="color: #cae682;">diff</span> = <span style="color: #8ac6f2; font-weight: bold;">self</span>.c + r - <span style="color: #8ac6f2; font-weight: bold;">self</span>.lim  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">last return</span>

        <span style="color: #8ac6f2; font-weight: bold;">self</span>.<span style="color: #cae682;">c</span> += r - diff  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">update counter</span>
        <span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #e5786d;">int</span>(r - diff)

<span style="color: #cae682;">counts</span> = [20,30,10,7,100]
<span style="color: #cae682;">multiplyer</span> = 2
<span style="color: #cae682;">counter</span> = Counter(counts, multiplyer)
<span style="color: #8ac6f2; font-weight: bold;">for</span> v <span style="color: #8ac6f2; font-weight: bold;">in</span> counts:  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">v - quantity</span>
    counter.new_count(v)
    <span style="color: #cae682;">c</span> = 0
    <span style="color: #8ac6f2; font-weight: bold;">for</span> _ <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">range</span>(v):  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">i - v-1 # one item</span>
        <span style="color: #cae682;">c</span> += counter.how_many_now()
    <span style="color: #e5786d;">print</span>(c)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd0b8511" class="outline-3">
<h3 id="orgd0b8511"><span class="section-number-3">64.10.</span> most common ellement</h3>
<div class="outline-text-3" id="text-64-10">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">most_common</span>(lst):
    <span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #e5786d;">max</span>(<span style="color: #e5786d;">set</span>(lst), key=lst.count)

<span style="color: #cae682;">mc</span> = most_common([<span style="color: #e5786d;">round</span>(a, 1) <span style="color: #8ac6f2; font-weight: bold;">for</span> a <span style="color: #8ac6f2; font-weight: bold;">in</span> degrees <span style="color: #8ac6f2; font-weight: bold;">if</span> <span style="color: #e5786d;">abs</span>(a) != 0])
<span style="color: #cae682;">filtered_degrees</span> = []
<span style="color: #8ac6f2; font-weight: bold;">for</span> a <span style="color: #8ac6f2; font-weight: bold;">in</span> degrees:
    <span style="color: #8ac6f2; font-weight: bold;">if</span> <span style="color: #e5786d;">round</span>(a, 1) == mc:
       filtered_degrees.append(a)
<span style="color: #cae682;">med_degree</span> = <span style="color: #e5786d;">float</span>(np.median(filtered_degrees))


<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">max char</span>
<span style="color: #cae682;">s3</span> = <span style="color: #95e454;">'BEBBBB'</span>
<span style="color: #cae682;">s3</span> = {x: s3.count(x) <span style="color: #8ac6f2; font-weight: bold;">for</span> x <span style="color: #8ac6f2; font-weight: bold;">in</span> s3}
<span style="color: #cae682;">mc</span> = <span style="color: #e5786d;">sorted</span>(s3.values())[-1]
<span style="color: #cae682;">s3</span> = [key <span style="color: #8ac6f2; font-weight: bold;">for</span> key, value <span style="color: #8ac6f2; font-weight: bold;">in</span> s3.items() <span style="color: #8ac6f2; font-weight: bold;">if</span> value == mc][0]  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">most common</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1b7fa83" class="outline-3">
<h3 id="org1b7fa83"><span class="section-number-3">64.11.</span> print numpers</h3>
<div class="outline-text-3" id="text-64-11">
<pre class="example">
n=123123123412
print(f"{n:,}")
</pre>

<p>
&gt;&gt;&gt; 123,123,123,412
</p>
</div>
</div>
<div id="outline-container-orge1b3667" class="outline-3">
<h3 id="orge1b3667"><span class="section-number-3">64.12.</span> SCALE</h3>
<div class="outline-text-3" id="text-64-12">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">to range 0 1</span>
<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">scaler_simple</span>(data: np.array) -&gt; np.array:
    <span style="color: #f08080; font-style: italic;">""" in range (0,1)</span>

<span style="color: #f08080; font-style: italic;">    :param data: one dimensions</span>
<span style="color: #f08080; font-style: italic;">    :return:(0,1)</span>
<span style="color: #f08080; font-style: italic;">    """</span>
    <span style="color: #cae682;">data_min</span> = np.nanmin(data)
    <span style="color: #cae682;">data_max</span> = np.nanmax(data)
    <span style="color: #cae682;">data</span> = (data - data_min) / (data_max - data_min)
    <span style="color: #8ac6f2; font-weight: bold;">return</span> data

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">-(0 - 5) / 5</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">to range -1 1</span>
<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">scaler_simple</span>(data: np.array) -&gt; np.array:
    <span style="color: #f08080; font-style: italic;">""" in range (0,1)</span>

<span style="color: #f08080; font-style: italic;">    :param data: one dimensions</span>
<span style="color: #f08080; font-style: italic;">    :return:(0,1)</span>
<span style="color: #f08080; font-style: italic;">    """</span>
    <span style="color: #cae682;">data_min</span> = np.nanmin(data)
    <span style="color: #cae682;">data_max</span> = np.nanmax(data)
    <span style="color: #cae682;">data</span> =(data_max/2 - data) / (data_max - data_min) / 2
    <span style="color: #8ac6f2; font-weight: bold;">return</span> data

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">(0,1) to (-1,1)</span>
<span style="color: #cae682;">data</span> = (0.5 - data) / 0.5
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">(-1,1) to (0,1)</span>
<span style="color: #cae682;">data</span> = (1 - data) / 2

<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">my_scaler</span>(data: np.array) -&gt; np.array:
    <span style="color: #f08080; font-style: italic;">""" data close to 0 will not add much value to the learning process</span>

<span style="color: #f08080; font-style: italic;">    :param data: two dimensions 0 - time, 1 - prices</span>
<span style="color: #f08080; font-style: italic;">    :return:</span>
<span style="color: #f08080; font-style: italic;">    """</span>

    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">data = scaler(data, axis=0)</span>
    <span style="color: #cae682;">smoothing_window_size</span> = data.shape[0] // 2  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">for 10000 - 4</span>
    <span style="color: #cae682;">dl</span> = []
    <span style="color: #8ac6f2; font-weight: bold;">for</span> di <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">range</span>(0, <span style="color: #e5786d;">len</span>(data), smoothing_window_size):
        <span style="color: #cae682;">window</span> = data[di:di + smoothing_window_size]
        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">print(window.shape)</span>
        <span style="color: #cae682;">window</span> = scaler(window, axis=1)
        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">print(window[0], window[-1])</span>
        dl.append(window)  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">last line will be shorter</span>

    <span style="color: #8ac6f2; font-weight: bold;">return</span> np.concatenate(dl)
</pre>
</div>
</div>
</div>
<div id="outline-container-orge7d97d7" class="outline-3">
<h3 id="orge7d97d7"><span class="section-number-3">64.13.</span> smoth</h3>
<div class="outline-text-3" id="text-64-13">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">savitzky_golay</span>(y, window_size, order, deriv=0, rate=1):

    <span style="color: #8ac6f2; font-weight: bold;">import</span> numpy <span style="color: #8ac6f2; font-weight: bold;">as</span> np
    <span style="color: #8ac6f2; font-weight: bold;">from</span> math <span style="color: #8ac6f2; font-weight: bold;">import</span> factorial

    <span style="color: #8ac6f2; font-weight: bold;">try</span>:
        <span style="color: #cae682;">window_size</span> = np.<span style="color: #e5786d;">abs</span>(np.<span style="color: #e5786d;">int</span>(window_size))
        <span style="color: #cae682;">order</span> = np.<span style="color: #e5786d;">abs</span>(np.<span style="color: #e5786d;">int</span>(order))
    <span style="color: #8ac6f2; font-weight: bold;">except</span> <span style="color: #92a65e; font-weight: bold;">ValueError</span> <span style="color: #8ac6f2; font-weight: bold;">as</span> msg:
        <span style="color: #8ac6f2; font-weight: bold;">raise</span> <span style="color: #92a65e; font-weight: bold;">ValueError</span>(<span style="color: #95e454;">"window_size and order have to be of type int:"</span>, msg)
    <span style="color: #8ac6f2; font-weight: bold;">if</span> window_size % 2 != 1 <span style="color: #8ac6f2; font-weight: bold;">or</span> window_size &lt; 1:
        <span style="color: #8ac6f2; font-weight: bold;">raise</span> <span style="color: #92a65e; font-weight: bold;">TypeError</span>(<span style="color: #95e454;">"window_size size must be a positive odd number"</span>)
    <span style="color: #8ac6f2; font-weight: bold;">if</span> window_size &lt; order + 2:
        <span style="color: #8ac6f2; font-weight: bold;">raise</span> <span style="color: #92a65e; font-weight: bold;">TypeError</span>(<span style="color: #95e454;">"window_size is too small for the polynomials order"</span>)
    <span style="color: #cae682;">order_range</span> = <span style="color: #e5786d;">range</span>(order+1)
    <span style="color: #cae682;">half_window</span> = (window_size -1) // 2
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">precompute coefficients</span>
    <span style="color: #cae682;">b</span> = np.mat([[k**i <span style="color: #8ac6f2; font-weight: bold;">for</span> i <span style="color: #8ac6f2; font-weight: bold;">in</span> order_range] <span style="color: #8ac6f2; font-weight: bold;">for</span> k <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">range</span>(-half_window, half_window+1)])
    <span style="color: #cae682;">m</span> = np.linalg.pinv(b).A[deriv] * rate**deriv * factorial(deriv)
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">pad the signal at the extremes with</span>
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">values taken from the signal itself</span>
    <span style="color: #cae682;">firstvals</span> = y[0] - np.<span style="color: #e5786d;">abs</span>(y[1:half_window+1][::-1] - y[0])
    <span style="color: #cae682;">lastvals</span> = y[-1] + np.<span style="color: #e5786d;">abs</span>(y[-half_window-1:-1][::-1] - y[-1])
    <span style="color: #cae682;">y</span> = np.concatenate((firstvals, y, lastvals))
    <span style="color: #8ac6f2; font-weight: bold;">return</span> np.convolve(m[::-1], y, mode=<span style="color: #95e454;">'valid'</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-orga7d970c" class="outline-3">
<h3 id="orga7d970c"><span class="section-number-3">64.14.</span> one-hot encoding</h3>
<div class="outline-text-3" id="text-64-14">
</div>
<div id="outline-container-orge035298" class="outline-4">
<h4 id="orge035298"><span class="section-number-4">64.14.1.</span> we have [1,3] [1,2,3,4], [3,4] -&gt; numbers</h4>
<div class="outline-text-4" id="text-64-14-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> numpy <span style="color: #8ac6f2; font-weight: bold;">as</span> np
<span style="color: #cae682;">nb_classes</span> = 4
<span style="color: #cae682;">targets</span> = np.array([[2, 3, 4, 0]]).reshape(-1)
<span style="color: #cae682;">one_hot_targets</span> = np.eye(nb_classes)[targets]
<span style="color: #cae682;">res</span>:<span style="color: #e5786d;">int</span> = <span style="color: #e5786d;">sum</span>([x*(2**i) <span style="color: #8ac6f2; font-weight: bold;">for</span> i, x <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">enumerate</span>(<span style="color: #e5786d;">sum</span>(one_hot_targets))]) <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">from binary to integer</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org4eac5cf" class="outline-4">
<h4 id="org4eac5cf"><span class="section-number-4">64.14.2.</span> column of strings</h4>
<div class="outline-text-4" id="text-64-14-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">one_h_str_col</span>(col: np.array, name: <span style="color: #e5786d;">str</span>):
    <span style="color: #cae682;">c</span> = <span style="color: #e5786d;">list</span>(<span style="color: #e5786d;">set</span>(col))  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">unique</span>
    <span style="color: #e5786d;">print</span>(name, c)  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">encoding</span>
    <span style="color: #cae682;">res_col</span> = []
    <span style="color: #8ac6f2; font-weight: bold;">for</span> x <span style="color: #8ac6f2; font-weight: bold;">in</span> col:
        <span style="color: #cae682;">ind</span> = c.index(x)
        res_col.append(ind)
    <span style="color: #8ac6f2; font-weight: bold;">return</span> np.array(res_col)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org7b1a1c9" class="outline-3">
<h3 id="org7b1a1c9"><span class="section-number-3">64.15.</span> binary encoding</h3>
<div class="outline-text-3" id="text-64-15">
<div class="org-src-container">
<pre class="src src-python">            <span style="color: #cae682;">s_ids</span> = []
            <span style="color: #8ac6f2; font-weight: bold;">for</span> service_id, cost <span style="color: #8ac6f2; font-weight: bold;">in</span> cursor1.fetchall():  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">service_id = None, 1,2,3,4</span>
                <span style="color: #cae682;">service_id</span> = 0 <span style="color: #8ac6f2; font-weight: bold;">if</span> service_id <span style="color: #8ac6f2; font-weight: bold;">is</span> <span style="color: #e5786d; font-weight: bold;">None</span> <span style="color: #8ac6f2; font-weight: bold;">else</span> <span style="color: #e5786d;">int</span>(service_id)
                s_ids.append(<span style="color: #e5786d;">int</span>(service_id))
            <span style="color: #cae682;">targets</span> = np.array(s_ids).reshape(-1)
            <span style="color: #cae682;">s_id</span> = 0
            <span style="color: #8ac6f2; font-weight: bold;">if</span> targets:
                <span style="color: #cae682;">one_hot_targets</span> = np.eye(6)[targets]  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">5 classes</span>
                <span style="color: #cae682;">s_id</span>: <span style="color: #e5786d;">int</span> = <span style="color: #e5786d;">sum</span>([x * (2 ** i) <span style="color: #8ac6f2; font-weight: bold;">for</span> i, x <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">enumerate</span>(<span style="color: #e5786d;">sum</span>(one_hot_targets))])  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">from binary to integer</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org546e879" class="outline-3">
<h3 id="org546e879"><span class="section-number-3">64.16.</span> map encoding</h3>
<div class="outline-text-3" id="text-64-16">
<pre class="example">
df['`condition`'] = df['`condition`'].map({'new': 0, 'uses': 1})
</pre>
</div>
</div>
<div id="outline-container-orgf24ad2a" class="outline-3">
<h3 id="orgf24ad2a"><span class="section-number-3">64.17.</span> Accuracy</h3>
<div class="outline-text-3" id="text-64-17">
<pre class="example">
import numpy as np
</pre>


<p>
Accuracy = (TP+TN)/(TP+TN+FP+FN):
</p>
<pre class="example">
print("%f" % (np.round(ypred2) != labels_test).mean())
</pre>


<p>
Precision = (TP) / (TP+FP)
</p>
</div>
</div>

<div id="outline-container-orgb546fdc" class="outline-3">
<h3 id="orgb546fdc"><span class="section-number-3">64.18.</span> garbage collect</h3>
<div class="outline-text-3" id="text-64-18">
<p>
del train, test; gc.collect()
</p>
</div>
</div>

<div id="outline-container-org74c9dac" class="outline-3">
<h3 id="org74c9dac"><span class="section-number-3">64.19.</span> Class <b>loop for member varibles</b></h3>
<div class="outline-text-3" id="text-64-19">
<pre class="example">
for x in vars(instance): # string names
   v = vars(e)[x]  # varible
</pre>
</div>
</div>
<div id="outline-container-org5a3c82e" class="outline-3">
<h3 id="org5a3c82e"><span class="section-number-3">64.20.</span> filter special characters</h3>
<div class="outline-text-3" id="text-64-20">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"asd"</span>)
<span style="color: #8ac6f2; font-weight: bold;">import</span> re
<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">remove_special_characters</span>(character):
    <span style="color: #8ac6f2; font-weight: bold;">if</span> character.isalnum() <span style="color: #8ac6f2; font-weight: bold;">or</span> character == <span style="color: #95e454;">' '</span>:
        <span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #e5786d; font-weight: bold;">True</span>
    <span style="color: #8ac6f2; font-weight: bold;">else</span>:
        <span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #e5786d; font-weight: bold;">False</span>
<span style="color: #cae682;">text</span> = <span style="color: #95e454;">'datagy -- is. great!'</span>
<span style="color: #cae682;">new_text</span> = <span style="color: #95e454;">''</span>.join(<span style="color: #e5786d;">filter</span>(remove_special_characters, text))
<span style="color: #e5786d;">print</span>(new_text)
</pre>
</div>
</div>
</div>

<div id="outline-container-org52b9cd1" class="outline-3">
<h3 id="org52b9cd1"><span class="section-number-3">64.21.</span> measure time</h3>
<div class="outline-text-3" id="text-64-21">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> time
<span style="color: #cae682;">start_time</span> = time.time()
main()
<span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"--- %s seconds ---"</span> % (time.time() - start_time))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd0ab434" class="outline-3">
<h3 id="orgd0ab434"><span class="section-number-3">64.22.</span> primes in interval</h3>
<div class="outline-text-3" id="text-64-22">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">!/usr/bin/python</span>
<span style="color: #8ac6f2; font-weight: bold;">import</span> sys
<span style="color: #cae682;">m</span> = 2
<span style="color: #cae682;">n</span> = 10
<span style="color: #cae682;">primes</span> = [i <span style="color: #8ac6f2; font-weight: bold;">for</span> i <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">range</span>(m,n) <span style="color: #8ac6f2; font-weight: bold;">if</span> <span style="color: #e5786d;">all</span>(i%j !=0 <span style="color: #8ac6f2; font-weight: bold;">for</span> j <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">range</span>(2,<span style="color: #e5786d;">int</span>(i**0.5) + 1))]
<span style="color: #e5786d;">print</span>(primes)
</pre>
</div>

<pre class="example">
[2, 3, 5, 7]
</pre>
</div>
</div>

<div id="outline-container-org3843fea" class="outline-3">
<h3 id="org3843fea"><span class="section-number-3">64.23.</span> unicode characters in interval</h3>
<div class="outline-text-3" id="text-64-23">
<p>
emacs character info: C-x =
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> sys
<span style="color: #cae682;">a</span> = 945
<span style="color: #cae682;">b</span> = 961
<span style="color: #8ac6f2; font-weight: bold;">for</span> i <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">range</span>(a,b + 1):
    <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">" "</span>.join([<span style="color: #e5786d;">str</span>(i),<span style="color: #95e454;">" "</span>,<span style="color: #e5786d;">chr</span>(i)]))
</pre>
</div>

<pre class="example" id="org71a58df">
945   α
946   β
947   γ
948   δ
949   ε
950   ζ
951   η
952   θ
953   ι
954   κ
955   λ
956   μ
957   ν
958   ξ
959   ο
960   π
961   ρ
</pre>
</div>
</div>
</div>

<div id="outline-container-org0a5d6ee" class="outline-2">
<h2 id="org0a5d6ee"><span class="section-number-2">65.</span> Flask</h2>
<div class="outline-text-2" id="text-65">
<ul class="org-ul">
<li>Flask and Quart built on Werkzeug and uses Jinja for templating.</li>
<li>Flask wraps Werkzeug, allowing it to take care of the WSGI intricacies while also offering extra structure
and patterns for creating powerful applications.</li>
<li>Quart — an async reimplementation of flask</li>
</ul>

<p>
Flask will never have a database layer. Flask itself just bridges to Werkzeug to implement a proper WSGI
 application and to Jinja2 to handle templating. It also binds to a few common standard library packages such
 as logging. Everything else is up for extensions.
</p>
</div>
<div id="outline-container-orgee7bae4" class="outline-3">
<h3 id="orgee7bae4"><span class="section-number-3">65.1.</span> terms</h3>
<div class="outline-text-3" id="text-65-1">
<dl class="org-dl">
<dt>view</dt><dd>view function is the code you write to respond to requests to your application</dd>
<dt>Blueprints</dt><dd>way to organize a group of related views and other code. Flask associates view functions with
blueprints when dispatching requests and generating URLs.</dd>
</dl>
</div>
</div>

<div id="outline-container-orge643b6e" class="outline-3">
<h3 id="orge643b6e"><span class="section-number-3">65.2.</span> components</h3>
<div class="outline-text-3" id="text-65-2">
<dl class="org-dl">
<dt>Jinja</dt><dd>template engine <a href="https://jinja.palletsprojects.com/">https://jinja.palletsprojects.com/</a></dd>
<dt>Werkzeug</dt><dd>WSGI toolkit <a href="https://werkzeug.palletsprojects.com/">https://werkzeug.palletsprojects.com/</a></dd>
<dt>Click </dt><dd>CLI toolkit <a href="https://click.palletsprojects.com/">https://click.palletsprojects.com/</a></dd>
<dt>MarkupSafe</dt><dd>escapes characters so it is safe to use in HTML and XML <a href="https://markupsafe.palletsprojects.com/">https://markupsafe.palletsprojects.com/</a></dd>
<dt>ItsDangerous</dt><dd>safe data serialization library, store the session of a Flask application in a cookie
without allowing users to tamper with the session contents. <a href="https://itsdangerous.palletsprojects.com/">https://itsdangerous.palletsprojects.com/</a></dd>
<dt>importlib-metadata</dt><dd>import at middle of execution for optional module dotenv.</dd>
<dt>zipp</dt><dd>?</dd>
</dl>
</div>
</div>
<div id="outline-container-org603a023" class="outline-3">
<h3 id="org603a023"><span class="section-number-3">65.3.</span> static files and debugging console</h3>
<div class="outline-text-3" id="text-65-3">
</div>
<div id="outline-container-org12e8124" class="outline-4">
<h4 id="org12e8124"><span class="section-number-4">65.3.1.</span> get URL</h4>
<div class="outline-text-4" id="text-65-3-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">from</span> flask <span style="color: #8ac6f2; font-weight: bold;">import</span> url_for
<span style="color: #8ac6f2; font-weight: bold;">from</span> flask <span style="color: #8ac6f2; font-weight: bold;">import</span> redirect
<span style="color: #92a65e; font-weight: bold;">@app.route</span>(<span style="color: #95e454;">"/"</span>)
<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">hell</span>():
    <span style="color: #8ac6f2; font-weight: bold;">return</span> redirect(url_for(<span style="color: #95e454;">'static'</span>, filename=<span style="color: #95e454;">'style.css'</span>))
</pre>
</div>
</div>
</div>
<div id="outline-container-org4e2609d" class="outline-4">
<h4 id="org4e2609d"><span class="section-number-4">65.3.2.</span> path and console <a id="orgf991d4b"></a></h4>
<div class="outline-text-4" id="text-65-3-2">
<p>
default:
</p>
<ul class="org-ul">
<li>in localhost:8080/console
<ul class="org-ul">
<li>&gt;&gt;&gt; print(app.static<sub>folder</sub>)
<ul class="org-ul">
<li>/home/u/static</li>
</ul></li>
<li>&gt;&gt;&gt; print(app.static<sub>url</sub><sub>path</sub>)
<ul class="org-ul">
<li>/static</li>
</ul></li>
<li>&gt;&gt;&gt; print(app.template<sub>folder</sub>)
<ul class="org-ul">
<li>templates</li>
</ul></li>
</ul></li>
</ul>
<p>
if we set: app = Flask(static<sub>folder</sub>='test')
</p>
<ul class="org-ul">
<li>&gt;&gt;&gt; print(app.static<sub>folder</sub>)</li>
<li>/home/u/test</li>
<li>&gt;&gt;&gt; print(app.static<sub>url</sub><sub>path</sub>)</li>
<li>/test</li>
</ul>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #cae682;">app</span> = Flask(<span style="color: #e5786d;">__name__</span>, template_folder=<span style="color: #95e454;">'./'</span>,
            static_url_path=<span style="color: #95e454;">'/static'</span>,
            static_folder=<span style="color: #95e454;">'/home/u/sources/documents_recognition_service/docker/worker/code/test'</span>
            )
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgedf3017" class="outline-3">
<h3 id="orgedf3017"><span class="section-number-3">65.4.</span> start, run</h3>
<div class="outline-text-3" id="text-65-4">
<p>
ways to run:
</p>
</div>
<div id="outline-container-org498e266" class="outline-4">
<h4 id="org498e266"><span class="section-number-4">65.4.1.</span> start $flask run (recommended)</h4>
<div class="outline-text-4" id="text-65-4-1">
<pre class="example">
export FLASK_RUN_debug=false
export FLASK_RUN_HOST=localhost FLASK_RUN_PORT=8080 ; flask --app main run --no-debug
export FLASK_APP=main
flask --app main run --debug
</pre>


<p>
FLASK<sub>COMMAND</sub><sub>OPTION</sub> - pattern for all options
</p>
<ul class="org-ul">
<li>FLASK<sub>APP</sub></li>
</ul>

<pre class="example">
print(app.config) # to get all configuration variables in app
</pre>
</div>
</div>
<div id="outline-container-org8ece307" class="outline-4">
<h4 id="org8ece307"><span class="section-number-4">65.4.2.</span> start app.run()</h4>
<div class="outline-text-4" id="text-65-4-2">
<p>
app.run() or flask run
</p>
<ul class="org-ul">
<li>development web server</li>
</ul>

<p>
use gunicorn or uWSGI.
production deployment
</p>


<p>
app.run()
</p>
<ul class="org-ul">
<li>host – the hostname to listen on.</li>
<li>port – the port of the web server.</li>
<li>debug – if given, enable or disable debug mode.  automatically reload if code changes, and will show an
interactive debugger in the browser if an error occurs during a request</li>
<li>load<sub>dotenv</sub> – load the nearest .env and .flaskenv files to set environment variables.</li>
<li>use<sub>reloader</sub> – should the server automatically restart the python process if modules were changed?</li>
<li>use<sub>debugger</sub> – should the werkzeug debugging system be used?</li>
<li>use<sub>evalex</sub> – should the exception evaluation feature be enabled?</li>
<li>extra<sub>files</sub> – a list of files the reloader should watch additionally to the modules.</li>
<li>reloader<sub>interval</sub> – the interval for the reloader in seconds.</li>
<li>reloader<sub>type</sub> – the type of reloader to use.</li>
<li>threaded – should the process handle each request in a separate thread?</li>
<li>processes – if greater than 1 then handle each request in a new process up to this maximum number of concurrent processes.</li>
<li>passthrough<sub>errors</sub> – set this to True to disable the error catching.</li>
<li>ssl<sub>context</sub> – an SSL context for the connection.</li>
</ul>
</div>
</div>
<div id="outline-container-org096c14b" class="outline-4">
<h4 id="org096c14b"><span class="section-number-4">65.4.3.</span> links</h4>
<div class="outline-text-4" id="text-65-4-3">
<ul class="org-ul">
<li><a href="https://flask.palletsprojects.com/en/2.3.x/cli/">https://flask.palletsprojects.com/en/2.3.x/cli/</a></li>
<li><a href="https://flask.palletsprojects.com/en/2.3.x/config/">https://flask.palletsprojects.com/en/2.3.x/config/</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgc76376b" class="outline-3">
<h3 id="orgc76376b"><span class="section-number-3">65.5.</span> Quart</h3>
<div class="outline-text-3" id="text-65-5">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">save this as app.py</span>
<span style="color: #8ac6f2; font-weight: bold;">from</span> quart <span style="color: #8ac6f2; font-weight: bold;">import</span> Quart, request
<span style="color: #8ac6f2; font-weight: bold;">from</span> markupsafe <span style="color: #8ac6f2; font-weight: bold;">import</span> escape

<span style="color: #cae682;">app</span> = Quart(<span style="color: #e5786d;">__name__</span>)

<span style="color: #92a65e; font-weight: bold;">@app.get</span>(<span style="color: #95e454;">"/"</span>)
<span style="color: #8ac6f2; font-weight: bold;">async def</span> <span style="color: #cae682; font-weight: bold;">hello</span>():
    <span style="color: #cae682;">name</span> = request.args.get(<span style="color: #95e454;">"name"</span>, <span style="color: #95e454;">"World"</span>)
    <span style="color: #8ac6f2; font-weight: bold;">return</span> f<span style="color: #95e454;">"Hello, </span>{escape(name)}<span style="color: #95e454;">!"</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">$ quart run</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">* Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)</span>

</pre>
</div>
</div>
</div>
<div id="outline-container-org3189492" class="outline-3">
<h3 id="org3189492"><span class="section-number-3">65.6.</span> GET</h3>
<div class="outline-text-3" id="text-65-6">
</div>
<div id="outline-container-org682d430" class="outline-4">
<h4 id="org682d430"><span class="section-number-4">65.6.1.</span> variables</h4>
<div class="outline-text-4" id="text-65-6-1">
<ul class="org-ul">
<li>string (default) accepts any text without a slash</li>
<li>int accepts positive integers</li>
<li>float accepts positive floating point values</li>
<li>path like string but also accepts slashes</li>
<li>uuid accepts UUID strings</li>
</ul>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #92a65e; font-weight: bold;">@app.route</span>(<span style="color: #95e454;">'/post/&lt;int:post_id&gt;'</span>)
<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">show_post</span>(post_id):
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">show the post with the given id, the id is an integer</span>
    <span style="color: #8ac6f2; font-weight: bold;">return</span> f<span style="color: #95e454;">'Post </span>{post_id}<span style="color: #95e454;">'</span>

<span style="color: #92a65e; font-weight: bold;">@app.route</span>(<span style="color: #95e454;">'/path/&lt;path:subpath&gt;'</span>)
<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">show_subpath</span>(subpath):
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">show the subpath after /path/</span>
    <span style="color: #8ac6f2; font-weight: bold;">return</span> f<span style="color: #95e454;">'Subpath </span>{escape(subpath)}<span style="color: #95e454;">'</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org6fdc479" class="outline-4">
<h4 id="org6fdc479"><span class="section-number-4">65.6.2.</span> parameters ?key=value</h4>
<div class="outline-text-4" id="text-65-6-2">
<pre class="example">
from flask import request
searchword = request.args.get('key', '')
</pre>
</div>
</div>
</div>
<div id="outline-container-org7c14939" class="outline-3">
<h3 id="org7c14939"><span class="section-number-3">65.7.</span> app.route</h3>
<div class="outline-text-3" id="text-65-7">
<ul class="org-ul">
<li><a href="https://werkzeug.palletsprojects.com/en/2.3.x/routing/#werkzeug.routing.Rule">https://werkzeug.palletsprojects.com/en/2.3.x/routing/#werkzeug.routing.Rule</a></li>
<li><a href="https://werkzeug.palletsprojects.com/en/2.3.x/tutorial/#step-4-the-routing">https://werkzeug.palletsprojects.com/en/2.3.x/tutorial/#step-4-the-routing</a></li>
</ul>
</div>
</div>
<div id="outline-container-org6386e0f" class="outline-3">
<h3 id="org6386e0f"><span class="section-number-3">65.8.</span> gentoo dependencies</h3>
<div class="outline-text-3" id="text-65-8">
<ul class="org-ul">
<li>dev-python/asgiref - Asynchronous Server Gateway Interface - calling convention for web servers to forward
requests to web applications or frameworks written in the Python</li>
<li>dev-python/blinker - fast dispatching system, to subscribe to events</li>
<li>dev-python/click - creating beautiful command line interfaces</li>
<li>dev-python/gpep517 - gentoo</li>
<li>dev-python/importlib<sub>metadata</sub> - gentoo</li>
<li>dev-python/itsdangerous - helpers to pass data to untrusted environments and to get it back safe and sound
<ul class="org-ul">
<li><a href="https://github.com/pallets/itsdangerous/">https://github.com/pallets/itsdangerous/</a></li>
</ul></li>
<li>dev-python/jinja - template engine for Python</li>
<li>dev-python/pallets-sphinx-themes - ? themes for documentation</li>
<li>dev-python/pypy3 - fast, compliant alternative implementation of the Python (4.5 times faster than CPython)</li>
<li>dev-python/pytest - Simple powerful testing with Python - detailed assertion introspection</li>
<li>dev-python/setuptools - Easily download, build, install, upgrade, and uninstall Python packages</li>
<li>dev-python/sphinx - Python documentation generator</li>
<li>dev-python/sphinx-issues</li>
<li>dev-python/sphinx-tabs</li>
<li>dev-python/sphinxcontrib-log<sub>cabinet</sub></li>
<li>dev-python/werkzeug - Collection of various utilities for WSGI applications</li>
<li>dev-python/wheel - A built-package format for Python</li>
</ul>
</div>
</div>
<div id="outline-container-orgf867005" class="outline-3">
<h3 id="orgf867005"><span class="section-number-3">65.9.</span> blueprints</h3>
</div>
<div id="outline-container-orgb3993f3" class="outline-3">
<h3 id="orgb3993f3"><span class="section-number-3">65.10.</span> Hello world</h3>
<div class="outline-text-3" id="text-65-10">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> flask
<span style="color: #8ac6f2; font-weight: bold;">from</span> flask <span style="color: #8ac6f2; font-weight: bold;">import</span> Flask
<span style="color: #8ac6f2; font-weight: bold;">from</span> flask <span style="color: #8ac6f2; font-weight: bold;">import</span> json, Response, redirect, url_for
<span style="color: #8ac6f2; font-weight: bold;">from</span> markupsafe <span style="color: #8ac6f2; font-weight: bold;">import</span> escape


<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">create_app</span>(test=<span style="color: #e5786d; font-weight: bold;">False</span>) -&gt; Flask:
    <span style="color: #cae682;">app</span> = Flask(<span style="color: #e5786d;">__name__</span>, template_folder=<span style="color: #95e454;">'./'</span>, static_folder=<span style="color: #95e454;">'./'</span>)
    <span style="color: #8ac6f2; font-weight: bold;">if</span> test:
        <span style="color: #8ac6f2; font-weight: bold;">pass</span>

    <span style="color: #92a65e; font-weight: bold;">@app.route</span>(<span style="color: #95e454;">"/predict"</span>, methods=[<span style="color: #95e454;">"POST"</span>])
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">predict</span>():
        <span style="color: #cae682;">data</span> = {<span style="color: #95e454;">"success"</span>: <span style="color: #e5786d; font-weight: bold;">False</span>}

        <span style="color: #8ac6f2; font-weight: bold;">if</span> flask.request.method != <span style="color: #95e454;">"POST"</span>:
            <span style="color: #cae682;">json_string</span> = json.dumps(data, ensure_ascii=<span style="color: #e5786d; font-weight: bold;">False</span>)
            <span style="color: #8ac6f2; font-weight: bold;">return</span> Response(json_string, content_type=<span style="color: #95e454;">"application/json; charset=utf-8"</span>)

    <span style="color: #92a65e; font-weight: bold;">@app.route</span>(<span style="color: #95e454;">"/&lt;name&gt;"</span>)
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">hello</span>(name):
        <span style="color: #8ac6f2; font-weight: bold;">return</span> f<span style="color: #95e454;">"Hello, </span>{escape(name)}<span style="color: #95e454;">!"</span>

    <span style="color: #92a65e; font-weight: bold;">@app.route</span>(<span style="color: #95e454;">'/'</span>, methods=[<span style="color: #95e454;">'GET'</span>, <span style="color: #95e454;">'POST'</span>])
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">index</span>():
        <span style="color: #8ac6f2; font-weight: bold;">return</span> redirect(url_for(<span style="color: #95e454;">'transcribe'</span>))

    <span style="color: #8ac6f2; font-weight: bold;">return</span> app


<span style="color: #8ac6f2; font-weight: bold;">if</span> <span style="color: #e5786d;">__name__</span> == <span style="color: #95e454;">"__main__"</span>:
    <span style="color: #cae682;">app</span> = create_app()
    app.run(debug=<span style="color: #e5786d; font-weight: bold;">False</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-org67a079b" class="outline-3">
<h3 id="org67a079b"><span class="section-number-3">65.11.</span> curl</h3>
<div class="outline-text-3" id="text-65-11">
<ul class="org-ul">
<li><a href="https://gist.github.com/subfuzion/08c5d85437d5d4f00e58">https://gist.github.com/subfuzion/08c5d85437d5d4f00e58</a></li>
</ul>

<p>
<b>one string</b>
</p>

<p>
application/x-www-form-urlencoded is the default:
</p>
<pre class="example">
curl -d "param1=value1&amp;param2=value2" -X POST http://localhost:3000/data
</pre>


<p>
explicit:
</p>
<pre class="example">
curl -d "param1=value1&amp;param2=value2" -H "Content-Type: application/x-www-form-urlencoded" -X POST http://localhost:3000/dat
</pre>
</div>
</div>
<div id="outline-container-org02b0c8c" class="outline-3">
<h3 id="org02b0c8c"><span class="section-number-3">65.12.</span> response object</h3>
<div class="outline-text-3" id="text-65-12">
<p>
default return:
</p>
<ul class="org-ul">
<li>string =&gt; 200 OK status code and a text/html mimetype</li>
<li>dict or list =&gt; jsonify() is called to produce a response</li>
<li>iterator or generator returning strings or bytes =&gt; streaming response</li>
<li>(response, status), (response, headers), or (response, status, headers)
<ul class="org-ul">
<li>headers : list or dictionary</li>
</ul></li>
<li>other -  assume the return is a WSGI application and convert that into a response object.</li>
</ul>

<p>
make<sub>response</sub>:
</p>
<pre class="example">
from flask import make_response

@app.route('/')
def index():
    resp = make_response(render_template(...))
    resp.set_cookie('username', 'the username')
    return resp
</pre>

<ul class="org-ul">
<li><a href="https://flask.palletsprojects.com/en/2.2.x/quickstart/#about-responses">https://flask.palletsprojects.com/en/2.2.x/quickstart/#about-responses</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgc40cc4e" class="outline-3">
<h3 id="orgc40cc4e"><span class="section-number-3">65.13.</span> request object</h3>
<div class="outline-text-3" id="text-65-13">
<ul class="org-ul">
<li>from flask import request</li>
</ul>
</div>
<div id="outline-container-org93b8c27" class="outline-4">
<h4 id="org93b8c27"><span class="section-number-4">65.13.1.</span> get all values</h4>
<div class="outline-text-4" id="text-65-13-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">for</span> x <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">dir</span>(request):
    <span style="color: #e5786d;">print</span>(x, <span style="color: #e5786d;">getattr</span>(request, x))
</pre>
</div>

<ul class="org-ul">
<li><a href="https://flask.palletsprojects.com/en/2.3.x/api/#flask.Request">https://flask.palletsprojects.com/en/2.3.x/api/#flask.Request</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgdf4c6bb" class="outline-3">
<h3 id="orgdf4c6bb"><span class="section-number-3">65.14.</span> Jinja templates</h3>
<div class="outline-text-3" id="text-65-14">
<p>
Jinja template library to render templates, located at <a href="#orgf991d4b">65.3.2</a>
</p>
<ul class="org-ul">
<li>autoescape any data that is rendered in HTML templates - such as &lt; and &gt; will be escaped with safe value</li>
<li>{{ and }} - for output. a single trailing newline is stripped if present, other whitespace (spaces, tabs,
newlines etc.) is returned unchanged
<ul class="org-ul">
<li>{{ name|striptags|title }}  - equal to (title(striptags(name)))</li>
</ul></li>
<li>{% and %} - control flow, and other Statements
<ul class="org-ul">
<li>{%+ if something %}yay{% endif %} or {% if something +%}yay{% endif %} - disabled block with +</li>
<li>{%- if something %}yay{% endif %} - the whitespaces before or after that block will be removed. used for {{ }} also</li>
</ul></li>
<li>{# &#x2026; #} for Comments not included in the template output</li>
<li># for item in seq - line stiment, equivalent to {% for item in seq %}</li>
</ul>
<p>
common for {{}}
</p>
<ul class="org-ul">
<li>url<sub>for</sub>('static', filename='style.css')</li>
<li></li>
</ul>
<p>
join paths:
</p>
<pre class="example">
{{path_join('pillar', 'device1.sls'}}
</pre>


<p>
common for {%%}
</p>
<ul class="org-ul">
<li>{% if True %}   yay     {% endif %}</li>
<li>{% raw %}  {%  {%  {%  {% endraw %}</li>
<li>{% for user in users %} {{user.a}} {% endfor %}</li>
<li>{% include 'header.html' %}</li>
</ul>
</div>

<div id="outline-container-orgb1adbbd" class="outline-4">
<h4 id="orgb1adbbd"><span class="section-number-4">65.14.1.</span> own filters:</h4>
<div class="outline-text-4" id="text-65-14-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">1 way</span>
<span style="color: #92a65e; font-weight: bold;">@app.template_filter</span>(<span style="color: #95e454;">'reverse'</span>)
<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">reverse_filter</span>(s):
    <span style="color: #8ac6f2; font-weight: bold;">return</span> s[::-1]

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">2 way</span>
<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">reverse_filter</span>(s):
    <span style="color: #8ac6f2; font-weight: bold;">return</span> s[::-1]
app.jinja_env.<span style="color: #cae682;">filters</span>[<span style="color: #95e454;">'reverse'</span>] = reverse_filter

app.jinja_env.<span style="color: #cae682;">filters</span>[<span style="color: #95e454;">'path_join'</span>] = os.path.join
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">usage: {{ path | path_join('..') }}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc2c0be9" class="outline-4">
<h4 id="orgc2c0be9"><span class="section-number-4">65.14.2.</span> links</h4>
<div class="outline-text-4" id="text-65-14-2">
<p>
<a href="https://jinja.palletsprojects.com/templates/">https://jinja.palletsprojects.com/templates/</a>
</p>
</div>
</div>
</div>
<div id="outline-container-org3bbca1a" class="outline-3">
<h3 id="org3bbca1a"><span class="section-number-3">65.15.</span> security</h3>
<div class="outline-text-3" id="text-65-15">
<ul class="org-ul">
<li>from markupsafe import escape; return f"Hello, {escape(name)}!"</li>
</ul>

<p>
werkzeug.secure<sub>filename</sub>()
</p>
</div>
</div>

<div id="outline-container-orga58f917" class="outline-3">
<h3 id="orga58f917"><span class="section-number-3">65.16.</span> my projects</h3>
<div class="outline-text-3" id="text-65-16">
</div>
<div id="outline-container-org8d0c4ca" class="outline-4">
<h4 id="org8d0c4ca"><span class="section-number-4">65.16.1.</span> testing1</h4>
<div class="outline-text-4" id="text-65-16-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">from</span> main <span style="color: #8ac6f2; font-weight: bold;">import</span> app
<span style="color: #8ac6f2; font-weight: bold;">from</span> flask.testing <span style="color: #8ac6f2; font-weight: bold;">import</span> FlaskClient
<span style="color: #8ac6f2; font-weight: bold;">from</span> flask <span style="color: #8ac6f2; font-weight: bold;">import</span> Response
<span style="color: #8ac6f2; font-weight: bold;">from</span> pathlib <span style="color: #8ac6f2; font-weight: bold;">import</span> Path
<span style="color: #8ac6f2; font-weight: bold;">import</span> json
<span style="color: #8ac6f2; font-weight: bold;">import</span>  logging
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">-- enable app.logger.debug()</span>
app.logger.setLevel(logging.DEBUG)

app.<span style="color: #cae682;">testing</span> = <span style="color: #e5786d; font-weight: bold;">True</span> <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">propaget excetions to here, or it will return 500 status only</span>



client: FlaskClient
<span style="color: #8ac6f2; font-weight: bold;">with</span> app.test_client() <span style="color: #8ac6f2; font-weight: bold;">as</span> client:
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">-- get</span>
    <span style="color: #cae682;">r</span>: Response = client.get(<span style="color: #95e454;">'/audio_captcha'</span>, follow_redirects=<span style="color: #e5786d; font-weight: bold;">True</span>)
    <span style="color: #8ac6f2; font-weight: bold;">assert</span> r.status_code == 200
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">the same:</span>
    <span style="color: #cae682;">r</span>: Response = client.get(<span style="color: #95e454;">'/get'</span> ,query_string = {<span style="color: #95e454;">'id'</span>:<span style="color: #e5786d;">str</span>(<span style="color: #95e454;">'123'</span>)})
    <span style="color: #cae682;">r</span>: Response = client.get(<span style="color: #95e454;">'/get?id=123'</span>)
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">print(r.status_code)</span>
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">-- post</span>
    <span style="color: #cae682;">r</span>: Response = client.post(<span style="color: #95e454;">'/audio_captcha'</span>, data={
        <span style="color: #95e454;">'file'</span>: Path(<span style="color: #95e454;">'/home/u2/h4/PycharmProjects/captcha_fssp/929014e341a0457f5a90a909b0a51c40.wav'</span>).<span style="color: #e5786d;">open</span>(<span style="color: #95e454;">'rb'</span>)}
    )
    <span style="color: #8ac6f2; font-weight: bold;">assert</span> r.status_code == 200
    <span style="color: #e5786d;">print</span>(json.loads(r.data))


<span style="color: #8ac6f2; font-weight: bold;">with</span> app.test_request_context():
    <span style="color: #e5786d;">print</span>(url_for(<span style="color: #95e454;">'index'</span>))
    <span style="color: #e5786d;">print</span>(url_for(<span style="color: #95e454;">'login'</span>))
    <span style="color: #e5786d;">print</span>(url_for(<span style="color: #95e454;">'login'</span>, <span style="color: #e5786d;">next</span>=<span style="color: #95e454;">'/'</span>))
    <span style="color: #e5786d;">print</span>(url_for(<span style="color: #95e454;">'profile'</span>, username=<span style="color: #95e454;">'John Doe'</span>))

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">/</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">/login</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">/login?next=/</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">/user/John%20Doe</span>


</pre>
</div>
</div>
</div>
<div id="outline-container-org8401524" class="outline-4">
<h4 id="org8401524"><span class="section-number-4">65.16.2.</span> testing2</h4>
<div class="outline-text-4" id="text-65-16-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">from</span> main <span style="color: #8ac6f2; font-weight: bold;">import</span> app
<span style="color: #8ac6f2; font-weight: bold;">from</span> flask.testing <span style="color: #8ac6f2; font-weight: bold;">import</span> FlaskClient
<span style="color: #8ac6f2; font-weight: bold;">from</span> flask <span style="color: #8ac6f2; font-weight: bold;">import</span> Response
<span style="color: #8ac6f2; font-weight: bold;">from</span> pathlib <span style="color: #8ac6f2; font-weight: bold;">import</span> Path
app.<span style="color: #cae682;">testing</span> = <span style="color: #e5786d; font-weight: bold;">True</span>
client: FlaskClient
<span style="color: #8ac6f2; font-weight: bold;">import</span> json


<span style="color: #8ac6f2; font-weight: bold;">with</span> app.test_client() <span style="color: #8ac6f2; font-weight: bold;">as</span> client:
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">r: Response = client.get('/speech_ru')</span>
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">assert r.status_code == 200</span>
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">print(r.status_code)</span>

    <span style="color: #cae682;">r</span>: Response = client.post(<span style="color: #95e454;">'/speech_ru'</span>, data={
        <span style="color: #95e454;">'file'</span>: Path(<span style="color: #95e454;">'/home/u2/h4/PycharmProjects/captcha_fssp/929014e341a0457f5a90a909b0a51c40.wav'</span>).<span style="color: #e5786d;">open</span>(<span style="color: #95e454;">'rb'</span>)}
    )
    <span style="color: #8ac6f2; font-weight: bold;">assert</span> r.status_code == 200
    <span style="color: #e5786d;">print</span>(json.loads(r.data))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc6fab20" class="outline-4">
<h4 id="orgc6fab20"><span class="section-number-4">65.16.3.</span> file storage</h4>
<div class="outline-text-4" id="text-65-16-3">
<ul class="org-ul">
<li><a href="https://gist.github.com/andik/e86a7007c2af97e50fbb">https://gist.github.com/andik/e86a7007c2af97e50fbb</a></li>
<li><a href="https://codereview.stackexchange.com/questions/214418/simple-web-based-file-browser-with-flask">https://codereview.stackexchange.com/questions/214418/simple-web-based-file-browser-with-flask</a></li>
<li><a href="https://www.reddit.com/r/learnpython/comments/npadxh/how_to_return_directory_listingwith_files_and/">https://www.reddit.com/r/learnpython/comments/npadxh/how_to_return_directory_listingwith_files_and/</a></li>
<li><a href="https://stackoverflow.com/questions/23718236/python-flask-browsing-through-directory-with-files">https://stackoverflow.com/questions/23718236/python-flask-browsing-through-directory-with-files</a></li>
<li><a href="https://github.com/Wildog/flask-file-server">https://github.com/Wildog/flask-file-server</a></li>
<li><a href="https://pypi.org/project/Flask-AutoIndex/">https://pypi.org/project/Flask-AutoIndex/</a> <a href="https://github.com/general03/flask-autoindex">https://github.com/general03/flask-autoindex</a></li>
<li><a href="https://github.com/walkoncross/tornado-file-server">https://github.com/walkoncross/tornado-file-server</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orga0a3cb7" class="outline-3">
<h3 id="orga0a3cb7"><span class="section-number-3">65.17.</span> Flask-2.2.2 hashes <a id="org85befd4"></a></h3>
<div class="outline-text-3" id="text-65-17">
<div class="org-src-container">
<pre class="src src-conf"><span style="color: #cae682;">MarkupSafe</span>==2.1.1 \
  <span style="color: #cae682;">--hash</span>=sha256:7f91197cc9e48f989d12e4e6fbc46495c446636dfc81b9ccf50bb0ec74b91d4b

<span style="color: #cae682;">Jinja2</span>==3.1.2 \
  <span style="color: #cae682;">--hash</span>=sha256:31351a702a408a9e7595a8fc6150fc3f43bb6bf7e319770cbc0db9df9437e852

<span style="color: #cae682;">Werkzeug</span>==2.2.2 \
  <span style="color: #cae682;">--hash</span>=sha256:7ea2d48322cc7c0f8b3a215ed73eabd7b5d75d0b50e31ab006286ccff9e00b8f

<span style="color: #cae682;">click</span>==8.1.3 \
  <span style="color: #cae682;">--hash</span>=sha256:7682dc8afb30297001674575ea00d1814d808d6a36af415a82bd481d37ba7b8e

<span style="color: #cae682;">itsdangerous</span>==2.1.2 \
  <span style="color: #cae682;">--hash</span>=sha256:5dbbc68b317e5e42f327f9021763545dc3fc3bfe22e6deb96aaf1fc38874156a

<span style="color: #cae682;">importlib_metadata</span>==5.0.0 \
  <span style="color: #cae682;">--hash</span>=sha256:da31db32b304314d044d3c12c79bd59e307889b287ad12ff387b3500835fc2ab

<span style="color: #cae682;">zipp</span>==3.8.1 \
  <span style="color: #cae682;">--hash</span>=sha256:05b45f1ee8f807d0cc928485ca40a07cb491cf092ff587c0df9cb1fd154848d2
<span style="color: #cae682;">Flask</span>==2.2.2 \
 <span style="color: #cae682;">--hash</span>=sha256:642c450d19c4ad482f96729bd2a8f6d32554aa1e231f4f6b4e7e5264b16cca2b
</pre>
</div>
</div>
</div>

<div id="outline-container-org754033a" class="outline-3">
<h3 id="org754033a"><span class="section-number-3">65.18.</span> flask-api (bad working)</h3>
<div class="outline-text-3" id="text-65-18">
<pre class="example">
emerge --ask dev-python/flask-api
</pre>

<p>
Require Flask 1.1.+
</p>

<p>
<a href="https://github.com/flask-api/flask-api/">https://github.com/flask-api/flask-api/</a>
</p>
</div>
</div>
<div id="outline-container-org39879ee" class="outline-3">
<h3 id="org39879ee"><span class="section-number-3">65.19.</span> flask-restful (old)</h3>
<div class="outline-text-3" id="text-65-19">
<ul class="org-ul">
<li>flask-restful - complex API at the top of Flask API ( sucks)</li>

<li>flask-apispec inspired by Flask-RESTful and Flask-RESTplus, but attempts to provide similar functionality
with greater flexibility and less code</li>
</ul>

<p>
?? <a href="https://github.com/mgorny/flask-api">https://github.com/mgorny/flask-api</a>
</p>

<p>
<b>marshal<sub>with</sub></b> - declare serialization transformation for response
<a href="https://flask-restful.readthedocs.io/en/latest/quickstart.html">https://flask-restful.readthedocs.io/en/latest/quickstart.html</a>
</p>
</div>
</div>
<div id="outline-container-org16fa43e" class="outline-3">
<h3 id="org16fa43e"><span class="section-number-3">65.20.</span> example</h3>
<div class="outline-text-3" id="text-65-20">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">from</span> flask_restful <span style="color: #8ac6f2; font-weight: bold;">import</span> fields, marshal_with

<span style="color: #cae682;">resource_fields</span> = {
    <span style="color: #95e454;">'task'</span>:   fields.String,
    <span style="color: #95e454;">'uri'</span>:    fields.Url(<span style="color: #95e454;">'todo_ep'</span>)
}

<span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">TodoDao</span>(<span style="color: #e5786d;">object</span>):
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">__init__</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>, todo_id, task):
        <span style="color: #8ac6f2; font-weight: bold;">self</span>.<span style="color: #cae682;">todo_id</span> = todo_id
        <span style="color: #8ac6f2; font-weight: bold;">self</span>.<span style="color: #cae682;">task</span> = task

        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">This field will not be sent in the response</span>
        <span style="color: #8ac6f2; font-weight: bold;">self</span>.<span style="color: #cae682;">status</span> = <span style="color: #95e454;">'active'</span>


<span style="color: #cae682;">parser</span> = reqparse.RequestParser()
parser.add_argument(<span style="color: #95e454;">'task'</span>, <span style="color: #e5786d;">type</span>=<span style="color: #e5786d;">str</span>, <span style="color: #e5786d;">help</span>=<span style="color: #95e454;">'Rate to charge for this resource'</span>)
parser.add_argument(<span style="color: #95e454;">'picture'</span>, <span style="color: #e5786d;">type</span>=werkzeug.datastructures.FileStorage, required=<span style="color: #e5786d; font-weight: bold;">True</span>, location=<span style="color: #95e454;">'files'</span>)


<span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">Todo</span>(Resource):
    <span style="color: #92a65e; font-weight: bold;">@marshal_with</span>(resource_fields)
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">get</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>, todo_id):
        <span style="color: #cae682;">args</span> = parser.parse_args()
        <span style="color: #cae682;">task</span> = {<span style="color: #95e454;">'task'</span>: args[<span style="color: #95e454;">'task'</span>]}
        <span style="color: #e5786d;">file</span> = args[<span style="color: #95e454;">'file'</span>]
        <span style="color: #e5786d;">file</span>.save(<span style="color: #95e454;">"your_file_name.jpg"</span>)
        <span style="color: #8ac6f2; font-weight: bold;">if</span> something:
            abort(404, message=<span style="color: #95e454;">"Todo oesn't exist"</span>)
        <span style="color: #8ac6f2; font-weight: bold;">return</span> TodoDao(todo_id=<span style="color: #95e454;">'my_todo'</span>, task=<span style="color: #95e454;">'Remember the milk'</span>)

api.add_resource(Todo, <span style="color: #95e454;">'/todos/&lt;todo_id&gt;'</span>)

<span style="color: #8ac6f2; font-weight: bold;">if</span> <span style="color: #e5786d;">__name__</span> == <span style="color: #95e454;">'__main__'</span>:
    app.run(debug=<span style="color: #e5786d; font-weight: bold;">True</span>)

</pre>
</div>
</div>
<div id="outline-container-orgc3534cd" class="outline-4">
<h4 id="orgc3534cd"><span class="section-number-4">65.20.1.</span> image</h4>
<div class="outline-text-4" id="text-65-20-1">
<div class="org-src-container">
<pre class="src src-python">
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org261cde1" class="outline-3">
<h3 id="org261cde1"><span class="section-number-3">65.21.</span> swagger</h3>
<div class="outline-text-3" id="text-65-21">
<ul class="org-ul">
<li>flask<sub>restx</sub> - same API as flask-restful but with Swagger autogeneration</li>
</ul>

<p>
flask<sub>restx.reqparse.RequestParser.add</sub><sub>argument</sub>
</p>
</div>
</div>
<div id="outline-container-org274e31e" class="outline-3">
<h3 id="org274e31e"><span class="section-number-3">65.22.</span> werkzeug</h3>
<div class="outline-text-3" id="text-65-22">
<ul class="org-ul">
<li><a href="https://werkzeug.palletsprojects.com/">https://werkzeug.palletsprojects.com/</a></li>
<li>/usr/lib/python3.11/site-packages/werkzeug</li>
</ul>
</div>
</div>
<div id="outline-container-orga166c0e" class="outline-3">
<h3 id="orga166c0e"><span class="section-number-3">65.23.</span> debug</h3>
<div class="outline-text-3" id="text-65-23">
<ol class="org-ol">
<li>run(debug=True) - create two applications</li>
<li>localhost:8080/console
<ul class="org-ul">
<li>&gt;&gt; app.url<sub>map</sub></li>
<li>&gt;&gt; print(app.static<sub>folder</sub>)</li>
</ul></li>
</ol>
</div>
</div>

<div id="outline-container-orgd562670" class="outline-3">
<h3 id="orgd562670"><span class="section-number-3">65.24.</span> test</h3>
<div class="outline-text-3" id="text-65-24">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">from</span> flask.testing <span style="color: #8ac6f2; font-weight: bold;">import</span> FlaskClient
<span style="color: #8ac6f2; font-weight: bold;">from</span> flask <span style="color: #8ac6f2; font-weight: bold;">import</span> Response

<span style="color: #8ac6f2; font-weight: bold;">from</span> micro_file_server.__main__ <span style="color: #8ac6f2; font-weight: bold;">import</span> app


<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">test_main</span>():
    app.<span style="color: #cae682;">testing</span> = <span style="color: #e5786d; font-weight: bold;">True</span>
    <span style="color: #8ac6f2; font-weight: bold;">with</span> app.test_client() <span style="color: #8ac6f2; font-weight: bold;">as</span> client:
        client: FlaskClient
        <span style="color: #cae682;">r</span>: Response = client.get(<span style="color: #95e454;">'/'</span>)
        <span style="color: #8ac6f2; font-weight: bold;">assert</span> r.status_code == 200

</pre>
</div>
</div>
</div>
<div id="outline-container-org9776831" class="outline-3">
<h3 id="org9776831"><span class="section-number-3">65.25.</span> production</h3>
<div class="outline-text-3" id="text-65-25">
<p>
built-in WSGI in Flask
</p>
<ul class="org-ul">
<li>not handle more than one request at a time by default.</li>
<li>If you leave debug mode on and an error pops up, it opens up a shell that allows for arbitrary code to be
executed on your server</li>
</ul>

<p>
pdoction WSGI (Web Server Gateway Interface)
</p>
<ul class="org-ul">
<li>Gunicorn</li>
<li>Waitress</li>
<li>mod<sub>wsgi</sub></li>
<li>uWSGI</li>
<li>gevent</li>
<li>eventlet</li>
<li>ASGI</li>
</ul>

<p>
links
</p>
<ul class="org-ul">
<li><a href="https://flask.palletsprojects.com/en/2.3.x/tutorial/deploy/">https://flask.palletsprojects.com/en/2.3.x/tutorial/deploy/</a></li>
<li><a href="https://flask.palletsprojects.com/en/2.3.x/deploying/">https://flask.palletsprojects.com/en/2.3.x/deploying/</a></li>
</ul>

<p>
**
</p>
</div>
</div>
<div id="outline-container-orgc78d557" class="outline-3">
<h3 id="orgc78d557"><span class="section-number-3">65.26.</span> vulnerabilities</h3>
<div class="outline-text-3" id="text-65-26">
<p>
<a href="https://github.com/lokori/flask-vuln">https://github.com/lokori/flask-vuln</a>
</p>
</div>
</div>
<div id="outline-container-org57f940d" class="outline-3">
<h3 id="org57f940d"><span class="section-number-3">65.27.</span> USECASES</h3>
<div class="outline-text-3" id="text-65-27">
<ul class="org-ul">
<li>get data <a href="https://stackoverflow.com/questions/10434599/how-to-get-data-received-in-flask-request">https://stackoverflow.com/questions/10434599/how-to-get-data-received-in-flask-request</a></li>
<li>app.config['JSON<sub>AS</sub><sub>ASCII</sub>'] = False # disabling ASCII-safe encoding opens the door for issues with U+2028
and U+2029 separators in the data to break Javascript interpolation or JSONP APIs
<a href="http://timelessrepo.com/json-isnt-a-javascript-subset">http://timelessrepo.com/json-isnt-a-javascript-subset</a></li>
</ul>

<p>
Для возвращаемого значения создается
</p>
<ul class="org-ul">
<li>Response 200 OK, with the string as response body, text/html mimetype</li>
<li>(response, status, headers) or (response, headers)</li>
</ul>
</div>




<div id="outline-container-orgd958ca0" class="outline-4">
<h4 id="orgd958ca0"><span class="section-number-4">65.27.1.</span> check file exist</h4>
<div class="outline-text-4" id="text-65-27-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">from</span> flask <span style="color: #8ac6f2; font-weight: bold;">import</span> Flask
<span style="color: #8ac6f2; font-weight: bold;">from</span> flask <span style="color: #8ac6f2; font-weight: bold;">import</span> render_template
<span style="color: #8ac6f2; font-weight: bold;">import</span> os
<span style="color: #cae682;">app</span> = Flask(<span style="color: #e5786d;">__name__</span>)
<span style="color: #92a65e; font-weight: bold;">@app.route</span>(<span style="color: #95e454;">"/"</span>)
<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">main</span>():
    app.logger.debug(os.path.exists(os.path.join(app.static_folder, <span style="color: #95e454;">'staticimage.png'</span>)))
    app.logger.debug(os.path.exists(os.path.join(app.template_folder, <span style="color: #95e454;">'index.html'</span>)))
    <span style="color: #8ac6f2; font-weight: bold;">return</span> render_template(<span style="color: #95e454;">'index.html'</span>)

</pre>
</div>
</div>
</div>
<div id="outline-container-orgb1a3b6c" class="outline-4">
<h4 id="orgb1a3b6c"><span class="section-number-4">65.27.2.</span> call POST method</h4>
<div class="outline-text-4" id="text-65-27-2">
<div class="org-src-container">
<pre class="src src-python">request.<span style="color: #cae682;">files</span> = {<span style="color: #95e454;">'file'</span>: <span style="color: #e5786d;">open</span>(<span style="color: #95e454;">'/home/u/a.html'</span>, <span style="color: #95e454;">'rb'</span>)}
request.<span style="color: #cae682;">method</span> = <span style="color: #95e454;">'POST'</span>
<span style="color: #cae682;">r</span> = upload()
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">('{"id": "35f190f6aa854b6c9bb0c64e601c0eda"}', 200, {'Content-Type': 'application/json'})</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4afda2c" class="outline-4">
<h4 id="org4afda2c"><span class="section-number-4">65.27.3.</span> call GET method with arguments</h4>
<div class="outline-text-4" id="text-65-27-3">
<div class="org-src-container">
<pre class="src src-python">request.<span style="color: #cae682;">args</span> = {<span style="color: #95e454;">'id'</span>: rid}
<span style="color: #cae682;">r</span> = get()
app.logger.debug(<span style="color: #95e454;">"r "</span> + json.dumps(json.loads(r[0]), indent=4))
</pre>
</div>
</div>
</div>
<div id="outline-container-orge0785af" class="outline-4">
<h4 id="orge0785af"><span class="section-number-4">65.27.4.</span> print headers</h4>
<div class="outline-text-4" id="text-65-27-4">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">from</span> flask <span style="color: #8ac6f2; font-weight: bold;">import</span> Flask
<span style="color: #e5786d;">print</span>(<span style="color: #e5786d;">__name__</span>)
<span style="color: #cae682;">app</span> = Flask(<span style="color: #e5786d;">__name__</span>, template_folder=<span style="color: #95e454;">'./'</span>, static_folder=<span style="color: #95e454;">'./'</span>)

<span style="color: #8ac6f2; font-weight: bold;">from</span> flask <span style="color: #8ac6f2; font-weight: bold;">import</span> render_template
<span style="color: #8ac6f2; font-weight: bold;">from</span> flask <span style="color: #8ac6f2; font-weight: bold;">import</span> abort, redirect, url_for
<span style="color: #8ac6f2; font-weight: bold;">from</span> flask <span style="color: #8ac6f2; font-weight: bold;">import</span> request
<span style="color: #8ac6f2; font-weight: bold;">from</span> werkzeug.utils <span style="color: #8ac6f2; font-weight: bold;">import</span> secure_filename


<span style="color: #92a65e; font-weight: bold;">@app.route</span>(<span style="color: #95e454;">"/"</span>)
<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">hell</span>():
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">return render_template('a.html')</span>
    <span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #95e454;">''</span>.join([f<span style="color: #95e454;">"&lt;br&gt; </span>{x[0]}<span style="color: #95e454;">: </span>{x[1]}<span style="color: #e5786d; font-weight: bold;">\n</span><span style="color: #95e454;">"</span> <span style="color: #8ac6f2; font-weight: bold;">for</span> x <span style="color: #8ac6f2; font-weight: bold;">in</span> request.headers])

<span style="color: #8ac6f2; font-weight: bold;">if</span> <span style="color: #e5786d;">__name__</span> == <span style="color: #95e454;">"__main__"</span>:
    <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"start"</span>)
    app.run(host=<span style="color: #95e454;">'0.0.0.0'</span>, port=80, debug=<span style="color: #e5786d; font-weight: bold;">False</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-org830b31c" class="outline-4">
<h4 id="org830b31c"><span class="section-number-4">65.27.5.</span> TLS server</h4>
<div class="outline-text-4" id="text-65-27-5">
<p>
generate CSR (Creating the Server Certificate) used by CA to generate SSL
</p>
<ul class="org-ul">
<li>rm server.key ; openssl genrsa -out server.key 2048 &amp;&amp; cp server.key server.key.org &amp;&amp; openssl rsa -in server.key.org -out server.key
<ul class="org-ul">
<li>cp server.key server.key.org</li>
<li>openssl rsa -in server.key.org -out server.key</li>
</ul></li>
<li>openssl req -new -key server.key -out server.csr</li>
</ul>

<p>
generate self-signed:
</p>
<ul class="org-ul">
<li>openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt</li>
</ul>

<p>
CN must be full domain address
</p>

<p>
.well-known/pki-validation/926C419392B7B26DFCECBAEB9F163A53.txt
</p>
</div>
</div>
</div>
<div id="outline-container-orga60b5f3" class="outline-3">
<h3 id="orga60b5f3"><span class="section-number-3">65.28.</span> async/await and ASGI</h3>
<div class="outline-text-3" id="text-65-28">
<p>
Flask supports <b>async coroutines for view functions</b> by executing the coroutine on a separate thread instead of
 using an <b>event loop on the main thread</b> as an async-first (ASGI) framework would. This is necessary for Flask
 to remain backwards compatible with extensions and code built before async was introduced into Python. This
 compromise introduces a performance cost compared with the ASGI frameworks, due to the overhead of the
 threads.
</p>

<p>
you can run async code within a view, for example to make multiple concurrent database queries, HTTP requests
 to an external API, etc. However, the number of requests your application can handle at one time will remain
 the same.
</p>
</div>
</div>
<div id="outline-container-orgbf747e6" class="outline-3">
<h3 id="orgbf747e6"><span class="section-number-3">65.29.</span> use HTTPS</h3>
<div class="outline-text-3" id="text-65-29">
<p>
unstable certificate:
</p>
<pre class="example">
flask run --cert=adhoc
</pre>

<p>
or
</p>
<pre class="example">
app.run(ssl_context='adhoc')
</pre>


<p>
stable
</p>
<ol class="org-ol">
<li>generate: openssl req -x509 -newkey rsa:4096 -nodes -out cert.pem -keyout key.pem -days 365</li>
<li></li>
</ol>
<pre class="example">
app.run(ssl_context=('cert.pem', 'key.pem'))
</pre>

<p>
or
</p>
<pre class="example">
flask run --cert=cert.pem --key=key.pem
</pre>

<p>
or
</p>
<pre class="example">
python micro_file_server/__main__.py --cert=.cert/cert.pem --key=.cert/key.pem
</pre>
</div>
</div>

<div id="outline-container-orgdd1cd90" class="outline-3">
<h3 id="orgdd1cd90"><span class="section-number-3">65.30.</span> links</h3>
<div class="outline-text-3" id="text-65-30">
<ul class="org-ul">
<li><a href="https://flask.palletsprojects.com/">https://flask.palletsprojects.com/</a></li>
<li><a href="file:///usr/lib/python3.11/site-packages/flask/">file:///usr/lib/python3.11/site-packages/flask/</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org3361501" class="outline-2">
<h2 id="org3361501"><span class="section-number-2">66.</span> FastAPI</h2>
<div class="outline-text-2" id="text-66">
<ul class="org-ul">
<li>built-in data validation feature</li>
<li>error messages displayed in JSON format</li>
<li>anychronous task support - asyncio</li>
<li>documentation support - automatic</li>
<li>feature-rich: HTTPS requests, OAuth, XML/JSON response, TLS encryption</li>
<li>built-in monitoring tools</li>
<li>cons: expensive, difficult to scale</li>
</ul>

<p>
implement ASGI specification
</p>

<p>
installation:
</p>
<ul class="org-ul">
<li>pip install fastapi</li>
</ul>
</div>
<div id="outline-container-org18aa4c9" class="outline-3">
<h3 id="org18aa4c9"><span class="section-number-3">66.1.</span> Interactive API Documentation</h3>
<div class="outline-text-3" id="text-66-1">
<ul class="org-ul">
<li>Swagger UI: <a href="http://127.0.0.1:8000/docs">http://127.0.0.1:8000/docs</a></li>
<li>ReDoc: <a href="http://127.0.0.1:8000/redoc">http://127.0.0.1:8000/redoc</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgb705418" class="outline-3">
<h3 id="orgb705418"><span class="section-number-3">66.2.</span> running with uvicorn or gunicorn</h3>
<div class="outline-text-3" id="text-66-2">
<p>
FastAPI doesn’t contain any built-in development server.
</p>

<p>
www-servers/gunicorn  - A WSGI HTTP Server for UNIX
</p>
<ul class="org-ul">
<li>NOT SUITABLE.</li>
</ul>

<p>
dev-python/uvicorn - ASGI server
</p>
<ul class="org-ul">
<li>suitable</li>
</ul>

<p>
uvicorn fapi:app
</p>
<ul class="org-ul">
<li>&#x2013;reload - when you update your application code, the server will reload automatically.</li>
</ul>
</div>
</div>

<div id="outline-container-orgfc3c90e" class="outline-3">
<h3 id="orgfc3c90e"><span class="section-number-3">66.3.</span> dependencies</h3>
<div class="outline-text-3" id="text-66-3">
<ul class="org-ul">
<li>dev-python/fastapi-0.112.0</li>
<li>dev-python/pydantic-2.8.2</li>
<li>dev-python/pydantic-core-2.20.1</li>
<li>dev-python/annotated-types-0.7.0</li>
<li>dev-python/starlette-0.37.2</li>
<li>dev-python/httpx-0.27.0</li>
<li>dev-python/httpcore-1.0.5</li>
<li>dev-python/h2-4.1.0-r1</li>
<li>dev-python/hpack-4.0.0-r1</li>
<li>dev-python/hyperframe-6.0.1-r1</li>
<li>dev-python/h11-0.14.0</li>
<li>dev-python/python-multipart-0.0.9</li>
<li>dev-python/pdm-backend-2.3.3</li>
<li>dev-python/tomli-w-1.0.0-r1</li>
<li>dev-python/starlette-0.37.2</li>
<li>dev-python/anyio-4.4.0-r1</li>
<li>dev-python/sniffio-1.3.1</li>
</ul>
</div>
</div>
<div id="outline-container-orgc7fb830" class="outline-3">
<h3 id="orgc7fb830"><span class="section-number-3">66.4.</span> swagger</h3>
<div class="outline-text-3" id="text-66-4">
<ul class="org-ul">
<li><a href="https://fastapi.tiangolo.com/tutorial/metadata/">https://fastapi.tiangolo.com/tutorial/metadata/</a></li>
</ul>
<p>
app.swagger<sub>ui</sub><sub>parameters</sub>
</p>
<ul class="org-ul">
<li><a href="https://fastapi.tiangolo.com/how-to/configure-swagger-ui/">https://fastapi.tiangolo.com/how-to/configure-swagger-ui/</a></li>
<li><a href="https://swagger.io/docs/open-source-tools/swagger-ui/usage/configuration/">https://swagger.io/docs/open-source-tools/swagger-ui/usage/configuration/</a></li>
</ul>


<p>
Problem: external (not solved)
</p>
<ul class="org-ul">
<li>swagger-ui-bundle.js</li>
<li>swagger-ui.css</li>
<li><a href="https://medium.com/@chodvadiyasaurabh/elevating-your-api-documentation-customizing-swagger-ui-in-fastapi-28513ccb2af6">https://medium.com/@chodvadiyasaurabh/elevating-your-api-documentation-customizing-swagger-ui-in-fastapi-28513ccb2af6</a></li>
<li><a href="https://github.com/swagger-api/swagger-ui/tree/master/dist">https://github.com/swagger-api/swagger-ui/tree/master/dist</a></li>
</ul>
</div>
</div>
<div id="outline-container-org6a1ebbb" class="outline-3">
<h3 id="org6a1ebbb"><span class="section-number-3">66.5.</span> links</h3>
<div class="outline-text-3" id="text-66-5">
<ul class="org-ul">
<li><a href="https://fastapi.tiangolo.com/">https://fastapi.tiangolo.com/</a></li>
<li><a href="https://github.com/fastapi/fastapi">https://github.com/fastapi/fastapi</a></li>
<li><a href="https://realpython.com/fastapi-python-web-apis/">https://realpython.com/fastapi-python-web-apis/</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org165101c" class="outline-2">
<h2 id="org165101c"><span class="section-number-2">67.</span> Databases</h2>
<div class="outline-text-2" id="text-67">
</div>
<div id="outline-container-org5e29e86" class="outline-3">
<h3 id="org5e29e86"><span class="section-number-3">67.1.</span> Database API Specification v2.0 (PEP 249). <a href="http://www.python.org/dev/peps/pep-0249/">http://www.python.org/dev/peps/pep-0249/</a></h3>
<div class="outline-text-3" id="text-67-1">
<ul class="org-ul">
<li>constructor .connect( parameters… )</li>
<li>.close()</li>
<li>.commit()</li>
<li>.rollback() - optional</li>
<li>.cursor() -&gt; Cursor Object</li>
</ul>

<p>
Cursor:
</p>
<ul class="org-ul">
<li>.execute(operation [, parameters])</li>
<li>.fetchone()</li>
<li>.fetchall()</li>
<li>.close()</li>
<li>.arraysize -  number of rows to fetch at a time with .fetchmany()</li>
</ul>
</div>
</div>
<div id="outline-container-orgd152afe" class="outline-3">
<h3 id="orgd152afe"><span class="section-number-3">67.2.</span> Groonga</h3>
<div class="outline-text-3" id="text-67-2">
<p>
<a href="http://groonga.org/docs/">http://groonga.org/docs/</a>
GNU Lesser General Public License v2.1
</p>
<ul class="org-ul">
<li>full text search engine based on inverted index</li>
<li>updates without read locks</li>
<li>column-oriented database management system</li>
<li>read lock-free</li>
<li>Geo-location (latitude and longitude) search</li>
</ul>

<p>
start:
</p>
<ul class="org-ul">
<li>apt-get install groonga</li>
<li>$ groonga -n grb.db            - create database</li>
<li>$ groonga -s -p 10041  grb.db</li>
</ul>

<p>
0.0.0.0:10041
</p>
</div>

<div id="outline-container-org5efabc8" class="outline-4">
<h4 id="org5efabc8"><span class="section-number-4">67.2.1.</span> Basic commands:</h4>
<div class="outline-text-4" id="text-67-2-1">
<dl class="org-dl">
<dt>status</dt><dd>shows status of a Groonga process.</dd>
<dt>table<sub>list</sub></dt><dd>shows a list of tables in a database.</dd>
<dt>column<sub>list</sub></dt><dd>shows a list of columns in a table.</dd>
<dt>table<sub>create</sub></dt><dd>adds a table to a database.</dd>
<dt>column<sub>create</sub></dt><dd>adds a column to a table.</dd>
<dt>select</dt><dd>searches records from a table and shows the result.</dd>
<dt>load</dt><dd>inserts records to a table.</dd>
</dl>

<pre class="example">
table_create --name Site --flags TABLE_HASH_KEY --key_type ShortText
select --table Site
column_create --table Site --name gender --type UInt8
</pre>


<pre class="example">
select Site --filter 'fuzzy_search(_key, "two")'
</pre>

<p>
<a href="https://github.com/groonga/groonga/search?l=C&amp;q=fuzzy_search">https://github.com/groonga/groonga/search?l=C&amp;q=fuzzy_search</a>
</p>


<p>
default:
</p>
<ul class="org-ul">
<li>data.max<sub>distance</sub> = 1;</li>
<li>data.prefix<sub>length</sub> = 0;</li>
<li>data.prefix<sub>match</sub><sub>size</sub> = 0;</li>
<li>data.max<sub>expansion</sub> = 0;</li>
</ul>
</div>
</div>
<div id="outline-container-orgb6fbb34" class="outline-4">
<h4 id="orgb6fbb34"><span class="section-number-4">67.2.2.</span> python</h4>
<div class="outline-text-4" id="text-67-2-2">
<p>
<a href="https://github.com/hhatto/poyonga">https://github.com/hhatto/poyonga</a>
</p>

<pre class="example">
pip install --upgrade poyonga
</pre>


<pre class="example">
groonga -s --protocol http grb.db
</pre>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">from</span> poyonga <span style="color: #8ac6f2; font-weight: bold;">import</span> Groonga
<span style="color: #cae682;">g</span> = Groonga(port=10041, protocol=<span style="color: #95e454;">"http"</span>, host=<span style="color: #95e454;">'0.0.0.0'</span>)
<span style="color: #e5786d;">print</span>(g.call(<span style="color: #95e454;">"status"</span>).status)
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">&gt;&gt;&gt; 0</span>
</pre>
</div>
</div>

<ol class="org-ol">
<li><a id="org93b2ec6"></a>load<br />
<div class="outline-text-5" id="text-67-2-2-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">from</span> poyonga <span style="color: #8ac6f2; font-weight: bold;">import</span> Groonga

<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">_call</span>(g, cmd, **kwargs):
    <span style="color: #cae682;">ret</span> = g.call(cmd, **kwargs)
    <span style="color: #e5786d;">print</span>(ret.status)
    <span style="color: #e5786d;">print</span>(ret.body)
    <span style="color: #8ac6f2; font-weight: bold;">if</span> cmd == <span style="color: #95e454;">'select'</span>:
        <span style="color: #8ac6f2; font-weight: bold;">for</span> item <span style="color: #8ac6f2; font-weight: bold;">in</span> ret.items:
            <span style="color: #e5786d;">print</span>(item)
        <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"=*="</span> * 30)

<span style="color: #cae682;">data</span> = <span style="color: #95e454;">"""\</span>
<span style="color: #95e454;">[</span>
<span style="color: #95e454;">  {</span>
<span style="color: #95e454;">    "_key": "one",</span>
<span style="color: #95e454;">    "gender": 1,</span>
<span style="color: #95e454;">  }</span>
<span style="color: #95e454;">]</span>
<span style="color: #95e454;">"""</span>
_call(g, <span style="color: #95e454;">"load"</span>, table=<span style="color: #95e454;">"Site"</span>, values=<span style="color: #95e454;">""</span>.join(data.splitlines()))

</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-orgf54a1e6" class="outline-3">
<h3 id="orgf54a1e6"><span class="section-number-3">67.3.</span> Oracle</h3>
<div class="outline-text-3" id="text-67-3">
<p>
<a href="https://www.oracle.com/database/technologies/instant-client.html">https://www.oracle.com/database/technologies/instant-client.html</a>
</p>

<pre class="example">
python cx_Oracle
</pre>

<p>
require: Oracle Instant Client - Basic zip, SQLPlus zip (for console)
</p>

<p>
.bashrc
</p>
<pre class="example">
export LD_LIBRARY_PATH=/home/u2/.local/instantclient_19_8:$LD_LIBRARY_PATH
</pre>



<pre class="example">
wget https://download.oracle.com/otn_software/linux/instantclient/instantclient-basic-linuxx64.zip
unzip instantclient-basic-linuxx64.zip
apt-get install libaio1
export LD_LIBRARY_PATH=/instantclient_19_8:$LD_LIBRARY_PATH
</pre>
</div>

<div id="outline-container-org47fb2a5" class="outline-4">
<h4 id="org47fb2a5"><span class="section-number-4">67.3.1.</span> sql</h4>
<div class="outline-text-4" id="text-67-3-1">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #8ac6f2; font-weight: bold;">SELECT</span> *
<span style="color: #8ac6f2; font-weight: bold;">FROM</span>
    nls_database_parameters
<span style="color: #8ac6f2; font-weight: bold;">WHERE</span>
    <span style="color: #8ac6f2; font-weight: bold;">PARAMETER</span> = <span style="color: #95e454;">'NLS_NCHAR_CHARACTERSET'</span>;

<span style="color: #8ac6f2; font-weight: bold;">DELETE</span> <span style="color: #8ac6f2; font-weight: bold;">FROM</span> <span style="color: #8ac6f2; font-weight: bold;">table</span> - remove records
<span style="color: #8ac6f2; font-weight: bold;">drop</span> <span style="color: #8ac6f2; font-weight: bold;">table</span> - remove <span style="color: #8ac6f2; font-weight: bold;">table</span>

<span style="color: #8ac6f2; font-weight: bold;">SELECT</span> * <span style="color: #8ac6f2; font-weight: bold;">FROM</span> ALL_OBJECTS - <span style="color: #8ac6f2; font-weight: bold;">system</span>
<span style="color: #8ac6f2; font-weight: bold;">SELECT</span> * <span style="color: #8ac6f2; font-weight: bold;">FROM</span> v$version - oracle version
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org595a2ec" class="outline-3">
<h3 id="org595a2ec"><span class="section-number-3">67.4.</span> MySQL</h3>
<div class="outline-text-3" id="text-67-4">
<p>
MySQL Connector/Python  <a href="https://dev.mysql.com/doc/connector-python/en/connector-python-introduction.html">https://dev.mysql.com/doc/connector-python/en/connector-python-introduction.html</a>
</p>
<ul class="org-ul">
<li>compliant with Python Database API Specification v2.0 (PEP 249). <a href="http://www.python.org/dev/peps/pep-0249/">http://www.python.org/dev/peps/pep-0249/</a></li>
</ul>
</div>
</div>
<div id="outline-container-orga90a3be" class="outline-3">
<h3 id="orga90a3be"><span class="section-number-3">67.5.</span> Redis</h3>
<div class="outline-text-3" id="text-67-5">
<pre class="example">
emerge --ask dev-python/redis
equery f dev-python/redis
</pre>

<p>
main files:
</p>
<ul class="org-ul">
<li>client.py
<ul class="org-ul">
<li>class Redis</li>
</ul></li>
<li>connection.py
<ul class="org-ul">
<li>Connection</li>
<li>ConnectionPool</li>
</ul></li>
</ul>
</div>
<div id="outline-container-orgb42d0cc" class="outline-4">
<h4 id="orgb42d0cc"><span class="section-number-4">67.5.1.</span> timeout - connection for client to master</h4>
<div class="outline-text-4" id="text-67-5-1">
<p>
For CLI: Close the connection after a client is idle for N seconds (0 to disable)
</p>
<pre class="example">
timeout 0
</pre>


<p>
Redis(socket<sub>connect</sub><sub>timeout</sub>=None,  socket<sub>keepalive</sub><sub>options</sub>=None, socket<sub>keepalive</sub><sub>options</sub>=None)
</p>

<p>
Redis uses:
</p>
<ul class="org-ul">
<li>socket<sub>timeout</sub></li>
<li>socket<sub>keepalive</sub></li>
</ul>

<p>
seconds?
</p>
<ul class="org-ul">
<li><a href="https://docs.python.org/3/library/socket.html#socket.socket.settimeout">https://docs.python.org/3/library/socket.html#socket.socket.settimeout</a></li>
<li><a href="https://docs.python.org/3/library/socket.html#socket-timeouts">https://docs.python.org/3/library/socket.html#socket-timeouts</a></li>
</ul>

<p>
<b>there is no straightforward way to set a global socket timeout for all connections in imported libraries</b>
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org6b0f574" class="outline-2">
<h2 id="org6b0f574"><span class="section-number-2">68.</span> SQLAlchemy - ORM</h2>
<div class="outline-text-2" id="text-68">
<p>
<a href="https://docs.sqlalchemy.org/en/20/orm/quickstart.html">https://docs.sqlalchemy.org/en/20/orm/quickstart.html</a>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">from</span> sqlalchemy.orm <span style="color: #8ac6f2; font-weight: bold;">import</span> DeclarativeBase
<span style="color: #8ac6f2; font-weight: bold;">from</span> sqlalchemy.orm <span style="color: #8ac6f2; font-weight: bold;">import</span> mapped_column
<span style="color: #8ac6f2; font-weight: bold;">from</span> sqlalchemy.orm <span style="color: #8ac6f2; font-weight: bold;">import</span> Mapped
<span style="color: #8ac6f2; font-weight: bold;">from</span> sqlalchemy.orm <span style="color: #8ac6f2; font-weight: bold;">import</span> relationship
<span style="color: #8ac6f2; font-weight: bold;">from</span> sqlalchemy <span style="color: #8ac6f2; font-weight: bold;">import</span> ForeignKey
<span style="color: #8ac6f2; font-weight: bold;">from</span> sqlalchemy <span style="color: #8ac6f2; font-weight: bold;">import</span> String
<span style="color: #8ac6f2; font-weight: bold;">from</span> typing <span style="color: #8ac6f2; font-weight: bold;">import</span> List

<span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">Base</span>(DeclarativeBase):
    <span style="color: #8ac6f2; font-weight: bold;">pass</span>

<span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">User</span>(Base):
    <span style="color: #cae682;">__tablename__</span> = <span style="color: #95e454;">"user_account"</span>
    <span style="color: #e5786d;">id</span>: Mapped[<span style="color: #e5786d;">int</span>] = mapped_column(primary_key=<span style="color: #e5786d; font-weight: bold;">True</span>)
    <span style="color: #cae682;">name</span>: Mapped[<span style="color: #e5786d;">str</span>] = mapped_column(String(30))
    fullname: Mapped[<span style="color: #e5786d;">str</span> | <span style="color: #e5786d; font-weight: bold;">None</span>]
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">-- relationship</span>
    <span style="color: #cae682;">addresses</span>: Mapped[List[<span style="color: #95e454;">"Address"</span>]] = relationship(
        back_populates=<span style="color: #95e454;">"user"</span>, cascade=<span style="color: #95e454;">"all, delete-orphan"</span>)

<span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">Address</span>(Base):
    <span style="color: #cae682;">__tablename__</span> = <span style="color: #95e454;">"address"</span>
    <span style="color: #e5786d;">id</span>: Mapped[<span style="color: #e5786d;">int</span>] = mapped_column(primary_key=<span style="color: #e5786d; font-weight: bold;">True</span>)
    <span style="color: #cae682;">user_id</span>: Mapped[<span style="color: #e5786d;">int</span>] = mapped_column(ForeignKey(<span style="color: #95e454;">"user_account.id"</span>))
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">-- relationship</span>
    <span style="color: #cae682;">user</span>: Mapped[<span style="color: #95e454;">"User"</span>] = relationship(back_populates=<span style="color: #95e454;">"addresses"</span>)

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">-------- Create Tables -------------</span>
<span style="color: #8ac6f2; font-weight: bold;">from</span> sqlalchemy <span style="color: #8ac6f2; font-weight: bold;">import</span> create_engine
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">echo=True parameter indicates that SQL emitted by connections will be logged to standard out.</span>
<span style="color: #cae682;">engine</span> = create_engine(<span style="color: #95e454;">"sqlite://"</span>, echo=<span style="color: #e5786d; font-weight: bold;">True</span>)

Base.metadata.create_all(engine) <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">create DDL</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">-------- Create records -------------</span>
<span style="color: #8ac6f2; font-weight: bold;">from</span> sqlalchemy.orm <span style="color: #8ac6f2; font-weight: bold;">import</span> Session
<span style="color: #8ac6f2; font-weight: bold;">with</span> Session(engine) <span style="color: #8ac6f2; font-weight: bold;">as</span> session:
    <span style="color: #cae682;">spongebob</span> = User(
        name=<span style="color: #95e454;">"spongebob"</span>,
        fullname=<span style="color: #95e454;">"Spongebob Squarepants"</span>,
        addresses=[Address()],
    )
    session.add_all([spongebob])
    session.commit()

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">-------- Select -------------</span>
<span style="color: #8ac6f2; font-weight: bold;">from</span> sqlalchemy <span style="color: #8ac6f2; font-weight: bold;">import</span> select
<span style="color: #cae682;">session</span> = Session(engine)
<span style="color: #cae682;">stmt</span> = select(User).where(User.name.in_([<span style="color: #95e454;">"spongebob"</span>]))

<span style="color: #8ac6f2; font-weight: bold;">for</span> user <span style="color: #8ac6f2; font-weight: bold;">in</span> session.scalars(stmt):
    <span style="color: #e5786d;">print</span>(user.name, user)

</pre>
</div>

<pre class="example" id="org95d5742">
2024-03-03 13:05:24,386 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-03-03 13:05:24,386 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("user_account")
2024-03-03 13:05:24,387 INFO sqlalchemy.engine.Engine [raw sql] ()
2024-03-03 13:05:24,388 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("user_account")
2024-03-03 13:05:24,388 INFO sqlalchemy.engine.Engine [raw sql] ()
2024-03-03 13:05:24,389 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("address")
2024-03-03 13:05:24,389 INFO sqlalchemy.engine.Engine [raw sql] ()
2024-03-03 13:05:24,389 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("address")
2024-03-03 13:05:24,389 INFO sqlalchemy.engine.Engine [raw sql] ()
2024-03-03 13:05:24,393 INFO sqlalchemy.engine.Engine
CREATE TABLE user_account (
	id INTEGER NOT NULL,
	name VARCHAR(30) NOT NULL,
	fullname VARCHAR,
	PRIMARY KEY (id)
)


2024-03-03 13:05:24,394 INFO sqlalchemy.engine.Engine [no key 0.00035s] ()
2024-03-03 13:05:24,395 INFO sqlalchemy.engine.Engine
CREATE TABLE address (
	id INTEGER NOT NULL,
	user_id INTEGER NOT NULL,
	PRIMARY KEY (id),
	FOREIGN KEY(user_id) REFERENCES user_account (id)
)


2024-03-03 13:05:24,395 INFO sqlalchemy.engine.Engine [no key 0.00032s] ()
2024-03-03 13:05:24,396 INFO sqlalchemy.engine.Engine COMMIT
2024-03-03 13:05:24,411 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-03-03 13:05:24,415 INFO sqlalchemy.engine.Engine INSERT INTO user_account (name, fullname) VALUES (?, ?)
2024-03-03 13:05:24,415 INFO sqlalchemy.engine.Engine [generated in 0.00040s] ('spongebob', 'Spongebob Squarepants')
2024-03-03 13:05:24,417 INFO sqlalchemy.engine.Engine INSERT INTO address (user_id) VALUES (?)
2024-03-03 13:05:24,417 INFO sqlalchemy.engine.Engine [generated in 0.00036s] (1,)
2024-03-03 13:05:24,418 INFO sqlalchemy.engine.Engine COMMIT
2024-03-03 13:05:24,420 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-03-03 13:05:24,425 INFO sqlalchemy.engine.Engine SELECT user_account.id, user_account.name, user_account.fullname
FROM user_account
WHERE user_account.name IN (?)
2024-03-03 13:05:24,425 INFO sqlalchemy.engine.Engine [generated in 0.00050s] ('spongebob',)
spongebob &lt;__main__.User object at 0x7fb43dedf290&gt;
</pre>
</div>
</div>

<div id="outline-container-orgc578998" class="outline-2">
<h2 id="orgc578998"><span class="section-number-2">69.</span> Virtualenv</h2>
<div class="outline-text-2" id="text-69">
<p>
enables multiple side-by-side installations of Python, one for each project.
</p>
</div>

<div id="outline-container-orgf7ad408" class="outline-3">
<h3 id="orgf7ad408"><span class="section-number-3">69.1.</span> venv - default module</h3>
<div class="outline-text-3" id="text-69-1">
<p>
Creation of virtual environments is done by executing the command venv:
</p>
<ol class="org-ol">
<li>python3 -m venv path</li>
<li>source &lt;venv&gt;/bin/activate</li>
</ol>
</div>
</div>

<div id="outline-container-orgeb11a27" class="outline-3">
<h3 id="orgeb11a27"><span class="section-number-3">69.2.</span> virtualenv</h3>
<div class="outline-text-3" id="text-69-2">
<ul class="org-ul">
<li>pip3.6 install virtualenv &#x2013;user</li>
<li>~/.local/bin/virtualenv ENV</li>
<li>source ENV/bin/activate</li>
</ul>
</div>
</div>
<div id="outline-container-orga4b940e" class="outline-3">
<h3 id="orga4b940e"><span class="section-number-3">69.3.</span> two virtaul environments</h3>
<div class="outline-text-3" id="text-69-3">
<ol class="org-ol">
<li>create first with PyCharm, it will be /opt/venv</li>
<li>create second with python -m venv <i>opt</i>.venv</li>
<li>apt update</li>
<li>apt install nano</li>
<li>nano <i>opt</i>.venv/pyvenv.cfg: home = <i>opt</i>.venv/bin</li>
<li>execute my script</li>
<li>source /opt/venv/bin/activate</li>
<li>python -m pip install &#x2013;prefix=/opt/venv &#x2013;no-cache-dir -r requirements.txt</li>
</ol>

<p>
now both venv will hold two
</p>

<p>
script:
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #cae682;">p</span>=/opt/.venv <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">path without / ending - for Docker</span>
<span style="color: #cae682;">t</span>=/opt/venv <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">path without / ending - for PyCharm</span>

rm -rf $<span style="color: #cae682;">p</span>/bin
ln -s $<span style="color: #cae682;">t</span>/bin $<span style="color: #cae682;">p</span>/bin
rm -rf $<span style="color: #cae682;">p</span>/include
ln -s $<span style="color: #cae682;">t</span>/bin $<span style="color: #cae682;">p</span>/include
rm -rf $<span style="color: #cae682;">p</span>/lib
ln -s $<span style="color: #cae682;">t</span>/lib $<span style="color: #cae682;">p</span>/lib
rm -rf $<span style="color: #cae682;">p</span>/lib64
ln -s $<span style="color: #cae682;">t</span>/lib $<span style="color: #cae682;">p</span>/lib64
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4a311e6" class="outline-2">
<h2 id="org4a311e6"><span class="section-number-2">70.</span> ldap</h2>
<div class="outline-text-2" id="text-70">
<p>
apt-get install libsasl2-dev python-dev libldap2-dev libssl-dev
</p>
</div>
</div>
<div id="outline-container-orgcec9e59" class="outline-2">
<h2 id="orgcec9e59"><span class="section-number-2">71.</span> Containerized development</h2>
<div class="outline-text-2" id="text-71">
<p>
Docker
</p>
<ul class="org-ul">
<li>ENV values are available to containers</li>
</ul>

<pre class="example">
USER = os.getenv('API_USER')
PASSWORD = os.environ.get('API_PASSWORD')
</pre>



<pre class="example">
os.environ['API_USER'] = 'username'
os.environ['API_PASSWORD'] = 'secret'
</pre>
</div>
</div>

<div id="outline-container-org0d7c240" class="outline-2">
<h2 id="org0d7c240"><span class="section-number-2">72.</span> security</h2>
<div class="outline-text-2" id="text-72">
<ul class="org-ul">
<li>html.escape - &lt;html&gt; =&gt; &amp;lt;html&amp;gt;</li>
<li>from werkzeug.utils import secure<sub>filename</sub> - request.files['the<sub>file</sub>'].filename</li>
<li><a href="#org0b73dbc">34.9</a> - <a href="#org85befd4">65.17</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgbec856c" class="outline-2">
<h2 id="orgbec856c"><span class="section-number-2">73.</span> serialization</h2>
<div class="outline-text-2" id="text-73">
<ul class="org-ul">
<li>pickle (unsafe alone) +  hmac</li>
<li>json</li>
<li>YAML: YAML is a superset of JSON, but easier to read (read &amp; write, comparison of JSON and YAML)</li>
<li>csv</li>
<li>MessagePack (Python package): More compact representation (read &amp; write)</li>
<li>HDF5 (Python package): Nice for matrices (read &amp; write)</li>
<li>XML: exists too <b>sigh</b> (read &amp; write)</li>
<li></li>
</ul>
</div>
<div id="outline-container-org96b3d49" class="outline-3">
<h3 id="org96b3d49"><span class="section-number-3">73.1.</span> pickle</h3>
<div class="outline-text-3" id="text-73-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">-- pandas pickle and csv --</span>
<span style="color: #8ac6f2; font-weight: bold;">import</span> pickle
<span style="color: #cae682;">p</span>: <span style="color: #e5786d;">str</span> = p
<span style="color: #8ac6f2; font-weight: bold;">if</span> p.endswith(<span style="color: #95e454;">'.csv'</span>):
    <span style="color: #cae682;">df</span> = pd.read_csv(p, index_col=0, low_memory=<span style="color: #e5786d; font-weight: bold;">False</span>, nrows=nrows)
<span style="color: #8ac6f2; font-weight: bold;">elif</span> p.endswith(<span style="color: #95e454;">'.pickle'</span>):
    <span style="color: #cae682;">df</span>: pd.DataFrame = pd.read_pickle(p)

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">-- pickle</span>
<span style="color: #8ac6f2; font-weight: bold;">import</span> pickle
<span style="color: #8ac6f2; font-weight: bold;">with</span> <span style="color: #e5786d;">open</span>(<span style="color: #95e454;">'filename.pickle'</span>, <span style="color: #95e454;">'wb'</span>) <span style="color: #8ac6f2; font-weight: bold;">as</span> fh:
    pickle.dump(a, fh, protocol=pickle.HIGHEST_PROTOCOL)
<span style="color: #8ac6f2; font-weight: bold;">with</span> <span style="color: #e5786d;">open</span>(<span style="color: #95e454;">'filename.pickle'</span>, <span style="color: #95e454;">'rb'</span>) <span style="color: #8ac6f2; font-weight: bold;">as</span> fh:
    <span style="color: #cae682;">b</span> = pickle.load(fh)

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org84912b0" class="outline-2">
<h2 id="org84912b0"><span class="section-number-2">74.</span> cython</h2>
<div class="outline-text-2" id="text-74">
<ul class="org-ul">
<li>cython -3 &#x2013;embed a.py</li>
<li>gcc `python3-config &#x2013;cflags &#x2013;ldflags` -lpython3.10 -fPIC -shared a.c</li>
</ul>

<p>
from doc:
</p>
<pre class="example">
gcc -shared -pthread -fPIC -fwrapv -O2 -Wall -fno-strict-aliasing \
      -I/usr/include/python3.5 -o yourmod.so yourmod.c
</pre>
</div>
</div>

<div id="outline-container-orgb1f4457" class="outline-2">
<h2 id="orgb1f4457"><span class="section-number-2">75.</span> headles browsers</h2>
<div class="outline-text-2" id="text-75">
<p>
<a href="https://github.com/dhamaniasad/HeadlessBrowsers">https://github.com/dhamaniasad/HeadlessBrowsers</a>
</p>
</div>
</div>
<div id="outline-container-orgd50c30f" class="outline-2">
<h2 id="orgd50c30f"><span class="section-number-2">76.</span> selenium</h2>
<div class="outline-text-2" id="text-76">
<ul class="org-ul">
<li>Selenium WebDriver - interface to write instructions that work interchangeably across browsers, like a
headless browser.
<ul class="org-ul">
<li>1) Protocol specification</li>
<li>2) Ruby official implementation for Protocol specification</li>
<li>3) ChromeDriver, GeckoDriver - implementations of specification by Google and Mozilla. Most drivers are created by the browser vendors themselves</li>
</ul></li>
<li>Selenium Remote Control (RC) (pip install selenium) simple? interface to browsers and to webdirever</li>
<li>Selenium IDE - browser plug-in, records your actions in the browser and repeats them.</li>
<li>Selenium Grid - allows you to run parallel tests on multiple machines and browsers at the same time</li>
<li>bindings for languages.</li>
</ul>

<p>
pros:
</p>
<ul class="org-ul">
<li>easily integrates with various development platforms such as Jenkins, Maven, TestNG, QMetry, SauceLabs, etc.</li>
</ul>

<p>
cons:
</p>
<ul class="org-ul">
<li>No built-in image comparison ( Sikuli is a common choice)</li>
<li>No tech support</li>
<li>No reporting capabilities
<ul class="org-ul">
<li>TestNG creates two types of reports upon test execution: detailed and summary. The summary provides simple passed/failed data; while detailed reports have logs, errors, test groups, etc.</li>
<li>JUnit uses HTML to generate simple reports in Selenium with indicators “failed” and “succeeded.”</li>
<li>Extent Library is the most complex option: It creates test summaries, includes screenshots, generates pie charts, and so on.</li>
<li>Allure creates beautiful reports with graphs, a timeline, and categorized test results — all on a handy dashboard.</li>
</ul></li>
<li>well-coded Selenium test typically verifies less than 10% of the user interface</li>
</ul>

<p>
 web mobile apps. based on Selenium.
</p>
<ul class="org-ul">
<li>Selendroid focused exclusively on Android</li>
<li>Appium - iOS, Android, and Windows devices</li>
<li>Robotium — a black-box testing framework for Android</li>
<li>ios-driver—a Selenium WebDriver API for iOS testing integrated with Selenium Grid</li>
</ul>
</div>

<div id="outline-container-org07b608a" class="outline-3">
<h3 id="org07b608a"><span class="section-number-3">76.1.</span> drivers</h3>
<div class="outline-text-3" id="text-76-1">
<p>
Chrome: <a href="https://chromedriver.chromium.org/downloads">https://chromedriver.chromium.org/downloads</a>
</p>
<ul class="org-ul">
<li>source C++ <a href="https://chromium.googlesource.com/chromium/src/+/main/chrome/test/chromedriver/">https://chromium.googlesource.com/chromium/src/+/main/chrome/test/chromedriver/</a></li>
</ul>

<p>
Edge: <a href="https://developer.microsoft.com/en-us/microsoft-edge/tools/webdriver/">https://developer.microsoft.com/en-us/microsoft-edge/tools/webdriver/</a>
</p>

<p>
Firefox: <a href="https://github.com/mozilla/geckodriver/releases">https://github.com/mozilla/geckodriver/releases</a>
</p>
<ul class="org-ul">
<li>gentoo: USE="geckodriver" emerge www-client/firefox</li>
<li><a href="https://firefox-source-docs.mozilla.org/testing/geckodriver/">https://firefox-source-docs.mozilla.org/testing/geckodriver/</a></li>
<li>source Rust <a href="https://hg.mozilla.org/mozilla-central/file/tip/testing/geckodriver">https://hg.mozilla.org/mozilla-central/file/tip/testing/geckodriver</a></li>
</ul>
<p>
Safari: <a href="https://webkit.org/blog/6900/webdriver-support-in-safari-10/">https://webkit.org/blog/6900/webdriver-support-in-safari-10/</a>
</p>
</div>
</div>
<div id="outline-container-org8c97599" class="outline-3">
<h3 id="org8c97599"><span class="section-number-3">76.2.</span> install</h3>
<div class="outline-text-3" id="text-76-2">
<p>
<a href="https://packages.gentoo.org/packages/dev-ruby/selenium-webdriver">https://packages.gentoo.org/packages/dev-ruby/selenium-webdriver</a>
binding for Selenium Remote Control <a href="https://packages.gentoo.org/packages/dev-python/selenium">https://packages.gentoo.org/packages/dev-python/selenium</a>
</p>
</div>
</div>
<div id="outline-container-orgf4255a0" class="outline-3">
<h3 id="orgf4255a0"><span class="section-number-3">76.3.</span> python installantion</h3>
<div class="outline-text-3" id="text-76-3">
<ul class="org-ul">
<li>www-client/firefox with geckodriver - it is WebDriver implementation for Firefox <a href="https://github.com/mozilla/geckodriver">https://github.com/mozilla/geckodriver</a></li>
<li>dev-python/selenium -</li>
</ul>
</div>
</div>
<div id="outline-container-org9fd800c" class="outline-3">
<h3 id="org9fd800c"><span class="section-number-3">76.4.</span> python usage</h3>
<div class="outline-text-3" id="text-76-4">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">from</span> selenium <span style="color: #8ac6f2; font-weight: bold;">import</span> webdriver

<span style="color: #cae682;">driver</span> = webdriver.Firefox()
driver.get(<span style="color: #95e454;">"https://google.com"</span>)
<span style="color: #8ac6f2; font-weight: bold;">for</span> i <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">range</span>(1):
    <span style="color: #cae682;">matched_elements</span> = driver.get(<span style="color: #95e454;">"https://www.google.com/search?q="</span> +
                                     search_string + <span style="color: #95e454;">"&amp;start="</span> + <span style="color: #e5786d;">str</span>(i))

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">driver.find_element_by_id("nav-search").send_keys("Selenium")</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf925771" class="outline-3">
<h3 id="orgf925771"><span class="section-number-3">76.5.</span> links</h3>
<div class="outline-text-3" id="text-76-5">
<ul class="org-ul">
<li><a href="https://www.selenium.dev/documentation/overview/components/">https://www.selenium.dev/documentation/overview/components/</a></li>
<li><a href="https://pythonbasics.org/selenium-firefox/">https://pythonbasics.org/selenium-firefox/</a></li>
<li><a href="https://www.scrapingbee.com/blog/selenium-python/">https://www.scrapingbee.com/blog/selenium-python/</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org496e5c6" class="outline-2">
<h2 id="org496e5c6"><span class="section-number-2">77.</span> plot in terminal</h2>
<div class="outline-text-2" id="text-77">
<ul class="org-ul">
<li>plotille
<ul class="org-ul">
<li><a href="https://pypi.org/project/plotille/">https://pypi.org/project/plotille/</a></li>
<li><a href="https://github.com/tammoippen/plotille">https://github.com/tammoippen/plotille</a></li>
</ul></li>
<li><a href="https://pypi.org/project/plotext/">https://pypi.org/project/plotext/</a></li>
</ul>
</div>
<div id="outline-container-org938c226" class="outline-3">
<h3 id="org938c226"><span class="section-number-3">77.1.</span> plotext</h3>
<div class="outline-text-3" id="text-77-1">
<p>
<a href="https://github.com/piccolomo/plotext">https://github.com/piccolomo/plotext</a>
Нагрузка на воркерах 0 и 1 - 400 и 500:
</p>
<pre class="example">
pip install plotext
python3 -c "import plotext as plt; plt.bar([0,1],[400,500]) ; plt.show() ;"
</pre>
</div>
</div>
</div>
<div id="outline-container-org24ec9cb" class="outline-2">
<h2 id="org24ec9cb"><span class="section-number-2">78.</span> xml parsing</h2>
<div class="outline-text-2" id="text-78">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> xml.etree.ElementTree <span style="color: #8ac6f2; font-weight: bold;">as</span> ET
<span style="color: #cae682;">xmlfile</span> = <span style="color: #95e454;">"a.xml"</span>
<span style="color: #cae682;">tree</span> = ET.parse(xmlfile)
<span style="color: #cae682;">root</span> = tree.getroot()
<span style="color: #8ac6f2; font-weight: bold;">for</span> child <span style="color: #8ac6f2; font-weight: bold;">in</span> root:
    <span style="color: #e5786d;">print</span>(child.tag, [x.tag <span style="color: #8ac6f2; font-weight: bold;">for</span> x <span style="color: #8ac6f2; font-weight: bold;">in</span> child], child.attrib)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgbde9cbc" class="outline-2">
<h2 id="orgbde9cbc"><span class="section-number-2">79.</span> pytest</h2>
<div class="outline-text-2" id="text-79">
</div>
<div id="outline-container-org3953fc4" class="outline-3">
<h3 id="org3953fc4"><span class="section-number-3">79.1.</span> features</h3>
<div class="outline-text-3" id="text-79-1">
<ul class="org-ul">
<li>Detailed info on failing assert statements</li>
<li>Auto-discovery of test modules and functions: <a href="https://docs.pytest.org/en/stable/explanation/goodpractices.html#conventions-for-python-test-discovery">https://docs.pytest.org/en/stable/explanation/goodpractices.html#conventions-for-python-test-discovery</a>
<ul class="org-ul">
<li>if no "testpaths" and not directories as arguments defined - Recurse into directories</li>
<li>test<sub>*</sub>.py or *<sub>test.py</sub></li>
<li>"test" prefixed functions.</li>
<li>test prefixed test functions or methods inside Test prefixed test classes</li>
</ul></li>
<li>Modular fixtures for managing small or parametrized long-lived test resources  <a href="https://docs.pytest.org/en/stable/explanation/fixtures.html">https://docs.pytest.org/en/stable/explanation/fixtures.html</a></li>
<li>Can run "unittest" (or trial), "nose" test suites out of the box</li>
<li>Rich plugin architecture, with over 850+ external plugins and thriving community <a href="https://docs.pytest.org/en/latest/reference/plugin_list.html">https://docs.pytest.org/en/latest/reference/plugin_list.html</a></li>
</ul>

<pre class="example">
[pytest] # pytest.ini (or .pytest.ini), pyproject.toml, tox.ini, or setup.cfg
testpaths = testing doc # as if $pytest testing doc
</pre>


<p>
pytest -x           # stop after first failure
pytest &#x2013;maxfail=2  # stop after two failures
</p>
</div>
</div>
<div id="outline-container-orgdf97658" class="outline-3">
<h3 id="orgdf97658"><span class="section-number-3">79.2.</span> layout</h3>
<div class="outline-text-3" id="text-79-2">
<div class="org-src-container">
<pre class="src src-text">pyproject.toml
src/
    mypkg/
        __init__.py
        app.py
        view.py
tests/
    test_app.py
    test_view.py
    ...
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc1168cb" class="outline-3">
<h3 id="orgc1168cb"><span class="section-number-3">79.3.</span> usage</h3>
<div class="outline-text-3" id="text-79-3">
<ol class="org-ol">
<li>cd project (with pyproject.toml and test folder)</li>
<li>pytest [ foders &#x2026; ]   - packages should be added to PYTHONPATH manually</li>
<li>or python -m pytest (this one add the current directory to sys.path) - current directory must be src or package(for flat)</li>
</ol>
</div>
</div>
<div id="outline-container-orgda845cc" class="outline-3">
<h3 id="orgda845cc"><span class="section-number-3">79.4.</span> dependencies</h3>
<div class="outline-text-3" id="text-79-4">
<div class="org-src-container">
<pre class="src src-text">dev-python/pytest-7.3.2:
 [  0]  dev-python/pytest-7.3.2
 [  1]  dev-python/iniconfig-2.0.0
 [  1]  dev-python/more-itertools-9.1.0
 [  1]  dev-python/packaging-23.1
 [  1]  dev-python/pluggy-1.0.0-r2
 [  1]  dev-python/exceptiongroup-1.1.1
 [  1]  dev-python/tomli-2.0.1-r1
 [  1]  dev-python/pypy3-7.3.11_p1
 [  1]  dev-lang/python-3.10.11
 [  1]  dev-lang/python-3.11.3
 [  1]  dev-lang/python-3.12.0_beta2
 [  1]  dev-python/setuptools-scm-7.1.0
 [  1]  dev-python/argcomplete-3.0.8
 [  1]  dev-python/attrs-23.1.0
 [  1]  dev-python/hypothesis-6.76.0
 [  1]  dev-python/mock-5.0.2
 [  1]  dev-python/pygments-2.15.1
 [  1]  dev-python/pytest-xdist-3.3.1
 [  1]  dev-python/requests-2.31.0
 [  1]  dev-python/xmlschema-2.3.0
 [  1]  dev-python/gpep517-13
 [  1]  dev-python/setuptools-67.7.2
 [  1]  dev-python/wheel-0.40.0
</pre>
</div>
</div>
</div>
<div id="outline-container-org4fa5a54" class="outline-3">
<h3 id="org4fa5a54"><span class="section-number-3">79.5.</span> fixtures - context for the test</h3>
<div class="outline-text-3" id="text-79-5">
<p>
fixtures can use other fixtures
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> pytest

<span style="color: #8ac6f2; font-weight: bold;">class</span> <span style="color: #92a65e; font-weight: bold;">Fruit</span>:
    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">__init__</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>, name):
        <span style="color: #8ac6f2; font-weight: bold;">self</span>.<span style="color: #cae682;">name</span> = name

    <span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">__eq__</span>(<span style="color: #8ac6f2; font-weight: bold;">self</span>, other):
        <span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #8ac6f2; font-weight: bold;">self</span>.name == other.name


<span style="color: #92a65e; font-weight: bold;">@pytest.fixture</span>
<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">my_fruit</span>():
    <span style="color: #8ac6f2; font-weight: bold;">return</span> Fruit(<span style="color: #95e454;">"apple"</span>)


<span style="color: #92a65e; font-weight: bold;">@pytest.fixture</span>
<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">fruit_basket</span>(my_fruit):
    <span style="color: #8ac6f2; font-weight: bold;">return</span> [Fruit(<span style="color: #95e454;">"banana"</span>), my_fruit]


<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">test_my_fruit_in_basket</span>(my_fruit, fruit_basket):
    <span style="color: #8ac6f2; font-weight: bold;">assert</span> my_fruit <span style="color: #8ac6f2; font-weight: bold;">in</span> fruit_basket

</pre>
</div>
<p>
<a href="https://docs.pytest.org/en/latest/explanation/fixtures.html#what-fixtures-are">https://docs.pytest.org/en/latest/explanation/fixtures.html#what-fixtures-are</a>
</p>
</div>
</div>
<div id="outline-container-org2b0cbd6" class="outline-3">
<h3 id="org2b0cbd6"><span class="section-number-3">79.6.</span> mock - monkeypatch fixture</h3>
<div class="outline-text-3" id="text-79-6">
<p>
<a href="https://docs.pytest.org/en/stable/how-to/monkeypatch.html#monkeypatching-returned-objects-building-mock-classes">https://docs.pytest.org/en/stable/how-to/monkeypatch.html#monkeypatching-returned-objects-building-mock-classes</a>
</p>
</div>
</div>
<div id="outline-container-orgf063f90" class="outline-3">
<h3 id="orgf063f90"><span class="section-number-3">79.7.</span> print</h3>
<div class="outline-text-3" id="text-79-7">
<p>
capture stdout and stderr to see only passed tests
</p>
<pre class="example">
pytest -s                  # disable all capturing
</pre>
</div>
</div>
<div id="outline-container-org5433a92" class="outline-3">
<h3 id="org5433a92"><span class="section-number-3">79.8.</span> troubleshooting</h3>
<div class="outline-text-3" id="text-79-8">
<p>
ModuleNotFoundError: No module named 'micro<sub>file</sub><sub>server</sub>'
</p>
<ul class="org-ul">
<li>solution 1: pyproject.toml:</li>
</ul>
<pre class="example">
[tool.pytest.ini_options]
pythonpath = [ "." ]
</pre>
</div>
</div>

<div id="outline-container-org46ae14a" class="outline-3">
<h3 id="org46ae14a"><span class="section-number-3">79.9.</span> links</h3>
<div class="outline-text-3" id="text-79-9">
<ul class="org-ul">
<li>article <a href="https://realpython.com/pytest-python-testing/">https://realpython.com/pytest-python-testing/</a></li>
<li><a href="https://pypi.org/project/pytest/">https://pypi.org/project/pytest/</a></li>
<li><a href="https://github.com/pytest-dev/pytest/">https://github.com/pytest-dev/pytest/</a></li>
<li>doc <a href="https://docs.pytest.org/en/latest/contents.html">https://docs.pytest.org/en/latest/contents.html</a>
<ul class="org-ul">
<li><a href="https://docs.pytest.org/en/stable/index.html">https://docs.pytest.org/en/stable/index.html</a></li>
</ul></li>
<li>example: <a href="https://github.com/okeeffed/hello-pytest">https://github.com/okeeffed/hello-pytest</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org9166cca" class="outline-2">
<h2 id="org9166cca"><span class="section-number-2">80.</span> <span class="todo TODO">TODO</span> collection of helpers and mock objects <a href="https://github.com/simplistix/testfixtures">https://github.com/simplistix/testfixtures</a></h2>
</div>
<div id="outline-container-org77b685d" class="outline-2">
<h2 id="org77b685d"><span class="section-number-2">81.</span> static analysis tools:</h2>
<div class="outline-text-2" id="text-81">
<ul class="org-ul">
<li>Pylint - coding standards compliance and various error checkers,
similar/duplicate code,
<a href="https://pylint.readthedocs.io/en/latest/user_guide/checkers/features.html">https://pylint.readthedocs.io/en/latest/user_guide/checkers/features.html</a></li>
<li>Pyflakes - only errors checks, tries very hard not to produce false positives</li>
<li>flake8 - Pyflakes with style checks against PEP 8.</li>
<li>pycodestyle - Simple Python style checker in one Python file  to check
the python code against the style conventions of PEP8.</li>
<li><a href="https://github.com/astral-sh/ruff">https://github.com/astral-sh/ruff</a>
<ul class="org-ul">
<li><a href="https://github.com/erickgnavar/flymake-ruff">https://github.com/erickgnavar/flymake-ruff</a></li>
</ul></li>
<li>Bandit - common security treats. <a href="https://github.com/PyCQA/bandit">https://github.com/PyCQA/bandit</a></li>
<li>Dodgy - secrets leak detection. <a href="https://github.com/landscapeio/dodgy">https://github.com/landscapeio/dodgy</a></li>
<li>Pyright (Microsoft extension for Visual Studio Code)</li>
</ul>

<p>
statis type checkers - mypy, Pyre
</p>

<p>
<a href="https://github.com/analysis-tools-dev/static-analysis#python">https://github.com/analysis-tools-dev/static-analysis#python</a>
</p>
</div>
<div id="outline-container-org340489b" class="outline-3">
<h3 id="org340489b"><span class="section-number-3">81.1.</span> security</h3>
<div class="outline-text-3" id="text-81-1">
<p>
Common Vulnerabilities and Exposures (CVE)
</p>
<ul class="org-ul">
<li>CVEs - We can count them and fix them</li>
<li>SCA - composition analysis tools.
<ul class="org-ul">
<li>Mostly signature based</li>
<li>3rd party and our own</li>
</ul></li>
<li>vulnerabilities</li>
</ul>

<p>
Things that probably won’t hurt us
</p>
<ul class="org-ul">
<li>Good habits/code hygiene</li>
<li>Active development</li>
<li>Developers we trust</li>
<li>CVE and SCA clear</li>
</ul>
</div>
</div>

<div id="outline-container-orgd078f89" class="outline-3">
<h3 id="orgd078f89"><span class="section-number-3">81.2.</span> mypy</h3>
<div class="outline-text-3" id="text-81-2">
<p>
reveal<sub>type</sub>() - To find out what type mypy infers for an expression anywhere in your program.
</p>
</div>
<div id="outline-container-orgb0b21d1" class="outline-4">
<h4 id="orgb0b21d1"><span class="section-number-4">81.2.1.</span> emacs fix</h4>
<div class="outline-text-4" id="text-81-2-1">
<p>
mypy /dev/stdin
</p>
</div>
</div>
<div id="outline-container-orgf1e5148" class="outline-4">
<h4 id="orgf1e5148"><span class="section-number-4">81.2.2.</span> ex</h4>
<div class="outline-text-4" id="text-81-2-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> random
<span style="color: #8ac6f2; font-weight: bold;">from</span> typing <span style="color: #8ac6f2; font-weight: bold;">import</span> Sequence, TypeVar

<span style="color: #cae682;">Choosable</span> = TypeVar(<span style="color: #95e454;">"Choosable"</span>, <span style="color: #e5786d;">str</span>, <span style="color: #e5786d;">float</span>)

<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">choose</span>(items: Sequence[Choosable]) -&gt; Choosable:
    <span style="color: #8ac6f2; font-weight: bold;">return</span> random.choice(items)

reveal_type(choose([<span style="color: #95e454;">"Guido"</span>, <span style="color: #95e454;">"Jukka"</span>, <span style="color: #95e454;">"Ivan"</span>]))
reveal_type(choose([1, 2, 3]))
reveal_type(choose([<span style="color: #e5786d; font-weight: bold;">True</span>, 42, 3.14]))
reveal_type(choose([<span style="color: #95e454;">"Python"</span>, 3, 7]))
</pre>
</div>

<pre class="example">
/dev/stdin:14: note: Revealed type is "builtins.str"
/dev/stdin:16: note: Revealed type is "builtins.float"
/dev/stdin:18: note: Revealed type is "builtins.float"
/dev/stdin:20: error: Value of type variable "Choosable" of "choose" cannot be "object"  [type-var]
/dev/stdin:20: note: Revealed type is "builtins.object"
Found 1 error in 1 file (checked 1 source file)
</pre>
</div>
</div>

<div id="outline-container-org6abd306" class="outline-4">
<h4 id="org6abd306"><span class="section-number-4">81.2.3.</span> troubleshooting</h4>
<div class="outline-text-4" id="text-81-2-3">
<p>
Missing library stubs or py.typed marker
</p>
<ul class="org-ul">
<li>PEP 561 - type information required in : 1) inline type annotations 2)</li>
</ul>
</div>
</div>
<div id="outline-container-org8f88d89" class="outline-4">
<h4 id="org8f88d89"><span class="section-number-4">81.2.4.</span> links</h4>
<div class="outline-text-4" id="text-81-2-4">
<ul class="org-ul">
<li><a href="https://mypy.readthedocs.io/en/stable/cheat_sheet_py3.html">https://mypy.readthedocs.io/en/stable/cheat_sheet_py3.html</a></li>
<li><a href="https://realpython.com/python-type-checking/">https://realpython.com/python-type-checking/</a></li>
<li><a href="https://en.wikipedia.org/wiki/Covariance_and_contravariance_%28computer_science%29">https://en.wikipedia.org/wiki/Covariance_and_contravariance_%28computer_science%29</a></li>
</ul>
</div>
</div>
</div>
</div>

<div id="outline-container-org8a404fe" class="outline-2">
<h2 id="org8a404fe"><span class="section-number-2">82.</span> release as execuable  - Pyinstaller</h2>
<div class="outline-text-2" id="text-82">
<p>
Pyinstller: <a href="https://pyinstaller.org/en/stable/usage.html">https://pyinstaller.org/en/stable/usage.html</a>
</p>

<p>
<a href="https://anshumanfauzdar.medium.com/using-github-actions-to-bundle-python-application-into-a-single-package-and-automatic-release-834bd42e0670">https://anshumanfauzdar.medium.com/using-github-actions-to-bundle-python-application-into-a-single-package-and-automatic-release-834bd42e0670</a>
</p>

<p>
Actions:
</p>
<ul class="org-ul">
<li><a href="https://github.com/AnshumanFauzdar/qwiklab-badge-checker">https://github.com/AnshumanFauzdar/qwiklab-badge-checker</a></li>
<li>example of usage <a href="https://github.com/JackMcKew/pyinstaller-action-windows/blob/main/action.yml">https://github.com/JackMcKew/pyinstaller-action-windows/blob/main/action.yml</a>
<ul class="org-ul">
<li><a href="https://github.com/AnshumanFauzdar/qwiklab-badge-checker/blob/main/.github/workflows/build.yml">https://github.com/AnshumanFauzdar/qwiklab-badge-checker/blob/main/.github/workflows/build.yml</a></li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org1a0cf27" class="outline-2">
<h2 id="org1a0cf27"><span class="section-number-2">83.</span> Documentation building with Sphinx</h2>
<div class="outline-text-2" id="text-83">
<p>
<a href="https://github.com/kruzhok-team/fossdev/blob/devel/educational_materials/docs/content.md">https://github.com/kruzhok-team/fossdev/blob/devel/educational_materials/docs/content.md</a>
</p>
</div>
</div>
<div id="outline-container-org1323d83" class="outline-2">
<h2 id="org1323d83"><span class="section-number-2">84.</span> troubleshooting</h2>
<div class="outline-text-2" id="text-84">
<p>
def a(l:dir = []):
</p>
<ol class="org-ol">
<li>If the user provides an empty list your version will not use that list but instead create a new one, because
an empty list is "falsy"</li>
<li>empty list is created just once when the function is defined, not every time the function is called.</li>
</ol>

<p>
python tests/test<sub>main.py</sub> - ModuleNotFoundError: No module named
</p>
<ul class="org-ul">
<li>solution: PYTHONPATH=. python tests/test<sub>main.py</sub></li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Created: 2025-01-14 Tue 12:50</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
