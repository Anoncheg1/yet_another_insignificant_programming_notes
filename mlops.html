<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2025-01-14 Tue 13:11 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>&lrm;</title>
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="content" class="content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org42c80db">1. Docker</a>
<ul>
<li><a href="#orgcef8b71">1.1. terms</a></li>
<li><a href="#org5a63415">1.2. theory</a>
<ul>
<li><a href="#orgd94eeb4">1.2.1. network</a></li>
<li><a href="#org5371d91">1.2.2. security</a></li>
<li><a href="#org381a878">1.2.3. distroless</a></li>
<li><a href="#org0816966">1.2.4. When not to use Docker</a></li>
</ul>
</li>
<li><a href="#org41e0e56">1.3. usage</a></li>
<li><a href="#org9d8c88e">1.4. use cases:</a>
<ul>
<li><a href="#orgd8f7e5f">1.4.1. containers</a></li>
<li><a href="#org018e8c3">1.4.2. Exploring Docker container's file system</a></li>
<li><a href="#orgaf4bff4">1.4.3. Block internet</a></li>
<li><a href="#orgb700a18">1.4.4. Block access to LAN and out:</a></li>
<li><a href="#org8d235a3">1.4.5. Block access to other containers:</a></li>
<li><a href="#org1dce8e2">1.4.6. Block any external access:</a></li>
<li><a href="#org6f34f92">1.4.7. backup</a></li>
<li><a href="#org7d79208">1.4.8. volume sizes</a></li>
<li><a href="#org8282fa0">1.4.9. monitor resource usage</a></li>
</ul>
</li>
<li><a href="#orgfcc2b05">1.5. admin usage</a></li>
<li><a href="#org7ec1562">1.6. CMD and ENTRYPOINT</a></li>
<li><a href="#orgc5808a3">1.7. ARG and ENV</a></li>
<li><a href="#org1d452eb">1.8. links</a></li>
<li><a href="#org16025d7">1.9. install</a>
<ul>
<li><a href="#org94b0e62">1.9.1. Docker CE</a></li>
</ul>
</li>
<li><a href="#orgbf3e2da">1.10. proxy</a></li>
<li><a href="#org10796a7">1.11. storage</a></li>
<li><a href="#org9bac8cf">1.12. images</a></li>
<li><a href="#org34f8fea">1.13. containers</a></li>
<li><a href="#orge55a375">1.14. reuse layers</a></li>
<li><a href="#orgaab780a">1.15. multi-stage builds</a></li>
<li><a href="#org79b1edf">1.16. clear</a></li>
<li><a href="#orgc38b3fe">1.17. tmpfs</a></li>
<li><a href="#org5850519">1.18. Dokerfile</a></li>
<li><a href="#org85d2021">1.19. apt Dokerfile</a></li>
<li><a href="#orge922ca3">1.20. health check for container</a></li>
<li><a href="#org396794b">1.21. Volumes, mount points (Bind mounts),</a></li>
<li><a href="#org79de2ac">1.22. Development Containers or dev containers or .devcontainer directory</a></li>
<li><a href="#orgf8b3c5c">1.23. DockerHub - publish</a></li>
<li><a href="#orgd8efb96">1.24. troubleshooting</a></li>
</ul>
</li>
<li><a href="#orgd1d060b">2. docker-compose</a>
<ul>
<li><a href="#orgbf02127">2.1. <span class="todo TODO">TODO</span> multi-stage builds</a></li>
<li><a href="#org5a731f3">2.2. swarm</a></li>
<li><a href="#orgcd7178e">2.3. docker-compose.yml</a></li>
<li><a href="#org14c0789">2.4. Environment variables</a></li>
<li><a href="#orge937092">2.5. Network</a>
<ul>
<li><a href="#org43e85c7">2.5.1. ex</a></li>
</ul>
</li>
<li><a href="#orgdda5b9f">2.6. errors</a></li>
<li><a href="#org56ad7e3">2.7. usage</a></li>
<li><a href="#orgc58df40">2.8. add folder (volumes)</a></li>
<li><a href="#org0ab7669">2.9. Entrypoint and Cmd</a></li>
</ul>
</li>
<li><a href="#orgbd64f7f">3. hub.docker.com</a></li>
<li><a href="#orga8a046b">4. <span class="todo TODO">TODO</span> devops</a></li>
<li><a href="#orge3f07d8">5. MLflow - experiment tracking</a>
<ul>
<li><a href="#orgcc6d98c">5.1. Features</a></li>
</ul>
</li>
<li><a href="#orgb62f54c">6. ClearML - experiment tracking</a></li>
<li><a href="#org4c763df">7. Mage - data pipeline tool</a></li>
<li><a href="#orgb267d72">8. kubernetes (K8S)</a>
<ul>
<li><a href="#org47f347d">8.1. theory</a>
<ul>
<li><a href="#org03f9ea5">8.1.1. Контейнер</a></li>
<li><a href="#org1009f4b">8.1.2. main features</a></li>
<li><a href="#orgfd2385e">8.1.3. Microservices</a></li>
<li><a href="#org35eda5d">8.1.4. Services &amp; Endpoinds &amp; probes</a></li>
<li><a href="#org49c82bf">8.1.5. PV &amp; Provisioners &amp; PVC</a></li>
<li><a href="#orgbfb6d8b">8.1.6. CRD - add own API to kubernetes</a></li>
</ul>
</li>
<li><a href="#org189d7e4">8.2. history</a></li>
<li><a href="#orgacf8f0d">8.3. objects, components, apis</a>
<ul>
<li><a href="#orge96518e">8.3.1. Abstractions:</a></li>
<li><a href="#orgdfb78eb">8.3.2. Kubernetes Objects or API object or API resources or resource type</a></li>
<li><a href="#org43b5160">8.3.3. workload resources - high-level abstractions</a></li>
<li><a href="#org24bda6b">8.3.4. object spec</a></li>
<li><a href="#org9707c3a">8.3.5. pod lifecycle -</a></li>
<li><a href="#org7a9f688">8.3.6. container states</a></li>
<li><a href="#org5970646">8.3.7. names and uids (all objects have)</a></li>
<li><a href="#orgfcdcf5a">8.3.8. Labels (optional)</a></li>
</ul>
</li>
<li><a href="#orge65b48c">8.4. terms</a></li>
<li><a href="#orgd5fc225">8.5. architecture</a>
<ul>
<li><a href="#org5a86304">8.5.1. master node</a></li>
<li><a href="#orgae7e54c">8.5.2. worker node</a></li>
<li><a href="#orge3e5b89">8.5.3. Container Runtime Interface (CRI)</a></li>
<li><a href="#org1cbc46c">8.5.4. istio</a></li>
<li><a href="#orgb723669">8.5.5. user namespaces</a></li>
<li><a href="#org42efe29">8.5.6. links</a></li>
</ul>
</li>
<li><a href="#org91b7c3e">8.6. ЦФТ обучение (to delete)</a></li>
<li><a href="#org16ee927">8.7. master and worker node (rusnarbank)</a>
<ul>
<li><a href="#orgedddf16">8.7.1. kubelet</a></li>
<li><a href="#org429ee62">8.7.2. есть кластеры:</a></li>
</ul>
</li>
<li><a href="#org4b7fd3e">8.8. Ansible</a></li>
<li><a href="#orgad804c8">8.9. from image to pod:</a></li>
<li><a href="#org13b8b53">8.10. primary/replica architecture (Master/slave):</a></li>
<li><a href="#orgf048575">8.11. CAP theorem</a></li>
<li><a href="#org06494d6">8.12. runC</a></li>
<li><a href="#org6f930c8">8.13. ReplicationControllerо</a></li>
<li><a href="#org2de9791">8.14. app logs</a></li>
<li><a href="#orgafc421f">8.15. Helm - Пакетный менеджер</a>
<ul>
<li><a href="#org0b2143e">8.15.1. .helm</a></li>
<li><a href="#orge2c2d0a">8.15.2. links</a></li>
</ul>
</li>
<li><a href="#org43d45ae">8.16. cluster management software</a></li>
<li><a href="#orgb6b6c58">8.17. как могут поды иметь свои IP ведь они на одной ноде</a></li>
<li><a href="#orgd306a2d">8.18. kubectl</a>
<ul>
<li><a href="#org7545625">8.18.1. theory</a></li>
<li><a href="#orgc7d89ff">8.18.2. kubectl get</a></li>
<li><a href="#org8e707e6">8.18.3. Viewing and finding resources</a></li>
<li><a href="#orgb6a4b43">8.18.4. request step by step</a></li>
</ul>
</li>
<li><a href="#org09aba46">8.19. kubeadm</a></li>
<li><a href="#org861916e">8.20. well-known values and paths</a></li>
<li><a href="#org98083e1">8.21. Installation steps</a></li>
<li><a href="#orgaf5cc61">8.22. .bashrc</a></li>
<li><a href="#org070fbae">8.23. common shorts</a></li>
<li><a href="#org717cae5">8.24. role-based access control (RBAC) policy</a></li>
<li><a href="#orgb609ff9">8.25. system maintentance</a></li>
<li><a href="#orgb974d2a">8.26. Usage My</a>
<ul>
<li><a href="#orgdd193af">8.26.1. explore</a></li>
<li><a href="#orgd4eb0ea">8.26.2. manage</a></li>
</ul>
</li>
<li><a href="#orga50be96">8.27. USAGE (max prokopenko)</a></li>
<li><a href="#org8d4a624">8.28. usage</a>
<ul>
<li><a href="#org6987318">8.28.1. Обновление ресурсов</a></li>
<li><a href="#org575dfd8">8.28.2. удаление ресурсов</a></li>
<li><a href="#orge55e666">8.28.3. работа с подами, логами</a></li>
<li><a href="#org4f714d4">8.28.4. Работа с кластером</a></li>
</ul>
</li>
<li><a href="#org4f627df">8.29. What is Krew?</a></li>
<li><a href="#org21b0a5c">8.30. create namespace</a></li>
<li><a href="#orgfd36047">8.31. create custom resource</a></li>
<li><a href="#orga0a74b0">8.32. one pod per node</a></li>
<li><a href="#org784130b">8.33. known errors and misleads in kubectl</a></li>
<li><a href="#orgd81fe88">8.34. Troubleshooting</a></li>
<li><a href="#orgdce0901">8.35. DNS</a>
<ul>
<li><a href="#org8a21e0f">8.35.1. theory</a></li>
<li><a href="#org59bf30a">8.35.2. Check if my DNS service is up:</a></li>
<li><a href="#org747efe0">8.35.3. edit configmap for CoreDNS</a></li>
</ul>
</li>
<li><a href="#org8bb7bf5">8.36. <span class="todo TODO">TODO</span> network &amp; security</a></li>
<li><a href="#orgbed60fc">8.37. links</a></li>
</ul>
</li>
<li><a href="#org6c1c489">9. Ansible and Terraform - infrastructure automation tools</a>
<ul>
<li><a href="#org7bc3c86">9.1. theory</a></li>
<li><a href="#org03166c2">9.2. Ansible vs Terraform</a></li>
<li><a href="#org2fb3412">9.3. Terraform</a>
<ul>
<li><a href="#org570b38e">9.3.1. theory</a></li>
<li><a href="#orgc1678f5">9.3.2. files</a></li>
<li><a href="#org3e730f9">9.3.3. steps:</a></li>
<li><a href="#orgd2c9f8f">9.3.4. modules</a></li>
</ul>
</li>
<li><a href="#org32d53ce">9.4. Ansible</a></li>
<li><a href="#orge78eb3c">9.5. Terraform with Ansible together</a></li>
</ul>
</li>
<li><a href="#orge6e0660">10. Onnx - Apache License 2.0, Python C++</a>
<ul>
<li><a href="#org167828e">10.1. features</a></li>
<li><a href="#org0342a2d">10.2. dependencies</a></li>
<li><a href="#org2c5023b">10.3. convertions</a></li>
<li><a href="#orgfc63cee">10.4. installation:</a></li>
<li><a href="#org794bd5e">10.5. ONNX Model Zoo</a></li>
<li><a href="#org4e0cb64">10.6. backends</a></li>
<li><a href="#org9b2c288">10.7. links:</a></li>
</ul>
</li>
<li><a href="#orgfbf2bb1">11. Onnx runtime - Microsoft - MIT license</a>
<ul>
<li><a href="#org185b604">11.1. dependencies - execution-providers (backend)</a></li>
</ul>
</li>
<li><a href="#org7418247">12. Onnx runtime - ncnn</a></li>
<li><a href="#orgf0b09c3">13. onnx runtime build</a>
<ul>
<li><a href="#org7f20d87">13.1. onnx runtime</a></li>
<li><a href="#orgfeb8c64">13.2. onnxruntime-bin</a></li>
<li><a href="#orgab5d3aa">13.3. onnxruntime dependencies</a></li>
</ul>
</li>
<li><a href="#org34af7b9">14. PyTorch</a>
<ul>
<li>
<ul>
<li><a href="#orgec86857">14.0.1. caffe2 gentoo dependencies</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgd3f10d2">15. PyTorch vs Tensorflow</a></li>
<li><a href="#org1749730">16. ML project tasks</a></li>
<li><a href="#orgc696fc0">17. Redis</a>
<ul>
<li><a href="#orgcb33eb6">17.1. history</a></li>
<li><a href="#org2e94e22">17.2. features</a></li>
<li><a href="#orgf828989">17.3. terms </a></li>
<li><a href="#org20571c1">17.4. license</a></li>
<li><a href="#orgb6e6bfe">17.5. Distribution</a></li>
<li><a href="#org813e507">17.6. Modules - Redisearch</a>
<ul>
<li><a href="#org3e6c46f">17.6.1. from sources</a></li>
<li><a href="#org22f3dd1">17.6.2. debian</a></li>
<li><a href="#org44aa944">17.6.3. test module load</a></li>
<li><a href="#org378006f">17.6.4. dependencies</a></li>
</ul>
</li>
<li><a href="#orga79f930">17.7. Data types</a></li>
<li><a href="#org5e338af">17.8. Hashes</a></li>
<li><a href="#org0fa5f1c">17.9. Transactions</a></li>
<li><a href="#org45e8827">17.10. dependencies runtime</a></li>
<li><a href="#org1691a6e">17.11. init</a></li>
<li><a href="#orgefcf38c">17.12. Best Practices</a></li>
<li><a href="#orga8f19a9">17.13. Python - connector - dev-python/redis</a></li>
<li><a href="#org50b4677">17.14. commands</a>
<ul>
<li><a href="#orgd2f7229">17.14.1. retrive</a></li>
<li><a href="#orgc7db7bd">17.14.2. set</a></li>
<li><a href="#org887202b">17.14.3. comment</a></li>
</ul>
</li>
<li><a href="#org1cb6d7c">17.15. tools</a></li>
<li><a href="#orgd193ccb">17.16. <span class="todo TODO">TODO</span> Indexes</a></li>
<li><a href="#orgaa68758">17.17. distributed usage</a>
<ul>
<li><a href="#orgc0ce9cd">17.17.1. Scaling</a></li>
<li><a href="#org85bdbdc">17.17.2. replication</a></li>
<li><a href="#orge1105fd">17.17.3. Lock</a></li>
<li><a href="#org5e000a6">17.17.4. commands</a></li>
</ul>
</li>
<li><a href="#orgf11380f">17.18. ORM</a></li>
<li><a href="#org13ed08c">17.19. architect schema - usecase</a>
<ul>
<li><a href="#org4578c6a">17.19.1. Sorting</a></li>
</ul>
</li>
<li><a href="#org5930775">17.20. timeouts for cluster</a></li>
<li><a href="#org4677308">17.21. Get a range of keys with redis?</a></li>
<li><a href="#org82e577c">17.22. modules</a></li>
<li><a href="#orge9badbd">17.23. Vector database</a>
<ul>
<li><a href="#org3df0048">17.23.1. RedisVL - MIT</a></li>
<li><a href="#org6e9a15f">17.23.2. redis-py or dev-python/redis - MIT</a></li>
<li><a href="#orgad0dc3c">17.23.3. RedisGraph (obsolate)</a></li>
<li><a href="#orgb210f0b">17.23.4. links</a></li>
</ul>
</li>
<li><a href="#orgcab4fea">17.24. Knowledge Graph implementation on vanila Redis</a>
<ul>
<li><a href="#org978acca">17.24.1. nlp</a></li>
<li><a href="#org7539ee6">17.24.2. code</a></li>
</ul>
</li>
<li><a href="#org731ccc3">17.25. Emacs integration</a></li>
<li><a href="#org70ce640">17.26. <span class="todo TODO">TODO</span> Feature Store</a></li>
<li><a href="#org297f189">17.27. links</a></li>
</ul>
</li>
<li><a href="#org2be182c">18. <span class="todo TODO">TODO</span> Spark, Hadoop, Hive</a></li>
<li><a href="#orge8a5de2">19. REST API Documentation UIs</a>
<ul>
<li><a href="#org03c08bf">19.1. generate OpenAPI from Flask</a></li>
<li><a href="#orgc17dda5">19.2. Swagger - развязность</a>
<ul>
<li><a href="#orga023fdf">19.2.1. swagger offline</a></li>
<li><a href="#orgdd6d1e6">19.2.2. Specification 2.0</a></li>
<li><a href="#orgc4facf0">19.2.3. JSON Schema</a></li>
</ul>
</li>
<li><a href="#org7c67abf">19.3. links</a></li>
</ul>
</li>
</ul>
</div>
</div>
<p>
;-<b>- mode: Org; coding: utf-8; fill-column: 100 -</b>-
</p>

<p>
<a href="https://github.com/visenger/awesome-mlops">https://github.com/visenger/awesome-mlops</a>
</p>

<p>
<a href="https://www.datacamp.com/cheat-sheet/category/data-engineering">https://www.datacamp.com/cheat-sheet/category/data-engineering</a>
</p>

<div id="outline-container-org42c80db" class="outline-2">
<h2 id="org42c80db"><span class="section-number-2">1.</span> Docker</h2>
<div class="outline-text-2" id="text-1">
<ul class="org-ul">
<li>guide <a href="https://docker-curriculum.com/">https://docker-curriculum.com/</a></li>
</ul>
</div>

<div id="outline-container-orgcef8b71" class="outline-3">
<h3 id="orgcef8b71"><span class="section-number-3">1.1.</span> terms</h3>
<div class="outline-text-3" id="text-1-1">
<p>
<b>Image</b> -docker run&gt; <b>Running Container</b> -&gt; <b>Stopped Container</b> -docker commit&gt; <b>New Image</b>
</p>

<p>
<b>parent image</b> - image that your image is based on (FROM)
</p>

<p>
Состоит:
</p>
<ul class="org-ul">
<li><b>Docker daemon</b>- manages Docker containers and handles container objects - <b>Docker client program</b> -
provides a command-line interface</li>
<li><b>Container</b> c т.з. ч. - стандартизированный метод упаковки приложений, его конфигурациии и всех
зависимостей в единый объект.</li>
<li><b>Container</b> c т.з. ОС - процесс извлеченный из tarball привязанный к namespaces и контролируемый через cgroups</li>
<li><b>Container</b> - состоит из <b>слоев</b> - слепков состояний файловой системы из image + read-write layer on
top. Images become containers when they run on Docker Engine. при перезапуске возвращается к image
<ul class="org-ul">
<li>UUID short and long</li>
<li>name - by user or random</li>
</ul></li>
<li><b>Container Runtime</b> - software that can run containers on a host operating system or each node in
the cluster so that Pods can run there.</li>
<li><b>Image</b> - read-only template used to build containers - to store and ship applications - series of
read-only layers</li>
<li><b>Docker service</b> - allows containers to be scaled across multiple Docker daemons - result is "swarm"</li>
<li><b>Docker registr</b> - repository for Docker images - download ("pull") - upload ("push").  Registries can be
public or private</li>
<li><b>Docker Hub</b> - default registry where Docker looks for images <a href="https://hub.docker.com/">https://hub.docker.com/</a></li>
<li><b>volumes</b> -</li>
<li>Dockerfile - Docker can build images automatically by reading the instructions from a Dockerfile by "$docker build ."</li>
<li><b>task</b> - container running in a service</li>
<li><b>replicas</b> - containers or task in one service defined in docker-compose.yml</li>
</ul>
</div>
</div>

<div id="outline-container-org5a63415" class="outline-3">
<h3 id="org5a63415"><span class="section-number-3">1.2.</span> theory</h3>
<div class="outline-text-3" id="text-1-2">
</div>
<div id="outline-container-orgd94eeb4" class="outline-4">
<h4 id="orgd94eeb4"><span class="section-number-4">1.2.1.</span> network</h4>
<div class="outline-text-4" id="text-1-2-1">
<p>
Docker’s networking subsystem is pluggable, using drivers.
</p>
<ul class="org-ul">
<li>bridge: The default network driver.</li>
<li>host</li>
<li>overlay</li>
<li>ipvlan</li>
<li>macvlan</li>
<li>none</li>
<li>network plugins</li>
</ul>

<p>
all networs - user defined bridges
</p>
</div>
</div>

<div id="outline-container-org5371d91" class="outline-4">
<h4 id="org5371d91"><span class="section-number-4">1.2.2.</span> security</h4>
<div class="outline-text-4" id="text-1-2-2">
<p>
Attack surface of a container image is measured by the number of files in it, or how many megabytes of space it uses on disk.
</p>

<p>
attack surface:
</p>
<ul class="org-ul">
<li>quality of software and configuration(aka files</li>
<li>software in the direct execution path which is used in many different container images (C</li>
</ul>
<p>
libraries, web servers, encryption libraries, etc)
</p>
<ul class="org-ul">
<li>Standardizing on the exact same versions (Linux distribution and version) of this widely used
software in the direct execution path (C libraries, web servers, encryption libraries, etc) reduces
attack surface</li>
</ul>
</div>
</div>
<div id="outline-container-org381a878" class="outline-4">
<h4 id="org381a878"><span class="section-number-4">1.2.3.</span> distroless</h4>
<div class="outline-text-4" id="text-1-2-3">
<p>
a Linux distro is made up of two main components: a kernel, and a user space.
</p>

<p>
   Even in a distroless set of container images, things like the Java virtual machine, Python, and
Node.js are compiled against a C library which gives these user space programs access to low level
functions in the Linux kernel (network sockets, storage volumes, files, etc).
</p>

<p>
Linux distros exist because we just want to write applications, we don’t want to patch and maintain
 widely used libraries and infrastructure like timezone data, C libraries, etc.
</p>


<p>
FROM scratch - official container <a href="https://docs.docker.com/build/building/base-images/">https://docs.docker.com/build/building/base-images/</a>
</p>
<ul class="org-ul">
<li>itself it is empty (in that it doesn’t contain any folders or files)</li>
<li>can conain executable that will be like a process on host machine: statically compiled and self-contained.</li>
<li>You also wouldn’t be able to login to the container either as there isn’t a shell unless you explicitly add one.</li>
</ul>
</div>
</div>

<div id="outline-container-org0816966" class="outline-4">
<h4 id="org0816966"><span class="section-number-4">1.2.4.</span> When not to use Docker</h4>
<div class="outline-text-4" id="text-1-2-4">
<p>
When use:
</p>
<ol class="org-ol">
<li>Your development team is not set in stone</li>
<li>Your software runs in different environments</li>
<li>Your software grows and consists of many bits and pieces</li>
<li>You want your software to be scalable and handle more users</li>
<li>Your hosting infrastructure may change in the future and you don’t want to be locked</li>
<li>You do some proof of concepts and test new technologies for your software</li>
</ol>

<p>
When to avoid Docker?
</p>
<ol class="org-ol">
<li>Your software product is a desktop application</li>
<li>Your project is relatively small and simple</li>
<li>Your development team consists of one developer</li>
<li>You are looking for a solution to speed up your application</li>
<li>Your development team consist mostly of MacBook users</li>
<li>Your team don’t know how to use Docker properly</li>
</ol>
</div>
</div>
</div>
<div id="outline-container-org41e0e56" class="outline-3">
<h3 id="org41e0e56"><span class="section-number-3">1.3.</span> usage</h3>
<div class="outline-text-3" id="text-1-3">
<p>
explore:
</p>
<ul class="org-ul">
<li>docker images - list images and layers
<ul class="org-ul">
<li>docker images | grep superset | awk '{print $1}' | xargs docker image rm</li>
</ul></li>
<li>docker ps - containers currently running
<ul class="org-ul">
<li>docker ps -a - was ran</li>
</ul></li>
<li>docker logs image</li>
</ul>


<ul class="org-ul">
<li>docker pull busybox - download image</li>
<li>docker build -t fedora/jboss:1.0 . # &#x2013;tag to give a name to the image
<ul class="org-ul">
<li>docker build image &#x2013;build-args HTTPS<sub>PROXY</sub>=172.0.0.1:8888</li>
<li>docker build -t aa -f Dockerfile.app .</li>
</ul></li>
<li>docker run -it debian<sub>my</sub> bash - create container based on image and attach to tty</li>
<li>docker exec -it debian<sub>my</sub> bash - connect to running
<ul class="org-ul">
<li>docker exec -it debian<sub>my</sub> bash -c "command ; command"</li>
<li>docker exec -w /workspace -it ps bash</li>
</ul></li>
<li>docker rename ngin nginx</li>
<li>docker start/stop/kill/restart/rm nginx</li>
<li>docker events/top/stats/diff nginx</li>
<li>docker -it superset<sub>db</sub> pg<sub>dump</sub> -U superset superset &gt; backups.sql - бэкап БД из контейнера в папку</li>
</ul>
<p>
networks
</p>
<ul class="org-ul">
<li>docker network create my-net</li>
<li>docker create &#x2013;name my-nginx &#x2013;network my-net &#x2013;publish 8080:80 nginx:latest</li>
<li>docker networks ls # show networs</li>
<li>docker network inspect NAME</li>
<li>docker network create -d bridge MyBridgeNetwork</li>
<li>docker network rm</li>
<li>docker connect MyOverlayNerwork nginx - подключение работающего контейнера к сети</li>
<li>docker run -it -d &#x2013;network=MyOverlayNetwork ngixn - подключение к сети при его запуске</li>
<li>docker network disconnect MyOverlayNerwork nginx</li>
</ul>
</div>
</div>

<div id="outline-container-org9d8c88e" class="outline-3">
<h3 id="org9d8c88e"><span class="section-number-3">1.4.</span> use cases:</h3>
<div class="outline-text-3" id="text-1-4">
</div>
<div id="outline-container-orgd8f7e5f" class="outline-4">
<h4 id="orgd8f7e5f"><span class="section-number-4">1.4.1.</span> containers</h4>
<div class="outline-text-4" id="text-1-4-1">
<ul class="org-ul">
<li>docker build -t container<sub>name</sub> .</li>
<li>docker run -d CONTAINER<sub>ID</sub><sub>REPOSITORY</sub> # execute and deattach
<ul class="org-ul">
<li>-p, &#x2013;publish ip:[hostPort]:containerPort | [hostPort:]containerPort Publish a container's port,
or range of ports, to the host.
<ul class="org-ul">
<li>docker run -p 80:5000 -d web<sub>alone</sub> # 80 - host port, 5000 - container port</li>
</ul></li>
</ul></li>
<li>docker stop container
<ul class="org-ul">
<li>docker ps -q | xargs docker stop  # stop all containers</li>
</ul></li>
<li>docker pull [IMAGE] # from repository</li>
<li>docker import [URL/FILE] # Create an image from a tarball:</li>
<li>docker rm $(docker ps -a -q) - удалить все контейнеры</li>
<li>docker commit NAME REPOSITORY</li>
<li>docker logs CONTAINER<sub>ID</sub><sub>REPOSITORY</sub></li>
<li>docker inspect logs CONTAINER<sub>ID</sub><sub>R</sub> | grep -E "LogPath" - где лог</li>
<li>docker logs containername &gt;&amp; ~/a
<ul class="org-ul">
<li>nano ~/a</li>
</ul></li>
<li>docker exec -u root -it 1db047ccc674 bash     - подключиться к уже запущенному</li>
</ul>
</div>
</div>
<div id="outline-container-org018e8c3" class="outline-4">
<h4 id="org018e8c3"><span class="section-number-4">1.4.2.</span> Exploring Docker container's file system</h4>
<div class="outline-text-4" id="text-1-4-2">
<ul class="org-ul">
<li><a href="https://stackoverflow.com/questions/20813486/exploring-docker-containers-file-system">https://stackoverflow.com/questions/20813486/exploring-docker-containers-file-system</a></li>

<li>docker commit CONTAINER ID mysnapshot</li>
<li>docker run -it mysnapshot /bin/sh     - запускает процесс в контейнере</li>
<li>docker exec -u root -it 1db047ccc674 bash     - подключиться к уже запущенному
<ul class="org-ul">
<li>i - stdin</li>
<li>t - virtual tty</li>
<li>1db047ccc674 - running container</li>
</ul></li>
<li>export http<sub>proxy</sub>='http://Pakhomov<sub>KA</sub>@192.168.2.252:8080'</li>
<li>export https<sub>proxy</sub>='http://Pakhomov<sub>KA</sub>@192.168.2.252:8080'</li>
<li>apt-get update</li>
<li>apt-get install emacs-nox</li>
</ul>
</div>
</div>
<div id="outline-container-orgaf4bff4" class="outline-4">
<h4 id="orgaf4bff4"><span class="section-number-4">1.4.3.</span> Block internet</h4>
<div class="outline-text-4" id="text-1-4-3">
</div>
<ol class="org-ol">
<li><a id="org6d1e9fc"></a>1<br />
<div class="outline-text-5" id="text-1-4-3-1">
<p>
service:
  one:
    networks:
</p>
<ul class="org-ul">
<li>internal</li>
<li>external</li>
</ul>
<p>
two:
  networks:
</p>
<ul class="org-ul">
<li>internal</li>
</ul>
<p>
networks:
  internal:
    internal: true
  external:
</p>
</div>
</li>
<li><a id="org99072f7"></a>2<br />
<div class="outline-text-5" id="text-1-4-3-2">
<p>
COPY entrypoint.sh /entrypoint.sh
</p>

<p>
ENTRYPOINT ["/entrypoint.sh", "&#x2013;"]
</p>

<p>
ACCEPT<sub>CIDR</sub>=${ALLOWED<sub>CIDR</sub>:-192.168.0.0/24}
</p>

<p>
iptables -A INPUT -s $ACCEPT<sub>CIDR</sub> -j ACCEPT
iptables -A INPUT -j DROP
iptables -A OUTPUT -d $ACCEPT<sub>CIDR</sub> -j ACCEPT
iptables -A OUTPUT -j DROP
</p>

<p>
sudo -u app sh -c "$@"
</p>
</div>
</li>
</ol>
</div>
<div id="outline-container-orgb700a18" class="outline-4">
<h4 id="orgb700a18"><span class="section-number-4">1.4.4.</span> Block access to LAN and out:</h4>
<div class="outline-text-4" id="text-1-4-4">
<ul class="org-ul">
<li>docker network create -o "com.docker.network.bridge.enable<sub>ip</sub><sub>masquerade</sub>"="false" lan-restricted</li>
<li>Blocks
<ul class="org-ul">
<li>Local LAN</li>
<li>Internet</li>
</ul></li>
<li>Does not block
<ul class="org-ul">
<li>Host running docker daemon (example access to 10.0.1.10:22)</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org8d235a3" class="outline-4">
<h4 id="org8d235a3"><span class="section-number-4">1.4.5.</span> Block access to other containers:</h4>
<div class="outline-text-4" id="text-1-4-5">
<ul class="org-ul">
<li>docker network create -o "com.docker.network.bridge.enable<sub>icc</sub>"="false" icc-restricted</li>
<li>Blocks
<ul class="org-ul">
<li>Containers accessing other containers on the same icc-restricted network.</li>
</ul></li>
<li>Does not block
<ul class="org-ul">
<li>Access to host running docker daemon</li>
<li>Local LAN</li>
<li>Internet</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org1dce8e2" class="outline-4">
<h4 id="org1dce8e2"><span class="section-number-4">1.4.6.</span> Block any external access:</h4>
<div class="outline-text-4" id="text-1-4-6">
<p>
networks:
  yournetwork:
     internal: true
</p>
</div>
</div>
<div id="outline-container-org6f34f92" class="outline-4">
<h4 id="org6f34f92"><span class="section-number-4">1.4.7.</span> backup</h4>
<div class="outline-text-4" id="text-1-4-7">
<ul class="org-ul">
<li>volumes: tar -cvzf a.tar.gz /var/lib/docker/volumes/&lt;volume<sub>name</sub>&gt;</li>
<li>docker save -o ubuntu.tar ubuntu:lucid</li>
<li>docker save myimage:latest | gzip &gt; myimage<sub>latest.tar.gz</sub></li>
</ul>
</div>
</div>
<div id="outline-container-org7d79208" class="outline-4">
<h4 id="org7d79208"><span class="section-number-4">1.4.8.</span> volume sizes</h4>
<div class="outline-text-4" id="text-1-4-8">
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #fa8072;">#</span><span style="color: #99968b; font-style: italic;">!/bin/</span><span style="color: #8ac6f2; font-weight: bold;">bash</span>

<span style="color: #8ac6f2; font-weight: bold;">for</span> v<span style="color: #8ac6f2; font-weight: bold;"> in</span> $(<span style="color: #fa8072;">docker volume ls | grep -v DRIVER | awk '{print $2}'</span>) ; <span style="color: #8ac6f2; font-weight: bold;">do</span>
   <span style="color: #cae682;">p</span>=$(<span style="color: #fa8072;">docker volume inspect $v | jq '.[].Mountpoint' | tr -d '"'</span>)
   du -sh $<span style="color: #cae682;">p</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org8282fa0" class="outline-4">
<h4 id="org8282fa0"><span class="section-number-4">1.4.9.</span> monitor resource usage</h4>
<div class="outline-text-4" id="text-1-4-9">
<ul class="org-ul">
<li>docker stats &#x2013;all &#x2013;no-stream &#x2013;no-trunc # memory, cpu</li>
<li>docker system df -v</li>
<li>docker status container<sub>ID</sub> #to check single container resources</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgfcc2b05" class="outline-3">
<h3 id="orgfcc2b05"><span class="section-number-3">1.5.</span> admin usage</h3>
<div class="outline-text-3" id="text-1-5">
<p>
Комманды
</p>
<ul class="org-ul">
<li>docker ps -a - все контейнеры</li>
<li>docker image ls - все images</li>
<li>docker load -i file.tar - Load saved image</li>
<li>docker pull debian:testing</li>
<li>docker inspect [CONTAINER ID] &#x2013;  "Config": { "Entrypoint": ["/pause"],</li>
<li>docker pull storm:TAG &#x2013; download image</li>
<li>docker ps &#x2013;no-trunc &#x2013; full command</li>
<li>docker system prune &#x2013;volumes - clean unused everything</li>
</ul>

<p>
docker run [OPTIONS] IMAGE [COMMAND] [ARG&#x2026;]
</p>

<p>
Commit a container’s file changes or settings into a new image: docker commit CONTAINER ID mysnapshot
</p>

<p>
Build image and run:
</p>
<ul class="org-ul">
<li>docker build &#x2013;tag=friendlyhello .</li>
<li>docker run -p 4000:80 friendlyhello -d  - execute CMD in Dockerfile, background</li>
</ul>
</div>
</div>

<div id="outline-container-org7ec1562" class="outline-3">
<h3 id="org7ec1562"><span class="section-number-3">1.6.</span> CMD and ENTRYPOINT</h3>
<div class="outline-text-3" id="text-1-6">
<p>
docker run - require CMD or ENTRYPOINT specified in Dokerfile
</p>

<p>
both CMD and ENTRYPOINT have exec and shell form
</p>
<ul class="org-ul">
<li>ENTRYPOINT ["executable", "param1", "param2"] - exec form - recommended</li>
<li>ENTRYPOINT command param1 param2 - shell form - Ctrl + C will not stop ex. ping google.com</li>
</ul>

<p>
CMD can be used to set additional defaults that are more likely to be changed
</p>
<ul class="org-ul">
<li>ENTRYPOINT ["top", "-b"]</li>
<li>CMD ["-c"]</li>
</ul>

<p>
If no ENTRYPOINT is specified, CMD sets the default command to be executed.
</p>
</div>
</div>

<div id="outline-container-orgc5808a3" class="outline-3">
<h3 id="orgc5808a3"><span class="section-number-3">1.7.</span> ARG and ENV</h3>
<div class="outline-text-3" id="text-1-7">
<ul class="org-ul">
<li>ARG is only available during the build of a Docker imag</li>
<li>ENV values are available to containers, but also RUN-style commands during the Docker build
starting with the line where they are introduced. If you set an environment variable in an
intermediate container using bash (RUN export VARI=5 &amp;&amp; …) it will not persist in the next
command.</li>
</ul>

<p>
docker build . &#x2013;build-arg -t foo
</p>

<p>
FROM debian:bullseye-slim
ARG WTF
ENV WTF=$WTF
CMD echo $WTF
</p>

<p>
ENV <a href="https://medium.com/google-cloud/kubernetes-configmaps-and-secrets-68d061f7ab5b">https://medium.com/google-cloud/kubernetes-configmaps-and-secrets-68d061f7ab5b</a>
</p>
</div>
</div>


<div id="outline-container-org1d452eb" class="outline-3">
<h3 id="org1d452eb"><span class="section-number-3">1.8.</span> links</h3>
<div class="outline-text-3" id="text-1-8">
<ul class="org-ul">
<li>ANTIFAQ <a href="https://habr.com/ru/company/southbridge/blog/452108/">https://habr.com/ru/company/southbridge/blog/452108/</a></li>
<li><a href="https://docs.docker.com/get-started/part2/">https://docs.docker.com/get-started/part2/</a></li>
<li>for java <a href="https://github.com/docker/labs/tree/master/developer-tools/java/">https://github.com/docker/labs/tree/master/developer-tools/java/</a></li>
<li>Linux virtualization <img src="https://upload.wikimedia.org/wikipedia/commons/0/09/Docker-linux-interfaces.svg" alt="Docker-linux-interfaces.svg" class="org-svg" /></li>
<li>building project inside docker <a href="https://mikulskibartosz.name/how-to-build-a-project-inside-a-docker-container-fd575058bf4a">https://mikulskibartosz.name/how-to-build-a-project-inside-a-docker-container-fd575058bf4a</a>
operating-system-level virtualization</li>
<li>Dockerfile reference <a href="https://docs.docker.com/engine/reference/builder/">https://docs.docker.com/engine/reference/builder/</a>
tool that can package an application and its dependencies in a lightweight! virtual <b>container</b>
<ul class="org-ul">
<li>Сontainers may simplify the creation of highly distributed systems.</li>
<li>Containers are created from "images" - read-only template</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org16025d7" class="outline-3">
<h3 id="org16025d7"><span class="section-number-3">1.9.</span> install</h3>
<div class="outline-text-3" id="text-1-9">
<p>
<a href="https://docs-stage.docker.com/engine/install/ubuntu/">https://docs-stage.docker.com/engine/install/ubuntu/</a>
<b>from deb</b>
<a href="https://download.docker.com/linux/ubuntu/dists/focal/stable/binary-amd64/Packages">https://download.docker.com/linux/ubuntu/dists/focal/stable/binary-amd64/Packages</a>
</p>
<ul class="org-ul">
<li><a href="https://download.docker.com/linux/ubuntu/dists/focal/stable/binary-amd64/">https://download.docker.com/linux/ubuntu/dists/focal/stable/binary-amd64/</a></li>
<li>pool/stable</li>
<li>wget docker-ce, docker-ce-cli and containerd.io</li>
<li>compare hashes from Package.</li>
<li>apt-get install</li>
</ul>
<p>
<b>from Dcoker Repository</b>
<a href="https://docs-stage.docker.com/engine/install/ubuntu/">https://docs-stage.docker.com/engine/install/ubuntu/</a>
</p>

<p>
<b>Installing Docker CE using Docker Installation Script</b>
</p>

<p>
Проверка:
</p>
<ul class="org-ul">
<li>docker run hello-world</li>
</ul>

<p>
Запускать без sudo <a href="https://docs-stage.docker.com/engine/install/linux-postinstall/#manage-docker-as-a-non-root-user">https://docs-stage.docker.com/engine/install/linux-postinstall/#manage-docker-as-a-non-root-user</a>
</p>
</div>
<div id="outline-container-org94b0e62" class="outline-4">
<h4 id="org94b0e62"><span class="section-number-4">1.9.1.</span> Docker CE</h4>
<div class="outline-text-4" id="text-1-9-1">
<p>
<a href="https://kifarunix.com/install-docker-ce-on-ubuntu-20-04/">https://kifarunix.com/install-docker-ce-on-ubuntu-20-04/</a>
</p>
<ul class="org-ul">
<li>Docker CE (Community Edition) is the open-source, community supported version of Docker and is available for free.</li>
<li>Docker EE (Enterprise Edition) is a commercial/premium version of Docker CE and is support by Docker Inc.
<ul class="org-ul">
<li>docker or docker-engine or docker-io</li>
<li>$ sudo apt-get remove docker docker-engine docker.io containerd runc</li>
</ul></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgbf3e2da" class="outline-3">
<h3 id="orgbf3e2da"><span class="section-number-3">1.10.</span> proxy</h3>
<div class="outline-text-3" id="text-1-10">
<ul class="org-ul">
<li>~/.docker/config.json</li>
<li>192.168.2.252 это srv-proxy</li>
</ul>
<p>
{
 "proxies":
 {
   "default":
   {
     "httpProxy": "<a href="http://192.168.2.252:8080">http://192.168.2.252:8080</a>",
     "httpsProxy": "<a href="http://192.168.2.252:8080">http://192.168.2.252:8080</a>"
   }
 }
}
</p>
</div>
</div>
<div id="outline-container-org10796a7" class="outline-3">
<h3 id="org10796a7"><span class="section-number-3">1.11.</span> storage</h3>
<div class="outline-text-3" id="text-1-11">
<ul class="org-ul">
<li><a href="https://docs.docker.com/storage/">https://docs.docker.com/storage/</a></li>
</ul>
<p>
by default a writable container layer.
</p>
<ul class="org-ul">
<li>volumes - on Docker <i>var/lib/docker/volumes</i> - best way - cannot be modified externaly - When you mount the
volume into a container, this directory is what is mounted into the container</li>
<li>bind mounts - can be modified externaly</li>
</ul>

<p>
kebenrenets - The Docker image is at the root of the filesystem hierarchy, and any volumes are mounted at the
specified paths within the image.
</p>
</div>
</div>
<div id="outline-container-org9bac8cf" class="outline-3">
<h3 id="org9bac8cf"><span class="section-number-3">1.12.</span> images</h3>
<div class="outline-text-3" id="text-1-12">
<p>
Хранятся в <i>var/lib/docker</i>
</p>
<ul class="org-ul">
<li>REPOSITORY - откуда был скачен или имя, &lt;none&gt; - локально</li>
</ul>

<p>
image is built up from a series of layers. Each layer except the very last one is read-only.
</p>

<p>
commands:
</p>
<ul class="org-ul">
<li>docker image ls - все images</li>
<li>docker rmi $(docker images -q) - удалить все images</li>
<li>docker run PARAMETERS repository<sub>or</sub><sub>name</sub> - запускает image и делает его контенером, если его нет, то скачивает из публичного репозитория
<ul class="org-ul">
<li>-d - deattached in background</li>
<li>-p &lt;host<sub>port</sub>&gt;:&lt;container<sub>port</sub>&gt;</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org34f8fea" class="outline-3">
<h3 id="org34f8fea"><span class="section-number-3">1.13.</span> containers</h3>
<div class="outline-text-3" id="text-1-13">
<p>
Container has:
read only layers:
1 writable layer - сохраняется только если завершается нормально, в случае сбоя теряется.
</p>
</div>
</div>

<div id="outline-container-orge55a375" class="outline-3">
<h3 id="orge55a375"><span class="section-number-3">1.14.</span> reuse layers</h3>
<div class="outline-text-3" id="text-1-14">
<ol class="org-ol">
<li>docker build &#x2013;cache-from image0 -t image1</li>
<li><a href="https://stackoverflow.com/questions/48449326/how-to-docker-reuse-layers-with-different-base-images">https://stackoverflow.com/questions/48449326/how-to-docker-reuse-layers-with-different-base-images</a></li>
</ol>
</div>
</div>
<div id="outline-container-orgaab780a" class="outline-3">
<h3 id="orgaab780a"><span class="section-number-3">1.15.</span> multi-stage builds</h3>
<div class="outline-text-3" id="text-1-15">
<p>
<b>builder pattern</b> - one Dockerfile to use for development, and a slimmed-down one to use for
 production, which only contained your application and exactly what was needed to run it.
</p>
<ul class="org-ul">
<li>FROM - starts new stage</li>
<li>FROM golang:1.16 AS builder; COPY &#x2013;from=builder /go/a ./a # if stages will be reoreded</li>
<li>COPY &#x2013;from=nginx:latest /etc/nginx/nginx.conf /nginx.conf # copy from separate image</li>
</ul>
</div>
</div>

<div id="outline-container-org79b1edf" class="outline-3">
<h3 id="org79b1edf"><span class="section-number-3">1.16.</span> clear</h3>
<div class="outline-text-3" id="text-1-16">
<p>
nnterms:
</p>
<ul class="org-ul">
<li>dangling - not associated with container</li>
</ul>

<p>
remove parts not connected to running contatinters:
</p>
<ul class="org-ul">
<li>docker system/image/container/network prune -a</li>
</ul>

<p>
remove images:
</p>
<ul class="org-ul">
<li>docker image prune # dangling</li>
<li>docker image prune -a # remove all images which are not used by containers</li>
<li>docker image prune -a &#x2013;filter "until=24h" # removes older than 24 hours</li>
<li>docker rmi $(docker images -f "dangling=true" -q)</li>
<li>remove images by pattern
<ul class="org-ul">
<li>docker images -a | grep “some<sub>pattern</sub>” | awk ‘{print $3}’ | xargs docker rmi</li>
</ul></li>
</ul>

<p>
remove containers:
</p>
<ul class="org-ul">
<li>docker container prune # stopped containers</li>
<li>docker rm $(docker ps -q -f status=exited) # remove all the containers that are not running (exited).</li>
<li>docker rm $(docker ps -a -q)  # wipe all containers</li>
<li>remove container by pattern
<ul class="org-ul">
<li>docker ps -a | grep “some<sub>pattern</sub>” | awk ‘{print $3}’ | xargs docker rm</li>
</ul></li>
</ul>

<p>
remove volumes (Volumes are never removed automatically):
</p>
<ul class="org-ul">
<li>docker volume prune # remove all volumes not used by at least one container</li>
<li>docker volume prune &#x2013;filter "label!=keep" # only removes volumes which are not labelled with the keep label</li>
<li>docker volume ls -f name=syst</li>
<li>docker volume rm volume1<sub>name</sub> volume2<sub>name</sub></li>
</ul>

<p>
remove networks:
</p>
<ul class="org-ul">
<li>docker network prune # networks which aren’t used by any containers</li>
</ul>

<p>
Prune everything:
</p>
<ul class="org-ul">
<li>docker system prune #  shortcut that prunes images, containers, and networks</li>
<li>docker system prune &#x2013;volumes # and volumes too</li>
</ul>

<p>
docker builder prune - удаление кэша сборки
</p>

<p>
remove all images:
</p>
<pre class="example">
docker rmi -f $(docker images -aq)
</pre>
</div>
</div>
<div id="outline-container-orgc38b3fe" class="outline-3">
<h3 id="orgc38b3fe"><span class="section-number-3">1.17.</span> tmpfs</h3>
<div class="outline-text-3" id="text-1-17">
<ul class="org-ul">
<li>sudo mount -t tmpfs tmpfs /var/lib/docker</li>
<li>systemctl restart docker</li>
</ul>
</div>
</div>
<div id="outline-container-org5850519" class="outline-3">
<h3 id="org5850519"><span class="section-number-3">1.18.</span> Dokerfile</h3>
<div class="outline-text-3" id="text-1-18">
<ul class="org-ul">
<li>COPY local.conf . # to current directory # preffered # stripped-down version of ADD</li>
<li>ADD . /code # Too Much Magic
<ul class="org-ul">
<li>ADD <i>foo.tar.gz /tmp</i> # autounpack</li>
</ul></li>
<li>WORKDIR /code</li>
<li>ENV FLASK<sub>APP</sub> app.py # set env variable inside of running container</li>
<li>RUN pip3 install &#x2013;upgrade pip # run command to build image</li>
</ul>
</div>
</div>

<div id="outline-container-org85d2021" class="outline-3">
<h3 id="org85d2021"><span class="section-number-3">1.19.</span> apt Dokerfile</h3>
<div class="outline-text-3" id="text-1-19">
<div class="org-src-container">
<pre class="src src-Dockerfile">RUN apt-get update &amp;&amp; apt-get install -y --no-install-recommends \
    cuda-libraries-11-8=${NV_CUDA_LIB_VERSION} \
    &amp;&amp; rm -rf /var/lib/apt/lists/*
</pre>
</div>
</div>
</div>
<div id="outline-container-orge922ca3" class="outline-3">
<h3 id="orge922ca3"><span class="section-number-3">1.20.</span> health check for container</h3>
<div class="outline-text-3" id="text-1-20">
<p>
can be baked into the image definition
</p>
<ul class="org-ul">
<li>HEALTHCHECK &#x2013;interval=5s &#x2013;timeout=3s CMD curl &#x2013;fail <a href="http://localhost:8091/pools">http://localhost:8091/pools</a> || exit 1
<ul class="org-ul">
<li>&#x2013;interval=DURATION (default 30s)</li>
<li>&#x2013;timeout=DURATION (default 30s)</li>
<li>&#x2013;retries=N (default 3)</li>
</ul></li>
</ul>

<p>
If health check is enabled, then the container can have three states:
</p>
<ul class="org-ul">
<li>starting</li>
<li>healthy</li>
<li>unhealthy</li>
</ul>

<p>
docker-compose.yml:
</p>
<div class="org-src-container">
<pre class="src src-yaml">services:
        webapp:
                image: your-repo-name/webapp:1.0.1-nginx
                container_name: webapp
                network_mode: host
                healthcheck:
                        test: mysql airflowdb -u $MYSQL_USER --password=$MYSQL_PASSWORD -e 'SELECT 1;'
                        interval: 20s
                        timeout: 60s
                        start_period: 15s
                restart: always
</pre>
</div>
</div>
</div>
<div id="outline-container-org396794b" class="outline-3">
<h3 id="org396794b"><span class="section-number-3">1.21.</span> Volumes, mount points (Bind mounts),</h3>
<div class="outline-text-3" id="text-1-21">
<p>
mount <a href="https://docs.docker.com/storage/bind-mounts/">https://docs.docker.com/storage/bind-mounts/</a>
</p>
<ul class="org-ul">
<li>-v or &#x2013;volume syntax, but are encouraged to use &#x2013;mount, because research has shown it to be
easier to use.</li>
<li>docker run -v /root/proj-ds:/opt -t ds</li>
</ul>

<p>
volume <a href="https://docs.docker.com/storage/volumes/">https://docs.docker.com/storage/volumes/</a>
</p>
<ul class="org-ul">
<li>VOLUME /app/data - a volume named /app/data is created within the container, and any data stored
in that directory will be persisted even if the container is stopped or deleted.</li>
<li>Volumes are easier to back up or migrate than bind mounts.</li>
</ul>
</div>
</div>
<div id="outline-container-org79de2ac" class="outline-3">
<h3 id="org79de2ac"><span class="section-number-3">1.22.</span> Development Containers or dev containers or .devcontainer directory</h3>
<div class="outline-text-3" id="text-1-22">
<ul class="org-ul">
<li><a href="https://containers.dev/">https://containers.dev/</a></li>
<li><a href="https://docs.github.com/en/codespaces/setting-up-your-project-for-codespaces/adding-a-dev-container-configuration/introduction-to-dev-containers">https://docs.github.com/en/codespaces/setting-up-your-project-for-codespaces/adding-a-dev-container-configuration/introduction-to-dev-containers</a></li>
</ul>

<p>
PyCharm <a href="https://www.jetbrains.com/help/pycharm/connect-to-devcontainer.html">https://www.jetbrains.com/help/pycharm/connect-to-devcontainer.html</a>
</p>
</div>
</div>

<div id="outline-container-orgf8b3c5c" class="outline-3">
<h3 id="orgf8b3c5c"><span class="section-number-3">1.23.</span> DockerHub - publish</h3>
<div class="outline-text-3" id="text-1-23">
<div class="org-src-container">
<pre class="src src-bash">docker build -t mlops-zoomcamp-model:2024-3.10.13-slim .
docker tag mlops-zoomcamp-model:2024-3.10.13-slim agrigorev/zoomcamp-model:mlops-2024-3.10.13-slim

docker login --username USERNAME
docker push agrigorev/zoomcamp-model:mlops-2024-3.10.13-slim
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd8efb96" class="outline-3">
<h3 id="orgd8efb96"><span class="section-number-3">1.24.</span> troubleshooting</h3>
<div class="outline-text-3" id="text-1-24">
<p>
Building Dokcer image fails with failed to fetch anonymous token,
</p>
<ul class="org-ul">
<li>connect: network is unreachable.</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgd1d060b" class="outline-2">
<h2 id="orgd1d060b"><span class="section-number-2">2.</span> docker-compose</h2>
<div class="outline-text-2" id="text-2">
<p>
multi-container Docker applications - for scaling - docker-compose
</p>
<ul class="org-ul">
<li><a href="https://docs.docker.com/get-started/part3/">https://docs.docker.com/get-started/part3/</a></li>
<li><b>Docker Compouse</b> - run commands on multiple containers at once</li>
<li><b>Docker Swarm</b> - provides native clustering functionality for Docker containers. require docker-machine tool
and VM</li>
</ul>
<p>
docker-compose.yml - несоклько инстанцев - балансировщик нагрузки работает внутри, но не снаружи.
</p>

<dl class="org-dl">
<dt>service</dt><dd>conteiner in swarm - what ports it should use, how many replicas of the container should run</dd>
</dl>

<p>
build 5 images-services from Docker Hub image "redis:alpine" and directories:
</p>
<ul class="org-ul">
<li>docker-compose build &amp;&amp; docker-compose up -d</li>
<li>docker-compose up &#x2013;force-recreate &#x2013;build -d</li>
</ul>
</div>
<div id="outline-container-orgbf02127" class="outline-3">
<h3 id="orgbf02127"><span class="section-number-3">2.1.</span> <span class="todo TODO">TODO</span> multi-stage builds</h3>
</div>
<div id="outline-container-org5a731f3" class="outline-3">
<h3 id="org5a731f3"><span class="section-number-3">2.2.</span> swarm</h3>
<div class="outline-text-3" id="text-2-2">
<ul class="org-ul">
<li>docker swarm init - to enable swarm mode and make your current machine a swarm manage</li>
<li>docker-machine - инструмент который работает на базе виртуальных машин. ХЗ как что</li>
<li>docekr swarm leave</li>
</ul>
</div>
</div>
<div id="outline-container-orgcd7178e" class="outline-3">
<h3 id="orgcd7178e"><span class="section-number-3">2.3.</span> docker-compose.yml</h3>
<div class="outline-text-3" id="text-2-3">
<ul class="org-ul">
<li><a href="https://docs.docker.com/compose/compose-file/">https://docs.docker.com/compose/compose-file/</a></li>
<li>2 chars indentation</li>
</ul>

<p>
structure:
</p>
<ol class="org-ol">
<li>docker-compose.yaml</li>
</ol>
<div class="org-src-container">
<pre class="src src-python">version: <span style="color: #95e454;">"3.9"</span>  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">optional since v1.27.0</span>
services:
  web:
    build: path_to_Dockerfile
    ports:
      - <span style="color: #95e454;">"8000:5000"</span> <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">host port : container port</span>
</pre>
</div>

<ol class="org-ol">
<li>Dockerfile</li>
</ol>
</div>
</div>

<div id="outline-container-org14c0789" class="outline-3">
<h3 id="org14c0789"><span class="section-number-3">2.4.</span> Environment variables</h3>
<div class="outline-text-3" id="text-2-4">
<p>
default environment variable file named .env (or &#x2013;env-file command line option):
</p>
<ul class="org-ul">
<li>TAG=v1.5</li>
</ul>

<p>
var
</p>
<ul class="org-ul">
<li>${VARIABLE:?err} exits with an error message containing err if VARIABLE is unset or empty in the
environment.</li>
<li>${VARIABLE?err} exits with an error message containing err if VARIABLE is unset in the
environment.</li>
</ul>

<div class="org-src-container">
<pre class="src src-yaml">web:
  environment:
    - DEBUG=1
</pre>
</div>
</div>
</div>
<div id="outline-container-orge937092" class="outline-3">
<h3 id="orge937092"><span class="section-number-3">2.5.</span> Network</h3>
<div class="outline-text-3" id="text-2-5">
<p>
network per application
</p>
<ul class="org-ul">
<li>network name based on the “project name”, which is based on the name of the directory it lives in
(You can override the project name with either the &#x2013;project-name flag or the COMPOSE<sub>PROJECT</sub><sub>NAME</sub>
environment variable.)
<ul class="org-ul">
<li>myapp<sub>default</sub></li>
</ul></li>
<li>container join the network under own name
<ul class="org-ul">
<li>URL <a href="http://web">http://web</a></li>
</ul></li>
<li>standalone containers can connect default network (attachable=true)</li>
<li></li>
</ul>

<p>
ports: ["8001:5432"] - distinction between HOST<sub>PORT</sub> and CONTAINER<sub>PORT</sub>
</p>
<ul class="org-ul">
<li>service-to-service communication uses the <b>CONTAINER<sub>PORT</sub></b></li>
<li><b>HOST<sub>PORT</sub></b> is defined, the service is accessible outside the swarm as well.</li>
</ul>
</div>
<div id="outline-container-org43e85c7" class="outline-4">
<h4 id="org43e85c7"><span class="section-number-4">2.5.1.</span> ex</h4>
<div class="outline-text-4" id="text-2-5-1">
<div class="org-src-container">
<pre class="src src-yaml">services:
  web:
    build: .
    ports:
      - "8000:8000"
  db:
    image: postgres
    ports:
      - "8001:5432"
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgdda5b9f" class="outline-3">
<h3 id="orgdda5b9f"><span class="section-number-3">2.6.</span> errors</h3>
<div class="outline-text-3" id="text-2-6">
<p>
<b>error: for webb  No such image: sha256</b>
</p>
<ul class="org-ul">
<li>docker-compose -f docker-compose-filename.yml down</li>
<li>docker-compose -f docker-compose-filename.yml up</li>
</ul>

<p>
<b>Credentials store error: StoreError</b>
</p>
<ul class="org-ul">
<li><a href="https://stackoverflow.com/questions/56267890/docker-compose-unable-to-start">https://stackoverflow.com/questions/56267890/docker-compose-unable-to-start</a></li>
<li>sudo rm ~/.docker/config.json</li>
<li>Create login at <a href="https://hub.docker.com/">https://hub.docker.com/</a></li>
<li>docker login</li>
<li>docker-compose up</li>
</ul>
<p>
OR remove "credsStore wincredis" from  ~/.docker/config.json
</p>

<p>
<b>infinity restarts</b>
</p>
<div class="org-src-container">
<pre class="src src-yaml">version: '3'
services:
  my-service:
    restart: on-failure:5
</pre>
</div>
</div>
</div>
<div id="outline-container-org56ad7e3" class="outline-3">
<h3 id="org56ad7e3"><span class="section-number-3">2.7.</span> usage</h3>
<div class="outline-text-3" id="text-2-7">
<ul class="org-ul">
<li></li>

<li>docker-compose -f docker-compose.yml up</li>
<li>docker-compose up -d</li>
<li>docker-compose down</li>
<li>docker-compose down &#x2013;volumes # and remove volumes</li>
<li>docker-compose up &#x2013;no-deps &#x2013;build &lt;service<sub>name</sub>&gt; - rebuild</li>
<li>docker-compose build ServiceName+1</li>
</ul>
</div>
</div>

<div id="outline-container-orgc58df40" class="outline-3">
<h3 id="orgc58df40"><span class="section-number-3">2.8.</span> add folder (volumes)</h3>
<div class="outline-text-3" id="text-2-8">
<p>
services:
</p>
<ul class="org-ul">
<li>xxx<sub>service</sub>: volumes: - ./local:/root/container:ro</li>
</ul>

<p>
The imperative way (Docker client):
</p>
<ul class="org-ul">
<li>docker volume create [OPTIONS] [VOLUME]</li>
</ul>

<p>
Types of volumes in Docker:
</p>
<ul class="org-ul">
<li>Docker host-mounted volumes
<ul class="org-ul">
<li>/host/path:/container/path</li>
</ul></li>
<li>Docker named volumes
<ul class="org-ul">
<li>named<sub>volume</sub><sub>name</sub>:/container/path</li>
<li>types:
<ul class="org-ul">
<li>internal - used only inside docker-compose (app)</li>
<li>external - can be used across docker installation - must be created by the user</li>
</ul></li>
</ul></li>
</ul>

<p>
docker external named volume:
</p>
<ol class="org-ol">
<li>docker volume create &#x2013;driver local &#x2013;opt type=none &#x2013;opt device=/var/opt/my<sub>website</sub>/dist &#x2013;opt
o=bind web<sub>data</sub></li>
<li></li>
</ol>
<div class="org-src-container">
<pre class="src src-yml">volumes:
  web_data:
    external: true
</pre>
</div>
</div>
</div>
<div id="outline-container-org0ab7669" class="outline-3">
<h3 id="org0ab7669"><span class="section-number-3">2.9.</span> Entrypoint and Cmd</h3>
<div class="outline-text-3" id="text-2-9">
<p>
Override Docker ENTRYPOINT and CMD.
</p>
<ul class="org-ul">
<li>entrypoint: /code/entrypoint.sh</li>
<li>entrypoint: ["php", "-d", "memory<sub>limit</sub>=-1", "vendor/bin/phpunit"]</li>
</ul>

<p>
entrypoint: ["tail", "-f", "/dev/null"] # sleep
</p>
</div>
</div>
</div>
<div id="outline-container-orgbd64f7f" class="outline-2">
<h2 id="orgbd64f7f"><span class="section-number-2">3.</span> hub.docker.com</h2>
<div class="outline-text-2" id="text-3">
<p>
docker image history &#x2013;no-trunc image<sub>name</sub> &gt; image<sub>history</sub>
</p>
<ul class="org-ul">
<li>docker search</li>
<li>docker pull/push</li>
</ul>

<p>
repository
</p>
<ul class="org-ul">
<li>docker login</li>
<li>docker logout</li>
<li>docker push aa/nginx localhost:5000/myadmin/nginx</li>
<li>docker pull myregistry/nginx:master</li>
<li>docker pull eon01/nginx localhost:5000/myadmin/nginx</li>

<li>docker image history nginx</li>
<li>docker image history &#x2013;no-trunc image<sub>name</sub> &gt; image<sub>history</sub></li>
<li>docker inspect nginx</li>

<li>docker rmi nginx</li>

<li>docker rmi $(docker images | grep "^&lt;none&gt;" | awk "{print $3}") - удаление всех образов без тега (none)</li>
<li>docker commit nginx - создание образа из контейнера</li>
<li>docker tag nginx my/nginx</li>
</ul>
</div>
</div>

<div id="outline-container-orga8a046b" class="outline-2">
<h2 id="orga8a046b"><span class="section-number-2">4.</span> <span class="todo TODO">TODO</span> devops</h2>
<div class="outline-text-2" id="text-4">
<p>
<a href="https://github.com/MichaelCade/90DaysOfDevOps">https://github.com/MichaelCade/90DaysOfDevOps</a>
</p>



<ul class="org-ul">
<li><a href="theory#MissingReference">SRE vs ITIL vs DevOps</a></li>
<li><a href="theory#MissingReference">DevOps</a></li>
</ul>
</div>
</div>
<div id="outline-container-orge3f07d8" class="outline-2">
<h2 id="orge3f07d8"><span class="section-number-2">5.</span> MLflow - experiment tracking</h2>
<div class="outline-text-2" id="text-5">
<p>
focuses on tracking hyperparameters, metrics, and models but does not offer the same level of data and computational environment tracking as ClearML
</p>
</div>
<div id="outline-container-orgcc6d98c" class="outline-3">
<h3 id="orgcc6d98c"><span class="section-number-3">5.1.</span> Features</h3>
<div class="outline-text-3" id="text-5-1">
<dl class="org-dl">
<dt>Logging or Tracking</dt><dd>logging parameters, code versions, metrics, and output files when running your machine learning code
<ul class="org-ul">
<li>Can log to file or a server.</li>
</ul></dd>
<dt>Model Registry</dt><dd>versioning, model store, APIs, and UI, model lineage, versioning, aliasing,
tagging, and annotations.</dd>
<dt>(no term)</dt><dd>UI: limited visualization capabilities</dd>
<dt>(no term)</dt><dd>supports reproducibility but may require more manual effort</dd>
</dl>
</div>
</div>
</div>
<div id="outline-container-orgb62f54c" class="outline-2">
<h2 id="orgb62f54c"><span class="section-number-2">6.</span> ClearML - experiment tracking</h2>
<div class="outline-text-2" id="text-6">
<p>
more complex variant of MLflow
</p>
<ul class="org-ul">
<li>track data and the computational environment, including versioning datasets and managing
unstructured data effectively. It also provides features like Hyper-datasets for managing large
files and ensuring data lineage</li>
<li>UI: detailed view of tasks can be overwhelming for new users</li>
<li>full reproducibility of experiments</li>
</ul>
</div>
</div>
<div id="outline-container-org4c763df" class="outline-2">
<h2 id="org4c763df"><span class="section-number-2">7.</span> Mage - data pipeline tool</h2>
<div class="outline-text-2" id="text-7">
<p>
with a strong focus on data integration, transformation, and pipeline management.
</p>

<p>
features:
</p>
<ul class="org-ul">
<li>Data Integration and Synchronization - both real-time and batch data pipelines using Python, SQL</li>
<li>Interactive Code and UI</li>
<li>Pipeline Management - thousands of pipelines without the complexity of tools like Airflow</li>
<li>Scalability and Deployment - supports deployment on various cloud platforms like AWS, GCP, Azure, and DigitalOcean using Terraform templates</li>
<li>Observability and Monitoring - built-in monitoring, alerting, and observability features through an intuitive UI</li>
</ul>
</div>
</div>
<div id="outline-container-orgb267d72" class="outline-2">
<h2 id="orgb267d72"><span class="section-number-2">8.</span> kubernetes (K8S)</h2>
<div class="outline-text-2" id="text-8">
<p>
[k(j)uːbərˈnɛtɪs]
</p>
<ul class="org-ul">
<li>Основы <a href="https://habr.com/ru/post/258443/">https://habr.com/ru/post/258443/</a></li>
<li>Concepts <a href="https://kubernetes.io/docs/concepts/">https://kubernetes.io/docs/concepts/</a></li>
</ul>

<p>
Процесс в K8S не может создавать под-процессы.
</p>

<p>
На мастере размещаются служемные поды
</p>
<ul class="org-ul">
<li>taind - ограничение</li>
<li></li>
</ul>

<p>
config maps - ?
</p>

<p>
bootstraping
</p>

<p>
Модули реализованы через API
</p>
<ul class="org-ul">
<li>in-tree</li>
<li>out of tree - addons - вне кодовой базы</li>
</ul>
</div>

<div id="outline-container-org47f347d" class="outline-3">
<h3 id="org47f347d"><span class="section-number-3">8.1.</span> theory</h3>
<div class="outline-text-3" id="text-8-1">
<p>
K8s is a platform for creating, deploying and managing distributed applications.
</p>

<ul class="org-ul">
<li>container-orchestration system for automating application deployment, scaling, and management.</li>
</ul>
<p>
container orchestration system for automating application deployment, scaling, and management.  It
aims to provide a "platform for automating deployment, scaling, and operations of application
containers across clusters of hosts".
</p>

<p>
It eliminates the need for orchestration - continuously drive the
current state towards the provided desired state.
</p>

<p>
Master/slave (Primary/replica architecture) - model of asymmetric communication (data speed or
 quantity, when averaged over time, is different in one direction from the other).
</p>
</div>
<div id="outline-container-org03f9ea5" class="outline-4">
<h4 id="org03f9ea5"><span class="section-number-4">8.1.1.</span> Контейнер</h4>
<div class="outline-text-4" id="text-8-1-1">
<ul class="org-ul">
<li>Это стандартизированный метод упаковки приложения</li>
<li>процесс повязанный к namespaces и контролируемый через cgroups</li>
</ul>
</div>
</div>
<div id="outline-container-org1009f4b" class="outline-4">
<h4 id="org1009f4b"><span class="section-number-4">8.1.2.</span> main features</h4>
<div class="outline-text-4" id="text-8-1-2">
<p>
benefits of k8s:
</p>
<ul class="org-ul">
<li>Velocity
<ul class="org-ul">
<li>immutability - artifact created and don't change via user modifications</li>
<li>declarative configuration - desired state of the system</li>
<li>onlineself-healing systems</li>
</ul></li>
<li>scaling
<ul class="org-ul">
<li>decoupling - each component is separated from other components by defined APIs and service load balancers.</li>
</ul></li>
<li>abstracting your infrastructure</li>
<li>efficiency</li>
</ul>

<p>
o
</p>
<ul class="org-ul">
<li>service discovery and load balancing</li>
<li>storage orchistration (local storage, public cloud providers, etc)</li>
<li>automated rollouts and rollbacks (just tell the desired state) (развертывание и откат)</li>
<li>automatic bin packing (CPU and memory needs =&gt; a particular node)</li>
<li>Self-healing (liveness &amp; readiness probes)</li>
<li>Secret and configuration management (deploy &amp; update secrets and configuration without rebuilding
container images)</li>
</ul>

<p>
probes
</p>
<ul class="org-ul">
<li><b>liveness</b> - deadlock - application is running, but unable to make progress</li>
<li><b>readiness</b> - when app is start to accept traffic. Pod is considered ready when all of its
containers are ready.</li>
</ul>
</div>
</div>
<div id="outline-container-orgfd2385e" class="outline-4">
<h4 id="orgfd2385e"><span class="section-number-4">8.1.3.</span> Microservices</h4>
<div class="outline-text-4" id="text-8-1-3">
<p>
The ideal team size is the "two-pizza team" - 7-8 ppl.
</p>

<p>
The development of decoupled, service-oriented teams - each build single microservice.
</p>

<p>
The aggregation of all of these services provides the implementation of overall product's surface area.
</p>
</div>
</div>
<div id="outline-container-org35eda5d" class="outline-4">
<h4 id="org35eda5d"><span class="section-number-4">8.1.4.</span> Services &amp; Endpoinds &amp; probes</h4>
<div class="outline-text-4" id="text-8-1-4">
<p>
apiserver -&gt; [NODE kube-proxy -&gt; clusterIP(iptables)-&gt;] -&gt;Backed Pod1, Backed Pod2, Backed Pod3
</p>

<p>
clusterIP - load balancer by iptables with (probability distribution)
</p>

<p>
endpoint - address:port
</p>

<p>
if CLUSTER-IP - is not None - it is balanced.
</p>

<p>
probes?
</p>
</div>
</div>
<div id="outline-container-org49c82bf" class="outline-4">
<h4 id="org49c82bf"><span class="section-number-4">8.1.5.</span> PV &amp; Provisioners &amp; PVC</h4>
<div class="outline-text-4" id="text-8-1-5">
<p>
PV - persistent volume - just a folder at some server.
</p>

<p>
containers don't work directly with PV, they use PVC (PV claims) - it is query for storage volume to get PV.
</p>

<p>
reclaim policy (RECLAIM) - "Delete" mean provisioner (local volume provisioner) may just remove all
 data from folder and make PV available again. "Retain" mean change state to &#x2026; and don't remove data.
</p>
</div>
</div>
<div id="outline-container-orgbfb6d8b" class="outline-4">
<h4 id="orgbfb6d8b"><span class="section-number-4">8.1.6.</span> CRD - add own API to kubernetes</h4>
<div class="outline-text-4" id="text-8-1-6">
<p>
API - (kubectl get pods/alert/&#x2026;)
</p>

<p>
External Controller for logs/alerts management.
</p>
</div>
</div>
</div>
<div id="outline-container-org189d7e4" class="outline-3">
<h3 id="org189d7e4"><span class="section-number-3">8.2.</span> history</h3>
<div class="outline-text-3" id="text-8-2">
<ul class="org-ul">
<li>2003: <b>Borg System</b> - Google</li>
<li>2013: <b>Omega</b> - Google</li>
<li>2014: <b>Kubernetes</b> - Google - as an open source version of Borg</li>
<li>2015: v1.0</li>
<li>2016:
<ul class="org-ul">
<li>First release of <b>Helm</b> the package manager of Kubernetes.</li>
<li><b>Minikube</b> a tool that makes it easy to run Kubernetes locally.</li>
<li><b>Kops</b> official project for managing production-grade Kubernetes clusters.</li>
<li>kubeadm</li>
<li>supports OpenAPI - Specification defines a standard interface to RESTful APIs</li>
</ul></li>
<li>2017:
<ul class="org-ul">
<li>Google and IBM announce <b>Istio</b></li>
<li>role-based access control (RBAC) authorizer</li>
<li>Introducing <b>Kubeflow</b> - Machine Learning Stack Built for Kubernetes.</li>
<li><b>Amazon EKS</b> -  to run Kubernetes on AWS without needing to install, operate, and maintain your own Kubernetes control plane or nodes.</li>
<li><b>Azure AKS</b></li>
<li>the principal competitors:
<ul class="org-ul">
<li>VMware</li>
<li>Mesosphere, Inc.</li>
<li>Docker, Inc.</li>
<li>Microsoft Azure</li>
<li>AWS</li>
</ul></li>
</ul></li>
<li>the hard way guilde <a href="#orgcf7928e">4</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgacf8f0d" class="outline-3">
<h3 id="orgacf8f0d"><span class="section-number-3">8.3.</span> objects, components, apis</h3>
<div class="outline-text-3" id="text-8-3">
</div>
<div id="outline-container-orge96518e" class="outline-4">
<h4 id="orge96518e"><span class="section-number-4">8.3.1.</span> Abstractions:</h4>
<div class="outline-text-4" id="text-8-3-1">
<p>
main (kind)
</p>
<dl class="org-dl">
<dt>pod</dt><dd>group of containers with shared storage and network resources - ip adress, volumes - not
durable by default. (has hidden default container)
<ul class="org-ul">
<li>"assigning a pod to a Node"</li>
<li>Pods are the smallest deployable units of computing.</li>
</ul></dd>
<dt>service</dt><dd>provide load balancing, naming, discovery</dd>
<dt>namespace</dt><dd>just group resources</dd>
<dt>Ingress</dt><dd>objects provice an easy-to-use fronted that can combine multiple microservices into a
single externalized API survace area.</dd>
<dt>configmap</dt><dd>store yaml config as a service.</dd>
<dt>container</dt><dd>process, unit of service, on the same physical or virtual machine in the cluster.</dd>
</dl>
</div>
</div>
<div id="outline-container-orgdfb78eb" class="outline-4">
<h4 id="orgdfb78eb"><span class="section-number-4">8.3.2.</span> Kubernetes Objects or API object or API resources or resource type</h4>
<div class="outline-text-4" id="text-8-3-2">
<p>
Objects - persistent entities "record of intent". has <b>spec</b> and <b>status</b>.
</p>
</div>
<ol class="org-ol">
<li><a id="org528e24b"></a>list of objects (kind)<br />
<div class="outline-text-5" id="text-8-3-2-1">
<pre class="example">
kubectl api-resources # to get all accessible API resources
kubectl api-resources -o wide | grep tfjob # to get all supported operations for object
</pre>


<ul class="org-ul">
<li>node - Master and Workers. Master - служебный, Worker - для установки</li>
<li>pods - one or more containers share the same resources and local network - used as the unit of replication
<ul class="org-ul">
<li>pods are scaled up and down as a unit, all containers in a pod must scale together</li>
<li>pods should remain as small as possible, , typically holding only a main process and its tightly-coupled helper containers (side-cars)</li>
</ul></li>
<li>Ingress -  exposes HTTP and HTTPS routes from outside the cluster to services</li>
</ul>

<p>
Once you create the object, the Kubernetes system will constantly work to ensure that object exists
</p>
<ul class="org-ul">
<li>object spec - desired state</li>
<li>object status - actual state of the object</li>
</ul>

<p>
Objects:
</p>
<ul class="org-ul">
<li><b>Node</b> - phisical instance for kubernetes
<ul class="org-ul">
<li>Kubelet -  process responsible for communication between the Kubernetes Master and the Node</li>
<li>Kube-Proxy - proxy-балансировщик, простейшее перенаправление потоков TCP и UDP (round robin) между набором бэкендов</li>
<li>A container runtime (like Docker, rkt)</li>
</ul></li>
<li><b>Pod</b> - has unique IP, one or more application containers(tightly coupled) (such as Docker or rkt), and some shared
resources for those containers:
<ul class="org-ul">
<li>Volumes - Shared storage for containers</li>
<li>Networking, as a unique cluster IP address</li>
<li>configmap - kubectl -n aml get configmap provodki-app-cm-env -o yaml</li>
</ul></li>
<li><b>service</b> - абстракция которая определяет логический объединённый набор pod и политику доступа к ним.</li>
<li><b>Namespaces</b> - разделить кластер K8S на несколько логических - с квотами не влияя на другие</li>
</ul>
</div>
</li>

<li><a id="orgc578ae7"></a><span class="todo TODO">TODO</span> kubectl get all:<br />
<div class="outline-text-5" id="text-8-3-2-2">
<ul class="org-ul">
<li>pod</li>
<li>service</li>
<li>deployment.apps</li>
<li>replicaset.apps</li>
<li>statefulset.apps</li>
<li>job.batch</li>
</ul>
</div>
</li>
</ol>
</div>

<div id="outline-container-org43b5160" class="outline-4">
<h4 id="org43b5160"><span class="section-number-4">8.3.3.</span> workload resources - high-level abstractions</h4>
<div class="outline-text-4" id="text-8-3-3">
<p>
configure <b>controllers</b> that make sure the right number of the right kind of pod
 are running, to match the state you specified.
</p>

<dl class="org-dl">
<dt>Deployment</dt><dd>wrapper for ReplicaSet (rolling updates (versioning)). Pods are expected to be
interchangeable.</dd>
<dt>ReplicaSet</dt><dd>pods scaling (deprecated) maintain a stable set of replica Pods. (not used not manage workloads</dd>
<dt>StatefulSet</dt><dd>like Deployment, but maintains a sticky identity for each of its Pods. provide:
unique network identifiers, persistent storage, graceful deployment and scaling, automated rolling
updates. Most used to be able to make a link between its Pods and their persistent storage. Когда
пралажение хранит данные в volume.</dd>
<dt>DaemonSet</dt><dd>provide facilities that are local to a specific node. Одна реплика определенного пода
присутствовала на каждой ноде. Для служебных задач каких-то.</dd>
<dt>Job/CronJob</dt><dd>task one-off/repeat task. Разовая нагрузка, к примеру, мы хотим при деплои
прилажения сделать инициализацию базы данных.</dd>
</dl>
</div>
<ol class="org-ol">
<li><a id="org737bfb5"></a>Deployment<br />
<div class="outline-text-5" id="text-8-3-3-1">
<p>
<b>template</b> and <b>selector</b> are the only required fields of the .spec.
</p>
</div>
<ol class="org-ol">
<li><a id="orga9714c2"></a>template<br />
<div class="outline-text-6" id="text-8-3-3-1-1">
<p>
<b>Pod template</b>
</p>
</div>
</li>
</ol>
</li>
</ol>
</div>

<div id="outline-container-org24bda6b" class="outline-4">
<h4 id="org24bda6b"><span class="section-number-4">8.3.4.</span> object spec</h4>
<div class="outline-text-4" id="text-8-3-4">
<p>
Required fields
</p>
<dl class="org-dl">
<dt>apiVersion</dt><dd>v1 usualy</dd>
<dt>kind</dt><dd>What kind of object you want to create.</dd>
<dt>metadata</dt><dd>Data that helps uniquely identify the object, including a name string, UID, and optional namespace</dd>
<dt>spec</dt><dd>unuque for every object type. What state you desire for the object</dd>
</dl>

<p>
Display an explanation of a specific field
</p>
<pre class="example">
$ kubectl explain [pods.spec.containers
</pre>


<p>
Example:
</p>
<div class="org-src-container">
<pre class="src src-yaml">apiVersion: apps/v1  # default  version of the Kubernetes API
kind: Deployment
metadata: 		# uniquely identify the object - name, UID, namespace
  name: nginx-deployment
spec: 			# state you desire for the object
  replicas: 2	# tells deployment to run 2 pods matching the template
</pre>
</div>
</div>
</div>

<div id="outline-container-org9707c3a" class="outline-4">
<h4 id="org9707c3a"><span class="section-number-4">8.3.5.</span> pod lifecycle -</h4>
<div class="outline-text-4" id="text-8-3-5">
<p>
Pod.status(PodStatus).phase(string) - is phase
</p>
<ul class="org-ul">
<li>Pending -</li>
<li>Running - at least one of its primary containers is running, or is in starting or restarting.</li>
<li>on of:
<ul class="org-ul">
<li>Succeeded - All containers is terminated in success</li>
<li>Failed - any container in the Pod terminated and at least one in failure. or node dies or is disconnected</li>
<li>Unknown - error in communicating with the node</li>
</ul></li>
<li>Completed - status Succeeded is not a phase acutaly it is transitional state. scheduled, but not ready. Containers
state is Terminated with Completed reason.</li>
</ul>

<p>
restartPolicy - applies to all containers:
</p>
<ul class="org-ul">
<li>Always(default) -</li>
<li>OnFailure -</li>
<li>Never -</li>
</ul>

<p>
Pod.status(PodStatus).conditions(PodCondition).type(string) - is Pod conditions:
</p>
<ul class="org-ul">
<li>PodScheduled - scheduled to a node</li>
<li>PodHasNetwork - Pod sandbox has been successfully created</li>
<li>ContainersReady - all containers are ready</li>
<li>Initialized - all <b>init containers</b> have completed successfully</li>
<li>Ready - Pod is able to serve requests</li>
</ul>

<p>
Notes:
</p>
<ul class="org-ul">
<li>Pods are only scheduled once in their lifetime - until it stops or is terminated.</li>
</ul>
</div>
</div>

<div id="outline-container-org7a9f688" class="outline-4">
<h4 id="org7a9f688"><span class="section-number-4">8.3.6.</span> container states</h4>
<div class="outline-text-4" id="text-8-3-6">
<ul class="org-ul">
<li>Waiting - something required</li>
<li>Running</li>
<li>Terminated</li>
</ul>
</div>
</div>

<div id="outline-container-org5970646" class="outline-4">
<h4 id="org5970646"><span class="section-number-4">8.3.7.</span> names and uids (all objects have)</h4>
<div class="outline-text-4" id="text-8-3-7">
<ul class="org-ul">
<li>metadata-&gt;Name - is unique for that type of resource.</li>
<li>metadata-&gt;UIDs - A Kubernetes systems-generated string to uniquely identify objects.</li>
</ul>
</div>
</div>
<div id="outline-container-orgfcdcf5a" class="outline-4">
<h4 id="orgfcdcf5a"><span class="section-number-4">8.3.8.</span> Labels (optional)</h4>
<div class="outline-text-4" id="text-8-3-8">
<p>
metadata-&gt;Labels - key/value pairs that are attached to objects.
</p>

<p>
can be used for:
</p>
<ul class="org-ul">
<li>to organize and to select subsets of objects</li>
</ul>

<p>
selects pods with labels:
</p>
<pre class="example">
k get pods -l environment=production,tier=frontend
k get pods -l 'environment in (production, qa)'
k get pods -l 'environment,environment notin (frontend)'
</pre>
</div>
</div>
</div>
<div id="outline-container-orge65b48c" class="outline-3">
<h3 id="orge65b48c"><span class="section-number-3">8.4.</span> terms</h3>
<div class="outline-text-3" id="text-8-4">
<dl class="org-dl">
<dt>workload</dt><dd>app running on k8s - one or several components, you run it inside a set of pods.
<dl class="org-dl">
<dt>workload resources</dt><dd>Deployment, StatefulSet</dd>
</dl></dd>
<dt>container runtime</dt><dd>software that responsible for running containers.</dd>
<dt>control loop</dt><dd>is a non-terminating loop that regulates the state of a system. (used in controller)</dd>
<dt>control plane</dt><dd>set of components that run on mster nodes and control the overall state of the cluster.</dd>
<dt>bootstaping</dt><dd>is the process of setting up a new Kubernetes cluster from scratch.</dd>
<dt>provisioning machines</dt><dd>the process of creating and preparing virtual of phisical machines:
install OS, configure network, etc.</dd>
<dt>container</dt><dd>executable image that contains software and all of ins dependencies</dd>
<dt>ConfigMaps</dt><dd>non-confidential data in key-value pairs. environment-specific configuration.</dd>
<dt>Secret</dt><dd>an object that contains a small amount of sensitive data such as a password. stored
unencrypted in the API server's underlying data store (etcd). 1) as a files in a volume mounted 2)
as a env variable 3) By the kubelet when pulling images</dd>
<dt><b>Pod template</b></dt><dd>specifications for creating Pods .spec.template included in workload resources
such as Deployments, Jobs, and DaemonSets.</dd>
<dt><b>Services</b></dt><dd>type of object to group pods.</dd>
<dt><b>resources</b></dt><dd>types of objects, can by got by # kubectl api-resources. Defined and deployed with yaml of json files.</dd>
<dt><b>cluster</b></dt><dd><b>joined</b> worker nodes with "control plane" which is nodes also.
<ul class="org-ul">
<li>Кубернетис кластер, это <b>joined</b> worker nodes with "control plane" which is nodes also. Результат выполнения kubeadm init и kubeadm join, в результате которой поднимаются все необходимые сервисы на нодах и из нод формирутся кластер. К которому можно подключиться через доступ к API server. Подробная статья. <a href="https://www.airplane.dev/blog/kubernetes-control-plane">https://www.airplane.dev/blog/kubernetes-control-plane</a></li>
</ul></dd>
<dt>resource</dt><dd><i>kind</i> of API object</dd>
<dt>collection</dt><dd>A list of instances of a resource. There are dozens of collection types (such as PodList, ServiceList, and NodeList)</dd>

<dt>(no term)</dt><dd><b>reconsilation loop</b> - user-declared desired state -&gt; observed current state (action, observe) - у
каждого вида рабочей нагрузки есть свой контроллер который наблюдает за текущим состоянием и
желаемым. (kube-controller manager)</dd>
</dl>
</div>
</div>
<div id="outline-container-orgd5fc225" class="outline-3">
<h3 id="orgd5fc225"><span class="section-number-3">8.5.</span> architecture</h3>
<div class="outline-text-3" id="text-8-5">
<ul class="org-ul">
<li>pods - ip adress, volumes - not durable by default. (has hidden default container). a set of
running containers on your cluster</li>
<li>node - виртуальные машины в VMware. Can run(be assigned with) several pods.</li>
<li>controller - высшая обстрация над pods - CRI specification -</li>
<li>contrainer - run in pods - binary package with files
<ul class="org-ul">
<li>Docker image Format (often)</li>
</ul></li>
</ul>
</div>

<div id="outline-container-org5a86304" class="outline-4">
<h4 id="org5a86304"><span class="section-number-4">8.5.1.</span> master node</h4>
<div class="outline-text-4" id="text-8-5-1">
<ul class="org-ul">
<li>API Server - communicate with <b>kubelets</b> of Nodes - управление, все к нему обращается.</li>
<li>Controller (Manager) - control loops that watch the state of your cluster. tries to move the
current cluster state closer to the desired state.</li>
<li>Scheduler - планирование размещения pods and workloads на nodes. tracks resource allocation on each node.</li>
<li>etcd - ключ-значение хранилище - состояние кластера</li>
</ul>
</div>
</div>

<div id="outline-container-orgae7e54c" class="outline-4">
<h4 id="orgae7e54c"><span class="section-number-4">8.5.2.</span> worker node</h4>
<div class="outline-text-4" id="text-8-5-2">
<ul class="org-ul">
<li>kubelet - primary -  управляет pod'ами,их контейнерами, образами, разделами, etc.</li>
<li>cAdvisor</li>
<li>Kube-Proxy - network between pods and final users</li>
<li>pods</li>
<li>Container runtime</li>
</ul>
</div>
</div>

<div id="outline-container-orge3e5b89" class="outline-4">
<h4 id="orge3e5b89"><span class="section-number-4">8.5.3.</span> Container Runtime Interface (CRI)</h4>
<div class="outline-text-4" id="text-8-5-3">
<p>
enables the <b>kubelet</b> to use a wide variety of container runtimes, without having a need to recompile
 the cluster components.
</p>

<p>
kubelet interacts with container runtimes via the Container Runtime Interface (CRI) or CRI API,
 which decouples the maintenance of core Kubernetes from the actual CRI implementation.
</p>

<p>
Implementations of CRI API (CRI plugins):
</p>
<ul class="org-ul">
<li>containerd <a href="https://github.com/containerd/containerd">https://github.com/containerd/containerd</a> - can handle any container images which
compliant with <b>OCI Distribution Specification</b></li>
<li>CRI-O <a href="https://github.com/cri-o/cri-o">https://github.com/cri-o/cri-o</a> - Open Container Initiative (OCI) for Linux containers
(OS-level virtualization): LXD, Podman, CBL-Mariner.</li>
<li>Docker Engine - The software that hosts the containers of Dockers (by the Linux kernel and
libvirt, LXC and systemd-nspawn)</li>
<li>Mirantis Container Runtime</li>
</ul>
</div>
</div>
<div id="outline-container-org1cbc46c" class="outline-4">
<h4 id="org1cbc46c"><span class="section-number-4">8.5.4.</span> istio</h4>
<div class="outline-text-4" id="text-8-5-4">
<p>
<b>service mesh</b> is a service-to-service communications between services. Is an abstraction layer over
 the underlying cluster management platform, such as Kubernete.
</p>
<ul class="org-ul">
<li>Service Mesh is the cloud native equivalent of TCP/IP, addressing application network communication,
security and visibility issues.</li>
<li>istio is relying on Kubernetes but also scalable to virtual machine loads.</li>
<li>Istio’s core consists of a control plane and a data plane, with Envoy as the default data-plane agent.</li>
</ul>

<p>
Empower K8s: intelligent routing, automatic load balancing, fine-grained access control, traffic
 encryption, and policy enforcement. They also enable powerful observability capabilities, including
 request tracing, metric collection, and distributed logging
</p>

<p>
Istio for Kubernetes is built right into the app and keeps track of how the different parts of the
 app interact with each other.
</p>

<p>
<a href="https://github.com/istio/istio">https://github.com/istio/istio</a>
</p>
</div>
</div>
<div id="outline-container-orgb723669" class="outline-4">
<h4 id="orgb723669"><span class="section-number-4">8.5.5.</span> user namespaces</h4>
<div class="outline-text-4" id="text-8-5-5">
<p>
Linux namespaces - feature of the Linux kernel. It makes: one set of processes sees one set of
 resources while another set of processes sees a different set of resources.
</p>
</div>
</div>
<div id="outline-container-org42efe29" class="outline-4">
<h4 id="org42efe29"><span class="section-number-4">8.5.6.</span> links</h4>
<div class="outline-text-4" id="text-8-5-6">
<ul class="org-ul">
<li>Node and pods <a href="https://kubernetes.io/docs/tutorials/kubernetes-basics/explore/explore-intro/">https://kubernetes.io/docs/tutorials/kubernetes-basics/explore/explore-intro/</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org91b7c3e" class="outline-3">
<h3 id="org91b7c3e"><span class="section-number-3">8.6.</span> ЦФТ обучение (to delete)</h3>
<div class="outline-text-3" id="text-8-6">
<ul class="org-ul">
<li>\\srv-file\Share\DEV\Обучение\AML</li>

<li>k create deployment nginx &#x2013;image=nginx - создать pod c одной репликой</li>
<li>k scale deployment nginx &#x2013;replicas 3  - реплики 3</li>
</ul>

<p>
pod name - nginx-(HashOfConfiguration)-randomValue
</p>

<p>
Deployments
</p>
<ul class="org-ul">
<li>случайные имена</li>
<li>чтобы мы не делали сервис будет работать</li>
</ul>

<p>
StatefulSet
DaemonSets
Job - при инициализации приложения
</p>
</div>
</div>

<div id="outline-container-org16ee927" class="outline-3">
<h3 id="org16ee927"><span class="section-number-3">8.7.</span> master and worker node (rusnarbank)</h3>
<div class="outline-text-3" id="text-8-7">
<p>
linux
</p>
<ul class="org-ul">
<li>kubelet - node and master - взаимодействуют с API-сервером и подписываются на выставленные
данных scheduler-oм</li>
<li>kube-proxy - отвечает за настройку iptables</li>
<li>Kubernetes CRI Container Runtime Interface
<ul class="org-ul">
<li>на dev - docker CRI shim</li>
<li>prod - CRI-O</li>
</ul></li>
<li>Addons дополнительные компоненты worker - kubectl -n kube-system get pods
<ul class="org-ul">
<li>fluent-d - logging - Cluster-level Logging</li>
<li>weave addon - creates a virtual network that connects containers across multiple hosts and enables their
automatic discovery</li>
<li>coredns addon</li>
<li>ambasador API gateway</li>
</ul></li>
</ul>

<p>
master
</p>
<ul class="org-ul">
<li>kube-apiserver - API Server - все взаимодействие с k8s</li>
<li>kube-controller-manager - Controller manager - reconsilation loop</li>
<li>kube-scheduler - Scheduler - оценить на какой ноде должен быть запущен контейнер</li>
<li>etcd - distributed key-value store, у значений есть версия. Optimistic concurrency control</li>
</ul>
</div>

<div id="outline-container-orgedddf16" class="outline-4">
<h4 id="orgedddf16"><span class="section-number-4">8.7.1.</span> kubelet</h4>
<div class="outline-text-4" id="text-8-7-1">
<p>
<a href="https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet/">https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet/</a>
</p>

<p>
сервис запускается в самой хостовой системе через systemd
</p>

<p>
мониторит pods
</p>
</div>
</div>

<div id="outline-container-org429ee62" class="outline-4">
<h4 id="org429ee62"><span class="section-number-4">8.7.2.</span> есть кластеры:</h4>
<div class="outline-text-4" id="text-8-7-2">
<ol class="org-ol">
<li>AML dev</li>
<li>AML prod</li>
<li>norma2 test 2 masters</li>
<li>norma2 prod 3 masters</li>
</ol>

<p>
Grafana, Prometeus - мониторинг кубернетиса
</p>
</div>
</div>
</div>
<div id="outline-container-org4b7fd3e" class="outline-3">
<h3 id="org4b7fd3e"><span class="section-number-3">8.8.</span> Ansible</h3>
<div class="outline-text-3" id="text-8-8">
<p>
Используется для развертывания подов на виртуалках. Kubernetes cluster on bare-metal or VMs.
</p>

<p>
Использует Vagrant?
</p>

<p>
Playbooks are Ansible’s configuration, deployment, and orchestration language.  playbooks are your instruction manuals
</p>
</div>
</div>

<div id="outline-container-orgad804c8" class="outline-3">
<h3 id="orgad804c8"><span class="section-number-3">8.9.</span> from image to pod:</h3>
<div class="outline-text-3" id="text-8-9">
<ul class="org-ul">
<li>web server - gitlab registry</li>
<li>Scheduler - command to kubelet</li>
<li>kubelet use cri (Container Runtime Interface) to pull nodes</li>
</ul>
</div>
</div>
<div id="outline-container-org13b8b53" class="outline-3">
<h3 id="org13b8b53"><span class="section-number-3">8.10.</span> primary/replica architecture (Master/slave):</h3>
<div class="outline-text-3" id="text-8-10">
<p>
master - one or many nodes - control plane
</p>
<ul class="org-ul">
<li>etcd - distributed key-value data store stores the configuration (like Apache ZooKeeper)</li>
<li>API server - internal and external interface - REST JSON over HTTP</li>
<li>Scheduler - запускает pods на node based on resource availability - match resource "supply" to workload "demand"</li>
<li>Controller manager - communicating with the API server to create, update, and delete the resources it
manages (pods, service endpoints, etc.).
<ul class="org-ul">
<li>Replication Controller - handles replication and scaling</li>
<li>Autosclaer - use metrics from Prometheus чтобы подстроить количество репли к количеству запросов</li>
</ul></li>
</ul>

<p>
node or Worker -
</p>
<ul class="org-ul">
<li>Kubelet - starting, stopping, and maintaining application containers organized into pods</li>
<li>Kube-proxy (network proxy and a load balancer) - routing traffic to the appropriate container</li>
<li><b>Container runtime</b> - must implement Container Runtime Interface (CRI) - Most <b>container runtime environments</b>
use <b>runc</b>.
<ul class="org-ul">
<li>Docker</li>
<li>CRI-O</li>
<li>Containerd</li>
<li>Other CRI runtimes: frakti</li>
</ul></li>
</ul>

<p>
<b>runc</b> provide OCI API. Kubelet communicate with the container runtime via the CRI’s gRPC interface.
</p>
</div>
</div>
<div id="outline-container-orgf048575" class="outline-3">
<h3 id="orgf048575"><span class="section-number-3">8.11.</span> CAP theorem</h3>
<div class="outline-text-3" id="text-8-11">
<p>
<b>it is impossible for a distributed data store to simultaneously provide more than two out of the following
 three guarantees:</b>
</p>
<ul class="org-ul">
<li>Consistency: Every read receives the most recent write or an error</li>
<li>Availability: Every request receives a (non-error) response, without the guarantee that it contains the most recent write</li>
<li>Partition tolerance: The system continues to operate despite an arbitrary number of messages being dropped (or delayed) by the network between nodes</li>
</ul>
</div>
</div>
<div id="outline-container-org06494d6" class="outline-3">
<h3 id="org06494d6"><span class="section-number-3">8.12.</span> runC</h3>
<div class="outline-text-3" id="text-8-12">
<ul class="org-ul">
<li><a href="https://habr.com/ru/company/selectel/blog/316258/">https://habr.com/ru/company/selectel/blog/316258/</a></li>
<li>libcontainer, которая по сути является частью runc, используется в Docker вместо LXC</li>
</ul>
</div>
</div>
<div id="outline-container-org6f930c8" class="outline-3">
<h3 id="org6f930c8"><span class="section-number-3">8.13.</span> ReplicationControllerо</h3>
<div class="outline-text-3" id="text-8-13">
<p>
homogeneous ˌhōməˈjēnēəs - однородная система
heterogeneous <i>ˌhɛt(ə)rə(ʊ)ˈdʒiːnɪəs</i> - неоднородная система
</p>
</div>
</div>
<div id="outline-container-org2de9791" class="outline-3">
<h3 id="org2de9791"><span class="section-number-3">8.14.</span> app logs</h3>
<div class="outline-text-3" id="text-8-14">
<ul class="org-ul">
<li><a href="https://vzurczak.wordpress.com/2019/02/13/using-graylog-for-centralized-logs-in-k8s-platforms-and-permissions-management/">https://vzurczak.wordpress.com/2019/02/13/using-graylog-for-centralized-logs-in-k8s-platforms-and-permissions-management/</a></li>
</ul>
<p>
3 variants:
</p>
<ul class="org-ul">
<li>letting applications directly output their traces in other systems</li>
<li>collector per pod</li>
<li>collector per node - this</li>
</ul>

<p>
Two architectures for log managements:
</p>
<ol class="org-ol">
<li>"Elastic Stack" (formerly the "ELK stack") (products for Elastic Search):
<ul class="org-ul">
<li>Logstash - data collection and log-parsing engine</li>
<li>Kibana - visualisation platform</li>
<li>?</li>
<li>?</li>
</ul></li>
<li>Graylog - three-tier architecture and scalable storage (based on Elasticsearch - its backend)</li>
</ol>

<p>
Collecting logs per node - Logstash or (FileBeat, Fluentd, Fluent Bit…)
</p>
</div>
</div>

<div id="outline-container-orgafc421f" class="outline-3">
<h3 id="orgafc421f"><span class="section-number-3">8.15.</span> Helm - Пакетный менеджер</h3>
<div class="outline-text-3" id="text-8-15">
<p>
Think of it like apt/yum/homebrew for Kubernetes.
</p>

<ul class="org-ul">
<li>Container: Container refers to operating system level virtualization</li>
<li>Docker: Docker is a popular program to create and run containers</li>
<li>Kubernetes: Kubernetes is a popular container orchestration program.</li>
</ul>

<p>
Helm cnsist of:
</p>
<ul class="org-ul">
<li>Tiller Server: installed within a Kubernates cluster - interacts with the Kubernetes API server to install,
upgrade, query and remove Kubernetes resources</li>
<li>Client: command-line interface - install, upgrade and rollback charts</li>
</ul>

<p>
Charts - Kubernetes resources package
</p>
<ul class="org-ul">
<li>collection of files</li>
<li>configuration</li>
</ul>

<p>
Release - running instance of a chart
</p>
</div>
<div id="outline-container-org0b2143e" class="outline-4">
<h4 id="org0b2143e"><span class="section-number-4">8.15.1.</span> .helm</h4>
<div class="outline-text-4" id="text-8-15-1">
<ul class="org-ul">
<li>Chart.yaml : This is the main file that contains the description of our chart</li>
<li>values.yaml : this is the file that contains the default values for our chart</li>
<li>templates/ : This is the directory where Kubernetes resources are defined as templates</li>
<li>.helmignore: patterns to ignore when packaging (similar in concept to .gitignore)</li>
</ul>

<p>
Template:
</p>
</div>
</div>

<div id="outline-container-orge2c2d0a" class="outline-4">
<h4 id="orge2c2d0a"><span class="section-number-4">8.15.2.</span> links</h4>
<div class="outline-text-4" id="text-8-15-2">
<ul class="org-ul">
<li><a href="https://github.com/helm/helm">https://github.com/helm/helm</a></li>
<li><a href="https://www.baeldung.com/kubernetes-helm">https://www.baeldung.com/kubernetes-helm</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org43d45ae" class="outline-3">
<h3 id="org43d45ae"><span class="section-number-3">8.16.</span> cluster management software</h3>
<div class="outline-text-3" id="text-8-16">
<p>
<a href="https://en.wikipedia.org/wiki/List_of_cluster_management_software">https://en.wikipedia.org/wiki/List_of_cluster_management_software</a>
</p>
<ul class="org-ul">
<li>Kubernetes - google</li>
<li>Docker Swarm</li>
<li>CoreOS</li>
<li>Mesos – Apache</li>
</ul>
</div>
</div>
<div id="outline-container-orgb6b6c58" class="outline-3">
<h3 id="orgb6b6c58"><span class="section-number-3">8.17.</span> как могут поды иметь свои IP ведь они на одной ноде</h3>
<div class="outline-text-3" id="text-8-17">
<p>
оверлейная сеть
</p>
</div>
</div>

<div id="outline-container-orgd306a2d" class="outline-3">
<h3 id="orgd306a2d"><span class="section-number-3">8.18.</span> kubectl</h3>
<div class="outline-text-3" id="text-8-18">
</div>
<div id="outline-container-org7545625" class="outline-4">
<h4 id="org7545625"><span class="section-number-4">8.18.1.</span> theory</h4>
<div class="outline-text-4" id="text-8-18-1">
<p>
Config: uses $HOME/.kube/ or $KUBECONFIG or &#x2013;kubeconfig or direct connect
</p>

<p>
to see config:
</p>
<pre class="example">
kubectl config view
</pre>


<p>
direct connect:
</p>
<div class="org-src-container">
<pre class="src src-sh">kubectl get nodes <span style="color: #95e454;">\</span>
    --server https://localhost:6443 <span style="color: #95e454;">\</span>
    --user docker-for-desktop <span style="color: #95e454;">\</span>
    --client-certificate my.cert <span style="color: #95e454;">\</span>
    --client-key my.key <span style="color: #95e454;">\</span>
    --insecure-skip-tls-verify
</pre>
</div>

<p>
kubectl [command] [TYPE] [NAME] [flags]
</p>
<dl class="org-dl">
<dt>TYPE</dt><dd>Specifies the resource type.</dd>
<dt>flags</dt><dd>Specifies optional flags. For example, you can use the -s or &#x2013;server</dd>
</dl>
</div>
</div>
<div id="outline-container-orgc7d89ff" class="outline-4">
<h4 id="orgc7d89ff"><span class="section-number-4">8.18.2.</span> kubectl get</h4>
<div class="outline-text-4" id="text-8-18-2">
<ul class="org-ul">
<li><b>all</b></li>
</ul>
<p>
NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
service/kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP   307d
</p>
<ul class="org-ul">
<li><b>namespaces</b></li>
</ul>
</div>
</div>

<div id="outline-container-org8e707e6" class="outline-4">
<h4 id="org8e707e6"><span class="section-number-4">8.18.3.</span> Viewing and finding resources</h4>
<div class="outline-text-4" id="text-8-18-3">
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Get commands with basic output</span>
kubectl get services                          <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">List all services in the namespace</span>
kubectl get pods --all-namespaces             <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">List all pods in all namespaces</span>
kubectl get pods -o wide                      <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">List all pods in the current namespace, with more details</span>
kubectl get deployment my-dep                 <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">List a particular deployment</span>
kubectl get pods                              <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">List all pods in the namespace</span>
kubectl get pod my-pod -o yaml                <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Get a pod's YAML</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Describe commands with verbose output</span>
kubectl describe nodes my-node
kubectl describe pods my-pod

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">List Services Sorted by Name</span>
kubectl get services --sort-by=.metadata.name

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">List pods Sorted by Restart Count</span>
kubectl get pods --sort-by=<span style="color: #95e454;">'.status.containerStatuses[0].restartCount'</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">List PersistentVolumes sorted by capacity</span>
kubectl get pv --sort-by=.spec.capacity.storage

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Get the version label of all pods with label app=cassandra</span>
kubectl get pods --selector=<span style="color: #cae682;">app</span>=cassandra -o <span style="color: #95e454;">\</span>
  <span style="color: #cae682;">jsonpath</span>=<span style="color: #95e454;">'{.items[*].metadata.labels.version}'</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Retrieve the value of a key with dots, e.g. 'ca.crt'</span>
kubectl get configmap myconfig <span style="color: #95e454;">\</span>
  -o <span style="color: #cae682;">jsonpath</span>=<span style="color: #95e454;">'{.data.ca\.crt}'</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Retrieve a base64 encoded value with dashes instead of underscores.</span>
kubectl get secret my-secret --template=<span style="color: #95e454;">'{{index .data "key-name-with-dashes"}}'</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Get all worker nodes (use a selector to exclude results that have a label</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">named 'node-role.kubernetes.io/control-plane')</span>
kubectl get node --selector=<span style="color: #95e454;">'!node-role.kubernetes.io/control-plane'</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Get all running pods in the namespace</span>
kubectl get pods --field-selector=status.phase=Running

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Get ExternalIPs of all nodes</span>
kubectl get nodes -o <span style="color: #cae682;">jsonpath</span>=<span style="color: #95e454;">'{.items[*].status.addresses[?(@.type=="ExternalIP")].address}'</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">List Names of Pods that belong to Particular RC</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">"jq" command useful for transformations that are too complex for jsonpath, it can be found at https://stedolan.github.io/jq/</span>
<span style="color: #cae682;">sel</span>=${<span style="color: #cae682;">$</span>(<span style="color: #fa8072;">kubectl get rc my-rc --output=json | jq -j '.spec.selector | to_entries | .[] | "\(.key</span><span style="color: #95e454;">)=\(.value),"'</span>)%?}
<span style="color: #e5786d;">echo</span> $(<span style="color: #fa8072;">kubectl get pods --selector=$sel --output=jsonpath={.items..metadata.name}</span>)

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Show labels for all pods (or any other Kubernetes object that supports labelling)</span>
kubectl get pods --show-labels

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Check which nodes are ready</span>
<span style="color: #cae682;">JSONPATH</span>=<span style="color: #95e454;">'{range .items[*]}{@.metadata.name}:{range @.status.conditions[*]}{@.type}={@.status};{end}{end}'</span> <span style="color: #95e454;">\</span>
 &amp;&amp; kubectl get nodes -o <span style="color: #cae682;">jsonpath</span>=<span style="color: #95e454;">"$JSONPATH"</span> | grep <span style="color: #95e454;">"Ready=True"</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Output decoded secrets without external tools</span>
kubectl get secret my-secret -o go-template=<span style="color: #95e454;">'{{range $k,$v := .data}}{{"### "}}{{$k}}{{"\n"}}{{$v|base64decode}}{{"\n\n"}}{{end}}'</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">List all Secrets currently in use by a pod</span>
kubectl get pods -o json | jq <span style="color: #95e454;">'.items[].spec.containers[].env[]?.valueFrom.secretKeyRef.name'</span> | grep -v null | sort | uniq

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">List all containerIDs of initContainer of all pods</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Helpful when cleaning up stopped containers, while avoiding removal of initContainers.</span>
kubectl get pods --all-namespaces -o <span style="color: #cae682;">jsonpath</span>=<span style="color: #95e454;">'{range .items[*].status.initContainerStatuses[*]}{.containerID}{"\n"}{end}'</span> | cut -d/ -f3

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">List Events sorted by timestamp</span>
kubectl get events --sort-by=.metadata.creationTimestamp

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">List all warning events</span>
kubectl events --types=Warning

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Compares the current state of the cluster against the state that the cluster would be in if the manifest was applied.</span>
kubectl diff -f ./my-manifest.yaml

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Produce a period-delimited tree of all keys returned for nodes</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Helpful when locating a key within a complex nested JSON structure</span>
kubectl get nodes -o json | jq -c <span style="color: #95e454;">'paths|join(".")'</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Produce a period-delimited tree of all keys returned for pods, etc</span>
kubectl get pods -o json | jq -c <span style="color: #95e454;">'paths|join(".")'</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Produce ENV for all pods, assuming you have a default container for the pods, default namespace and the `env` command is supported.</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Helpful when running any supported command across all pods, not just `env`</span>
<span style="color: #8ac6f2; font-weight: bold;">for</span> pod<span style="color: #8ac6f2; font-weight: bold;"> in</span> $(<span style="color: #fa8072;">kubectl get po --output=jsonpath={.items..metadata.name}</span>); <span style="color: #8ac6f2; font-weight: bold;">do </span><span style="color: #e5786d;">echo</span> $<span style="color: #cae682;">pod</span> &amp;&amp; kubectl exec -it $<span style="color: #cae682;">pod</span> -- env; <span style="color: #8ac6f2; font-weight: bold;">done</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Get a deployment's status subresource</span>
kubectl get deployment nginx-deployment --subresource=status

</pre>
</div>
</div>
</div>
<div id="outline-container-orgb6a4b43" class="outline-4">
<h4 id="orgb6a4b43"><span class="section-number-4">8.18.4.</span> request step by step</h4>
<div class="outline-text-4" id="text-8-18-4">
<pre class="example">
kubectl config view - cat  /etc/kubernetes/kubelet.conf
</pre>


<p>
By default, the Kubernetes API server listens on port 6443 on the first non-localhost network interface, protected by TLS.
</p>

<p>
kube-apiserver is pods
</p>
</div>
</div>
</div>
<div id="outline-container-org09aba46" class="outline-3">
<h3 id="org09aba46"><span class="section-number-3">8.19.</span> kubeadm</h3>
<div class="outline-text-3" id="text-8-19">
<p>
<b>kubeadm init</b> and <b>kubeadm join</b> as best-practice "fast paths" for creating Kubernetes clusters.
</p>
<ul class="org-ul">
<li><b>kubeadm init</b> to bootstrap a Kubernetes control-plane node</li>
<li><b>kubeadm join</b> to bootstrap a Kubernetes worker node and join it to the cluster</li>
</ul>
</div>
</div>
<div id="outline-container-org861916e" class="outline-3">
<h3 id="org861916e"><span class="section-number-3">8.20.</span> well-known values and paths</h3>
<div class="outline-text-3" id="text-8-20">
<ul class="org-ul">
<li>/etc/kubernetes/manifests as the path where kubelet should look for static Pod manifests.</li>
</ul>
</div>
</div>
<div id="outline-container-org98083e1" class="outline-3">
<h3 id="org98083e1"><span class="section-number-3">8.21.</span> Installation steps</h3>
<div class="outline-text-3" id="text-8-21">
<ol class="org-ol">
<li>Verify the MAC address and product<sub>uuid</sub> are unique for every node
<ol class="org-ol">
<li>ip link or ifconfig -a</li>
<li>cat /sys/class/dmi/id/product<sub>uuid</sub></li>
</ol></li>
<li>check that required ports for master and worker nodes are open and don't blocked by firewall</li>
<li>Installing a <b>container runtime</b>, most common:
<ul class="org-ul">
<li>containerd - began as part of Docker</li>
<li>CRI-O</li>
<li>Docker Engine</li>
<li>Mirantis Container Runtime</li>
</ul></li>
<li>Installing kubeadm, kubelet and kubectl</li>
<li>Configuring a <b>cgroup</b> driver - isolates the resource usage (CPU, memory, disk I/O, etc.) of a
collection of processes.</li>
<li>Creating a cluster with kubeadm <a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/">https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/</a>
<ol class="org-ol">
<li>install to provisioning systems such as Ansible or Terraform or on your own.</li>
<li></li>
</ol></li>
</ol>
</div>
</div>
<div id="outline-container-orgaf5cc61" class="outline-3">
<h3 id="orgaf5cc61"><span class="section-number-3">8.22.</span> .bashrc</h3>
<div class="outline-text-3" id="text-8-22">
<p>
apt-get install bash-completion
</p>

<pre class="example">
## Install
apt-get install bash-completion
## Bash
echo 'source &lt;(kubectl completion bash)' &gt;&gt;~/.bashrc

echo 'alias k="kubectl"' &gt;&gt;~/.bashrc

</pre>
</div>
</div>
<div id="outline-container-org070fbae" class="outline-3">
<h3 id="org070fbae"><span class="section-number-3">8.23.</span> common shorts</h3>
<div class="outline-text-3" id="text-8-23">
<ul class="org-ul">
<li>ns	namespaces</li>
<li>componentstatuses	cs</li>
<li>configmaps	cm</li>
<li>endpoints	ep</li>
<li>events	ev</li>
<li>limitranges	limits</li>
<li>namespaces	ns</li>
<li>nodes	no</li>
<li>persistentvolumeclaims	pvc</li>
<li>persistentvolumes	pv</li>
<li>pods	po</li>
<li>replicationcontrollers	rc</li>
<li>resourcequotas	quota</li>
<li>serviceaccounts	sa</li>
<li>services	svc</li>
<li>customresourcedefinitions	crd, crds</li>
<li>daemonsets	ds</li>
<li>deployments	deploy</li>
<li>replicasets	rs</li>
<li>statefulsets	sts</li>
<li>horizontalpodautoscalers	hpa</li>
<li>cronjobs	cj</li>
<li>certificiaterequests	cr, crs</li>
<li>certificates	cert, certs</li>
<li>certificatesigningrequests	csr</li>
<li>ingresses	ing</li>
<li>networkpolicies	netpol</li>
<li>podsecuritypolicies	psp</li>
<li>replicasets	rs</li>
<li>scheduledscalers	ss</li>
<li>priorityclasses	pc</li>
<li>storageclasses	sc</li>
</ul>
</div>
</div>

<div id="outline-container-org717cae5" class="outline-3">
<h3 id="org717cae5"><span class="section-number-3">8.24.</span> role-based access control (RBAC) policy</h3>
<div class="outline-text-3" id="text-8-24">
<p>
establish what resources a given role is able to access. Implement principle of least privilege.
</p>
<pre class="example">
kubectl auth can-i '*' '*' # allowed commands
</pre>
</div>
</div>

<div id="outline-container-orgb609ff9" class="outline-3">
<h3 id="orgb609ff9"><span class="section-number-3">8.25.</span> system maintentance</h3>
<div class="outline-text-3" id="text-8-25">
<p>
kube-system - namespace for system services
</p>
<pre class="example">
k -n kube-system get all
</pre>
</div>
</div>
<div id="outline-container-orgb974d2a" class="outline-3">
<h3 id="orgb974d2a"><span class="section-number-3">8.26.</span> Usage My</h3>
<div class="outline-text-3" id="text-8-26">
<p>
alias k=kubectl
</p>
</div>

<div id="outline-container-orgdd193af" class="outline-4">
<h4 id="orgdd193af"><span class="section-number-4">8.26.1.</span> explore</h4>
<div class="outline-text-4" id="text-8-26-1">
<div class="org-src-container">
<pre class="src src-sh">kubectl config view <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">cat /etc/kubernetes/kubelet.conf</span>
kubectl cluster-info &amp; kubectl cluster-info dump <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">more info</span>
kubectl get nodes
kubectl describe node kube-worker-1
k logs -n kube-system kube-apiserver... <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">get pod description</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">get containers in pod:</span>
kubectl get pod --namespace=kube-system coredns-d46f87476-c5r4m  -o <span style="color: #cae682;">jsonpath</span>=<span style="color: #95e454;">'{.spec.containers[*].name}'</span>

k get pods -n ml1 -o wide <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">get pods in namespace</span>
k get -n ml1 pod paramserv-worker-0 -o yaml <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">get yaml of pod</span>
k get ns <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">&#1074;&#1089;&#1077; &#1085;&#1077;&#1081;&#1084;&#1089;&#1087;&#1077;&#1081;&#1089;&#1099;</span>
k -n aml get all <span style="color: #fa8072;">#  </span><span style="color: #99968b; font-style: italic;">&#1074;&#1089;&#1077; &#1074; &#1085;&#1077;&#1081;&#1084;&#1089;&#1087;&#1077;&#1081;&#1089;&#1077;</span>
k -n aml exec -it front-77d466758c-ttpfj -- sh
k -n aml describe pods/podname <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">detailed information about a resource</span>
k -n aml get configmap provodki-app-cm-env -o yaml <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">configmap for pod - Labels - &#1082;&#1083;&#1102;&#1095; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077;</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">-- #</span>
k get pod podname <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Verify that the container is running</span>
k exec --stdin --tty podname -- /bin/bash       <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">access to pod=podname</span>
k exec -it podname -- /bin/bash         <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">access to pod=podname</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd4eb0ea" class="outline-4">
<h4 id="orgd4eb0ea"><span class="section-number-4">8.26.2.</span> manage</h4>
<div class="outline-text-4" id="text-8-26-2">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">-- test</span>
k -n ml1 apply --dry-run=<span style="color: #95e454;">'client'</span> -f a.yaml: <span style="color: #fa8072;">#  </span><span style="color: #99968b; font-style: italic;">Must be "none", "server", or "client"</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">-- control resources</span>
k -n ml1 delete -f ./ML1/k8s/paramserv.yaml
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">force delete pod in Terminated state:</span>
kubectl delete pod paramserv-ps-0 -n ml1 --grace-period=0 --force

k -n ml1 apply -f ./ML1/k8s/paramserv.yaml <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">creating a pod</span>
kubectl replace --force -f ./ML1/k8s/paramserv.yaml <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">delete + apply</span>

kubectl scale deployment [deployment_name] --replicas=0 <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">change count of replicas</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">disable node for scheduling</span>
kubectl label node kube-exp-w3.k8s.sumus.work GPU-

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">add label to pod</span>
kubectl label pods foo <span style="color: #cae682;">unhealthy</span>=true
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga50be96" class="outline-3">
<h3 id="orga50be96"><span class="section-number-3">8.27.</span> USAGE (max prokopenko)</h3>
<div class="outline-text-3" id="text-8-27">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Get-&#1082;&#1086;&#1084;&#1072;&#1085;&#1076;&#1099; &#1089; &#1086;&#1089;&#1085;&#1086;&#1074;&#1085;&#1086;&#1084; &#1074;&#1099;&#1074;&#1086;&#1076;&#1086;&#1084;</span>
kubectl get services <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">&#1042;&#1099;&#1074;&#1077;&#1089;&#1090;&#1080; &#1074;&#1089;&#1077; &#1089;&#1077;&#1088;&#1074;&#1080;&#1089;&#1099; &#1074; &#1087;&#1088;&#1086;&#1089;&#1090;&#1088;&#1072;&#1085;&#1089;&#1090;&#1074;&#1077; &#1080;&#1084;&#1105;&#1085;</span>
kubectl get pods --all-namespaces <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">&#1042;&#1099;&#1074;&#1077;&#1089;&#1090;&#1080; &#1074;&#1089;&#1077; &#1087;&#1086;&#1076;&#1099; &#1074;&#1086; &#1074;&#1089;&#1077;&#1093; &#1087;&#1088;&#1086;&#1089;&#1090;&#1088;&#1072;&#1085;&#1089;&#1090;&#1074; &#1080;&#1084;&#1105;&#1085;</span>
kubectl get pods -o wide <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">&#1042;&#1099;&#1074;&#1077;&#1089;&#1090;&#1080; &#1074;&#1089;&#1077; &#1087;&#1086;&#1076;&#1099; &#1074; &#1090;&#1077;&#1082;&#1091;&#1097;&#1077;&#1084; &#1087;&#1088;&#1086;&#1089;&#1090;&#1088;&#1072;&#1085;&#1089;&#1090;&#1074;&#1077; &#1080;&#1084;&#1105;&#1085; &#1089;</span>
&#1087;&#1086;&#1076;&#1088;&#1086;&#1073;&#1085;&#1086;&#1089;&#1090;&#1103;&#1084;&#1080;
kubectl get deployment my-dep <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">&#1042;&#1099;&#1074;&#1077;&#1089;&#1090;&#1080; &#1086;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1105;&#1085;&#1085;&#1086;&#1077; &#1088;&#1072;&#1079;&#1074;&#1105;&#1088;&#1090;&#1099;&#1074;&#1072;&#1085;&#1080;&#1077;</span>
kubectl get pods <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">&#1042;&#1099;&#1074;&#1077;&#1089;&#1090;&#1080; &#1074;&#1089;&#1077; &#1087;&#1086;&#1076;&#1099; &#1074; &#1087;&#1088;&#1086;&#1089;&#1090;&#1088;&#1072;&#1085;&#1089;&#1090;&#1074;&#1077; &#1080;&#1084;&#1105;&#1085;</span>
kubectl get pod my-pod -o yaml <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">&#1055;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100; &#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1102; &#1087;&#1086; &#1087;&#1086;&#1076;&#1091; &#1074; &#1092;&#1086;&#1088;&#1084;&#1072;&#1090;&#1077; YAML</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">&#1055;&#1086;&#1089;&#1084;&#1086;&#1090;&#1088;&#1077;&#1090;&#1100; &#1076;&#1086;&#1087;&#1086;&#1083;&#1085;&#1080;&#1090;&#1077;&#1083;&#1100;&#1085;&#1099;&#1077; &#1089;&#1074;&#1077;&#1076;&#1077;&#1085;&#1080;&#1103; &#1082;&#1086;&#1084;&#1072;&#1085;&#1076;&#1099; &#1089; &#1084;&#1085;&#1086;&#1075;&#1086;&#1089;&#1083;&#1086;&#1074;&#1085;&#1099;&#1084; &#1074;&#1099;&#1074;&#1086;&#1076;&#1086;&#1084;</span>
kubectl describe nodes my-node
kubectl describe pods my-pod
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">&#1042;&#1099;&#1074;&#1077;&#1089;&#1090;&#1080; &#1089;&#1077;&#1088;&#1074;&#1080;&#1089;&#1099;, &#1086;&#1090;&#1089;&#1086;&#1088;&#1090;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1085;&#1099;&#1077; &#1087;&#1086; &#1080;&#1084;&#1077;&#1085;&#1080;</span>
kubectl get services --sort-by=.metadata.name
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">&#1042;&#1099;&#1074;&#1077;&#1089;&#1090;&#1080; &#1087;&#1086;&#1076;&#1099;, &#1086;&#1090;&#1089;&#1086;&#1088;&#1090;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1085;&#1099;&#1077; &#1087;&#1086; &#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1091; &#1087;&#1077;&#1088;&#1077;&#1079;&#1072;&#1075;&#1088;&#1091;&#1079;&#1086;&#1082;</span>
kubectl get pods --sort-by=<span style="color: #95e454;">'.status.containerStatuses[0].restartCount'</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">&#1042;&#1099;&#1074;&#1077;&#1089;&#1090;&#1080; &#1087;&#1086;&#1089;&#1090;&#1086;&#1103;&#1085;&#1085;&#1099;&#1077; &#1090;&#1086;&#1084;&#1072; (PersistentVolumes), &#1086;&#1090;&#1089;&#1086;&#1088;&#1090;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1085;&#1099;&#1077; &#1087;&#1086; &#1077;&#1084;&#1082;&#1086;&#1089;&#1090;&#1080;</span>
kubectl get pv --sort-by=.spec.capacity.storage
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">&#1055;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100; &#1084;&#1077;&#1090;&#1082;&#1091; &#1074;&#1077;&#1088;&#1089;&#1080;&#1080; &#1074;&#1089;&#1077;&#1093; &#1087;&#1086;&#1076;&#1086;&#1074; &#1089; &#1084;&#1077;&#1090;&#1082;&#1086;&#1081; app=cassandra</span>
kubectl get pods --selector=<span style="color: #cae682;">app</span>=cassandra -o <span style="color: #95e454;">\</span>
<span style="color: #cae682;">jsonpath</span>=<span style="color: #95e454;">'{.items[*].metadata.labels.version}'</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">&#1055;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100; &#1074;&#1089;&#1077; &#1088;&#1072;&#1073;&#1086;&#1095;&#1080;&#1077; &#1091;&#1079;&#1083;&#1099; (&#1089; &#1087;&#1086;&#1084;&#1086;&#1097;&#1100;&#1102; &#1089;&#1077;&#1083;&#1077;&#1082;&#1090;&#1086;&#1088;&#1072; &#1080;&#1089;&#1082;&#1083;&#1102;&#1095;&#1072;&#1077;&#1084; &#1091;&#1079;&#1083;&#1099; &#1089; &#1084;&#1077;&#1090;&#1082;&#1086;&#1081; 'node-role.kubernetes.io/master')</span>
kubectl get node --selector=<span style="color: #95e454;">'!node-role.kubernetes.io/master'</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">&#1055;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100; &#1074;&#1089;&#1077; &#1079;&#1072;&#1087;&#1091;&#1097;&#1077;&#1085;&#1085;&#1099;&#1077; &#1087;&#1086;&#1076;&#1099; &#1074; &#1087;&#1088;&#1086;&#1089;&#1090;&#1088;&#1072;&#1085;&#1089;&#1090;&#1074;&#1077; &#1080;&#1084;&#1105;&#1085;</span>
kubectl get pods --field-selector=status.phase=Running
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">&#1055;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100; &#1074;&#1085;&#1077;&#1096;&#1085;&#1080;&#1077; IP-&#1072;&#1076;&#1088;&#1077;&#1089;&#1072; (ExternalIP) &#1074;&#1089;&#1077;&#1093; &#1091;&#1079;&#1083;&#1086;&#1074;</span>
kubectl get nodes -o <span style="color: #cae682;">jsonpath</span>=<span style="color: #95e454;">'{.items[*].status.addresses[?(@.type=="ExternalIP")].address}'</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">&#1042;&#1099;&#1074;&#1077;&#1089;&#1090;&#1080; &#1080;&#1084;&#1077;&#1085;&#1072; &#1087;&#1086;&#1076;&#1086;&#1074;, &#1087;&#1088;&#1080;&#1085;&#1072;&#1076;&#1083;&#1077;&#1078;&#1072;&#1097;&#1080;&#1077; &#1082; &#1086;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1105;&#1085;&#1085;&#1086;&#1084;&#1091; RC</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">&#1048;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1085;&#1080;&#1077; &#1082;&#1086;&#1084;&#1072;&#1085;&#1076;&#1099; "jq" &#1087;&#1086;&#1084;&#1086;&#1075;&#1072;&#1077;&#1090; &#1091;&#1087;&#1088;&#1086;&#1089;&#1080;&#1090;&#1100; &#1087;&#1086;&#1080;&#1089;&#1082; &#1074; jsonpath, &#1087;&#1086;&#1076;&#1088;&#1086;&#1073;&#1085;&#1077;&#1077; &#1089;&#1084;&#1086;&#1090;&#1088;&#1080;&#1090;&#1077; &#1085;&#1072; &#1089;&#1072;&#1081;&#1090;&#1077; https://stedolan.github.io/jq/</span>
<span style="color: #cae682;">sel</span>=${<span style="color: #cae682;">$</span>(<span style="color: #fa8072;">kubectl get rc my-rc --output=json | jq -j '.spec.selector | to_entries | .[] | "\(.key</span><span style="color: #95e454;">)=\(.value),"'</span> )%? }
<span style="color: #e5786d;">echo</span> $(<span style="color: #fa8072;">kubectl get pods --selector=$sel --output=jsonpath={.items..metadata.name}</span>)
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">&#1055;&#1086;&#1082;&#1072;&#1079;&#1072;&#1090;&#1100; &#1084;&#1077;&#1090;&#1082;&#1080; &#1074;&#1089;&#1077;&#1093; &#1087;&#1086;&#1076;&#1086;&#1074; (&#1080;&#1083;&#1080; &#1083;&#1102;&#1073;&#1086;&#1075;&#1086; &#1076;&#1088;&#1091;&#1075;&#1086;&#1075;&#1086; &#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1072; Kubernetes, &#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1084; &#1084;&#1086;&#1078;&#1085;&#1086;&#1087;&#1088;&#1080;&#1082;&#1088;&#1077;&#1087;&#1083;&#1103;&#1090;&#1100; &#1084;&#1077;&#1090;&#1082;&#1080;)</span>
kubectl get pods --show-labels

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">&#1055;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100; &#1075;&#1086;&#1090;&#1086;&#1074;&#1099;&#1077; &#1091;&#1079;&#1083;&#1099;</span>
<span style="color: #cae682;">JSONPATH</span>=<span style="color: #95e454;">'{range .items[*]}{@.metadata.name}:{range @.status.conditions[*]}</span>
<span style="color: #95e454;">{@.type}={@.status};{end}{end}'</span> <span style="color: #95e454;">\</span>
&amp;&amp; kubectl get nodes -o <span style="color: #cae682;">jsonpath</span>=<span style="color: #95e454;">"$JSONPATH"</span> | grep <span style="color: #95e454;">"Ready=True"</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">&#1042;&#1099;&#1074;&#1086;&#1076; &#1076;&#1077;&#1082;&#1086;&#1076;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1085;&#1099;&#1093; &#1089;&#1077;&#1082;&#1088;&#1077;&#1090;&#1086;&#1074; &#1073;&#1077;&#1079; &#1074;&#1085;&#1077;&#1096;&#1085;&#1080;&#1093; &#1080;&#1085;&#1089;&#1090;&#1088;&#1091;&#1084;&#1077;&#1085;&#1090;&#1086;&#1074;</span>
kubectl get secret my-secret -o go-template=<span style="color: #95e454;">'{{range $k,$v := .data}}{{"### "}}{{$k}}{{"\n"}}</span>
<span style="color: #95e454;">{{$v|base64decode}}{{"\n\n"}}{{end}}'</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">&#1042;&#1099;&#1074;&#1077;&#1089;&#1090;&#1080; &#1074;&#1089;&#1077; &#1089;&#1077;&#1082;&#1088;&#1077;&#1090;&#1099;, &#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1077;&#1084;&#1099;&#1077; &#1089;&#1077;&#1081;&#1095;&#1072;&#1089; &#1074; &#1087;&#1086;&#1076;&#1077;.</span>

kubectl get pods -o json | jq <span style="color: #95e454;">'.items[].spec.containers[].env[]?.valueFrom.secretKeyRef.name'</span> | grep -
v null | sort | uniq
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">&#1042;&#1099;&#1074;&#1077;&#1089;&#1090;&#1080; &#1074;&#1089;&#1077; &#1080;&#1076;&#1077;&#1085;&#1090;&#1080;&#1092;&#1080;&#1082;&#1072;&#1090;&#1086;&#1088;&#1099; (containerID) &#1082;&#1086;&#1085;&#1090;&#1077;&#1081;&#1085;&#1077;&#1088;&#1086;&#1074; &#1080;&#1085;&#1080;&#1094;&#1080;&#1072;&#1083;&#1080;&#1079;&#1072;&#1094;&#1080;&#1080; (initContainers) &#1074;&#1086;</span>
&#1074;&#1089;&#1077;&#1093; &#1087;&#1086;&#1076;&#1072;&#1093;.

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">&#1069;&#1090;&#1086; &#1087;&#1086;&#1083;&#1077;&#1079;&#1085;&#1086; &#1087;&#1088;&#1080; &#1086;&#1095;&#1080;&#1089;&#1090;&#1082;&#1077; &#1086;&#1089;&#1090;&#1072;&#1085;&#1086;&#1074;&#1083;&#1077;&#1085;&#1085;&#1099;&#1093; &#1082;&#1086;&#1085;&#1090;&#1077;&#1081;&#1085;&#1077;&#1088;&#1086;&#1074;, &#1085;&#1077; &#1091;&#1076;&#1072;&#1083;&#1103;&#1103; &#1087;&#1088;&#1080; &#1101;&#1090;&#1086;&#1084; &#1082;&#1086;&#1085;&#1090;&#1077;&#1081;&#1085;&#1077;&#1088;&#1099;</span>
&#1080;&#1085;&#1080;&#1094;&#1080;&#1072;&#1083;&#1080;&#1079;&#1072;&#1094;&#1080;&#1080;.

kubectl get pods --all-namespaces -o <span style="color: #cae682;">jsonpath</span>=<span style="color: #95e454;">'{range .items[*].status.initContainerStatuses[*]}</span>
<span style="color: #95e454;">{.containerID}{"\n"}{end}'</span> | cut -d/ -f3
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">&#1042;&#1099;&#1074;&#1077;&#1089;&#1090;&#1080; &#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1103;, &#1086;&#1090;&#1089;&#1086;&#1088;&#1090;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1085;&#1099;&#1077; &#1087;&#1086; &#1074;&#1088;&#1077;&#1084;&#1077;&#1085;&#1085;&#1086;&#1081; &#1084;&#1077;&#1090;&#1082;&#1077;</span>
kubectl get events --sort-by=.metadata.creationTimestamp
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">&#1057;&#1088;&#1072;&#1074;&#1085;&#1080;&#1090;&#1100; &#1090;&#1077;&#1082;&#1091;&#1097;&#1077;&#1077; &#1089;&#1086;&#1089;&#1090;&#1086;&#1103;&#1085;&#1080;&#1077; &#1082;&#1083;&#1072;&#1089;&#1090;&#1077;&#1088;&#1072; &#1089; &#1089;&#1086;&#1089;&#1090;&#1086;&#1103;&#1085;&#1080;&#1077;&#1084;, &#1074; &#1082;&#1086;&#1090;&#1086;&#1088;&#1086;&#1084; &#1085;&#1072;&#1093;&#1086;&#1076;&#1080;&#1083;&#1089;&#1103; &#1073;&#1099; &#1082;&#1083;&#1072;&#1089;&#1090;&#1077;&#1088; &#1074;</span>
&#1089;&#1083;&#1091;&#1095;&#1072;&#1077; &#1087;&#1088;&#1080;&#1084;&#1077;&#1085;&#1077;&#1085;&#1080;&#1103; &#1084;&#1072;&#1085;&#1080;&#1092;&#1077;&#1089;&#1090;&#1072;.

kubectl diff -f ./my-manifest.yaml
</pre>
</div>
</div>
</div>
<div id="outline-container-org8d4a624" class="outline-3">
<h3 id="org8d4a624"><span class="section-number-3">8.28.</span> usage</h3>
<div class="outline-text-3" id="text-8-28">
</div>
<div id="outline-container-org6987318" class="outline-4">
<h4 id="org6987318"><span class="section-number-4">8.28.1.</span> Обновление ресурсов</h4>
<div class="outline-text-4" id="text-8-28-1">
<p>
kubectl set image deployment/frontend www=image:v2 # Плавающее обновление
контейнеров "www" развёртывания "frontend", обновление образа
kubectl rollout history deployment/frontend # Проверить историю развёртывания, включая ревизии.
</p>

<p>
kubectl rollout undo deployment/frontend # Откатиться к предыдущему
развёртыванию
kubectl rollout undo deployment/frontend &#x2013;to-revision=2 # Откатиться к определённой ревизии
kubectl rollout status -w deployment/frontend # Отслеживать статус плавающего
развёртывания "frontend" до его завершения
kubectl rollout restart deployment/frontend # Перезапуск плавающего развёртывания
"frontend"
</p>

<p>
kubectl get pod mypod -o yaml | sed 's/\(image: myimage\):.*$/\1:v4/' | kubectl replace -f -
kubectl label pods my-pod new-label=awesome # Добавить метку
kubectl annotate pods my-pod icon-url=<a href="http://goo.gl/XXBTWq">http://goo.gl/XXBTWq</a> # Добавить аннотацию
kubectl autoscale deployment foo &#x2013;min=2 &#x2013;max=10 # Автоматически масштабировать развёртывание "foo" в диапазоне от 2 до 10 подов
</p>
</div>
</div>
<div id="outline-container-org575dfd8" class="outline-4">
<h4 id="org575dfd8"><span class="section-number-4">8.28.2.</span> удаление ресурсов</h4>
<div class="outline-text-4" id="text-8-28-2">
<p>
kubectl delete -f ./pod.json # Удалить под по типу и имени в pod.json kubectl delete pod,service baz foo # Удалить поды и сервисы с одноимёнными
именам "baz" и "foo"
kubectl delete pods,services -l name=myLabel # Удалить поды и сервисы с именем
метки myLabel
kubectl -n my-ns delete pod,svc &#x2013;all # Удалить все поды и сервисы в
пространстве имен my-ns
</p>

<p>
kubectl get pods -n mynamespace &#x2013;no-headers=true | awk '/pattern1|pattern2/{print $1}' | xargs kubectl delete -n mynamespace pod
</p>
</div>
</div>
<div id="outline-container-orge55e666" class="outline-4">
<h4 id="orge55e666"><span class="section-number-4">8.28.3.</span> работа с подами, логами</h4>
<div class="outline-text-4" id="text-8-28-3">
<p>
kubectl logs my-pod # вывести логи пода (в stdout)
kubectl logs -l name=myLabel # вывести логи пода с меткой myLabel (в stdout) kubectl logs my-pod &#x2013;previous # вывести логи пода (в stdout) по предыдущему
экземпляру контейнера
kubectl logs my-pod -c my-container # вывести логи контейнера пода (в stdout, при работе
с несколькими контейнерами)
kubectl logs -l name=myLabel -c my-container # вывести логи пода с меткой myLabel (в stdout) kubectl logs my-pod -c my-container &#x2013;previous # вывести логи контейнера пода (в stdout, при
работе с несколькими контейнерами) по предыдущему экземпляру контейнера
kubectl logs -f my-pod # вывести логи пода в режиме реального времени (в stdout) kubectl logs -f my-pod -c my-container # вывести логи контейнера пода в режиме реального
времени (в stdout, при работе с несколькими контейнерами)
kubectl logs -f -l name=myLabel &#x2013;all-containers # вывести логи всех подов с меткой myLabel (в
stdout)
kubectl run -i &#x2013;tty busybox &#x2013;image=busybox &#x2013; sh # запустить под как интерактивную оболочку
kubectl run nginx &#x2013;image=nginx &#x2013;restart=Never -n
mynamespace # Запустить под nginx в заданном пространстве имён
kubectl run nginx &#x2013;image=nginx &#x2013;restart=Never # Запустить под nginx и записать его
спецификацию в файл pod.yaml
&#x2013;dry-run -o yaml &gt; pod.yaml
kubectl attach my-pod -i # Прикрепить к запущенному контейнеру
kubectl port-forward my-pod 5000:6000 # Переадресовать порт 5000 в локальной машине
на порт 6000 в поде my-pod
kubectl exec my-pod &#x2013; ls / # Выполнить команду в существующем поде (в случае
одного контейнера).
</p>

<p>
kubectl exec my-pod -c my-container &#x2013; ls / # Выполнить команду в существующем поде (в
случае нескольких контейнеров)
kubectl top pod POD<sub>NAME</sub> &#x2013;containers # Показать метрики по заданному поду вместе с
его контейнерами
</p>
</div>
</div>
<div id="outline-container-org4f714d4" class="outline-4">
<h4 id="org4f714d4"><span class="section-number-4">8.28.4.</span> Работа с кластером</h4>
<div class="outline-text-4" id="text-8-28-4">
<p>
kubectl config view # показать объединённые настройки kubeconfig
</p>

<p>
конфигурацию из этих файлов
KUBECONFIG=~/.kube/config:~/.kube/kubconfig2
kubectl config view
</p>

<p>
kubectl config view -o jsonpath='{.users[?(@.name <code>= "e2e")].user.password}'
kubectl config view -o jsonpath</code>'{.users[].name}' # показать первого пользователя
kubectl config view -o jsonpath='{.users[*].name}' # получить список пользователей
kubectl config get-contexts # показать список контекстов
kubectl config current-context # показать текущий контекст (current-context) kubectl config use-context my-cluster-name # установить my-cluster-name как контекст по
умолчанию
</p>

<p>
kubectl config set-credentials kubeuser/foo.kubernetes.com &#x2013;username=kubeuser &#x2013;
password=kubepassword
</p>

<p>
kubectl config set-context &#x2013;current &#x2013;namespace=ggckad-s2
</p>

<p>
kubectl config set-context gce &#x2013;user=cluster-admin &#x2013;namespace=foo \
&amp;&amp; kubectl config use-context gce
kubectl config unset users.foo # удалить пользователя foo
kubectl cordon my-node # Отметить узел my-node как неназначаемый
kubectl drain my-node # Вытеснить узел my-node, чтобы подготовиться
к эксплуатации
kubectl uncordon my-node # Отметить узел my-node как назначаемый
kubectl top node my-node # Показать метрики по заданному узлу
kubectl cluster-info # Показать адреса главного узла и сервисов
kubectl cluster-info dump # Вывести состояние текущего кластера в stdout kubectl cluster-info dump &#x2013;output-directory=/path/to/cluster-state # Вывести состояние текущего
кластера в /path/to/cluster-state
</p>

<p>
заменено указанным
kubectl taint nodes foo dedicated=special-user:NoSchedule
</p>
</div>
</div>
</div>

<div id="outline-container-org4f627df" class="outline-3">
<h3 id="org4f627df"><span class="section-number-3">8.29.</span> What is Krew?</h3>
<div class="outline-text-3" id="text-8-29">
<p>
Krew is the plugin manager for kubectl command-line tool.
</p>
</div>
</div>
<div id="outline-container-org21b0a5c" class="outline-3">
<h3 id="org21b0a5c"><span class="section-number-3">8.30.</span> create namespace</h3>
<div class="outline-text-3" id="text-8-30">
<pre class="example">
k get ns --show-labels # with labels
</pre>

<div class="org-src-container">
<pre class="src src-yaml">---

apiVersion: v1
kind: Namespace
metadata:
  # name: mlsynth
  name: ml1
</pre>
</div>

<pre class="example">
{'apiVersion': 'v1', 'kind': 'Namespace', 'metadata': {'name': 'ml1'}}
</pre>
</div>
</div>

<div id="outline-container-orgfd36047" class="outline-3">
<h3 id="orgfd36047"><span class="section-number-3">8.31.</span> create custom resource</h3>
<div class="outline-text-3" id="text-8-31">
<div class="org-src-container">
<pre class="src src-yaml">apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
name: dolphins.ship.io
spec:
group: ship.io
versions:
   - name: v1
     served: true
     storage: true
     schema:
       openAPIV3Schema:
         type: object
         properties:
           spec:
             type: object
             properties:
               name:
                 type: string
scope: Namespaced
names:
   plural: dolphins
   singular: dolphin
   kind: Dolphin
   shortNames:
   - dolphin
   categories:
   - all

</pre>
</div>
</div>
</div>

<div id="outline-container-orga0a74b0" class="outline-3">
<h3 id="orga0a74b0"><span class="section-number-3">8.32.</span> one pod per node</h3>
<div class="outline-text-3" id="text-8-32">
<div class="org-src-container">
<pre class="src src-yaml">template:
  metadata:
    labels:
      app: paramserv
  spec:
    affinity:
      podAntiAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
        - labelSelector:
            matchExpressions:
            - key: app
              operator: In
              values:
              - paramserv
          topologyKey: kubernetes.io/hostname
</pre>
</div>

<pre class="example">
{'template': {'metadata': {'labels': {'app': 'paramserv'}},
              'spec': {'affinity': {'podAntiAffinity': {'requiredDuringSchedulingIgnoredDuringExecution': [{'labelSelector': {'matchExpressions': [{'key': 'app',
                                                                                                                                                    'operator': 'In',
                                                                                                                                                    'values': ['paramserv']}]},
                                                                                                            'topologyKey': 'kubernetes.io/hostname'}]}}}}}
</pre>
</div>
</div>

<div id="outline-container-org784130b" class="outline-3">
<h3 id="org784130b"><span class="section-number-3">8.33.</span> known errors and misleads in kubectl</h3>
<div class="outline-text-3" id="text-8-33">
<pre class="example">
k -n ml1 get all # will get pods and services
</pre>
</div>
</div>
<div id="outline-container-orgd81fe88" class="outline-3">
<h3 id="orgd81fe88"><span class="section-number-3">8.34.</span> Troubleshooting</h3>
<div class="outline-text-3" id="text-8-34">
<p>
-v, &#x2013;v Level number for the log level verbosity. Up to 8.
</p>

<pre class="example">
kubectl cluster-info - Display cluster info
</pre>

<p>
responses:
</p>
<ul class="org-ul">
<li>Error from server: etcdserver: request timed out
<ul class="org-ul">
<li>no response from</li>
</ul></li>
<li>The connection to the server kube-exp-m.clive.tk:6443 was refused - did you specify the right host or port?
<ul class="org-ul">
<li></li>
</ul></li>
<li>"Kubernetes control plane is running at <a href="https://kube-exp-m.clive.tk:6443">https://kube-exp-m.clive.tk:6443</a>"  "CoreDNS is running at <a href="https://kube-exp-m.clive.tk:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy">https://kube-exp-m.clive.tk:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy</a>"
<ul class="org-ul">
<li>everything is allright</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-orgdce0901" class="outline-3">
<h3 id="orgdce0901"><span class="section-number-3">8.35.</span> DNS</h3>
<div class="outline-text-3" id="text-8-35">
</div>
<div id="outline-container-org8a21e0f" class="outline-4">
<h4 id="org8a21e0f"><span class="section-number-4">8.35.1.</span> theory</h4>
<div class="outline-text-4" id="text-8-35-1">
<p>
<b>CoreDNS</b> is a general-purpose authoritative DNS server that can serve as cluster DNS
</p>
</div>
</div>

<div id="outline-container-org59bf30a" class="outline-4">
<h4 id="org59bf30a"><span class="section-number-4">8.35.2.</span> Check if my DNS service is up:</h4>
<div class="outline-text-4" id="text-8-35-2">
<p>
$ kubectl get svc &#x2013;namespace=kube-system
NAME       CLUSTER-IP   EXTERNAL-IP   PORT(S)         AGE
kube-dns   10.96.0.10   &lt;none&gt;        53/UDP,53/TCP   5d
</p>

<p>
Check if DNS endpoints are exposed:
</p>

<p>
$ kubectl get ep kube-dns &#x2013;namespace=kube-system
NAME       ENDPOINTS                     AGE
kube-dns   10.244.0.5:53,10.244.0.5:53   5d
</p>

<p>
Check the contents of /etc/resolv.conf in my container:
$ kubectl exec -ti busybox &#x2013; cat /etc/resolv.conf
nameserver 10.96.0.10
search default.svc.cluster.local svc.cluster.local cluster.local
options ndots:5
</p>


<p>
logs from the kube-dns container:
$ kubectl logs &#x2013;namespace=kube-system $(kubectl get pods &#x2013;namespace=kube-system -l k8s-app=kube-dns -o name) -c kubedns
</p>

<p>
kubectl rollout restart -n kube-system deployment/coredns
</p>
</div>
</div>

<div id="outline-container-org747efe0" class="outline-4">
<h4 id="org747efe0"><span class="section-number-4">8.35.3.</span> edit configmap for CoreDNS</h4>
<div class="outline-text-4" id="text-8-35-3">
<ul class="org-ul">
<li>kubectl get -n kube-system configmaps coredns -o yaml &gt; core<sub>dns.yaml</sub></li>
<li>kubectl replace -n kube-system -f core<sub>dns.yaml</sub></li>
</ul>
<p>
or
</p>
<ul class="org-ul">
<li>kubectl -n kube-system edit configmap coredns</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org8bb7bf5" class="outline-3">
<h3 id="org8bb7bf5"><span class="section-number-3">8.36.</span> <span class="todo TODO">TODO</span> network &amp; security</h3>
<div class="outline-text-3" id="text-8-36">
<ul class="org-ul">
<li>cilium - networking, observability, and security solution with an eBPF-based dataplane.</li>
<li>Calico - full-blown Kubernetes “networking solution” with functionality including network policy controller, kube-proxy replacement and network traffic observability.</li>
</ul>
</div>
</div>
<div id="outline-container-orgbed60fc" class="outline-3">
<h3 id="orgbed60fc"><span class="section-number-3">8.37.</span> links</h3>
<div class="outline-text-3" id="text-8-37">
<ul class="org-ul">
<li>docs <a href="https://kubernetes.io/docs/">https://kubernetes.io/docs/</a></li>
<li>guide <a href="https://kubectl.docs.kubernetes.io/guides/">https://kubectl.docs.kubernetes.io/guides/</a></li>
<li>api <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.27/">https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.27/</a>
<ul class="org-ul">
<li>template(PodTemplateSpec) <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.27/#podtemplate-v1-core">https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.27/#podtemplate-v1-core</a></li>
</ul></li>
<li><a href="https://github.com/kelseyhightower/kubernetes-the-hard-way">https://github.com/kelseyhightower/kubernetes-the-hard-way</a> <a id="orgcf7928e"></a></li>
<li><a href="https://kubernetes.io/ru/docs/reference/kubectl/cheatsheet/">https://kubernetes.io/ru/docs/reference/kubectl/cheatsheet/</a></li>
</ul>

<p>
<a href="https://kubernetes.io/docs/tasks/administer-cluster/dns-debugging-resolution/">https://kubernetes.io/docs/tasks/administer-cluster/dns-debugging-resolution/</a>
</p>
</div>
</div>
</div>
<div id="outline-container-org6c1c489" class="outline-2">
<h2 id="org6c1c489"><span class="section-number-2">9.</span> Ansible and Terraform - infrastructure automation tools</h2>
<div class="outline-text-2" id="text-9">
<p>
see <a href="theory#MissingReference">theory#MissingReference</a>
</p>
</div>
<div id="outline-container-org7bc3c86" class="outline-3">
<h3 id="org7bc3c86"><span class="section-number-3">9.1.</span> theory</h3>
<div class="outline-text-3" id="text-9-1">
<p>
Configuration Drift - difference between the desired and actual state of your configuration.
</p>
<ul class="org-ul">
<li>Ansible relies on idempotent tasks and continuous execution without maintaining a persistent state of the infrastructure.</li>
<li>Terraform relies on a stored state to detect and manage drift, emphasizing a declarative approach to infrastructure as code.</li>
</ul>
</div>
</div>
<div id="outline-container-org03166c2" class="outline-3">
<h3 id="org03166c2"><span class="section-number-3">9.2.</span> Ansible vs Terraform</h3>
<div class="outline-text-3" id="text-9-2">
<p>
<b>Ansible</b> - <i>Terraform</i>
</p>
<ul class="org-ul">
<li>Type
<ul class="org-ul">
<li><b>Configuration management tool</b>
<ul class="org-ul">
<li><i>Orchestration tool</i></li>
</ul></li>
</ul></li>
<li>Syntax - <b>YAML</b> <i>HCL</i></li>
<li>Language - <b>Procedural</b> <i>Declarative</i></li>
<li>Default approach
<ul class="org-ul">
<li><b>Immutable infrastructure</b> and mutation supported.
<ul class="org-ul">
<li><i>Immutable infrastructure</i></li>
</ul></li>
</ul></li>
<li>Cloud support - <b>All clouds</b> <i>All clouds</i></li>
<li>Lifecycle (state) management
<ul class="org-ul">
<li><b>Does not support</b>
<ul class="org-ul">
<li><i>Depends on the lifecycle and state management</i></li>
</ul></li>
</ul></li>
<li>Packaging and templating
<ul class="org-ul">
<li><b>Provides complete support</b>
<ul class="org-ul">
<li><i>Provides partial support</i></li>
</ul></li>
</ul></li>
<li>Capabilities
<ul class="org-ul">
<li><b>Provisioning and configuring</b>
<ul class="org-ul">
<li>Provisioning and configuring</li>
</ul></li>
</ul></li>
<li>Agentless <b>Yes</b> <i>Yes</i> - <b>SSH</b> <i>Providers API and SSH</i></li>
<li>Masterless <b>Yes</b> <i>Yes</i> - “state” information not require server.</li>
<li>License - <b>Open Source</b> <i>Business Source License (BUSL)</i></li>
<li>Writen in - <b>Python, shell</b> <i>Go</i></li>
<li>Configuration language - <b>YAML and Jinja templates</b> <i>HashiCorp Configuration Language (HCL)</i></li>
</ul>

<p>
Orchestration tools ensure that an environment is in its desired state continuously.
</p>

<p>
Terraform :
</p>
<ul class="org-ul">
<li>infrastructure provisioning</li>
<li>managing cloud resources</li>
<li>implementing infrastructure changes</li>
<li>enabling infrastructure as code practices.</li>
</ul>

<p>
Ansible :
</p>
<ul class="org-ul">
<li>configuration management</li>
<li>application deployment</li>
<li>continuous delivery</li>
<li>server provisioning</li>
<li>automating repetitive system administration tasks.</li>
</ul>

<p>
Terraform - more user-fiendly, good scheduling capabilities.
</p>
</div>
</div>

<div id="outline-container-org2fb3412" class="outline-3">
<h3 id="org2fb3412"><span class="section-number-3">9.3.</span> Terraform</h3>
<div class="outline-text-3" id="text-9-3">
</div>
<div id="outline-container-org570b38e" class="outline-4">
<h4 id="org570b38e"><span class="section-number-4">9.3.1.</span> theory</h4>
<div class="outline-text-4" id="text-9-3-1">
<p>
Pretend to be abstracted from cloud providers.
</p>

<p>
OpenTofu is an open-source version of Terraform
</p>

<p>
Playbook, Inventory -&gt; Ansible Management Node -&gt; SSH to machines
</p>
<ul class="org-ul">
<li>Inventory:  IP addresses, databases, servers, and other details.</li>
<li>Playbook: set of Plays - a set of tasks to run on a specific host or group of hosts.</li>
</ul>

<p>
<b>Providesrs</b> - terraform plugins for cloud proveder API
</p>
</div>
</div>

<div id="outline-container-orgc1678f5" class="outline-4">
<h4 id="orgc1678f5"><span class="section-number-4">9.3.2.</span> files</h4>
<div class="outline-text-4" id="text-9-3-2">
<p>
Terraform manifests.
</p>

<p>
Main directory - Terraform uses this directory to store
</p>
<ul class="org-ul">
<li>required plugins</li>
<li>modules (pre-written configurations)</li>
<li>information about the real infrastructure it created.</li>
</ul>

<p>
main.tf
</p>

<p>
Terraform state files - log  information about the resources.
</p>
<ul class="org-ul">
<li>to compare infrastructure to the code and make any adjustments as necessary.</li>
</ul>

<p>
Configuration files (\*.tf) -&gt; Terraform Core -&gt; State files (\*.tfstate)
</p>
</div>
</div>
<div id="outline-container-org3e730f9" class="outline-4">
<h4 id="org3e730f9"><span class="section-number-4">9.3.3.</span> steps:</h4>
<div class="outline-text-4" id="text-9-3-3">
</div>
<ol class="org-ol">
<li><a id="orge0085c4"></a>base<br />
<div class="outline-text-5" id="text-9-3-3-1">
<ol class="org-ol">
<li>create main direcoty</li>
<li>create main.tf
<ol class="org-ol">
<li>terraform validate - syntax checking</li>
</ol></li>
<li>terraform init - download “provider”. also execute “terraform get”.
<ul class="org-ul">
<li>safe to run multiple times</li>
<li>terraform init -from-module=MODULE-SOURCE - given module will be copied into the target directory</li>
<li>do:
<ul class="org-ul">
<li>backend state initialization (local by default) -backend=false</li>
<li>module installation -get=false</li>
<li>Plugin Installation - most published separately <a href="https://registry.terraform.io/">https://registry.terraform.io/</a> or in a third-party provider registry</li>
</ul></li>
</ul></li>
<li>terraform plan - review plan
<ul class="org-ul">
<li>Reads the current state of any already-existing remote objects to make sure that the Terraform state is up-to-date.</li>
<li>Compares the current configuration to the prior state and noting any differences.</li>
<li>Proposes a set of change actions that should, if applied, make the remote objects match the configuration.</li>
</ul></li>
<li>terraform apply - review plan and create infrastructure.</li>
<li>terraform refresh - update states file</li>
<li>terraform destroy</li>
</ol>
<p>
<a href="https://developer.hashicorp.com/terraform/intro/core-workflow">https://developer.hashicorp.com/terraform/intro/core-workflow</a>
</p>
</div>
</li>
<li><a id="orgc95dfb2"></a>provider<br />
<div class="outline-text-5" id="text-9-3-3-2">
<p>
project configuration page -&gt; Terraform
</p>
<ol class="org-ol">
<li>Project ID</li>
<li>Username</li>
<li>User Domain ID</li>
<li>Region Name</li>
</ol>
</div>
</li>
</ol>
</div>

<div id="outline-container-orgd2c9f8f" class="outline-4">
<h4 id="orgd2c9f8f"><span class="section-number-4">9.3.4.</span> modules</h4>
</div>
</div>
<div id="outline-container-org32d53ce" class="outline-3">
<h3 id="org32d53ce"><span class="section-number-3">9.4.</span> Ansible</h3>
<div class="outline-text-3" id="text-9-4">
<p>
Ansible - better security and ACL functionality.
</p>

<p>
Ansible bad with logical dependencies, orchestration services, and interconnected applications.
</p>

<ul class="org-ul">
<li>inventory file</li>
<li>playbooks -  manifest files that describe what needs to be done on the desired machine.</li>
</ul>

<p>
Analogs:
</p>
<ul class="org-ul">
<li>chef, puppet</li>
</ul>
</div>
</div>

<div id="outline-container-orge78eb3c" class="outline-3">
<h3 id="orge78eb3c"><span class="section-number-3">9.5.</span> Terraform with Ansible together</h3>
<div class="outline-text-3" id="text-9-5">
<p>
Terraform managing infrastructure and Ansible handling configuration changes.
</p>
<ul class="org-ul">
<li>Terraform first to create, for example, a virtual machine and then use Ansible to install
necessary applications on that machine.</li>
<li>two options: either use Terraform’s output as input for Ansible’s inventory or instruct Terraform to execute Ansible.</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orge6e0660" class="outline-2">
<h2 id="orge6e0660"><span class="section-number-2">10.</span> Onnx - Apache License 2.0, Python C++</h2>
<div class="outline-text-2" id="text-10">
<p>
ecosystem - Open Neural Network Exchange
</p>

<p>
<b>Python programming</b>: <a href="python-ds#MissingReference">python-ds#MissingReference</a>
</p>
</div>
<div id="outline-container-org167828e" class="outline-3">
<h3 id="org167828e"><span class="section-number-3">10.1.</span> features</h3>
<div class="outline-text-3" id="text-10-1">
<ul class="org-ul">
<li>optimized for numerical computation</li>
<li>ONNX Runtime provides a high-performance <b>inference</b> engine that can run on various platforms and
devices, including cloud and edge environments.</li>
<li>Interoperability: move models between different deep learning frameworks</li>
<li>simplify model development and deploying by allowing collaboration between many researches.</li>
</ul>
</div>
</div>
<div id="outline-container-org0342a2d" class="outline-3">
<h3 id="org0342a2d"><span class="section-number-3">10.2.</span> dependencies</h3>
<div class="outline-text-3" id="text-10-2">
<p>
equery g onnx
</p>

<p>
Protobuff - serializing structured data. ONNX uses protobuf to serialize the graph into one single block.
</p>

<ul class="org-ul">
<li><a href="https://github.com/protocolbuffers/protobuf.git">https://github.com/protocolbuffers/protobuf.git</a></li>
<li>dev-python/protobuf-python</li>
</ul>

<p>
build tools:
</p>
<ul class="org-ul">
<li>dev-python/pybind11 - Seamless operability between C++11 and Python</li>
<li>dev-cpp/abseil-cpp - C++ code is collected from Google's own C++ code base</li>
<li>dev-lang/python-3.12.3-r1  (dev-lang/python) amd64</li>
<li>dev-python/gpep517-16  (&gt;=dev-python/gpep517-15) amd64  [python<sub>targets</sub><sub>python3</sub><sub>10</sub>(-)? python<sub>targets</sub><sub>python3</sub><sub>11</sub>(-)? python<sub>targets</sub><sub>python3</sub><sub>12</sub>(-)?]</li>
<li>dev-python/setuptools-70.2.0-r1  (&gt;=dev-python/setuptools-69.0.3) amd64  [python<sub>targets</sub><sub>python3</sub><sub>10</sub>(-)? python<sub>targets</sub><sub>python3</sub><sub>11</sub>(-)? python<sub>targets</sub><sub>python3</sub><sub>12</sub>(-)?]</li>
<li>app-alternatives/ninja-1  (app-alternatives/ninja) amd64</li>
<li>dev-build/cmake-3.28.5  (&gt;=dev-build/cmake-3.20.5) amd64</li>
</ul>
</div>
</div>
<div id="outline-container-org2c5023b" class="outline-3">
<h3 id="org2c5023b"><span class="section-number-3">10.3.</span> convertions</h3>
<div class="outline-text-3" id="text-10-3">
<p>
built-in:
</p>
<ul class="org-ul">
<li>sklearn-onnx: converts models from scikit-learn,</li>
<li>tensorflow-onnx: converts models from tensorflow,</li>
<li>onnxmltools: converts models from lightgbm, xgboost, pyspark, libsvm</li>
<li>torch.onnx: converts model from pytorch.</li>

<li>built-in <a href="https://github.com/onnx/onnxmltools">https://github.com/onnx/onnxmltools</a></li>
<li><a href="https://github.com/nixiesearch/onnx-convert">https://github.com/nixiesearch/onnx-convert</a></li>
<li><a href="https://github.com/xenova/transformers.js/tree/main/scripts">https://github.com/xenova/transformers.js/tree/main/scripts</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgfc63cee" class="outline-3">
<h3 id="orgfc63cee"><span class="section-number-3">10.4.</span> installation:</h3>
<div class="outline-text-3" id="text-10-4">
<ul class="org-ul">
<li>pip install onnx</li>
</ul>
</div>
</div>

<div id="outline-container-org794bd5e" class="outline-3">
<h3 id="org794bd5e"><span class="section-number-3">10.5.</span> ONNX Model Zoo</h3>
<div class="outline-text-3" id="text-10-5">
<p>
<a href="https://github.com/onnx/models/tree/main">https://github.com/onnx/models/tree/main</a>
</p>
</div>
</div>
<div id="outline-container-org4e0cb64" class="outline-3">
<h3 id="org4e0cb64"><span class="section-number-3">10.6.</span> backends</h3>
<div class="outline-text-3" id="text-10-6">
<p>
<a href="https://github.com/onnx/onnx/blob/main/docs/ImplementingAnOnnxBackend.md">https://github.com/onnx/onnx/blob/main/docs/ImplementingAnOnnxBackend.md</a>
</p>

<p>
unified (Python) backend interface at onnx/backend/base.py that require implementation.
</p>
<ul class="org-ul">
<li><a href="https://onnx.ai/backend-scoreboard/index_dev.html">https://onnx.ai/backend-scoreboard/index_dev.html</a></li>
</ul>

<p>
backends that not fully complied:
<a href="https://onnx.ai/supported-tools.html#deployModel">https://onnx.ai/supported-tools.html#deployModel</a>
</p>

<p>
tensorflow
<a href="https://github.com/onnx/onnx-tensorflow/blob/main/README.md">https://github.com/onnx/onnx-tensorflow/blob/main/README.md</a>
</p>

<p>
dev-libs/ncnn  <a href="https://github.com/Tencent/ncnn/">https://github.com/Tencent/ncnn/</a>
</p>
</div>
</div>

<div id="outline-container-org9b2c288" class="outline-3">
<h3 id="org9b2c288"><span class="section-number-3">10.7.</span> links:</h3>
<div class="outline-text-3" id="text-10-7">
<ul class="org-ul">
<li><a href="https://packages.gentoo.org/packages/sci-libs/onnx">https://packages.gentoo.org/packages/sci-libs/onnx</a></li>
<li><a href="https://github.com/onnx/onnx">https://github.com/onnx/onnx</a></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgfbf2bb1" class="outline-2">
<h2 id="orgfbf2bb1"><span class="section-number-2">11.</span> Onnx runtime - Microsoft - MIT license</h2>
<div class="outline-text-2" id="text-11">
<p>
ONNX Runtime - implementation of “onnx.backend.base”
</p>
<ul class="org-ul">
<li><a href="https://onnxruntime.ai/docs/api/python/auto_examples/plot_backend.html">https://onnxruntime.ai/docs/api/python/auto_examples/plot_backend.html</a></li>
<li><a href="https://onnx.ai/onnx/api/backend.html#onnx.backend.base.Backend">https://onnx.ai/onnx/api/backend.html#onnx.backend.base.Backend</a></li>
</ul>

<p>
links
</p>
<ul class="org-ul">
<li><a href="https://github.com/Microsoft/onnxruntime">https://github.com/Microsoft/onnxruntime</a></li>
<li>building <a href="https://onnxruntime.ai/docs/build/inferencing.html">https://onnxruntime.ai/docs/build/inferencing.html</a></li>
</ul>

<p>
implementation:
</p>
<ul class="org-ul">
<li>onnxruntime: ONNX + MLAS (Microsoft Linear Algebra Subprograms)</li>
<li>onnxruntime-gpu: ONNX + MLAS + CUDA</li>
</ul>

<p>
ONNX Runtime supports models in formats:
</p>
<ul class="org-ul">
<li>ONNX</li>
<li>ORT - Open Neural Network Exchange Runtime, format optimized for memory and disk-constrained
environments, such as mobile and web applications. require Convert ONNX models to ORT format.</li>
</ul>

<p>
installation:
</p>
<ul class="org-ul">
<li>pip install onnxruntime</li>
</ul>

<p>
steps:
</p>
<ol class="org-ol">
<li>python -m pip install cmake</li>
<li>./build.sh &#x2013;config Release &#x2013;build &#x2013;build<sub>shared</sub><sub>lib</sub> &#x2013;parallel &#x2013;compile<sub>no</sub><sub>warning</sub><sub>as</sub><sub>error</sub>
&#x2013;skip<sub>submodule</sub><sub>sync</sub> &#x2013;allow<sub>running</sub><sub>as</sub><sub>root</sub></li>
</ol>


<p>
submodules
</p>
<ul class="org-ul">
<li>emsdk <a href="https://github.com/emscripten-core/emsdk.git">https://github.com/emscripten-core/emsdk.git</a></li>
<li>libprotobuf-mutator <a href="https://github.com/google/libprotobuf-mutator.git">https://github.com/google/libprotobuf-mutator.git</a></li>
<li>onnx <a href="https://github.com/onnx/onnx.git">https://github.com/onnx/onnx.git</a></li>
</ul>
</div>
<div id="outline-container-org185b604" class="outline-3">
<h3 id="org185b604"><span class="section-number-3">11.1.</span> dependencies - execution-providers (backend)</h3>
<div class="outline-text-3" id="text-11-1">
<p>
<a href="https://onnxruntime.ai/docs/execution-providers/">https://onnxruntime.ai/docs/execution-providers/</a>
</p>
</div>
</div>
</div>
<div id="outline-container-org7418247" class="outline-2">
<h2 id="org7418247"><span class="section-number-2">12.</span> Onnx runtime - ncnn</h2>
<div class="outline-text-2" id="text-12">
<p>
optimized for the mobile platform
</p>

<p>
emerge &#x2013;ask dev-libs/ncnn  <a href="https://github.com/Tencent/ncnn/">https://github.com/Tencent/ncnn/</a>
</p>

<p>
<a href="https://github.com/Tencent/ncnn/blob/master/docs/how-to-use-and-FAQ/use-ncnn-with-pytorch-or-onnx.md">https://github.com/Tencent/ncnn/blob/master/docs/how-to-use-and-FAQ/use-ncnn-with-pytorch-or-onnx.md</a>
</p>

<p>
convert PyTorch or ONNX to NNC:
</p>
<ul class="org-ul">
<li>pnnx</li>
<li><a href="https://github.com/pnnx/pnnx">https://github.com/pnnx/pnnx</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgf0b09c3" class="outline-2">
<h2 id="orgf0b09c3"><span class="section-number-2">13.</span> onnx runtime build</h2>
<div class="outline-text-2" id="text-13">
<p>
<a href="https://hacktivis.me/git/overlay/file/sci-libs/onnxruntime/onnxruntime-1.9.1.ebuild.html">https://hacktivis.me/git/overlay/file/sci-libs/onnxruntime/onnxruntime-1.9.1.ebuild.html</a>
</p>

<p>
require
</p>
<ul class="org-ul">
<li>cudnn</li>
<li>migraphx - AMD's graph optimization engine.</li>
<li>onednn -  oneAPI Deep Neural Network Library (oneDNN) - Apache 2.0</li>
<li>tensorrt - NVIDIA® TensorRT™ - Apache-2.0 license</li>
</ul>
</div>

<div id="outline-container-org7f20d87" class="outline-3">
<h3 id="org7f20d87"><span class="section-number-3">13.1.</span> onnx runtime</h3>
<div class="outline-text-3" id="text-13-1">
<p>
<a href="https://github.com/stefantalpalaru/gentoo-overlay">https://github.com/stefantalpalaru/gentoo-overlay</a>
</p>
<div class="org-src-container">
<pre class="src src-text">onnxruntime-9999.ebuild file might look like:

ebuild
# Copyright 1999-2024 Gentoo Foundation
# Distributed under the terms of the GNU General Public License v2

EAPI=8

inherit git-r3

EGIT_REPO_URI="https://github.com/microsoft/onnxruntime.git"

DESCRIPTION="ONNX Runtime is a cross-platform inference and training machine-learning accelerator"
HOMEPAGE="https://github.com/microsoft/onnxruntime"
LICENSE="MIT"

DEPEND="dev-python/numpy
        dev-python/pip"

src_prepare() {
    # Prepare the build environment
    python_setup
}

src_compile() {
    # Run the build script
    ./build.sh --config Release --build_shared_lib --parallel --build_wheel
}

src_install() {
    # Install the built wheel file
    pip_install dist/*.whl
}

</pre>
</div>
</div>
</div>
<div id="outline-container-orgfeb8c64" class="outline-3">
<h3 id="orgfeb8c64"><span class="section-number-3">13.2.</span> onnxruntime-bin</h3>
<div class="outline-text-3" id="text-13-2">
<div class="org-src-container">
<pre class="src src-text">https://github.com/gentoo/gentoo/tree/9181a6e9540cbfe6a684dc8945c0a20ae5c36749/sci-libs/onnxruntime-bin
</pre>
</div>
</div>
</div>
<div id="outline-container-orgab5d3aa" class="outline-3">
<h3 id="orgab5d3aa"><span class="section-number-3">13.3.</span> onnxruntime dependencies</h3>
<div class="outline-text-3" id="text-13-3">
<p>
<a href="https://data.gpo.zugaina.org/cg/sci-libs/onnxruntime/onnxruntime-1.18.0-r1.ebuild">https://data.gpo.zugaina.org/cg/sci-libs/onnxruntime/onnxruntime-1.18.0-r1.ebuild</a>
</p>

<p>
dev-libs/date-3.0.1
</p>
<ul class="org-ul">
<li><a href="https://packages.gentoo.org/packages/dev-libs/date">https://packages.gentoo.org/packages/dev-libs/date</a></li>
</ul>

<p>
coloredlogs - dev-python/coloredlogs
flatbuffers -
numpy &gt;= 1.21.6
packaging
protobuf
sympy
</p>
</div>
</div>
</div>

<div id="outline-container-org34af7b9" class="outline-2">
<h2 id="org34af7b9"><span class="section-number-2">14.</span> PyTorch</h2>
<div class="outline-text-2" id="text-14">
</div>
<div id="outline-container-orgec86857" class="outline-4">
<h4 id="orgec86857"><span class="section-number-4">14.0.1.</span> caffe2 gentoo dependencies</h4>
<div class="outline-text-4" id="text-14-0-1">
<p>
numpy flash
</p>

<p>
cuda distributed fbgemm flash gloo mkl mpi nnpack numpy onednn openblas opencl openmp qnnpack rocm xnnpack
</p>
<ul class="org-ul">
<li>fbgemm
<ul class="org-ul">
<li>dev-libs/FBGEMM</li>
<li><a href="https://github.com/pytorch/FBGEMM">https://github.com/pytorch/FBGEMM</a></li>
<li>FB (Facebook) + GEMM (General Matrix-Matrix Multiplication)</li>
<li>low-precision, high-performance matrix-matrix multiplications and convolution library for server-side inference.</li>
</ul></li>
<li>flash
<ul class="org-ul">
<li>USE<sub>FLASH</sub><sub>ATTENTION</sub>, no dependencies</li>
<li>technique designed to optimize transformer models. Beta in Pytorch.</li>
</ul></li>
<li>gloo
<ul class="org-ul">
<li>sci-libs/gloo[cuda?]</li>
<li><a href="https://github.com/facebookincubator/gloo/">https://github.com/facebookincubator/gloo/</a></li>
<li>communication for multi-machine training</li>
</ul></li>
<li>mkl
<ul class="org-ul">
<li>sci-libs/mkl</li>
<li><a href="https://github.com/oneapi-src/oneMKL">https://github.com/oneapi-src/oneMKL</a></li>
<li>works with multiple devices (backends) using device-specific libraries underneath (including
CPU)</li>
</ul></li>
<li>mpi
<ul class="org-ul">
<li>virtual/mpi</li>
<li>sys-cluster/openmpi</li>
<li><a href="https://github.com/open-mpi/ompi">https://github.com/open-mpi/ompi</a></li>
<li>Message Passing Interface</li>
</ul></li>
<li>nnpack
<ul class="org-ul">
<li>sci-libs/NNPACK</li>
<li><a href="https://github.com/Maratyszcza/NNPACK/">https://github.com/Maratyszcza/NNPACK/</a></li>
<li>acceleration package for neural network computations - convnet layers for multi-core CPUs.</li>
</ul></li>
<li>qnnpack
<ul class="org-ul">
<li>! sci-libs/QNNPACK</li>
<li>dev-cpp/gemmlowp
<ul class="org-ul">
<li><a href="https://github.com/google/gemmlowp/">https://github.com/google/gemmlowp/</a></li>
<li>Low-precision matrix multiplication</li>
</ul></li>
</ul></li>
<li>onednn
<ul class="org-ul">
<li>sci-libs/ideep
<ul class="org-ul">
<li><a href="https://github.com/intel/ideep">https://github.com/intel/ideep</a></li>
<li>Chainer module using Intel’s Math Kernel Library for Deep Neural Networks (MKL-DNN).</li>
<li>accelerate DNN computations on Intel architectures, such as CPUs and GPUs.</li>
<li>Chainer is an open-source deep learning framework developed by Preferred Networks and the
Japanese government.</li>
</ul></li>
</ul></li>
<li>openblas
<ul class="org-ul">
<li>sci-libs/openblas</li>
<li><a href="https://github.com/xianyi/OpenBLAS">https://github.com/xianyi/OpenBLAS</a></li>
<li>optimized Basic Linear Algebra Subprograms (BLAS) library</li>
</ul></li>
<li>opencl
<ul class="org-ul">
<li>virtual/opencl</li>
</ul></li>
<li>openmp
<ul class="org-ul">
<li>USE<sub>OPENMP</sub>, no dependencies</li>
</ul></li>
<li>xnnpack
<ul class="org-ul">
<li>sci-libs/XNNPACK</li>
<li><a href="https://github.com/google/XNNPACK/">https://github.com/google/XNNPACK/</a></li>
<li>High-efficiency floating-point neural network inference operators for CPU: ARM, x86 and x86-64, etc.</li>
</ul></li>
</ul>

<p>
additional dependencies:
</p>
<ul class="org-ul">
<li>dev-cpp/opentelemetry-cpp
<ul class="org-ul">
<li>dev-libs/thrift - C++ bindings for Apache Thrift</li>
</ul></li>
</ul>

<p>
<a href="https://github.com/oneapi-src/oneDNN">https://github.com/oneapi-src/oneDNN</a>
</p>
</div>
</div>
</div>
<div id="outline-container-orgd3f10d2" class="outline-2">
<h2 id="orgd3f10d2"><span class="section-number-2">15.</span> PyTorch vs Tensorflow</h2>
<div class="outline-text-2" id="text-15">
<p>
Computational Graphs
</p>
<ul class="org-ul">
<li>PyTorch - Dynamic - more flexibility and ease of use, particularly in research and rapid
prototyping scenarios. However, this dynamic nature can introduce some overhead, especially when
scaling to very large models or data sizes. Less optimized for production.</li>
<li>Tensorflow - Static - better optimization for production environments, enabling TensorFlow to
excel in large-scale and complex neural network architectures. This includes optimizations like
operator fusion, which reduces memory reads and kernel launch overhead.
<ul class="org-ul">
<li>TensorFlow 2.x - eager execution is the default. Offers a hybrid approach.  Allowing developers
to use dynamic graphs for development and debugging, and then optimize the code by converting it
into static graphs for production or performance-critical parts of the model.</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org1749730" class="outline-2">
<h2 id="org1749730"><span class="section-number-2">16.</span> ML project tasks</h2>
<div class="outline-text-2" id="text-16">
<ul class="org-ul">
<li>Data Gathering</li>
<li>Preprocessing</li>
<li>Team Collaboration - ClearML</li>
<li>Experiment Management - experiment versioning, hyperparameter tuning,  model management
<ul class="org-ul">
<li>ClearML</li>
</ul></li>
<li>versioning</li>
<li>hyperparameter tuning</li>
<li>Experiment Management and tracking
<ul class="org-ul">
<li>hyperparameter tuning</li>
<li>experiment tracking</li>
<li>Automated Pipelines</li>
<li>model versioning</li>
</ul></li>
<li>Model Development and Training</li>
<li>Model Evaluation and Deployment</li>
<li>Data Collection and Preprocessing</li>
</ul>

<p>
Small
</p>
<ul class="org-ul">
<li>versioning: notebooks, spreadsheets, git.</li>
<li>hyperparameter tuning: Manual or basic hyperparameter tuning using GridSearchCV or RandomSearchCV.</li>
<li>Basic Evaluation Metrics: Using metrics like accuracy, precision, recall, and F1-score to evaluate
model performance.</li>
</ul>

<p>
Medium
</p>
<ul class="org-ul">
<li>automate experiment tracking:  ClearML, DagsHub, or Kaggle</li>
<li>Advanced Hyperparameter Tuning: Using tools like Hyperopt or Optuna</li>
<li>Evaluation Metrics: Using a range of evaluation metrics and techniques, including cross-validation
and model interpretability.</li>
<li>Managed Deployment: Models are deployed using managed services like Docker and Kubernetes for
containerization and orchestration.</li>
<li>Team Collaboration: defined roles, using collaboration tools like GitHub, Slack, and tasks
management software. Regular Meetings, sprint planning and issue tracking.</li>
</ul>

<p>
Large
</p>
<ul class="org-ul">
<li>Large-Scale Data Gathering: Involves collecting, processing, and managing large-scale datasets,
often using big data technologies like Apache Hadoop and Apache Spark.</li>
<li>Advanced data preprocessing, including distributed processing, data warehousing, and complex
feature engineering.</li>
<li>sophisticated ML algorithms such as deep learning models, ensemble methods, and transfer learning.</li>
<li>Scalable Infrastructure: Models are trained on large-scale cloud infrastructure or on-premises
clusters, utilizing distributed computing and GPU acceleration.</li>
<li>Comprehensive Experiment Tracking: Advanced experiment tracking, model versioning, and
hyperparameter optimization using tools like ClearML, Vertex AI, or DagsHub.</li>
<li>Automated Pipelines: Use of CI/CD pipelines to automate the entire ML workflow from data
preparation to model deployment.</li>
<li>Robust Evaluation Metrics: Using advanced evaluation techniques, including A/B testing, model
interpretability, and continuous monitoring of model performance.</li>
<li>Cross-Functional Teams</li>
<li>detailed role assignments, and formal project management methodologies to ensure seamless
collaboration and knowledge sharing.</li>
</ul>
</div>
</div>
<div id="outline-container-orgc696fc0" class="outline-2">
<h2 id="orgc696fc0"><span class="section-number-2">17.</span> Redis</h2>
<div class="outline-text-2" id="text-17">
</div>
<div id="outline-container-orgcb33eb6" class="outline-3">
<h3 id="orgcb33eb6"><span class="section-number-3">17.1.</span> history</h3>
<div class="outline-text-3" id="text-17-1">
<ul class="org-ul">
<li>2009  open-source project under the BSD license</li>
<li>In 2018, Redis Labs have all rights</li>
<li>2021 - 6.2 internode encryption</li>
<li>In 2021, Redis Labs rebranded itself simply as "Redis".</li>
<li>2022 - 7.0 Auto Tiering, RESP3 support, and sharded pub/sub</li>
<li>7.2-7.4 Active-Active database management, full TLS 1.3 support</li>
<li>since Redis 7.4, the project is dual-licensed under the Redis Source Available License (RSALv2)
and the Server Side Public License (SSPLv1).</li>
</ul>
<p>
Redis OSS
</p>
</div>
</div>
<div id="outline-container-org2e94e22" class="outline-3">
<h3 id="org2e94e22"><span class="section-number-3">17.2.</span> features</h3>
<div class="outline-text-3" id="text-17-2">
<ul class="org-ul">
<li>in-memory caching and fast data retrieval.</li>
<li>keys are binary safe; this means that you can use any binary sequence as a key</li>
<li>some commands support cursor</li>
<li>clustering - master-replica model mainly.</li>
</ul>

<p>
Used for
</p>
<ul class="org-ul">
<li><b>caching</b>, <b>queuing</b>, <b>event processing</b></li>
<li>sub storage for the main database.</li>
</ul>

<p>
Nones:
</p>
<ul class="org-ul">
<li>Redis usually processes the requests in a single thread</li>
</ul>

<p>
Bloom filter - determine whether an element is a member of a set. “has this been seen before?”.
</p>
<ul class="org-ul">
<li>It can return false positives (i.e., it might say an element is in the set when it is not), but
it never returns false negatives (i.e., it will never say an element is not in the set when it
actually is).</li>
<li>hash: to determine one of distributed Database.</li>
<li>How: large set of numbered buckets, to putting Cat - Cat hashes to identifiers 3, 4, and 10, we
fill that buckets. To check if Dock is in we calc 3 hashes and check if bucket was filled.</li>
</ul>
</div>
</div>
<div id="outline-container-orgf828989" class="outline-3">
<h3 id="orgf828989"><span class="section-number-3">17.3.</span> terms <a id="orgcd99b1c"></a></h3>
<div class="outline-text-3" id="text-17-3">
<dl class="org-dl">
<dt>name or key</dt><dd>name of hash; HSET &lt;name/key&gt; &lt;key/field&gt; &lt;value&gt;</dd>
<dt>key or field</dt><dd>(attribute within the hash), may be of type: strings, hashes, lists, sets, sorted sets, and more</dd>
<dt>value</dt><dd></dd>

<dt>H,S,Z prefix</dt><dd>Sets, Hash, Sorted Set types</dd>
<dt>M prefix</dt><dd>command accept multiple values</dd>
<dt>(no term)</dt><dd>schema</dd>
</dl>
</div>
</div>

<div id="outline-container-org20571c1" class="outline-3">
<h3 id="org20571c1"><span class="section-number-3">17.4.</span> license</h3>
<div class="outline-text-3" id="text-17-4">
<p>
old RSALv2, new  SSPLv1 - permissive non-copyleft license. Not approved by Open Source Initiative (OSI).
</p>
<ul class="org-ul">
<li>SSPLv1 is a copyleft license based on GPLv3.</li>
</ul>

<p>
RSALv2 - Users cannot commercialize the software or provide it as a managed service.
</p>

<p>
SSPLv1 - If you provide the product as a service, you must publicly release any modifications and the source
  code of your management layers under SSPLv1. This ensures that any service built around the
  software must also make its source code available
</p>

<p>
Limitation for individuals:
</p>
<ul class="org-ul">
<li>You may not commercialize the software or provide it to others as a managed service.</li>
<li>You may not remove or obscure any licensing, copyright, or other notices of the licensor in the
software[1][3].</li>
<li>if you make the software available to third parties as a service, you must release the source code
for the entirety of the service. However, this does not apply to individual non-commercial
use. Individuals can use Redis without needing to release any source code.</li>
</ul>

<p>
The restrictions mainly target commercial and cloud service providers who wish to offer Redis as a
 managed service.
</p>
</div>
</div>
<div id="outline-container-orgb6e6bfe" class="outline-3">
<h3 id="orgb6e6bfe"><span class="section-number-3">17.5.</span> Distribution</h3>
<div class="outline-text-3" id="text-17-5">
<p>
Redis OSS was renamed Redis Community Edition (CE) with the v7.4 release.
</p>

<ul class="org-ul">
<li><b>Redis Community Edition</b> (CE) - dual-licensed for newer versions, features:
<ul class="org-ul">
<li>in-memory data structures</li>
<li>replication</li>
<li>Lua scripting</li>
</ul></li>
<li><b>Redis Stack</b> is an extension of Redis:
<ul class="org-ul">
<li>RedisJSON, RedisGraph, RedisSearch</li>
<li>for document storage, graph databases, and full-text search</li>
</ul></li>
</ul>

<p>
Redis Stack and its modules, which were previously licensed separately, will be integrated into the
 core Redis distribution starting with Redis 8. This means that advanced data types and processing
 engines will be available by default in future versions of Redis, making the separate Redis Stack
 build unnecessary
</p>
</div>
</div>
<div id="outline-container-org813e507" class="outline-3">
<h3 id="org813e507"><span class="section-number-3">17.6.</span> Modules - Redisearch</h3>
<div class="outline-text-3" id="text-17-6">
<ul class="org-ul">
<li><a href="https://github.com/RediSearch/RediSearch">https://github.com/RediSearch/RediSearch</a></li>
<li><a href="https://redis.io/docs/stack/search/">https://redis.io/docs/stack/search/</a></li>
<li><a href="https://forum.redis.io/c/modules/redisearch">https://forum.redis.io/c/modules/redisearch</a></li>
<li><a href="https://redis.io/docs/latest/develop/interact/search-and-query/">https://redis.io/docs/latest/develop/interact/search-and-query/</a></li>
</ul>

<p>
Debian: apt install redis-server redis-redisearch
</p>

<p>
origin/2.10 commit 496a1596d437b6114b92f46deba1dc3bd9eedb12
</p>
</div>
<div id="outline-container-org3e6c46f" class="outline-4">
<h4 id="org3e6c46f"><span class="section-number-4">17.6.1.</span> from sources</h4>
<div class="outline-text-4" id="text-17-6-1">
<p>
From <a href="https://github.com/redis/redis/tree/unstable/modules">https://github.com/redis/redis/tree/unstable/modules</a>
</p>


<p>
SRC<sub>DIR</sub> = src
MODULE<sub>VERSION</sub> = 2.10 # branch for release v2.10.7
MODULE<sub>REPO</sub> = <a href="https://github.com/redisearch/redisearch">https://github.com/redisearch/redisearch</a>
TARGET<sub>MODULE</sub> = \((SRC_DIR)/bin/\)(FULL<sub>VARIANT</sub>)/search-community/redisearch.so
</p>

<p>
<a href="https://github.com/RediSearch/RediSearch/archive/refs/tags/v2.10.7.tar.gz">https://github.com/RediSearch/RediSearch/archive/refs/tags/v2.10.7.tar.gz</a>
</p>



<p>
mkdir -p $(SRC<sub>DIR</sub>)
git clone &#x2013;recursive &#x2013;depth 1 &#x2013;branch $(MODULE<sub>VERSION</sub>) $(MODULE<sub>REPO</sub>) $(SRC<sub>DIR</sub>)
</p>

<p>
Installing Prerequisites:
cd install
./install<sub>script.sh</sub> sudo
./install<sub>boost.sh</sub> 1.83.0
</p>



<div class="org-src-container">
<pre class="src src-bash"><span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Create a build directory</span>
mkdir build
<span style="color: #e5786d;">cd</span> build

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Run CMake to generate build files</span>
cmake .. -DCMAKE_BUILD_TYPE=RelWithDebInfo

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Build the software</span>
make build

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Optionally, build with specific flags (e.g., coordinator)</span>
make build <span style="color: #cae682;">COORD</span>=1

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Run tests</span>
make test

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Clean build artifacts</span>
make clean

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Run Redis with RediSearch</span>
make run
</pre>
</div>

<p>
make build COORD=1  # For Redis Community Edition Coordinator
or
make all
</p>
</div>
</div>
<div id="outline-container-org22f3dd1" class="outline-4">
<h4 id="org22f3dd1"><span class="section-number-4">17.6.2.</span> debian</h4>
<div class="outline-text-4" id="text-17-6-2">
<p>
<a href="https://salsa.debian.org/janitor-team/proposed/pkg-redisearch/-/tree/debian/sid/debian?ref_type=heads">https://salsa.debian.org/janitor-team/proposed/pkg-redisearch/-/tree/debian/sid/debian?ref_type=heads</a>
</p>

<p>
src/redisearch.so usr/lib/redis/modules
</p>
</div>
</div>
<div id="outline-container-org44aa944" class="outline-4">
<h4 id="org44aa944"><span class="section-number-4">17.6.3.</span> test module load</h4>
<div class="outline-text-4" id="text-17-6-3">
<p>
redis-cli MODULE LOAD /etc/redisearch.so
redis-cli MODULE LIST
</p>



<p>
#!/bin/sh
set -eu
service redis-server restart
sleep 5
redis-cli LOAD MODULE /usr/lib/redis/modules/redisearch.so
</p>
</div>
</div>

<div id="outline-container-org378006f" class="outline-4">
<h4 id="org378006f"><span class="section-number-4">17.6.4.</span> dependencies</h4>
<div class="outline-text-4" id="text-17-6-4">
<p>
CMakeLists.txt \
	deps/friso/CMakeLists.txt \
	deps/phonetics/CMakeLists.txt \
	deps/snowball/CMakeLists.txt \ - big
	deps/rmutil/CMakeLists.txt
</p>
</div>

<ol class="org-ol">
<li><a id="orga575715"></a>snowball<br />
<div class="outline-text-5" id="text-17-6-4-1">
<p>
string processing language for creating stemming algorithms for use in Information Retrieval
</p>

<p>
Stemming maps different forms of the same word to a common "stem" - for example, the English stemmer
 maps connection, connections, connective, connected, and connecting to connect.
</p>

<p>
Snowball 2.1.0 (2021-01-21)
</p>

<p>
tag v2.1.0
</p>

<p>
libstemmer<sub>c</sub> <a href="https://snowballstem.org/dist/libstemmer_c-2.1.0.tar.gz">https://snowballstem.org/dist/libstemmer_c-2.1.0.tar.gz</a>
</p>

<ul class="org-ul">
<li><a href="https://snowballstem.org/">https://snowballstem.org/</a></li>
<li><a href="https://github.com/snowballstem">https://github.com/snowballstem</a></li>
<li><a href="https://github.com/snowballstem/snowball">https://github.com/snowballstem/snowball</a></li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-orga79f930" class="outline-3">
<h3 id="orga79f930"><span class="section-number-3">17.7.</span> Data types</h3>
<div class="outline-text-3" id="text-17-7">
<dl class="org-dl">
<dt>String</dt><dd>to store some Real-time Analytics, caching, configurations.</dd>
<dt>List</dt><dd>message <b>queues</b> for job processing FIFO, Leaderboards, <b>Event</b> Logging.</dd>
<dt>Set</dt><dd>for detecting duplicates: user IDs or product IDs, for <b>intersection or union</b> operations in
recommendation systems or social network analysis, Rate Limiting by storing unique identifiers of users</dd>
<dt>Sorted set</dt><dd>Ranking Systems, Task Scheduling where they ordered by priority, Geo Hashing to index
locations based on latitude and longitude. <b>One-to-many, many-to-many relationship</b></dd>
<dt>Hash</dt><dd>to store user profiles, <b>objects</b>, session data, Event Tracking with TTL, Fraud Detection
to count number of events per hour for the last 48 hours.</dd>
</dl>

<p>
others:
</p>
<ul class="org-ul">
<li>Stream</li>
<li>Bitmap</li>
<li>Bitfield</li>
<li>Geospatial</li>
</ul>

<p>
Structure:
</p>
<dl class="org-dl">
<dt>String</dt><dd>key-value (not ordered); set, get</dd>
<dt>List</dt><dd>key-linked lists; add to head or to tail.</dd>
<dt>Set</dt><dd>key-members (not ordered); add, rem</dd>
<dt>Sorted set</dt><dd>key-((member,score)..); When more than one string has the same score, the strings are
ordered lexicographically. zadd O(log(N)), ZREVRANK O(log(N)), ZRANGE and ZSCAN - to get</dd>
<dt>Hash</dt><dd>key - ((filed, value)&#x2026;)</dd>
</dl>
</div>
</div>
<div id="outline-container-org5e338af" class="outline-3">
<h3 id="org5e338af"><span class="section-number-3">17.8.</span> Hashes</h3>
<div class="outline-text-3" id="text-17-8">
<p>
Has ability to set TTL (a time-to-live) per key but not per field.
</p>

<p>
Retrive:
</p>
<ul class="org-ul">
<li>HKEYS key</li>
<li>HVALS key</li>
<li>HGETALL key</li>
<li>HGET key field</li>
<li>HMGET key filed [field &#x2026; ]</li>
</ul>

<p>
Set:
</p>
<ul class="org-ul">
<li>HSET key field value [field value &#x2026;]</li>
</ul>


<p>
Every hash can store up to 4,294,967,295 (2<sup>32</sup> - 1) field-value pairs.
</p>

<p>
Benefits versus Stirngs:
</p>
<ul class="org-ul">
<li>Strings is flat list of key-value pairs. Hashes is name-key-value.</li>
<li>We need just one Redis HMGET command per entity as opposed to multiple GET calls if features of
the entity were stored as individual key-value pairs.</li>
<li>Ability to store all fields of object at the same node in cluster.</li>
</ul>

<p>
The downside, however, of using Redis hashes is that expiration times (TTLs) can only be set at the
 top level key.
</p>
</div>
</div>
<div id="outline-container-org0fa5f1c" class="outline-3">
<h3 id="org0fa5f1c"><span class="section-number-3">17.9.</span> Transactions</h3>
<div class="outline-text-3" id="text-17-9">
<p>
a single isolated operation.
</p>
<ul class="org-ul">
<li>MULTI - enter</li>
<li>EXEC - commit</li>
<li>DISCARD - flush the transaction queue and will exit the transaction.</li>
<li>WATCH - make the EXEC conditional</li>
</ul>

<p>
if some command failed all the other commands will be executed even if some command fails during the
 transaction.
</p>

<p>
Redis does not support rollbacks.
</p>
</div>
</div>
<div id="outline-container-org45e8827" class="outline-3">
<h3 id="org45e8827"><span class="section-number-3">17.10.</span> dependencies runtime</h3>
<div class="outline-text-3" id="text-17-10">
<ul class="org-ul">
<li>dev-libs/jemalloc -  general-purpose scalable concurrent allocator, malloc(3) implementation</li>
<li>dev-util/google-perftools -  fastest malloc we’ve seen; works particularly well with threads</li>
</ul>
<p>
and STL.
</p>
</div>
</div>
<div id="outline-container-org1691a6e" class="outline-3">
<h3 id="org1691a6e"><span class="section-number-3">17.11.</span> init</h3>
<div class="outline-text-3" id="text-17-11">
<ol class="org-ol">
<li>edit /etc/redis/redis.conf</li>
<li>redis-server - two ways:
<ul class="org-ul">
<li>redis-server /etc/redis/6379.confredis.conf - Run the server with a configuration file</li>
<li>redis-server &#x2013;dbfilename myredis.db - passing changed default options of /etc/redis/redis.conf with &#x2013; two slashes
<ul class="org-ul">
<li>&#x2013;save "600 1 30 10 6 100" will not be used</li>
</ul></li>
</ul></li>
</ol>

<p>
<a href="https://www.mankier.com/1/redis-server">https://www.mankier.com/1/redis-server</a>
</p>
</div>
</div>
<div id="outline-container-orgefcf38c" class="outline-3">
<h3 id="orgefcf38c"><span class="section-number-3">17.12.</span> Best Practices</h3>
<div class="outline-text-3" id="text-17-12">
<p>
In Redis, you don’t need schemas or column names, but you do need to figure out how your data is
 best represented in terms of simple key-value strings, lists, hashes, sets, or sorted sets.
</p>
<ul class="org-ul">
<li>For example, storing a million jobs in a list, but then needing to retieve jobs based on
alphabetical order will kill your Redis performance. You need to use appropriate data structures
for appropriate use cases.</li>
</ul>

<p>
In traditional RDBS: Table scans are O(N) while fully indexed queries are O(lg N).
</p>

<p>
You should keep in mind RUGSS:
</p>
<dl class="org-dl">
<dt>retrieval</dt><dd>think before ways to retieve. Custom Indexing</dd>
<dt>(no term)</dt><dd>storage</dd>
<dt>(no term)</dt><dd>size</dd>
<dt>(no term)</dt><dd>growth</dd>
<dt>(no term)</dt><dd>user access.</dd>
</dl>

<p>
bp
</p>
<ul class="org-ul">
<li>Regularly <b>back up your Redis</b> database to prevent data loss in case of server failures.</li>
<li>Monitor your Redis instance’s performance and adjust the <b>dbfilename</b> frequency <b>or dir path</b> as
needed to balance persistence and performance. ??</li>
<li>Consider using a more descriptive file name for better organization and tracking purposes.</li>
<li>Very long keys are not a good idea. For instance a key of 1024 bytes is a bad idea not only
memory-wise, but also because the lookup of the key in the dataset may require several costly
key-comparisons. Even when the task at hand is to match the existence of a large value, hashing it
(for example with SHA1) is a better idea, especially from the perspective of memory and bandwidth.</li>
<li>Very short keys are often not a good idea. There is little point in writing "u1000flw" as a key if
you can instead write "user:1000:followers". The latter is more readable and the added space is
minor compared to the space used by the key object itself and the value object. While short keys
will obviously consume a bit less memory, your job is to find the right balance.</li>
<li>Try to stick with a schema. For instance "object-type:id" is a good idea, as in "user:1000". Dots
or dashes are often used for multi-word fields, as in "comment:4321:reply.to" or
"comment:4321:reply-to".</li>
<li>The maximum allowed key size is 512 MB.</li>
<li>It is more space effective to represent a “set” data structure
as a map/dict in Redis (SET vs HASH). In our case, the majority of our SET sizes will be below the
default value for <b>hash<sub>max</sub><sub>ziplist</sub><sub>entries</sub></b> which is 512. And, in the scenario where the SET size
exceeds this configured value (which we do run into sometimes), we can be confident that our
existing and new HASHes will not be affected.</li>
<li>Redis will store hashes (via "hset" or similar) in an optimized way if the hash does end up having
more than <b>hash-max-ziplist-entries</b> entries, or if each the values are smaller than
<b>hash-max-ziplist-values</b> 64 bytes.</li>
<li>Be cautious when using KEYS command (or its equivalent methods in clients) especially in
production environments because this command can negatively affect performance if it returns a
large number of keys. It's generally better to use scan-based commands like scan<sub>iter</sub>.</li>
<li>Always close the redis connection when it's no longer needed.</li>
</ul>


<p>
<a href="https://matt.sh/thinking-in-redis-part-one">https://matt.sh/thinking-in-redis-part-one</a>
</p>
</div>
</div>
<div id="outline-container-orga8f19a9" class="outline-3">
<h3 id="orga8f19a9"><span class="section-number-3">17.13.</span> Python - connector - dev-python/redis</h3>
<div class="outline-text-3" id="text-17-13">
<pre class="example">
redis-server --dbfilename dump.rdb --port 6379 --maxclients 1
</pre>
</div>
</div>

<div id="outline-container-org50b4677" class="outline-3">
<h3 id="org50b4677"><span class="section-number-3">17.14.</span> commands</h3>
<div class="outline-text-3" id="text-17-14">
<p>
pipeline - r.pipeline(); pipe.execute()
</p>
</div>
<div id="outline-container-orgd2f7229" class="outline-4">
<h4 id="orgd2f7229"><span class="section-number-4">17.14.1.</span> retrive</h4>
<div class="outline-text-4" id="text-17-14-1">
</div>
<ol class="org-ol">
<li><a id="org2926427"></a>KEYS and SMEMBERS (get all valus of sorted set by key) that may block the server.<br />
<div class="outline-text-5" id="text-17-14-1-1">
<p>
KEYS pattern
</p>
<ul class="org-ul">
<li>O(N) with N being the number of keys</li>
<li>glob patterns supported</li>
</ul>
</div>
</li>
<li><a id="orgf927a36"></a>GET - strings<br />
<div class="outline-text-5" id="text-17-14-1-2">
<p>
O(1)
</p>
<ul class="org-ul">
<li>GET retrieves a string value.</li>
<li><p>
MGET retrieves multiple string values in a single operation.
</p>

<p>
An error is returned if the value stored at key is not a string, because GET only handles string values.
</p></li>
</ul>
</div>
</li>
<li><a id="org40fb513"></a>SCAN - get with cursor, incrementally iterate over a collection of elements.<br />
<div class="outline-text-5" id="text-17-14-1-3">
<p>
SCAN - O(1)-O(N) - SSCAN, HSCAN, ZSCAN
</p>
</div>
</li>

<li><a id="org263a20c"></a>ZRANGE - scorted set<br />
<div class="outline-text-5" id="text-17-14-1-4">
<p>
ZRANGE key start stop [BYSCORE | BYLEX] [REV] [LIMIT offset count]
  [WITHSCORES]
</p>
<ul class="org-ul">
<li>by default - index range query - first, second</li>
<li>BYSCORE -</li>
<li>BYLEX</li>
</ul>
</div>
</li>
</ol>
</div>
<div id="outline-container-orgc7db7bd" class="outline-4">
<h4 id="orgc7db7bd"><span class="section-number-4">17.14.2.</span> set</h4>
<div class="outline-text-4" id="text-17-14-2">
</div>
<ol class="org-ol">
<li><a id="org343e473"></a>SET - string, Getting and setting Strings<br />
<div class="outline-text-5" id="text-17-14-2-1">
<p>
SET key value [NX | XX] [GET] [EX seconds | PX milliseconds |
  EXAT unix-time-seconds | PXAT unix-time-milliseconds | KEEPTTL]
</p>
<ul class="org-ul">
<li>SET stores a string value.</li>
<li>SETNX stores a string value only if the key doesn't already exist. Useful for implementing locks.</li>
</ul>
</div>
</li>


<li><a id="orgab8a96d"></a>HSET - hash - Redis hashes are record types structured as collections of field-value pairs.<br />
<div class="outline-text-5" id="text-17-14-2-2">
<ul class="org-ul">
<li>HSET &lt;name/key&gt; &lt;key/field&gt; &lt;value&gt; [field value &#x2026;] - sets multiple fields of the hash</li>
<li>HGET &lt;name&gt; &lt;key&gt; - Return the value of ``key`` within the hash ``name``</li>
<li>HKEYS &lt;name&gt; - Return the list of keys within hash ``name``</li>
<li>hgetall(self, name: str) -&gt; dict</li>
</ul>

<p>
HSET - Sets the specified fields to their respective values
Set <b>key</b> to <b>value</b> within hash <b>name</b>. see <a href="#orgcd99b1c">17.3</a>
</p>
<dl class="org-dl">
<dt>mapping</dt><dd>accepts a dict of key/value pairs that will be added to hash ``name``.</dd>
<dt>items</dt><dd>accepts a list of key/value pairs that will be added to hash ``name``.  Returns the
number of fields that were added.</dd>
</dl>

<p>
<a href="https://redis.io/docs/latest/develop/data-types/hashes/">https://redis.io/docs/latest/develop/data-types/hashes/</a>
</p>
</div>
</li>

<li><a id="orgfcbdbbb"></a>LPUSH - list -  at the head<br />
<div class="outline-text-5" id="text-17-14-2-3">
<p>
LPUSH key element [element &#x2026;]
</p>
</div>
</li>
</ol>
</div>

<div id="outline-container-org887202b" class="outline-4">
<h4 id="org887202b"><span class="section-number-4">17.14.3.</span> comment</h4>
<div class="outline-text-4" id="text-17-14-3">
<pre class="example">
ECHO "Setting foo to bar"
</pre>
</div>
</div>
</div>
<div id="outline-container-org1cb6d7c" class="outline-3">
<h3 id="org1cb6d7c"><span class="section-number-3">17.15.</span> tools</h3>
<div class="outline-text-3" id="text-17-15">
<p>
<a href="https://redis.io/clients">https://redis.io/clients</a>
</p>

<dl class="org-dl">
<dt>redis-server</dt><dd>main</dd>
<dt>redis-sentinel</dt><dd>monitors Redis instances and can automatically failover to a replica if the master instance fails.</dd>
<dt>redis-cli</dt><dd>This is the Redis command-line interface. It allows you to interact with Redis
instances, execute commands, and monitor their status. You can use it to check the configuration,
monitor the replication status, and execute commands like INFO, ROLE, and MONITOR.</dd>
<dt>redis-check-aof</dt><dd>This tool checks the integrity of the Append-Only File (AOF) used for
persistence in Redis. It helps ensure that the AOF is consistent and can be used to recover the
dataset in case of a failure.</dd>
<dt>redis-check-rdb</dt><dd>This tool checks the integrity of the Redis Database (RDB) snapshots used for
persistence in Redis. It helps ensure that the RDB snapshots are consistent and can be used to
recover the dataset in case of a failure.</dd>
</dl>
</div>
</div>
<div id="outline-container-orgd193ccb" class="outline-3">
<h3 id="orgd193ccb"><span class="section-number-3">17.16.</span> <span class="todo TODO">TODO</span> Indexes</h3>
<div class="outline-text-3" id="text-17-16">
<p>
FLAT VS HNSW INDEXING
</p>

<p>
<a href="https://redis.io/learn/howtos/solutions/vector/getting-started-vector">https://redis.io/learn/howtos/solutions/vector/getting-started-vector</a>
</p>


<p>
Redis VSS capability  - a new feature of the RediSearch module.
</p>
<ul class="org-ul">
<li>It allows developers to store a vector just as easily as any other field in a Redis hash</li>
<li><a href="https://redis.io/blog/build-intelligent-apps-redis-vector-similarity-search/">https://redis.io/blog/build-intelligent-apps-redis-vector-similarity-search/</a>
<ul class="org-ul">
<li><a href="https://github.com/RedisAI/vecsim-demo">https://github.com/RedisAI/vecsim-demo</a></li>
<li></li>

<li><a href="https://github.com/RedisAI/vecsim-demo">https://github.com/RedisAI/vecsim-demo</a></li>
</ul></li>
</ul>

<p>
<a href="https://redis.io/blog/redisearch-2-build-modern-applications-interactive-search/">https://redis.io/blog/redisearch-2-build-modern-applications-interactive-search/</a>    -
</p>
<ul class="org-ul">
<li>RediSearch 2.0 - module for Redis: querying, indexing, and full-text search engine
<ul class="org-ul">
<li>Evolution: Pure key-value (unstructured key) -&gt; Redis (sub values of key) -&gt; RediSearch (indexes
on key structures, query language)</li>
<li>aggregations, highlights, stemming, and spelling correction.</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-orgaa68758" class="outline-3">
<h3 id="orgaa68758"><span class="section-number-3">17.17.</span> distributed usage</h3>
<div class="outline-text-3" id="text-17-17">
<p>
types:
</p>
<ul class="org-ul">
<li>Master-Slave Replication - for high availability and fault tolerance</li>
<li>Sharding - dividing - for horizontal scaling</li>
<li>Redis Cluster - automatic sharding, replication, and failover. each responsible for a subset of
the key space, uses a hash function to determine which node to store a given key.</li>
<li>Distributed Caching - clients can query any node to retrieve the data</li>
</ul>
</div>
<div id="outline-container-orgc0ce9cd" class="outline-4">
<h4 id="orgc0ce9cd"><span class="section-number-4">17.17.1.</span> Scaling</h4>
<div class="outline-text-4" id="text-17-17-1">
<p>
<a href="https://redis.io/docs/latest/operate/oss_and_stack/management/scaling/">https://redis.io/docs/latest/operate/oss_and_stack/management/scaling/</a>
</p>

<p>
TCP: 6379, cluster bus port 16379
</p>

<p>
hash slot
</p>
<ul class="org-ul">
<li>16384 hash slots.</li>
<li>Every node in a Redis Cluster is responsible for a subset of the hash slots ex. 0-5500</li>
<li>to compute the hash slot for a given key, we simply take the CRC16 of the key modulo 16384.</li>
<li>HASH<sub>SLOT</sub> = CRC16(key) mod 16384</li>
</ul>

<p>
hash tags - force multiple keys to be part of the same hash slot
</p>
<ul class="org-ul">
<li>curly braces ({ and }) are signifiers of a hashtag and the string between these two characters is
put through the CRC16 hashing function.:
<ul class="org-ul">
<li>user-profile:{1234} - CRC16(‘1234’) mod 16384</li>
<li>user-session:{1234} - CRC16(‘1234’) mod 16384</li>
</ul></li>
</ul>

<p>
master-replica model - A, B, C masters and A1, B1, C1 replicas.
</p>
<ul class="org-ul">
<li><b>maximum window</b> is amount of writes that master accept, ???, side will have stopped accepting writes.</li>
<li><b>node timeout</b> - After node timeout has elapsed, a master node is considered to be failing, and can be replaced by one of its replicas.</li>
<li>inimal cluster that works as expected must contain at least three master nodes.</li>
</ul>

<p>
to connect to several master nodes we need cluster aware client:
</p>
<ul class="org-ul">
<li><a href="https://redis.io/docs/latest/develop/connect/clients/">https://redis.io/docs/latest/develop/connect/clients/</a></li>
</ul>
</div>

<ol class="org-ol">
<li><a id="org7cd19cc"></a><a href="https://redis-py.readthedocs.io/en/stable/clustering.html">https://redis-py.readthedocs.io/en/stable/clustering.html</a><br />
<div class="outline-text-5" id="text-17-17-1-1">
<p>
attempts to establish a connection to one of the provided startup nodes.
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">from</span> redis.cluster <span style="color: #8ac6f2; font-weight: bold;">import</span> RedisCluster <span style="color: #8ac6f2; font-weight: bold;">as</span> Redis
<span style="color: #8ac6f2; font-weight: bold;">from</span> redis.cluster <span style="color: #8ac6f2; font-weight: bold;">import</span> ClusterNode
<span style="color: #cae682;">nodes</span> = [ClusterNode(<span style="color: #95e454;">'localhost'</span>, 6379), ClusterNode(<span style="color: #95e454;">'localhost'</span>, 6378)]
<span style="color: #cae682;">rc</span> = Redis(startup_nodes=nodes)
</pre>
</div>
</div>
</li>
<li><a id="org2630bbe"></a>utils/create-cluster directory in the Redis distribution - start a big number of Redis instances<br />
<div class="outline-text-5" id="text-17-17-1-2">
<p>
configured to run in cluster mode. Allow manual testing.
</p>
<ul class="org-ul">
<li><a href="https://github.com/redis/redis/blob/unstable/utils/create-cluster/create-cluster">https://github.com/redis/redis/blob/unstable/utils/create-cluster/create-cluster</a></li>
<li>replace:
<ul class="org-ul">
<li>$BIN<sub>PATH</sub>/redis-server with /usr/sbin/redis-server</li>
<li>$BIN<sub>PATH</sub>/redis-cli with /usr/bin/redis-cli</li>
<li>exit 0 with “# exit 0”</li>
<li>NODES=6 with NODES=3</li>
<li>REPLICAS=1 with REPLICAS=0</li>
<li>tail -f <b>.log  with tail -f ${PORT%?}</b>.log</li>
<li>ADDITIONAL<sub>OPTIONS</sub>="&#x2013;cluster-require-full-coverage no &#x2013;repl-timeout 60"</li>
<li>wrap bottom “echos” with if [ -z "$1" ]; then &#x2026;.. fi</li>
<li>add as a last line: echo "--------------------------&#x2013;&#x2014;"</li>
</ul></li>
<li>. create-cluster.sh start # 3 nodes created</li>
<li>. create-cluster.sh create</li>
</ul>
</div>
</li>

<li><a id="orgf2b69fd"></a>links<br />
<div class="outline-text-5" id="text-17-17-1-3">
<ul class="org-ul">
<li><a href="https://redis.io/docs/latest/operate/oss_and_stack/management/scaling/">https://redis.io/docs/latest/operate/oss_and_stack/management/scaling/</a></li>
<li>article <a href="https://severalnines.com/blog/hash-slot-resharding-and-rebalancing-redis-cluster/">https://severalnines.com/blog/hash-slot-resharding-and-rebalancing-redis-cluster/</a></li>
<li>article <a href="https://severalnines.com/blog/hash-slot-vs-consistent-hashing-redis/">https://severalnines.com/blog/hash-slot-vs-consistent-hashing-redis/</a></li>
</ul>
</div>
</li>
</ol>
</div>
<div id="outline-container-org85bdbdc" class="outline-4">
<h4 id="org85bdbdc"><span class="section-number-4">17.17.2.</span> replication</h4>
<div class="outline-text-4" id="text-17-17-2">
<p>
<a href="https://redis.io/docs/latest/operate/oss_and_stack/management/replication/">https://redis.io/docs/latest/operate/oss_and_stack/management/replication/</a>
</p>
</div>
</div>
<div id="outline-container-orge1105fd" class="outline-4">
<h4 id="orge1105fd"><span class="section-number-4">17.17.3.</span> Lock</h4>
<div class="outline-text-4" id="text-17-17-3">
<p>
Distributed Lock Manager - to organise access to shared resources. runs in every machine in a
 cluster, with an identical copy of a cluster-wide lock database.
</p>

<p>
Redlock - DLM, proposed algorithm by Redis.
</p>
<ul class="org-ul">
<li>client send lock to multiple Redis instances. lock is successfully acquired when more than half of
these instances agree . client send GET and DEL command  on all the instances involved</li>
<li>takes into account the lock validity time, retry on failure, lock extension, and many other
aspects, which makes it a robust and reliable solution for distributed locking.</li>
</ul>

<p>
links
</p>
<ul class="org-ul">
<li><a href="https://redis.io/docs/latest/develop/use/patterns/distributed-locks/">https://redis.io/docs/latest/develop/use/patterns/distributed-locks/</a></li>
<li><a href="https://redis.io/glossary/distributed-events/">https://redis.io/glossary/distributed-events/</a></li>
</ul>
</div>
</div>
<div id="outline-container-org5e000a6" class="outline-4">
<h4 id="org5e000a6"><span class="section-number-4">17.17.4.</span> commands</h4>
<div class="outline-text-4" id="text-17-17-4">
<p>
Basic nodes in short:
</p>
<pre class="example">
redis-cli -p 7000 cluster nodes
</pre>

<p>
Advanced statistic:
</p>
<pre class="example">
redis-cli -p 30001 CLUSTER SHARDS
</pre>

<p>
Obsolate:
</p>
<pre class="example">
redis-cli -p 30001 CLUSTER SLOTS
</pre>


<p>
Execute command at every master node. Allow to find keys location.
</p>
<pre class="example">
redis-cli --cluster call localhost:30001 KEYS "*"
</pre>


<p>
Hash name is used as a hash tag.
</p>
</div>
</div>
</div>
<div id="outline-container-orgf11380f" class="outline-3">
<h3 id="orgf11380f"><span class="section-number-3">17.18.</span> ORM</h3>
<div class="outline-text-3" id="text-17-18">
<p>
<a href="https://github.com/redis/redis-om-python/">https://github.com/redis/redis-om-python/</a>
</p>

<p>
FastAPI integration <a href="https://github.com/redis/redis-om-python/blob/main/docs/fastapi_integration.md">https://github.com/redis/redis-om-python/blob/main/docs/fastapi_integration.md</a>
</p>
</div>
</div>
<div id="outline-container-org13ed08c" class="outline-3">
<h3 id="org13ed08c"><span class="section-number-3">17.19.</span> architect schema - usecase</h3>
<div class="outline-text-3" id="text-17-19">
</div>
<div id="outline-container-org4578c6a" class="outline-4">
<h4 id="org4578c6a"><span class="section-number-4">17.19.1.</span> Sorting</h4>
<div class="outline-text-4" id="text-17-19-1">
<p>
Set
</p>
<pre class="example">
multi
HSET redishop:items:Handcrafted-Trees-Mug price 99
sadd redishop:all-items Handcrafted-Trees-Mug
exec
</pre>

<p>
“#” is a pattern to GET the element itself
</p>
<pre class="example">
SORT redishop:all-items BY redishop:items:*-&gt;price GET # GET redishop:items:*-&gt;price
</pre>


<p>
Sorted Set
</p>
<pre class="example">
zadd redishop:priceIndex 10.99 Handcrafted-Trees-Mug
ZRANGEBYSCORE redishop:priceIndex 15 17 WITHSCORES
</pre>
</div>
</div>
</div>
<div id="outline-container-org5930775" class="outline-3">
<h3 id="org5930775"><span class="section-number-3">17.20.</span> timeouts for cluster</h3>
<div class="outline-text-3" id="text-17-20">
<p>
Close the connection after a client is idle for N seconds (0 to disable)
</p>
<pre class="example">
timeout 0
</pre>


<p>
Master send PINGs to its replicas:
</p>
<pre class="example">
repl-ping-replica-period 10
</pre>


<ol class="org-ol">
<li>Bulk transfer I/O during SYNC, from the point of view of replica.</li>
<li>Master timeout from the point of view of replicas (data, pings).</li>
<li>Replica timeout from the point of view of masters (REPLCONF ACK pings).</li>
</ol>
<pre class="example">
repl-timeout 60
</pre>


<p>
RedisCluster(AbstractRedisCluster, RedisClusterCommands)
</p>
<ul class="org-ul">
<li>f ile:/usr/lib/python3.12/site-packages/redis/cluster.py::133</li>
<li>cluster<sub>error</sub><sub>retry</sub><sub>attempts</sub>, default is 3 for CLUSTERDOWN</li>
<li>reinitialize<sub>steps</sub>, default =5
<ul class="org-ul">
<li>number of MOVED errors that need to occur before reinitializing the whole cluster topology.</li>
</ul></li>
<li>retry Retry(default<sub>backoff</sub>(), 0)</li>
</ul>
</div>
</div>

<div id="outline-container-org4677308" class="outline-3">
<h3 id="org4677308"><span class="section-number-3">17.21.</span> Get a range of keys with redis?</h3>
<div class="outline-text-3" id="text-17-21">
<ol class="org-ol">
<li>(2 query) sorted set, with unix timestamps or incremental id
<ol class="org-ol">
<li>Sorted sets are implemented via a dual-ported data structure containing both a skip list and a hash table</li>
<li>Add: O(log(N))</li>
<li>set: ZADD racer<sub>scores</sub> 8 "Sam-Bodden" 10 "Royce" 6 "Ford" 14 "Prickett"</li>
<li>get: ZRANGE racer<sub>scores</sub> 0 -1 withscores</li>
<li><a href="https://redis.io/docs/latest/develop/data-types/sorted-sets/">https://redis.io/docs/latest/develop/data-types/sorted-sets/</a></li>
</ol></li>
<li>MGET key1 key2 key3 &#x2026; or HMGET key field [field &#x2026;]</li>
<li>(not working for cluster print(list(rc.scan<sub>iter</sub>('id:*', count=100))) # slow?</li>
<li>put Ids into sorted set then use mget to get values out
<ul class="org-ul">
<li>if your keys are hashes then you need to issue multiple hget, but the advantage is that you can pull out
specific parts of the object that you actually need instead of everything. It is very fast in practice.</li>
</ul></li>
<li>(fastest, not working in cluster) SORT with list, set or sorted set <a href="https://redis.io/docs/latest/commands/sort/">https://redis.io/docs/latest/commands/sort/</a> <a href="https://stackoverflow.com/questions/3329408/is-there-mget-analog-for-redis-hashes">https://stackoverflow.com/questions/3329408/is-there-mget-analog-for-redis-hashes</a>
<ul class="org-ul">
<li>hset hash:1 name fish1 # HSET key field value [field value &#x2026;]</li>
<li>hset hash:1 type fish2</li>
<li>sadd animals 1 # SADD key member [member &#x2026;] Add the specified members to the set stored at key.</li>
<li>sort animals get # return</li>
</ul></li>
<li>keys - not working for clusters</li>
<li>(to get values after getting keys) pipeline: pipe = conn.pipeline() pipe.hgetall('foo') pipe.hgetall('bar') pipe.hgetall('zar') hash1, hash2, hash3 = pipe.execute()</li>
<li>(for cluster) redis-cli &#x2013;cluster call -p 30001 KEYS "*" ; Python: rc.keys(target<sub>nodes</sub>=Redis.ALL<sub>NODES</sub>)</li>
</ol>

<p>
SortedSet is a collection of unique strings (members) ordered by an associated score.
</p>
<ul class="org-ul">
<li>ZADD adds a new member and associated score to a sorted set. If the member already exists, the score is updated.</li>
<li>ZRANGE returns members of a sorted set, sorted within a given range.</li>
<li>ZRANK returns the rank of the provided member, assuming the sorted is in ascending order.</li>
<li>ZREVRANK returns the rank of the provided member, assuming the sorted set is in descending order.</li>
</ul>

<p>
ZRANGE key start stop [BYSCORE | BYLEX] [REV] [LIMIT offset count] [WITHSCORES]
</p>
<ul class="org-ul">
<li>WITHSCORES output lines:  1) "Ford"  2) "6"  3) "Sam-Bodden"  4) "8"</li>
<li>O(log(N)+M) with N being the number of elements in the sorted set and M the number of elements returned.</li>
</ul>

<p>
SORT key [BY pattern] [LIMIT offset count] [GET pattern [GET pattern  &#x2026;]] [ASC | DESC] [ALPHA] [STORE destination]
</p>
<ul class="org-ul">
<li>O(N+M*log(M)) where N is the number of elements in the list or set to sort, and M the number of returned
elements. When the elements are not sorted, complexity is O(N).</li>
</ul>

<p>
SADD key member [member &#x2026;]
</p>

<p>
Avoid using the KEYS command to fetch keys on large databases as it may block the server until it's completed.
</p>
<div class="org-src-container">
<pre class="src src-text">hset hash:{1}:1 name fish1
hset hash:{1}:2 name donkey
hset hash:{1}:3 name horse
hset hash:{1}:1 type fish2
hset hash:{1}:2 type mammal
hset hash:{1}:3 type mammal
sadd animals:{1} 1
sadd animals:{1} 2
sadd animals:{1} 3
sort animals get # get hash:*-&gt;name get hash:*-&gt;type
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">from</span> redis.cluster <span style="color: #8ac6f2; font-weight: bold;">import</span> RedisCluster <span style="color: #8ac6f2; font-weight: bold;">as</span> Redis
<span style="color: #8ac6f2; font-weight: bold;">from</span> redis.cluster <span style="color: #8ac6f2; font-weight: bold;">import</span> ClusterNode

<span style="color: #cae682;">nodes</span> = [ClusterNode(<span style="color: #95e454;">'localhost'</span>, pport) <span style="color: #8ac6f2; font-weight: bold;">for</span> pport <span style="color: #8ac6f2; font-weight: bold;">in</span> <span style="color: #e5786d;">range</span>(30001,30003)]
<span style="color: #cae682;">rc</span> = Redis(startup_nodes=nodes, decode_responses=<span style="color: #e5786d; font-weight: bold;">True</span>,
           socket_connect_timeout=2) <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">2 seconds timeout</span>
<span style="color: #e5786d;">print</span>(rc.ping(target_nodes=Redis.RANDOM))
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">print(rc.set("id:{1-10}:1", "Name1"))</span>
<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">print(rc.get("id:{1-10}:1"))</span>
<span style="color: #e5786d;">print</span>(<span style="color: #e5786d;">list</span>(rc.scan_iter(<span style="color: #95e454;">'id:*'</span>)))
<span style="color: #e5786d;">print</span>(rc.keys())
</pre>
</div>
</div>
</div>

<div id="outline-container-org82e577c" class="outline-3">
<h3 id="org82e577c"><span class="section-number-3">17.22.</span> modules</h3>
<div class="outline-text-3" id="text-17-22">
<p>
<a href="https://redis.io/docs/latest/develop/reference/modules/">https://redis.io/docs/latest/develop/reference/modules/</a>
</p>

<p>
Redis modules are dynamic libraries that can be loaded into Redis at startup, or using the MODULE LOAD command.
</p>
<ul class="org-ul">
<li>redis.conf: loadmodule /path/to/mymodule.so</li>
<li>MODULE LOAD /path/to/mymodule.so</li>
<li>MODULE LIST</li>
<li>MODULE UNLOAD mymodule</li>
</ul>
</div>
</div>
<div id="outline-container-orge9badbd" class="outline-3">
<h3 id="orge9badbd"><span class="section-number-3">17.23.</span> Vector database</h3>
<div class="outline-text-3" id="text-17-23">
<p>
support querying strategies
</p>
<ul class="org-ul">
<li>k-nearest neighbor (KNN)</li>
<li>vector range queries</li>
<li>metadata filters.</li>
</ul>

<p>
index types: FLAT and HNSW vector.
</p>
</div>
<div id="outline-container-org3df0048" class="outline-4">
<h4 id="org3df0048"><span class="section-number-4">17.23.1.</span> RedisVL - MIT</h4>
<div class="outline-text-4" id="text-17-23-1">
<p>
Python client designed for AI applications
</p>
<ul class="org-ul">
<li><a href="https://github.com/redis/redis-vl-python">https://github.com/redis/redis-vl-python</a></li>
<li><a href="https://www.redisvl.com/">https://www.redisvl.com/</a></li>
</ul>

<p>
require:
</p>
<ul class="org-ul">
<li>Redis Stack</li>
</ul>


<p>
hf = HFTextVectorizer(model="sentence-transformers/all-mpnet-base-v2")
</p>
<ul class="org-ul">
<li>438 MB</li>
<li>768 dimensional</li>
</ul>

<p>
VertexAI
</p>
<ul class="org-ul">
<li><a href="https://cloud.google.com/vertex-ai/generative-ai/docs/embeddings/get-text-embeddings">https://cloud.google.com/vertex-ai/generative-ai/docs/embeddings/get-text-embeddings</a></li>
<li>768-dimensional</li>
<li>REST support</li>
</ul>

<p>
<a href="https://dashboard.cohere.com/welcome/register">https://dashboard.cohere.com/welcome/register</a>
</p>
</div>
</div>
<div id="outline-container-org6e9a15f" class="outline-4">
<h4 id="org6e9a15f"><span class="section-number-4">17.23.2.</span> redis-py or dev-python/redis - MIT</h4>
<div class="outline-text-4" id="text-17-23-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> redis
<span style="color: #8ac6f2; font-weight: bold;">from</span> redis.commands.search.field <span style="color: #8ac6f2; font-weight: bold;">import</span> TagField, VectorField
<span style="color: #8ac6f2; font-weight: bold;">from</span> redis.commands.search.indexDefinition <span style="color: #8ac6f2; font-weight: bold;">import</span> IndexDefinition, IndexType
<span style="color: #8ac6f2; font-weight: bold;">from</span> redis.commands.search.query <span style="color: #8ac6f2; font-weight: bold;">import</span> Query

<span style="color: #cae682;">r</span> = redis.Redis(host=<span style="color: #95e454;">"localhost"</span>, port=6379)

<span style="color: #cae682;">INDEX_NAME</span> = <span style="color: #95e454;">"index"</span>                              <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Vector Index Name</span>
<span style="color: #cae682;">DOC_PREFIX</span> = <span style="color: #95e454;">"doc:"</span>                               <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">RediSearch Key Prefix for the Index</span>

<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">create_index</span>(vector_dimensions: <span style="color: #e5786d;">int</span>):
    <span style="color: #8ac6f2; font-weight: bold;">try</span>:
        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">check to see if index exists</span>
        r.ft(INDEX_NAME).info()
        <span style="color: #e5786d;">print</span>(<span style="color: #95e454;">"Index already exists!"</span>)
    <span style="color: #8ac6f2; font-weight: bold;">except</span>:
        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">schema</span>
        <span style="color: #cae682;">schema</span> = (
            TagField(<span style="color: #95e454;">"tag"</span>),                       <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Tag Field Name</span>
            VectorField(<span style="color: #95e454;">"vector"</span>,                  <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Vector Field Name</span>
                <span style="color: #95e454;">"FLAT"</span>, {                          <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Vector Index Type: FLAT or HNSW</span>
                    <span style="color: #95e454;">"TYPE"</span>: <span style="color: #95e454;">"FLOAT32"</span>,             <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">FLOAT32 or FLOAT64</span>
                    <span style="color: #95e454;">"DIM"</span>: vector_dimensions,      <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Number of Vector Dimensions</span>
                    <span style="color: #95e454;">"DISTANCE_METRIC"</span>: <span style="color: #95e454;">"COSINE"</span>,   <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Vector Search Distance Metric</span>
                }
            ),
        )

        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">index Definition</span>
        <span style="color: #cae682;">definition</span> = IndexDefinition(prefix=[DOC_PREFIX], index_type=IndexType.HASH)

        <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">create Index</span>
        r.ft(INDEX_NAME).create_index(fields=schema, definition=definition)


<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">define vector dimensions</span>
<span style="color: #cae682;">VECTOR_DIMENSIONS</span> = 2

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">--------------------create the index ---------------</span>
create_index(vector_dimensions=VECTOR_DIMENSIONS)

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">-------------------- adding vector -----------------</span>
<span style="color: #8ac6f2; font-weight: bold;">import</span> numpy <span style="color: #8ac6f2; font-weight: bold;">as</span> np

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">instantiate a redis pipeline</span>
<span style="color: #cae682;">pipe</span> = r.pipeline()

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">define some dummy data</span>
<span style="color: #cae682;">objects</span> = [ <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">name is a key</span>
    {<span style="color: #95e454;">"name"</span>: <span style="color: #95e454;">"a"</span>, <span style="color: #95e454;">"tag"</span>: <span style="color: #95e454;">"foo"</span>},
    {<span style="color: #95e454;">"name"</span>: <span style="color: #95e454;">"b"</span>, <span style="color: #95e454;">"tag"</span>: <span style="color: #95e454;">"foo"</span>},
    {<span style="color: #95e454;">"name"</span>: <span style="color: #95e454;">"c"</span>, <span style="color: #95e454;">"tag"</span>: <span style="color: #95e454;">"bar"</span>},
]

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">write data</span>
<span style="color: #8ac6f2; font-weight: bold;">for</span> obj <span style="color: #8ac6f2; font-weight: bold;">in</span> objects:
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">define key</span>
    <span style="color: #cae682;">key</span> = f<span style="color: #95e454;">"doc:</span>{obj['name']}<span style="color: #95e454;">"</span>
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">create a random "dummy" vector</span>
    <span style="color: #cae682;">obj</span>[<span style="color: #95e454;">"vector"</span>] = np.random.rand(VECTOR_DIMENSIONS).astype(np.float32).tobytes()
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">HSET - overwrite or create new</span>
    pipe.hset(key, mapping=obj) <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">key="doc:a",</span>

<span style="color: #cae682;">res</span> = pipe.execute()

<span style="color: #cae682;">a</span> = np.array([0,1], dtype=np.float32).tobytes()
<span style="color: #e5786d;">print</span>(a)
</pre>
</div>

<pre class="example">
b'\x00\x00\x00\x00\x00\x00\x80?'
</pre>


<pre class="example">

</pre>


<ul class="org-ul">
<li><a href="https://vishnudeva.medium.com/redis-as-a-vector-database-rediscloud-2a444c478f3d">https://vishnudeva.medium.com/redis-as-a-vector-database-rediscloud-2a444c478f3d</a></li>
<li><a href="https://redis-py.readthedocs.io/en/stable/examples/search_vector_similarity_examples.html">https://redis-py.readthedocs.io/en/stable/examples/search_vector_similarity_examples.html</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgad0dc3c" class="outline-4">
<h4 id="orgad0dc3c"><span class="section-number-4">17.23.3.</span> RedisGraph (obsolate)</h4>
<div class="outline-text-4" id="text-17-23-3">
<ul class="org-ul">
<li><a href="https://github.com/RedisGraph/RedisGraph">https://github.com/RedisGraph/RedisGraph</a></li>
<li><a href="https://redis.io/docs/latest/operate/oss_and_stack/stack-with-enterprise/deprecated-features/graph/">https://redis.io/docs/latest/operate/oss_and_stack/stack-with-enterprise/deprecated-features/graph/</a></li>
</ul>


<p>
After January 31, 2025, RedisGraph commands will be disabled on Redis Enterprise Cloud.
</p>

<p>
Based on the Property Graph Model
</p>
<ul class="org-ul">
<li>nodes and relationships may have attributes</li>
</ul>

<p>
Graphs represented as sparse adjacency matrices
</p>

<p>
Cypher as query language - queries translated into linear algebra expressions
</p>

<p>
uses sparse adjacency matrices to represent graphs.
</p>
<ul class="org-ul">
<li>adjacency matrix M - rows represent source nodes while matrix columns represent destination nodes.</li>
</ul>
</div>
<ol class="org-ol">
<li><a id="org24bc53e"></a>arch<br />
<div class="outline-text-5" id="text-17-23-3-1">
<p>
graph with two relationships types: visits and friend
</p>

<p>
Matrices:
</p>
<ul class="org-ul">
<li>THE adjacency matrix - marking every connection within the graph</li>
<li>visit matrix - marking visit connections</li>
<li>friend matrix - marking friend connections</li>
</ul>
</div>
</li>
</ol>
</div>

<div id="outline-container-orgb210f0b" class="outline-4">
<h4 id="orgb210f0b"><span class="section-number-4">17.23.4.</span> links</h4>
<div class="outline-text-4" id="text-17-23-4">
<ul class="org-ul">
<li>empty <a href="https://redis.com/solutions/use-cases/vector-database/">https://redis.com/solutions/use-cases/vector-database/</a>
<ul class="org-ul">
<li><a href="https://redis.io/docs/latest/develop/interact/search-and-query/advanced-concepts/vectors/">https://redis.io/docs/latest/develop/interact/search-and-query/advanced-concepts/vectors/</a></li>
</ul></li>
<li><a href="https://redis.io/docs/latest/develop/interact/search-and-query/indexing/">https://redis.io/docs/latest/develop/interact/search-and-query/indexing/</a></li>
<li><a href="https://redis.io/docs/latest/commands/ft.create/">https://redis.io/docs/latest/commands/ft.create/</a></li>
<li><a href="https://redis.io/docs/latest/develop/get-started/vector-database/">https://redis.io/docs/latest/develop/get-started/vector-database/</a></li>

<li><a href="https://redis-py.readthedocs.io/en/stable/examples/search_vector_similarity_examples.html">https://redis-py.readthedocs.io/en/stable/examples/search_vector_similarity_examples.html</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgcab4fea" class="outline-3">
<h3 id="orgcab4fea"><span class="section-number-3">17.24.</span> Knowledge Graph implementation on vanila Redis</h3>
<div class="outline-text-3" id="text-17-24">
<p>
Key Points
</p>
<ul class="org-ul">
<li>Sets for Relationships: Using sets for relationships ensures fast membership tests and additions.</li>
<li>Pipelining: Pipelining reduces the number of round-trips to the server, improving overall performance.</li>
<li>BFS Algorithm: The BFS algorithm ensures efficient traversal of the graph to find entities within N hops.</li>
<li>Optimized Retrieval: Using SMEMBERS for retrieving all members of a set in a single command optimizes the retrieval process.</li>
</ul>
</div>
<div id="outline-container-org978acca" class="outline-4">
<h4 id="org978acca"><span class="section-number-4">17.24.1.</span> nlp</h4>
<div class="outline-text-4" id="text-17-24-1">
<p>
Knowledge graphs are one of the best ways to connect and make sense out of information from
 different data sources, following the motto of one of the vendors— “It’s about things not strings”.
</p>

<p>
<a href="https://redis.io/learn/howtos/nlp">https://redis.io/learn/howtos/nlp</a>
</p>
</div>
</div>
<div id="outline-container-org7539ee6" class="outline-4">
<h4 id="org7539ee6"><span class="section-number-4">17.24.2.</span> code</h4>
<div class="outline-text-4" id="text-17-24-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8ac6f2; font-weight: bold;">import</span> redis

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Connect to Redis</span>
<span style="color: #cae682;">r</span> = redis.Redis(host=<span style="color: #95e454;">'localhost'</span>, port=6379, db=0)

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Function to create an entity</span>
<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">create_entity</span>(entity_id, entity_type, properties):
    r.hset(f<span style="color: #95e454;">"</span>{entity_type}<span style="color: #95e454;">:</span>{entity_id}<span style="color: #95e454;">"</span>, mapping=properties)
    <span style="color: #8ac6f2; font-weight: bold;">return</span> entity_id

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Function to create a relationship between entities</span>
<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">create_relationship</span>(entity_id1, entity_id2, relationship_type):
    r.sadd(f<span style="color: #95e454;">"</span>{relationship_type}<span style="color: #95e454;">:</span>{entity_id1}<span style="color: #95e454;">"</span>, entity_id2)
    r.sadd(f<span style="color: #95e454;">"</span>{relationship_type}<span style="color: #95e454;">:</span>{entity_id2}<span style="color: #95e454;">"</span>, entity_id1)
    <span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #e5786d; font-weight: bold;">True</span>

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Define a function to query entities by property</span>
<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">query_entities_by_property</span>(entity_type, property_name, property_value):
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Use Redis Search to index entity properties</span>
    <span style="color: #cae682;">index_name</span> = f<span style="color: #95e454;">"</span>{entity_type}<span style="color: #95e454;">:</span>{property_name}<span style="color: #95e454;">"</span>
    r.ft(index_name).add_doc(json.dumps({property_name: property_value}))
    <span style="color: #cae682;">results</span> = r.ft(index_name).search(property_value)
    <span style="color: #8ac6f2; font-weight: bold;">return</span> results

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Define a function to query relationships between entities</span>
<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">query_relationships</span>(entity_id1, entity_id2, relationship_type):
    <span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Use a set to store relationships</span>
    <span style="color: #cae682;">relationships</span> = r.smembers(f<span style="color: #95e454;">"</span>{relationship_type}<span style="color: #95e454;">:</span>{entity_id1}<span style="color: #95e454;">"</span>)
    <span style="color: #8ac6f2; font-weight: bold;">return</span> entity_id2 <span style="color: #8ac6f2; font-weight: bold;">in</span> relationships

<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">get_entity_properties</span>(entity_id, entity_type):
    <span style="color: #8ac6f2; font-weight: bold;">return</span> r.hgetall(f<span style="color: #95e454;">"</span>{entity_type}<span style="color: #95e454;">:</span>{entity_id}<span style="color: #95e454;">"</span>)

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Function to retrieve entities with N hops using BFS</span>
<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">get_entities_with_n_hops</span>(entity_id, relationship_type, n):
    <span style="color: #cae682;">visited</span> = <span style="color: #e5786d;">set</span>()
    <span style="color: #cae682;">queue</span> = [(entity_id, 0)]
    <span style="color: #cae682;">result</span> = []

    <span style="color: #8ac6f2; font-weight: bold;">while</span> queue:
        <span style="color: #cae682;">current_entity</span>, <span style="color: #cae682;">current_hop</span> = queue.pop(0)
        <span style="color: #8ac6f2; font-weight: bold;">if</span> current_entity <span style="color: #8ac6f2; font-weight: bold;">not</span> <span style="color: #8ac6f2; font-weight: bold;">in</span> visited:
            visited.add(current_entity)
            <span style="color: #8ac6f2; font-weight: bold;">if</span> current_hop &lt; n:
                result.append(current_entity)
                <span style="color: #8ac6f2; font-weight: bold;">for</span> next_entity <span style="color: #8ac6f2; font-weight: bold;">in</span> r.smembers(f<span style="color: #95e454;">"</span>{relationship_type}<span style="color: #95e454;">:</span>{current_entity}<span style="color: #95e454;">"</span>):
                    queue.append((next_entity, current_hop + 1))
            <span style="color: #8ac6f2; font-weight: bold;">elif</span> current_hop == n:
                result.append(current_entity)

    <span style="color: #8ac6f2; font-weight: bold;">return</span> result

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Function to retrieve relationships</span>
<span style="color: #8ac6f2; font-weight: bold;">def</span> <span style="color: #cae682; font-weight: bold;">get_relationships</span>(entity_id, relationship_type):
    <span style="color: #8ac6f2; font-weight: bold;">return</span> r.smembers(f<span style="color: #95e454;">"</span>{relationship_type}<span style="color: #95e454;">:</span>{entity_id}<span style="color: #95e454;">"</span>)


<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Create entities</span>
<span style="color: #cae682;">entity_id1</span> = create_entity(1, <span style="color: #95e454;">"Person"</span>, {<span style="color: #95e454;">"name"</span>: <span style="color: #95e454;">"John"</span>, <span style="color: #95e454;">"age"</span>: 30})
<span style="color: #cae682;">entity_id2</span> = create_entity(2, <span style="color: #95e454;">"Person"</span>, {<span style="color: #95e454;">"name"</span>: <span style="color: #95e454;">"Jane"</span>, <span style="color: #95e454;">"age"</span>: 25})
<span style="color: #cae682;">entity_id3</span> = create_entity(3, <span style="color: #95e454;">"Person"</span>, {<span style="color: #95e454;">"name"</span>: <span style="color: #95e454;">"Bob"</span>, <span style="color: #95e454;">"age"</span>: 35})

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Create relationships</span>
create_relationship(entity_id1, entity_id2, <span style="color: #95e454;">"Friend"</span>)
create_relationship(entity_id2, entity_id3, <span style="color: #95e454;">"Friend"</span>)
create_relationship(entity_id3, entity_id1, <span style="color: #95e454;">"Friend"</span>)

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Retrieve entities connected to entity_id1 with 2 hops</span>
<span style="color: #cae682;">connected_entities</span> = get_entities_with_n_hops(entity_id1, <span style="color: #95e454;">"Friend"</span>, 2)
<span style="color: #e5786d;">print</span>(connected_entities)

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Using pipelining for efficient retrieval</span>
<span style="color: #8ac6f2; font-weight: bold;">with</span> r.pipeline() <span style="color: #8ac6f2; font-weight: bold;">as</span> pipe:
    pipe.smembers(f<span style="color: #95e454;">"Friend:</span>{entity_id1}<span style="color: #95e454;">"</span>)
    pipe.smembers(f<span style="color: #95e454;">"Friend:</span>{entity_id2}<span style="color: #95e454;">"</span>)
    <span style="color: #cae682;">result</span> = pipe.execute()
<span style="color: #e5786d;">print</span>(result)

<span style="color: #e5786d;">print</span>(get_entity_properties(entity_id1, <span style="color: #95e454;">"Person"</span>))

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Query entities by property</span>
<span style="color: #cae682;">results</span> = query_entities_by_property(<span style="color: #95e454;">"Person"</span>, <span style="color: #95e454;">"age"</span>, 30)
<span style="color: #e5786d;">print</span>(results)

<span style="color: #fa8072;"># </span><span style="color: #99968b; font-style: italic;">Query relationships between entities</span>
<span style="color: #cae682;">relationships</span> = query_relationships(entity_id1, entity_id2, <span style="color: #95e454;">"Friend"</span>)
<span style="color: #e5786d;">print</span>(relationships)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org731ccc3" class="outline-3">
<h3 id="org731ccc3"><span class="section-number-3">17.25.</span> Emacs integration</h3>
<div class="outline-text-3" id="text-17-25">
<ul class="org-ul">
<li>eredis <a href="https://github.com/justinhj/eredis">https://github.com/justinhj/eredis</a>
<ul class="org-ul">
<li>dash-0</li>
<li>article <a href="https://justinhj.github.io/2018/11/19/eredis-updated-emacs-redis-api.html">https://justinhj.github.io/2018/11/19/eredis-updated-emacs-redis-api.html</a></li>
</ul></li>
<li>ob-redis <a href="https://repo.or.cz/ob-redis.git">https://repo.or.cz/ob-redis.git</a></li>
<li>redis <a href="https://github.com/emacs-pe/redis.el">https://github.com/emacs-pe/redis.el</a>
<ul class="org-ul">
<li>comint mode for `redis-cli'.</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org70ce640" class="outline-3">
<h3 id="org70ce640"><span class="section-number-3">17.26.</span> <span class="todo TODO">TODO</span> Feature Store</h3>
<div class="outline-text-3" id="text-17-26">
<ul class="org-ul">
<li>DoorDash - for large scale feature store for high throughput, batch random reads</li>
<li>materialized from the offline stores (S3, Snowflake, and Redshift) dbt + RedShift - to online
store (Redis). Features are also ingested into the online store from streaming sources (Kafka topics).</li>
<li>Feast + Java gRPC server and with Redis as the online store</li>
</ul>

<p>
<a href="https://redis.io/blog/feature-stores-for-real-time-artificial-intelligence-and-machine-learning/">https://redis.io/blog/feature-stores-for-real-time-artificial-intelligence-and-machine-learning/</a>
</p>
</div>
</div>
<div id="outline-container-org297f189" class="outline-3">
<h3 id="org297f189"><span class="section-number-3">17.27.</span> links</h3>
<div class="outline-text-3" id="text-17-27">
<p>
<a href="https://medium.com/@stockholmux/the-node-redis-series-e812085c917f">https://medium.com/@stockholmux/the-node-redis-series-e812085c917f</a>
</p>
</div>
</div>
</div>
<div id="outline-container-org2be182c" class="outline-2">
<h2 id="org2be182c"><span class="section-number-2">18.</span> <span class="todo TODO">TODO</span> Spark, Hadoop, Hive</h2>
<div class="outline-text-2" id="text-18">
<p>
see <a href="file:///home/u/docsmy_short/modified/bi#MissingReference">file:///home/u/docsmy_short/modified/bi#MissingReference</a>
</p>
</div>
</div>
<div id="outline-container-orge8a5de2" class="outline-2">
<h2 id="orge8a5de2"><span class="section-number-2">19.</span> REST API Documentation UIs</h2>
<div class="outline-text-2" id="text-19">
<p>
In 2015, the Swagger standard changed its name to OpenAPI. Your API documentation will be displayed
through the Swagger UI.
</p>
<ul class="org-ul">
<li>DapperDox -</li>
<li>ReDoc</li>
<li>RAML 2 HTML -</li>
</ul>
</div>
<div id="outline-container-org03c08bf" class="outline-3">
<h3 id="org03c08bf"><span class="section-number-3">19.1.</span> generate OpenAPI from Flask</h3>
<div class="outline-text-3" id="text-19-1">
<ul class="org-ul">
<li><a href="https://donofden.com/blog/2020/06/14/Python-Flask-automatically-generated-Swagger-3-0-openapi-Document">https://donofden.com/blog/2020/06/14/Python-Flask-automatically-generated-Swagger-3-0-openapi-Document</a></li>
<li><a href="https://apispec.readthedocs.io/en/latest/install.html">https://apispec.readthedocs.io/en/latest/install.html</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgc17dda5" class="outline-3">
<h3 id="orgc17dda5"><span class="section-number-3">19.2.</span> Swagger - развязность</h3>
<div class="outline-text-3" id="text-19-2">
<p>
OpenAPI Specification (formerly Swagger Specification) is an API description format for REST APIs.
</p>

<p>
YAML, being a superset of JSON
</p>

<p>
Consist off
</p>
<ul class="org-ul">
<li>Swagger Editor – browser-based editor where you can write OpenAPI specs.</li>
<li>Swagger UI – renders OpenAPI specs as interactive API documentation.</li>
<li>Swagger Codegen – generates server stubs and client libraries from an OpenAPI spec.</li>
</ul>
</div>

<div id="outline-container-orga023fdf" class="outline-4">
<h4 id="orga023fdf"><span class="section-number-4">19.2.1.</span> swagger offline</h4>
<div class="outline-text-4" id="text-19-2-1">
<ul class="org-ul">
<li><a href="https://github.com/swagger-api/swagger-editor">https://github.com/swagger-api/swagger-editor</a></li>
<li>index.html</li>
<li>dist/*</li>
<li><a href="https://stackoverflow.com/questions/57677424/disable-generate-server-client-inside-swagger-editor">https://stackoverflow.com/questions/57677424/disable-generate-server-client-inside-swagger-editor</a></li>
<li><a href="https://issue.life/questions/49515713">https://issue.life/questions/49515713</a></li>
<li>show only <a href="https://github.com/swagger-api/swagger-editor/issues/719">https://github.com/swagger-api/swagger-editor/issues/719</a></li>
</ul>


<p>
<b>Create spec.js file containg Swagger JSON</b>  <a href="https://stackoverflow.com/questions/30400477/how-to-open-local-files-in-swagger-ui">https://stackoverflow.com/questions/30400477/how-to-open-local-files-in-swagger-ui</a>
</p>
<div class="org-src-container">
<pre class="src src-html">
  &lt;<span style="color: #cae682; font-weight: bold;">script</span> <span style="color: #cae682;">src</span>=<span style="color: #95e454;">'spec.js'</span> <span style="color: #cae682;">type</span>=<span style="color: #95e454;">"text/javascript"</span>&gt;&lt;/<span style="color: #cae682; font-weight: bold;">script</span>&gt;
  &lt;<span style="color: #cae682; font-weight: bold;">script</span> <span style="color: #cae682;">type</span>=<span style="color: #95e454;">"text/javascript"</span>&gt;

      var url = window.location.search.match(/url=([^&amp;]+)/);
      if (url &amp;&amp; url.length &gt; 1) {
        url = decodeURIComponent(url[1]);
      } else {
        url = "http://petstore.swagger.io/v2/swagger.json";
      }

  window.onload = function() {
    // Build a system
  const editor = SwaggerEditorBundle({
     // url: url,
      spec: spec,
</pre>
</div>

<p>
<b>Hide editor</b>
</p>
<div class="org-src-container">
<pre class="src src-css"> <span style="color: #fa8072;">/**</span>

<span style="color: #99968b; font-style: italic;">    Styling for printing out of the editor</span>

<span style="color: #fa8072;"> */</span>
<span style="color: #b0c4de;">.Pane1,</span>
<span style="color: #b0c4de;">.topbar</span> {
<span style="color: #20b2aa;">display</span>: none;
}
<span style="color: #b0c4de;">.SplitPane</span> {
<span style="color: #20b2aa;">position</span>: relative <span style="color: #e5786d;">!important</span>;
<span style="color: #20b2aa;">display</span>: block <span style="color: #e5786d;">!important</span>;
}
<span style="color: #b0c4de;">.Pane2</span> {
<span style="color: #20b2aa;">overflow-y</span>: auto;
<span style="color: #20b2aa;">width</span>: 100% <span style="color: #e5786d;">!important</span>;
}

</pre>
</div>
</div>
</div>

<div id="outline-container-orgdd6d1e6" class="outline-4">
<h4 id="orgdd6d1e6"><span class="section-number-4">19.2.2.</span> Specification 2.0</h4>
<div class="outline-text-4" id="text-19-2-2">
<p>
<a href="https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md">https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md</a>
</p>
<ul class="org-ul">
<li>Field Names are case sensitive:
<ul class="org-ul">
<li>Fixed fields, which have a declared name</li>
<li>Patterned fields, which declare a regex pattern for the field name</li>
</ul></li>
<li># Comment</li>
<li>list - [] or - with \n</li>
</ul>
</div>
<ol class="org-ol">
<li><a id="org2fec221"></a>Data Types<br />
<div class="outline-text-5" id="text-19-2-2-1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">integer</td>
<td class="org-left">integer</td>
<td class="org-left">int32</td>
<td class="org-left">signed 32 bits</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">long</td>
<td class="org-left">integer</td>
<td class="org-left">int64</td>
<td class="org-left">signed 64 bits</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">float</td>
<td class="org-left">number</td>
<td class="org-left">float</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">10.1</td>
</tr>

<tr>
<td class="org-left">double</td>
<td class="org-left">number</td>
<td class="org-left">double</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">string</td>
<td class="org-left">string</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">"blabla"</td>
</tr>

<tr>
<td class="org-left">byte</td>
<td class="org-left">string</td>
<td class="org-left">byte</td>
<td class="org-left">base64 encoded characters</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">binary</td>
<td class="org-left">string</td>
<td class="org-left">binary</td>
<td class="org-left">any sequence of octets</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">boolean</td>
<td class="org-left">boolean</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">true false</td>
</tr>

<tr>
<td class="org-left">date</td>
<td class="org-left">string</td>
<td class="org-left">date</td>
<td class="org-left">As defined by full-date - RFC3339</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">dateTime</td>
<td class="org-left">string</td>
<td class="org-left">date-time</td>
<td class="org-left">As defined by date-time - RFC3339</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">password</td>
<td class="org-left">string</td>
<td class="org-left">password</td>
<td class="org-left">Used to hint UIs the input needs to be obscured.</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<p>
"file" - used by the Parameter Object and the Response Object to set the parameter type or the response as
being a file
</p>

<p>
<b>formats</b> -  to more finely define the data (accompanied by property)
</p>
<ul class="org-ul">
<li>"email", "uuid", etc.,</li>
</ul>
</div>
</li>

<li><a id="org166b82a"></a>Hierarchy<br />
<div class="outline-text-5" id="text-19-2-2-2">
<p>
Swagger Object - root. Required subobjects:
</p>
<ul class="org-ul">
<li>swagger: "2.0"</li>
<li>info
<ul class="org-ul">
<li>version: string - application API version</li>
</ul></li>
<li>paths - The available paths and operations for the API.</li>
</ul>

<p>
not required:
</p>
<ul class="org-ul">
<li>definitions Definitions Object - data types produced and consumed by operations - used by schema: \n $ref:
"#/definitions/Order"</li>
</ul>
</div>
<ol class="org-ol">
<li><a id="orgb6ce426"></a>Paths Object<br />
<div class="outline-text-6" id="text-19-2-2-2-1">
<p>
/{path} 	Path Item Object
</p>
<ul class="org-ul">
<li>get</li>
<li>put</li>
<li>post</li>
<li>delete</li>
<li>options</li>
<li>head</li>
<li>patch</li>
<li>parameters - общие для всех операций на этом Path. Могут быть overriden на уровне операции</li>
</ul>

<p>
<b>Operation Object</b>
</p>
<ul class="org-ul">
<li>tags [] - for logical grouping</li>
<li>summary - what the operation does</li>
<li>description - GFM syntax can be used for rich text representation</li>
<li>externalDocs</li>
<li>operationId: "addPet" - MUST be unique among all operations described in the API - recommended to follow common
programming naming conventions</li>
<li>consumes: - for all parameters
<ul class="org-ul">
<li>"application/json"</li>
<li>"application/xml"</li>
</ul></li>
<li>produces: - for all responses
<ul class="org-ul">
<li>"application/xml"</li>
<li>"application/json"</li>
</ul></li>
<li>parameters - [Parameter Object]</li>
<li>responses -  	Responses Object 	REQUIRED list of sub</li>
<li>schemes ["http", "https"]</li>
<li>deprecated 	boolean</li>
<li>security - [Security Requirement Object]</li>
</ul>

<p>
<b>Parameter Object</b>
parameter types:
</p>
<ul class="org-ul">
<li>/pet/{petId}: - from path petId</li>
<li>query   (/items?id=###)</li>
<li>header - Custom headers that are expected as part of the request.</li>
<li>body  - payload of an HTTP - can only be one body parameter</li>
<li>form - payload of an HTTP request when either application/x-www-form-urlencoded, multipart/form-data or both
are used as the content type - only parameter type that can be used to send files - cannot be declared
together with a body parameter</li>
</ul>

<p>
fields:
</p>
<ul class="org-ul">
<li>name string - case sensitive REQUIRED</li>
<li>in string - parameter type "query", "header", "path", "formData" or "body" REQUIRED</li>
<li>description - string</li>
<li>required boolean - for path must be true</li>
<li>schema - Schema Object - for body only</li>
</ul>
<p>
not for body:
</p>
<ul class="org-ul">
<li>type - REQUIRED - "string", "number", "integer", "boolean", "array" (or "file" for "formData")</li>
<li>format - string see Data Type Formats</li>
<li>allowEmptyValue boolean - Default false</li>
<li>items ItemsObject - Required if type is "array"</li>
<li>default any - MUST conform to type</li>
</ul>

<p>
<b>Responses Object</b>
</p>
<ul class="org-ul">
<li>status code
<ul class="org-ul">
<li>description 	string REQUIRED</li>
<li>schema</li>
<li>headers</li>
<li>examples</li>
</ul></li>
</ul>
</div>
</li>


<li><a id="org061882f"></a>Schema<br />
<div class="outline-text-6" id="text-19-2-2-2-2">
<div class="org-src-container">
<pre class="src src-yml">definitions:
  Id:
    type: "object"
    properties:
      id:
        type: "integer"
        format: "int64"
    xml:
      name: "Id"
  Exception:
    type: "object"
    properties:
      status:
        type: "string"
        example: "exception"
      description:
        type: "string"
    xml:
      name: "Exception"
</pre>
</div>
</div>
</li>
</ol>
</li>
</ol>
</div>
<div id="outline-container-orgc4facf0" class="outline-4">
<h4 id="orgc4facf0"><span class="section-number-4">19.2.3.</span> JSON Schema</h4>
<div class="outline-text-4" id="text-19-2-3">
<p>
<a href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=75977264">https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=75977264</a>
</p>
</div>
</div>
</div>
<div id="outline-container-org7c67abf" class="outline-3">
<h3 id="org7c67abf"><span class="section-number-3">19.3.</span> links</h3>
<div class="outline-text-3" id="text-19-3">
<ul class="org-ul">
<li><a href="https://stackoverflow.com/questions/36634281/list-of-swagger-ui-alternatives">https://stackoverflow.com/questions/36634281/list-of-swagger-ui-alternatives</a></li>
<li>article <a href="https://pronovix.com/blog/free-and-open-source-api-documentation-tools?platform=hootsuite">https://pronovix.com/blog/free-and-open-source-api-documentation-tools?platform=hootsuite</a></li>
</ul>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Created: 2025-01-14 Tue 13:11</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
